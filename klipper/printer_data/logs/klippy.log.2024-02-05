===== Config file =====
[virtual_sdcard]
path = /home/pi/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]
recover_velocity = 350

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	TURN_OFF_HEATERS
	G91
	G1 Z10 E-2 F3600
	G1 E-3 F3600
	G90
	G1 X30 Y250 F7000; home X axis
	M106 S80
	G4 P10000
	M106 S0
	M221 S100
	CANCEL_PRINT_BASE
	CLEAR_PAUSE
	
	SET_GCODE_OFFSET Z=0.0
	RESETSPEEDS
	M84
	
	BED_MESH_CLEAR

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	
	{% set x_park = printer.toolhead.axis_maximum.x|float - 5.0 %}
	{% set y_park = printer.toolhead.axis_maximum.y|float - 5.0 %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < (max_z - 2.0) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	
	SAVE_GCODE_STATE NAME=PAUSE_state
	BASE_PAUSE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	G91
	G1 E-{1} F2100
	G1 Z{10} F900
	G90
	G1 X{50} Y{0} F6000
variable_extrude = 1.0

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	G91
	G1 E{1} F2100
	RESTORE_GCODE_STATE NAME=PAUSE_state
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[tmc5160 extruder]
cs_pin = PA10
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 0.65
sense_resistor = 0.075
stealthchop_threshold = 0

[extruder]
rotation_distance = 5.7
full_steps_per_rotation = 200
sensor_type = PT1000
min_temp = 0
max_temp = 330
filament_diameter = 1.750
dir_pin = !PB6
step_pin = PG15
enable_pin = !PG14
heater_pin = PF6
sensor_pin = PB1
microsteps = 16
max_extrude_only_distance = 101
max_extrude_cross_section = 100
nozzle_diameter = 0.600
pressure_advance = 0.015
pressure_advance_smooth_time = 0.02
control = pid
pid_kp = 22.354
pid_ki = 1.552
pid_kd = 80.473

[tmc5160 stepper_x]
cs_pin = PD6
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
diag1_pin = PC15
run_current = 2.00
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_x]
dir_pin = !PC13
step_pin = PC14
enable_pin = !PE6
endstop_pin = PC15
microsteps = 16
rotation_distance = 40
position_endstop = -6
position_min = -6
position_max = 330
homing_speed = 20
full_steps_per_rotation = 200
homing_retract_dist = 0
homing_positive_dir = false
step_pulse_duration = 0.000001

[tmc5160 stepper_x1]
cs_pin = PD5
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2.00
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_x1]
dir_pin = !PE4
step_pin = PE5
enable_pin = !PE3
microsteps = 16
rotation_distance = 40
full_steps_per_rotation = 200
step_pulse_duration = 0.000001

[tmc5160 stepper_y]
cs_pin = PD4
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_y]
dir_pin = !PE1
step_pin = PE2
enable_pin = !PE0
endstop_pin = PF0
microsteps = 16
rotation_distance = 40
position_endstop = 0
position_min = 0
position_max = 315
homing_speed = 20
full_steps_per_rotation = 200
homing_retract_dist = 0
homing_positive_dir = false
step_pulse_duration = 0.000001

[tmc5160 stepper_y1]
cs_pin = PD3
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_y1]
dir_pin = !PB8
step_pin = PB9
enable_pin = !PB7
microsteps = 16
rotation_distance = 40
full_steps_per_rotation = 200
step_pulse_duration = 0.000001

[tmc5160 stepper_z]
cs_pin = PD2
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 1
sense_resistor = 0.075
stealthchop_threshold = 0

[stepper_z]
dir_pin = !PG10
step_pin = PG9
enable_pin = !PG13
endstop_pin = probe:z_virtual_endstop
microsteps = 16
rotation_distance = 8
position_min = -20
position_max = 400
full_steps_per_rotation = 200
homing_retract_dist = 5.0
homing_positive_dir = false
homing_speed = 3
second_homing_speed = 1
step_pulse_duration = 0.000004

[tmc5160 stepper_z1]
cs_pin = PA15
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 1
sense_resistor = 0.075
stealthchop_threshold = 0

[stepper_z1]
dir_pin = !PD7
step_pin = PG11
enable_pin = !PG12
microsteps = 16
rotation_distance = 8

[temperature_sensor Kraken]
sensor_type = temperature_mcu
min_temp = 10
max_temp = 100

[heater_fan hotend_fan]
pin = PA0
max_power = 1.0
kick_start_time = 0.5
heater = extruder
heater_temp = 50.0

[fan]
pin = PF12
enable_pin = PF7
hardware_pwm = false
max_power = 1
cycle_time = 0.00002
off_below = 0.012
kick_start_time = 0.01

[heater_bed]
heater_pin = PF5
sensor_pin = PC5
sensor_type = NTC 100K MGB18-104F39050L32
control = pid
pid_kp = 34.679
pid_ki = 1.492
pid_kd = 201.572
min_temp = 0
max_temp = 120
max_power = 1
pwm_cycle_time = 0.0166

[bed_screws]
screw1 = 10,0
screw2 = 10,260
screw3 = 320,260
screw4 = 320,0

[screws_tilt_adjust]
screw1 = 10, 0
screw1_name = front left screw
screw2 = 10, 260
screw2_name = rear left screw
screw3 = 300, 260
screw3_name = rear right screw
screw4 = 320, 0
screw4_name = front right screw
horizontal_move_z = 10.
speed = 250
screw_thread = CW-M3

[force_move]
enable_force_move = true

[bed_mesh]
speed = 200
horizontal_move_z = 1
mesh_min = 10, 22
mesh_max = 310, 260
mesh_pps = 3,3
probe_count = 25,25
algorithm = bicubic
relative_reference_index = 12
bicubic_tension = 0.2
fade_start = 1
fade_end = 10
split_delta_z = .025
move_check_distance = 5

[neopixel my_neopixel]
pin = PF11
chain_count = 13
color_order = GRB
initial_red = 1.0
initial_green = 1
initial_blue = 1

[gcode_macro BED_MESH]
gcode = 
	BED_MESH_CALIBRATE

[gcode_macro PA_TUNING]
gcode = 
	SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=1 ACCEL=500
	TUNING_TOWER COMMAND=SET_PRESSURE_ADVANCE PARAMETER=ADVANCE START=0 FACTOR=.005

[gcode_macro HOTEND_PID]
gcode = 
	{% set tool_temp = params.TEMPERATURE|default(220)|int %}
	{% set tool_name = printer.toolhead.extruder %}
	PID_CALIBRATE HEATER={tool_name} TARGET={tool_temp}

[gcode_macro BED_PID]
gcode = 
	{% set bed_temp = params.TEMPERATURE|default(60)|int %}
	PID_CALIBRATE HEATER=heater_bed TARGET={bed_temp}

[gcode_macro SCREWS_TILT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro DUMP_WARNINGS]
description = Debug: Print all warning messages from klipper
gcode = 
	{% set parameters = ["printer.configfile.warnings:"] %}
	{% for warning in printer.configfile.warnings %}
	{% set parameters = parameters.append("%s -> %s -> %s\n%s" % (warning.type, warning.section, warning.option, warning.message)) %}
	{% endfor %}
	{action_respond_info(parameters|join("\n"))}

[gcode_macro enable_stepper]
gcode = 
	SET_STEPPER_ENABLE STEPPER=stepper_x ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_x1 ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y1 ENABLE=1

[gcode_macro disable-steppers]
gcode = 
	m84

[gcode_macro M600]
gcode = 
	G4 P1500
	{% set X = params.X|default(50)|float %}
	{% set Y = params.Y|default(0)|float %}
	{% set Z = params.Z|default(10)|float %}
	
	SAVE_GCODE_STATE NAME=M600_state
	PAUSE
	
	G91
	G1 E-{1} F2100
	G1 Z{Z}
	G90
	G1 X{X} Y{Y} F4000
	G91
	M83
	G1 E5 F800
	G1 E-180 F2000
	M82
	RESTORE_GCODE_STATE NAME=M600_state

[gcode_macro PURGE]
gcode = 
	M83
	G1 E120 F250

[gcode_macro _UNLOAD_FILAMENT]
gcode = 
	{% set e_temp = params.TEMPERATURE|default(235)|int %}
	M118 Filament unloading!
	M117 Filament unloading!
	M82
	G92 E0
	{% if printer.extruder.can_extrude|lower != 'true' %}
	
	M118 Hotend heating!
	M109 S{e_temp} T0
	{% endif %}
	G1 E10 F{5*60}
	G0 E-5 F{60*60}
	G0 E-70 F{5*60}
	M400
	M118 Filament unload complete!
	M117 Filament unload complete!

[gcode_macro _LOAD_FILAMENT]
gcode = 
	{% set e_temp = params.TEMPERATURE|default(230)|int %}
	M109 S{e_temp}
	M83
	G1 E50 F300
	G1 E-1 F100
	M82
	M104 S0

[gcode_macro UNLOAD_PLA]
gcode = 
	_UNLOAD_FILAMENT TEMPERATURE=200

[gcode_macro LOAD_PLA]
gcode = 
	_LOAD_FILAMENT TEMPERATURE=200

[gcode_macro UNLOAD_ABS]
gcode = 
	_UNLOAD_FILAMENT TEMPERATURE=250

[gcode_macro LOAD_ABS]
gcode = 
	_LOAD_FILAMENT TEMPERATURE=250

[gcode_macro UNLOAD_PETG]
gcode = 
	_UNLOAD_FILAMENT TEMPERATURE=235

[gcode_macro LOAD_PETG]
gcode = 
	_LOAD_FILAMENT TEMPERATURE=235

[gcode_macro LOAD_FILAMENT]
gcode = 
	{% set speed = params.SPEED|default(300) %}
	{% set max_velocity = printer.configfile.settings['extruder'].max_extrude_only_velocity %}
	SAVE_GCODE_STATE NAME=load_state
	M300
	G91
	G92 E0
	G1 E350 F{max_velocity}
	G1 E25 F{speed}
	M300
	M300
	RESTORE_GCODE_STATE NAME=load_state

[gcode_macro UNLOAD_FILAMENT]
gcode = 
	{% set speed = params.SPEED|default(300) %}
	{% set max_velocity = printer.configfile.settings['extruder'].max_extrude_only_velocity %}
	SAVE_GCODE_STATE NAME=unload_state
	G91
	M300
	G92 E0
	G1 E25 F{speed}
	G1 E-420 F{max_velocity}
	M300
	M300
	RESTORE_GCODE_STATE NAME=unload_state

[gcode_macro START_PRINT]
gcode = 
	
	{% set DWELL = params.DWELL|default(00)|int %}
	{% set bedTemp = params.BED|default(70)|int %}
	{% set hotendTemp = params.HOTEND|default(210)|int %}
	SET_FAN_SPEED FAN=LED_Bar SPEED=0.5
	CLEAR_PAUSE
	RESETSPEEDS
	G21
	G90
	M83
	M140 S{bedTemp}; start heating the bed
	M104 S100
	SET_DISPLAY_TEXT MSG="Waiting for temperatures..."
	HEATSOAK DWELL={DWELL}
	G28 X Y
	ATTACH_PROBE_LOCK
	G28 Z
	SET_DISPLAY_TEXT MSG="Adjusting Z Tilt"
	Z_TILT_ADJUST
	G28 Z
	
	SET_DISPLAY_TEXT MSG="Calibrating Bed Mesh"
	BED_MESH_CLEAR
	BED_MESH_CALIBRATE
	BED_MESH_PROFILE LOAD=default
	SET_DISPLAY_TEXT MSG="Heating Extruder to temp"
	G1 X1 Y1 Z0.5 F9000
	M109 S{hotendTemp}; wait for extruder to heat up
	TR_UNLOAD_TOOLHEAD
	TR_HOME
	FIXED_PURGE_LINE
	M83
	SET_DISPLAY_TEXT MSG="Printing..."
	TR_SYNC_TO_EXTRUDER

[gcode_macro HEATSOAK]
gcode = 
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion..."
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 5% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 10% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 15% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 20% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 25% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 30% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 35% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 40% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 45% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 50% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 55% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 60% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 65% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 70% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 75% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 80% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 85% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 90% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 95% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Thermal expansion done"

[gcode_macro _CG28]
gcode = 
	{% if "xyz" not in printer.toolhead.homed_axes %}
	G28
	{% endif %}

[gcode_macro FIXED_PURGE_LINE]
gcode = 
	M83
	G92 E0
	G1 Z1 F3000
	G1 X1 Y80 Z0.3 E10  F1200
	G1 X1 Y120 E11  F1200
	G1 E-0.8 F1000
	G92 E0
	G1 Z1 F2000

[gcode_macro END_PRINT]
gcode = 
	TR_UNLOAD_TOOLHEAD
	
	TURN_OFF_HEATERS
	G91
	G1 Z10 E-2 F3600
	
	G90
	G1 X30 Y250 F7000; home X axis
	M106 S80
	G4 P10000
	M106 S0
	M221 S100
	CLEAR_PAUSE
	
	SET_GCODE_OFFSET Z=0.0
	RESETSPEEDS
	
	M84
	BED_MESH_CLEAR
	SET_FAN_SPEED FAN=LED_Bar SPEED=0
	TR_UNSYNC_TO_EXTRUDER
	UPDATE_GIT

[gcode_macro PARK]
description = Park the toolhead at the front and retract some filament if the nozzle is hot
gcode = 
	{% set E = params.E|default(1.7)|float %}
	
	{% set Px, Py = printer["gcode_macro _USER_VARIABLES"].park_position_xy|map('float') %}
	{% set park_lift_z = printer["gcode_macro _USER_VARIABLES"].park_lift_z %}
	
	{% set St = printer["gcode_macro _USER_VARIABLES"].travel_speed * 60 %}
	{% set Sz = printer["gcode_macro _USER_VARIABLES"].z_drop_speed * 60 %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	
	{% set z_safe = act_z + park_lift_z %}
	{% if z_safe > max_z %}
	{% set z_safe = max_z %}
	{% endif %}
	
	
	{% if printer.extruder.temperature > 185 %}
	G10
	{% endif %}
	G90
	G1 Z{z_safe} F{Sz}
	
	G0 X{Px} Y{Py} F{St}

[gcode_macro RESETSPEEDS]
gcode = 
	SET_VELOCITY_LIMIT VELOCITY={printer.configfile.settings.printer.max_velocity}
	SET_VELOCITY_LIMIT ACCEL={printer.configfile.settings.printer.max_accel}
	SET_VELOCITY_LIMIT ACCEL_TO_DECEL={printer.configfile.settings.printer.max_accel_to_decel}
	SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={printer.configfile.settings.printer.square_corner_velocity}

[gcode_macro DISABLEXYE]
gcode = 
	SET_STEPPER_ENABLE STEPPER=extruder ENABLE=0
	SET_STEPPER_ENABLE STEPPER=stepper_x ENABLE=0
	
	SET_STEPPER_ENABLE STEPPER=stepper_y ENABLE=0
	
	SET_STEPPER_ENABLE STEPPER=stepper_z ENABLE=1

[gcode_macro TEST_SPEED]
gcode = 
	
	{% set speed  = params.SPEED|default(printer.configfile.settings.printer.max_velocity)|int %}
	
	{% set iterations = params.ITERATIONS|default(5)|int %}
	
	{% set accel  = params.ACCEL|default(printer.configfile.settings.printer.max_accel)|int %}
	
	{% set bound = params.BOUND|default(20)|int %}
	
	{% set smallpatternsize = SMALLPATTERNSIZE|default(20)|int %}
	
	
	
	{% set x_min = 10 + bound %}
	{% set x_max = 300 - bound %}
	{% set y_min = 10 + bound %}
	{% set y_max = 300 - bound %}
	
	
	
	{% set x_center = (printer.toolhead.axis_minimum.x|float + printer.toolhead.axis_maximum.x|float ) / 2 %}
	{% set y_center = (printer.toolhead.axis_minimum.y|float + printer.toolhead.axis_maximum.y|float ) / 2 %}
	
	
	{% set x_center_min = x_center - (smallpatternsize/2) %}
	{% set x_center_max = x_center + (smallpatternsize/2) %}
	{% set y_center_min = y_center - (smallpatternsize/2) %}
	{% set y_center_max = y_center + (smallpatternsize/2) %}
	
	
	SAVE_GCODE_STATE NAME=TEST_SPEED
	
	
	{ action_respond_info("TEST_SPEED: starting %d iterations at speed %d, accel %d" % (iterations, speed, accel)) }
	
	
	M400
	G28
	
	{% if printer.configfile.settings.quad_gantry_level %}
	{% if printer.quad_gantry_level.applied == False %}
	QUAD_GANTRY_LEVEL
	G28 Z
	{% endif %}
	{% endif %}
	
	G90
	G1 X{printer.toolhead.axis_maximum.x-50} Y{printer.toolhead.axis_maximum.y-50} F{30*60}
	M400
	G28 X Y
	G0 X{300} Y{300} F{30*60}
	G4 P1000
	GET_POSITION
	
	
	G0 X{x_min} Y{y_min} Z{bound + 10} F{speed*60}
	
	
	SET_VELOCITY_LIMIT VELOCITY={speed} ACCEL={accel} ACCEL_TO_DECEL={accel / 2}
	
	{% for i in range(iterations) %}
	
	G0 X{x_min} Y{y_min} F{speed*60}
	G0 X{x_max} Y{y_max} F{speed*60}
	G0 X{x_min} Y{y_min} F{speed*60}
	G0 X{x_max} Y{y_min} F{speed*60}
	G0 X{x_min} Y{y_max} F{speed*60}
	G0 X{x_max} Y{y_min} F{speed*60}
	
	
	G0 X{x_min} Y{y_min} F{speed*60}
	G0 X{x_min} Y{y_max} F{speed*60}
	G0 X{x_max} Y{y_max} F{speed*60}
	G0 X{x_max} Y{y_min} F{speed*60}
	
	
	G0 X{x_center_min} Y{y_center_min} F{speed*60}
	G0 X{x_center_max} Y{y_center_max} F{speed*60}
	G0 X{x_center_min} Y{y_center_min} F{speed*60}
	G0 X{x_center_max} Y{y_center_min} F{speed*60}
	G0 X{x_center_min} Y{y_center_max} F{speed*60}
	G0 X{x_center_max} Y{y_center_min} F{speed*60}
	
	
	G0 X{x_center_min} Y{y_center_min} F{speed*60}
	G0 X{x_center_min} Y{y_center_max} F{speed*60}
	G0 X{x_center_max} Y{y_center_max} F{speed*60}
	G0 X{x_center_max} Y{y_center_min} F{speed*60}
	{% endfor %}
	
	
	SET_VELOCITY_LIMIT VELOCITY={printer.configfile.settings.printer.max_velocity} ACCEL={printer.configfile.settings.printer.max_accel} ACCEL_TO_DECEL={printer.configfile.settings.printer.max_accel_to_decel}
	
	
	M400
	G28
	
	G90
	G0 X{300} Y{300} F{30*60}
	G4 P1000
	GET_POSITION
	
	
	RESTORE_GCODE_STATE NAME=TEST_SPEED

[gcode_macro update_git]
gcode = 
	RUN_SHELL_COMMAND CMD=update_git_script

[gcode_shell_command update_git_script]
command = bash /home/pi/klipper-backup/script.sh
timeout = 90.0
verbose = True

[mcu tr]
serial = /dev/serial/by-id/usb-Klipper_stm32g0b1xx_290023000950415833323720-if00

[belay my_belay]
extruder_type = trad_rack
sensor_pin = ^tr:PB9
multiplier_high = 1.05
multiplier_low = 0.8
debug_level = 1

[trad_rack]
sync_to_extruder = true
selector_max_velocity = 400
selector_max_accel = 10000
lane_count = 4
lane_spacing = 17.26
servo_down_angle = 0
servo_up_angle = 130
toolhead_unload_speed = 20
extruder_load_speed = 2
toolhead_sense_speed = 20
selector_unload_length = 20
bowden_length = 865
extruder_load_length = 60
hotend_load_length = 20
toolhead_unload_length = 80
buffer_pull_speed = 100.0
pre_unload_gcode = 
	SAVE_GCODE_STATE NAME=PRE_UNLOAD_state
	{% if printer.virtual_sdcard.is_active %}
	{% set z_max = printer.toolhead.axis_maximum.z - printer.gcode_move.homing_origin.z %}
	{% set z_lift = printer["gcode_macro TR_Variables"].z_lift|float %}
	{% set x_park = printer["gcode_macro TR_Variables"].x_park|float %}
	{% set y_park = printer["gcode_macro TR_Variables"].y_park|float %}
	{% set do_x_park = printer["gcode_macro TR_Variables"].do_x_park %}
	{% set do_y_park = printer["gcode_macro TR_Variables"].do_y_park %}
	{% set st = printer["gcode_macro TR_Variables"].travel_speed * 60 %}
	{% set shape_tip = printer["gcode_macro TR_Variables"].shape_tip %}
	{% set use_wiper = printer["gcode_macro TR_Variables"].use_wiper %}
	{% set x = printer.gcode_move.gcode_position.x %}
	{% set y = printer.gcode_move.gcode_position.y %}
	{% set z = printer.gcode_move.gcode_position.z %}
	{% set z_park = [z + z_lift, z_max]|min %}
	
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=x VALUE={x}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=y VALUE={y}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=z VALUE={z}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=saved_pos VALUE={True}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=z_park VALUE={z_park}
	
	
	G90
	G1 Z{z_park}
	
	
	{% if use_wiper %}
	Go_To_Purge_Location
	
	
	{% else %}
	G90
	{% if do_x_park %}
	{% set x = x_park %}
	{% endif %}
	{% if do_y_park %}
	{% set y = y_park %}
	{% endif %}
	G1 X{x} Y{y} F{st}
	{% endif %}
	
	
	{% if shape_tip %}
	Shape_Tip
	{% endif %}
	{% else %}
	
	{% if use_wiper %}
	Go_To_Purge_Location
	{% endif %}
	
	
	Shape_Tip
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRE_UNLOAD_state
post_load_gcode = 
	SAVE_GCODE_STATE NAME=POST_LOAD_state
	{% set use_wiper = printer["gcode_macro TR_Variables"].use_wiper %}
	{% if printer.virtual_sdcard.is_active %}
	{% set st = printer["gcode_macro TR_Variables"].travel_speed * 60 %}
	{% set take_frame = printer["gcode_macro TR_Variables"].take_frame %}
	{% set x = printer["gcode_macro TR_Variables"].x %}
	{% set y = printer["gcode_macro TR_Variables"].y %}
	{% set z = printer["gcode_macro TR_Variables"].z %}
	{% set saved_pos = printer["gcode_macro TR_Variables"].saved_pos %}
	{% set z_park = printer["gcode_macro TR_Variables"].z_park %}
	
	
	{% if take_frame %}
	TIMELAPSE_TAKE_FRAME
	{% endif %}
	
	
	{% if use_wiper %}
	Home_and_Wipe_Nozzle
	{% endif %}
	
	
	{% if saved_pos %}
	G90
	G1 Z{z_park}
	G1 X{x} Y{y} F{st}
	G1 Z{z}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=saved_pos VALUE={False}
	{% endif %}
	
	Restore_Pressure_Advance
	{% elif use_wiper %}
	Home_and_Wipe_Nozzle
	{% endif %}
	RESTORE_GCODE_STATE NAME=POST_LOAD_state

[stepper_tr_selector]
step_pin = tr:PB15
dir_pin = !tr:PB14
enable_pin = !tr:PA8
rotation_distance = 40
microsteps = 16
full_steps_per_rotation = 400
endstop_pin = ^tr:PA3
position_min = 0.0
position_endstop = 0
position_max = 158
homing_speed = 30

[stepper_tr_fil_driver]
step_pin = tr:PD2
dir_pin = tr:PB13
enable_pin = !tr:PD1
rotation_distance = 22.67895
gear_ratio = 50:17
microsteps = 16
full_steps_per_rotation = 400
endstop_pin = ^tr:PA4
position_min = -5000
position_endstop = 0
position_max = 5000
homing_positive_dir = False

[tmc2209 stepper_tr_selector]
uart_pin = tr:PA10
interpolate = True
run_current = 1.3
sense_resistor = 0.110

[tmc2209 stepper_tr_fil_driver]
uart_pin = tr:PC7
interpolate = False
run_current = 1.3
sense_resistor = 0.110

[servo tr_servo]
pin = tr:PA0
maximum_servo_angle = 131
minimum_pulse_width = 0.000700
maximum_pulse_width = 0.002200

[gcode_macro ACTIVATE_EXTRUDER]
rename_existing = ACTIVATE_EXTRUDER.1
gcode = 
	{% set EXTRUDER = params.EXTRUDER|default('extruder')|lower|replace('extruder', '') %}
	{% if EXTRUDER == '' %}
	{% set EXTRUDER = '0' %}
	{% endif %}
	TR_LOAD_TOOLHEAD LANE={EXTRUDER}

[gcode_macro TR_Variables]
description = Variables for use with Trad Rack pre unload and post load gcode
variable_z_lift = 0.1
variable_x_park = 0.0
variable_y_park = 175.0
variable_do_x_park = False
variable_do_y_park = False
variable_travel_speed = 300
variable_shape_tip = False
variable_take_frame = False
variable_use_wiper = False
variable_x = 0
variable_y = 0
variable_z = 0
variable_saved_pos = False
variable_z_park = 0
gcode = 

[gcode_macro Shape_Tip]
description = Perform tip-shaping, retraction, and cooling moves
gcode = 
	SAVE_GCODE_STATE NAME=Shape_Tip_state
	Save_Pressure_Advance
	
	Slicer_Unload
	
	
	Restore_Pressure_Advance
	RESTORE_GCODE_STATE NAME=Shape_Tip_state

[gcode_macro Set_Slicer_Unload_Preset]
description = Apply a preset of values to use for the Slicer_Unload macro
variable_asa_ss = {
	"filament_ramming_parameters": "120 110 5.32258 5.45161 5.67742 6 6.48387 7.12903 7.90323 8.70968 9.3871 9.83871 10.0968 10.2258| 0.05 5.30967 0.45 5.50967 0.95 6.1871 1.45 7.39677 1.95 9.05484 2.45 10 2.95 10.3098 3.45 13.0839 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": True}
variable_pla_ss = {
	"filament_ramming_parameters": "130 120 2.70968 2.93548 3.32258 3.83871 4.58065 5.54839 6.51613 7.35484 7.93548 8.16129| 0.05 2.66451 0.45 3.05805 0.95 4.05807 1.45 5.97742 1.95 7.69999 2.45 8.1936 2.95 11.342 3.45 11.4065 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": True}
variable_asa_ps = {
	"filament_ramming_parameters": "120 110 5.32258 5.45161 5.67742 6 6.48387 7.12903 7.90323 8.70968 9.3871 9.83871 10.0968 10.2258| 0.05 5.30967 0.45 5.50967 0.95 6.1871 1.45 7.39677 1.95 9.05484 2.45 10 2.95 10.3098 3.45 13.0839 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": False}
variable_pla_ps = {
	"filament_ramming_parameters": "130 120 2.70968 2.93548 3.32258 3.83871 4.58065 5.54839 6.51613 7.35484 7.93548 8.16129| 0.05 2.66451 0.45 3.05805 0.95 4.05807 1.45 5.97742 1.95 7.69999 2.45 8.1936 2.95 11.342 3.45 11.4065 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": False}
gcode = 
	{% set preset_name = params.PRESET|lower %}
	{% if preset_name in printer['gcode_macro Set_Slicer_Unload_Preset'] %}
	{% set preset = printer['gcode_macro Set_Slicer_Unload_Preset'].preset_name %}
	{% for key in preset %}
	SET_GCODE_VARIABLE MACRO=Slicer_Unload VARIABLE={key} VALUE={preset[key]}
	{% endfor %}
	{% else %}
	{ action_raise_error("Preset \"%s\" does not exist" % preset_name) }
	{% endif %}

[gcode_macro Slicer_Unload]
description = Mimic ramming and unload behavior of PrusaSlicer or SuperSlicer
variable_cooling_tube_length = 14
variable_cooling_tube_retraction = 30
variable_filament_cooling_final_speed = 30
variable_filament_cooling_initial_speed = 20
variable_filament_cooling_moves = 4
variable_filament_diameter = 1.75
variable_filament_unloading_speed = 90
variable_filament_unloading_speed_start = 100
variable_filament_toolchange_delay = 0
variable_filament_ramming_parameters = "120 110 5.32258 5.45161 5.67742 6 6.48387 7.12903 7.90323 8.70968 9.3871 9.83871 10.0968 10.2258| 0.05 5.30967 0.45 5.50967 0.95 6.1871 1.45 7.39677 1.95 9.05484 2.45 10 2.95 10.3098 3.45 13.0839 3.95 7.6 4.45 7.6 4.95 7.6"
variable_filament_enable_toolchange_temp = False
variable_filament_toolchange_temp = 200
variable_filament_use_fast_skinnydip = False
variable_filament_enable_toolchange_part_fan = False
variable_filament_toolchange_part_fan_speed = 50
variable_filament_use_skinnydip = True
variable_filament_skinnydip_distance = 24
variable_filament_melt_zone_pause = 0
variable_filament_cooling_zone_pause = 0
variable_filament_dip_insertion_speed = 33
variable_filament_dip_extraction_speed = 70
variable_superslicer = False
variable_do_ramming = False
variable_do_unload = True
gcode = 
	{% set NEW_TEMPERATURE = params.NEW_TEMPERATURE|default(0)|float %}
	{% set prev_temp_target = printer.extruder.target %}
	
	SAVE_GCODE_STATE NAME=Slicer_Unload_state
	Save_Pressure_Advance
	
	M83
	M220 S100
	SET_PRESSURE_ADVANCE ADVANCE=0
	
	
	{% if do_ramming %}
	
	{% set ramming_speed = (filament_ramming_parameters.split('|')[0]).split(' ') %}
	
	
	{% set filament_area = 3.1415 * (filament_diameter / 2) ** 2 %}
	
	
	{% for i in range(2, ramming_speed|length) %}
	
	{% set f = ramming_speed[i]|float / filament_area %}
	
	
	{% set e = f * 0.25 %}
	
	
	G1 E{e} F{f * 60}
	{% endfor %}
	{% endif %}
	
	
	{% if do_unload %}
	
	{% if superslicer and filament_enable_toolchange_temp and not filament_use_fast_skinnydip %}
	_Wait_for_Toolchange_Temp
	{% endif %}
	
	
	{% set total_retraction_distance = cooling_tube_retraction + cooling_tube_length / 2 - 15 %}
	G1 E-15 F{filament_unloading_speed_start * 60}
	G1 E-{0.70 * total_retraction_distance} F{1.0 * filament_unloading_speed * 60}
	G1 E-{0.20 * total_retraction_distance} F{0.5 * filament_unloading_speed * 60}
	G1 E-{0.10 * total_retraction_distance} F{0.3 * filament_unloading_speed * 60}
	
	
	{% if not superslicer or not filament_enable_toolchange_temp %}
	{% if NEW_TEMPERATURE != 0 and (NEW_TEMPERATURE != prev_temp_target) %}
	M104 S{NEW_TEMPERATURE}
	{% endif %}
	
	
	{% elif superslicer and filament_enable_toolchange_temp and not filament_use_fast_skinnydip %}
	{% if NEW_TEMPERATURE != 0 %}
	M104 S{NEW_TEMPERATURE}
	{% else %}
	M104 S{prev_temp_target}
	{% endif %}
	{% endif %}
	
	
	{% set speed_inc = (filament_cooling_final_speed - filament_cooling_initial_speed) / (2 * filament_cooling_moves - 1) %}
	{% for i in range(filament_cooling_moves) %}
	{% set speed = filament_cooling_initial_speed + speed_inc * 2 * i %}
	G1 E{cooling_tube_length} F{speed * 60}
	{% set speed = speed + speed_inc %}
	G1 E-{cooling_tube_length} F{speed * 60}
	{% endfor %}
	
	
	{% if superslicer %}
	
	{% if filament_enable_toolchange_temp and filament_use_fast_skinnydip %}
	_Wait_for_Toolchange_Temp
	{% endif %}
	
	
	{% if filament_use_skinnydip %}
	G1 E{filament_skinnydip_distance} F{filament_dip_insertion_speed * 60}
	G4 P{filament_melt_zone_pause}
	G1 E-{filament_skinnydip_distance} F{filament_dip_extraction_speed * 60}
	G4 P{filament_cooling_zone_pause}
	{% endif %}
	
	
	{% if filament_enable_toolchange_temp and filament_use_fast_skinnydip %}
	{% if NEW_TEMPERATURE != 0 %}
	M109 S{NEW_TEMPERATURE}
	{% else %}
	M109 S{prev_temp_target}
	{% endif %}
	{% elif filament_enable_toolchange_temp and filament_use_fast_skinnydip %}
	{% if NEW_TEMPERATURE != 0 and (NEW_TEMPERATURE != prev_temp_target) %}
	M109 S{NEW_TEMPERATURE}
	{% endif %}
	{% endif %}
	{% endif %}
	
	
	G4 P{filament_toolchange_delay}
	
	
	
	{% endif %}
	
	Restore_Pressure_Advance
	RESTORE_GCODE_STATE NAME=Slicer_Unload_state

[gcode_macro _Wait_for_Toolchange_Temp]
description = Helper function for Slicer_Unload
gcode = 
	{% set tc_temp = printer["gcode_macro Slicer_Unload"].filament_toolchange_temp %}
	{% set fan_on = printer["gcode_macro Slicer_Unload"].filament_enable_toolchange_part_fan %}
	{% set fan_speed = printer["gcode_macro Slicer_Unload"].filament_toolchange_part_fan_speed %}
	
	{% set prev_fan_speed = printer.fan.speed %}
	{% if fan_on %}
	M106 S{(fan_speed / 100.0 * 255)|int}
	{% endif %}
	M109 S{filament_toolchange_temp}
	{% if fan_on %}
	M106 S{(prev_fan_speed * 255)|int}
	{% endif %}

[gcode_macro Home_and_Wipe_Nozzle]
description = Home x and y if needed, then wipe the nozzle
gcode = 
	
	{% if not 'xy' in printer.toolhead.homed_axes %}
	G28 X Y
	{% endif %}
	
	
	Wipe_Nozzle

[gcode_macro Save_Pressure_Advance]
description = Save the current pressure advance value
variable_pa = -1
gcode = 
	
	{% set pa = printer.extruder.pressure_advance %}
	{% if pa > 0 %}
	SET_GCODE_VARIABLE MACRO=Save_Pressure_Advance VARIABLE=pa VALUE={pa}
	{% endif %}

[gcode_macro Restore_Pressure_Advance]
description = Restore saved pressure advance value
gcode = 
	
	{% if not (printer["gcode_macro Save_Pressure_Advance"].pa == -1) %}
	SET_PRESSURE_ADVANCE ADVANCE={printer["gcode_macro Save_Pressure_Advance"].pa}
	{% endif %}

[safe_z_home]
home_xy_position = 165, 165
z_hop = 10

[z_tilt]
z_positions = 
	-80,  -20
	350, -20
points = 
	15, 150
	275, 150
speed = 50
horizontal_move_z = 10
retries = 30
retry_tolerance = 0.1

[input_shaper]
shaper_type_x = zv
shaper_freq_x = 120.6
shaper_type_y = zv
shaper_freq_y = 76.6

[cartographer]
serial = /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00
speed = 40.
lift_speed = 5.
backlash_comp = 0.5
x_offset = 0.
y_offset = 21.1
trigger_distance = 2.
trigger_dive_threshold = 1.5
trigger_hysteresis = 0.006
cal_nozzle_z = 0.1
cal_floor = 0.1
cal_ceil = 5.
cal_speed = 1.0
cal_move_speed = 10.
default_model_name = default
mesh_main_direction = x
mesh_cluster_size = 1
mesh_runs = 2

[lis2dw]
cs_pin = cartographer:PA3
spi_bus = spi1

[resonance_tester]
accel_chip = lis2dw
probe_points = 
	125, 125, 20

[printer]
kinematics = corexy
max_velocity = 3000
max_accel = 20000
max_z_velocity = 20
max_z_accel = 15
square_corner_velocity = 10

[exclude_object]

[gcode_arcs]
resolution = 0.05

[idle_timeout]
gcode = 
	{% if not printer.pause_resume.is_paused %}
	TURN_OFF_HEATERS
	M84
	{% endif %}

[save_variables]
filename = vars.cfg

[mcu]
serial = /dev/serial/by-id/usb-Klipper_stm32h723xx_4C0023001551313338343730-if00

[bed_mesh default]
version = 1
points = 
	-0.215000, -0.210000, -0.190000, -0.185000, -0.170000, -0.145000, -0.135000, -0.120000, -0.105000, -0.070000, -0.055000, -0.035000, 0.000000, 0.010000, 0.025000, 0.050000, 0.080000, 0.105000, 0.130000, 0.135000, 0.150000, 0.155000, 0.165000, 0.190000, 0.205000
	-0.160000, -0.155000, -0.160000, -0.150000, -0.130000, -0.110000, -0.105000, -0.085000, -0.055000, -0.035000, -0.025000, 0.000000, 0.025000, 0.055000, 0.075000, 0.100000, 0.110000, 0.130000, 0.160000, 0.170000, 0.190000, 0.190000, 0.205000, 0.205000, 0.220000
	-0.160000, -0.150000, -0.140000, -0.135000, -0.115000, -0.105000, -0.090000, -0.070000, -0.040000, -0.025000, -0.010000, 0.015000, 0.030000, 0.045000, 0.080000, 0.100000, 0.115000, 0.135000, 0.160000, 0.165000, 0.180000, 0.185000, 0.190000, 0.220000, 0.235000
	-0.120000, -0.115000, -0.115000, -0.100000, -0.080000, -0.070000, -0.065000, -0.040000, -0.015000, 0.010000, 0.030000, 0.050000, 0.065000, 0.090000, 0.110000, 0.130000, 0.145000, 0.175000, 0.195000, 0.195000, 0.195000, 0.205000, 0.210000, 0.235000, 0.240000
	-0.075000, -0.065000, -0.055000, -0.045000, -0.040000, -0.020000, -0.005000, 0.015000, 0.035000, 0.065000, 0.075000, 0.090000, 0.105000, 0.115000, 0.140000, 0.170000, 0.175000, 0.190000, 0.205000, 0.205000, 0.205000, 0.210000, 0.215000, 0.240000, 0.240000
	-0.045000, -0.050000, -0.055000, -0.045000, -0.015000, -0.005000, -0.005000, 0.020000, 0.060000, 0.065000, 0.075000, 0.100000, 0.115000, 0.125000, 0.135000, 0.170000, 0.175000, 0.175000, 0.205000, 0.205000, 0.205000, 0.205000, 0.210000, 0.220000, 0.225000
	-0.035000, -0.030000, -0.030000, -0.020000, 0.000000, 0.015000, 0.015000, 0.035000, 0.065000, 0.085000, 0.100000, 0.110000, 0.115000, 0.130000, 0.160000, 0.170000, 0.180000, 0.180000, 0.200000, 0.200000, 0.200000, 0.205000, 0.205000, 0.220000, 0.235000
	0.005000, 0.010000, 0.015000, 0.025000, 0.035000, 0.040000, 0.055000, 0.085000, 0.095000, 0.110000, 0.115000, 0.125000, 0.140000, 0.160000, 0.175000, 0.180000, 0.190000, 0.190000, 0.225000, 0.225000, 0.225000, 0.225000, 0.230000, 0.235000, 0.250000
	0.055000, 0.065000, 0.060000, 0.065000, 0.075000, 0.090000, 0.100000, 0.110000, 0.120000, 0.130000, 0.140000, 0.155000, 0.170000, 0.180000, 0.190000, 0.195000, 0.210000, 0.220000, 0.235000, 0.235000, 0.235000, 0.235000, 0.245000, 0.250000, 0.260000
	0.100000, 0.105000, 0.110000, 0.110000, 0.120000, 0.135000, 0.145000, 0.150000, 0.155000, 0.155000, 0.170000, 0.185000, 0.190000, 0.195000, 0.195000, 0.215000, 0.230000, 0.235000, 0.245000, 0.245000, 0.245000, 0.235000, 0.245000, 0.250000, 0.260000
	0.100000, 0.115000, 0.125000, 0.130000, 0.135000, 0.145000, 0.150000, 0.155000, 0.165000, 0.175000, 0.190000, 0.200000, 0.205000, 0.205000, 0.215000, 0.225000, 0.230000, 0.245000, 0.255000, 0.240000, 0.240000, 0.240000, 0.245000, 0.250000, 0.250000
	0.155000, 0.150000, 0.150000, 0.150000, 0.160000, 0.165000, 0.165000, 0.175000, 0.175000, 0.195000, 0.200000, 0.215000, 0.205000, 0.210000, 0.215000, 0.225000, 0.235000, 0.240000, 0.245000, 0.240000, 0.240000, 0.235000, 0.220000, 0.235000, 0.240000
	0.170000, 0.165000, 0.165000, 0.170000, 0.180000, 0.190000, 0.190000, 0.185000, 0.200000, 0.205000, 0.220000, 0.230000, 0.225000, 0.225000, 0.240000, 0.245000, 0.240000, 0.250000, 0.255000, 0.245000, 0.250000, 0.245000, 0.245000, 0.240000, 0.240000
	0.210000, 0.200000, 0.195000, 0.200000, 0.210000, 0.210000, 0.210000, 0.215000, 0.215000, 0.215000, 0.235000, 0.245000, 0.235000, 0.235000, 0.245000, 0.250000, 0.240000, 0.250000, 0.250000, 0.250000, 0.255000, 0.250000, 0.235000, 0.235000, 0.240000
	0.240000, 0.250000, 0.250000, 0.245000, 0.260000, 0.260000, 0.255000, 0.255000, 0.255000, 0.250000, 0.265000, 0.265000, 0.260000, 0.255000, 0.260000, 0.255000, 0.255000, 0.270000, 0.260000, 0.255000, 0.250000, 0.255000, 0.245000, 0.250000, 0.240000
	0.270000, 0.260000, 0.255000, 0.265000, 0.265000, 0.265000, 0.265000, 0.260000, 0.260000, 0.255000, 0.265000, 0.265000, 0.265000, 0.255000, 0.255000, 0.250000, 0.255000, 0.250000, 0.250000, 0.245000, 0.245000, 0.235000, 0.230000, 0.235000, 0.240000
	0.275000, 0.280000, 0.275000, 0.275000, 0.275000, 0.275000, 0.275000, 0.275000, 0.280000, 0.280000, 0.280000, 0.270000, 0.270000, 0.270000, 0.265000, 0.265000, 0.265000, 0.270000, 0.260000, 0.255000, 0.235000, 0.235000, 0.235000, 0.240000, 0.235000
	0.335000, 0.315000, 0.305000, 0.310000, 0.305000, 0.300000, 0.295000, 0.290000, 0.300000, 0.295000, 0.290000, 0.290000, 0.280000, 0.270000, 0.270000, 0.275000, 0.275000, 0.265000, 0.250000, 0.245000, 0.235000, 0.225000, 0.225000, 0.230000, 0.235000
	0.355000, 0.350000, 0.345000, 0.325000, 0.330000, 0.325000, 0.325000, 0.325000, 0.315000, 0.310000, 0.300000, 0.290000, 0.285000, 0.290000, 0.275000, 0.275000, 0.265000, 0.265000, 0.250000, 0.245000, 0.235000, 0.225000, 0.230000, 0.225000, 0.215000
	0.395000, 0.385000, 0.380000, 0.370000, 0.365000, 0.370000, 0.360000, 0.355000, 0.345000, 0.340000, 0.330000, 0.320000, 0.310000, 0.305000, 0.300000, 0.290000, 0.275000, 0.260000, 0.255000, 0.255000, 0.250000, 0.235000, 0.230000, 0.230000, 0.230000
	0.395000, 0.390000, 0.375000, 0.375000, 0.375000, 0.370000, 0.365000, 0.360000, 0.355000, 0.335000, 0.325000, 0.315000, 0.315000, 0.300000, 0.295000, 0.280000, 0.255000, 0.260000, 0.250000, 0.240000, 0.230000, 0.235000, 0.230000, 0.205000, 0.195000
	0.405000, 0.395000, 0.395000, 0.390000, 0.380000, 0.375000, 0.370000, 0.360000, 0.355000, 0.345000, 0.325000, 0.325000, 0.310000, 0.295000, 0.290000, 0.270000, 0.250000, 0.240000, 0.235000, 0.235000, 0.230000, 0.205000, 0.195000, 0.195000, 0.195000
	0.405000, 0.395000, 0.380000, 0.375000, 0.375000, 0.370000, 0.360000, 0.345000, 0.340000, 0.330000, 0.305000, 0.300000, 0.285000, 0.270000, 0.250000, 0.235000, 0.220000, 0.215000, 0.220000, 0.205000, 0.195000, 0.175000, 0.175000, 0.170000, 0.165000
	0.405000, 0.390000, 0.395000, 0.385000, 0.365000, 0.350000, 0.345000, 0.330000, 0.320000, 0.305000, 0.290000, 0.265000, 0.260000, 0.240000, 0.225000, 0.215000, 0.205000, 0.190000, 0.180000, 0.185000, 0.165000, 0.150000, 0.145000, 0.145000, 0.145000
	0.430000, 0.425000, 0.400000, 0.395000, 0.385000, 0.370000, 0.365000, 0.340000, 0.320000, 0.305000, 0.295000, 0.270000, 0.250000, 0.235000, 0.215000, 0.215000, 0.200000, 0.190000, 0.185000, 0.165000, 0.155000, 0.145000, 0.135000, 0.130000, 0.135000
x_count = 25
y_count = 25
mesh_x_pps = 3
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 310.0
min_y = 26.43
max_y = 281.31
=======================
Args: ['/home/pi/klipper/klippy/klippy.py', '/home/pi/printer_data/config/printer.cfg', '-I', '/home/pi/printer_data/comms/klippy.serial', '-l', '/home/pi/printer_data/logs/klippy.log', '-a', '/home/pi/printer_data/comms/klippy.sock']
Git version: 'v0.12.0-102-g9f41f53c-dirty'
Untracked files: klippy/extras/belay.py, klippy/extras/gcode_shell_command.py, klippy/extras/trad_rack.py, klippy/extras/cartographer.py, klippy/extras/idm.py
Branch: master
Remote: origin
Tracked URL: https://github.com/Klipper3d/klipper
CPU: 4 core ?
Python: '3.11.2 (main, Mar 13 2023, 12:18:29) [GCC 12.2.0]'
webhooks client 140734118097616: {'program': 'Moonraker', 'version': 'v0.8.0-308-g71b46cc'}
=============== Log rollover at Mon Feb  5 14:48:53 2024 ===============
Attempting MCU 'mcu' reset command
b'Got EOF when reading from device'
Attempting MCU 'tr' reset command
b'Got EOF when reading from device'
Attempting MCU 'cartographer' reset
Unhandled exception during post run
Traceback (most recent call last):
  File "/home/pi/klippy-env/lib/python3.11/site-packages/serial/serialposix.py", line 265, in open
    self.fd = os.open(self.portstr, os.O_RDWR | os.O_NOCTTY | os.O_NONBLOCK)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
FileNotFoundError: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/pi/klipper/klippy/klippy.py", line 234, in run
    self.send_event("klippy:firmware_restart")
  File "/home/pi/klipper/klippy/klippy.py", line 263, in send_event
    return [cb(*params) for cb in self.event_handlers.get(event, [])]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/klippy.py", line 263, in <listcomp>
    return [cb(*params) for cb in self.event_handlers.get(event, [])]
            ^^^^^^^^^^^
  File "/home/pi/klipper/klippy/mcu.py", line 915, in _firmware_restart
    self._restart_arduino()
  File "/home/pi/klipper/klippy/mcu.py", line 875, in _restart_arduino
    serialhdl.arduino_reset(self._serialport, self._reactor)
  File "/home/pi/klipper/klippy/serialhdl.py", line 379, in arduino_reset
    ser = serial.Serial(serialport, 2400, timeout=0, exclusive=True)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klippy-env/lib/python3.11/site-packages/serial/serialutil.py", line 240, in __init__
    self.open()
  File "/home/pi/klippy-env/lib/python3.11/site-packages/serial/serialposix.py", line 268, in open
    raise SerialException(msg.errno, "could not open port {}: {}".format(self._port, msg))
serial.serialutil.SerialException: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
Restarting printer
Start printer at Mon Feb  5 14:48:54 2024 (1707144534.5 90450.3)
===== Config file =====
[virtual_sdcard]
path = /home/pi/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]
recover_velocity = 350

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	TURN_OFF_HEATERS
	G91
	G1 Z10 E-2 F3600
	G1 E-3 F3600
	G90
	G1 X30 Y250 F7000; home X axis
	M106 S80
	G4 P10000
	M106 S0
	M221 S100
	CANCEL_PRINT_BASE
	CLEAR_PAUSE
	
	SET_GCODE_OFFSET Z=0.0
	RESETSPEEDS
	M84
	
	BED_MESH_CLEAR

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	
	{% set x_park = printer.toolhead.axis_maximum.x|float - 5.0 %}
	{% set y_park = printer.toolhead.axis_maximum.y|float - 5.0 %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < (max_z - 2.0) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	
	SAVE_GCODE_STATE NAME=PAUSE_state
	BASE_PAUSE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	G91
	G1 E-{1} F2100
	G1 Z{10} F900
	G90
	G1 X{50} Y{0} F6000
variable_extrude = 1.0

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	G91
	G1 E{1} F2100
	RESTORE_GCODE_STATE NAME=PAUSE_state
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[tmc5160 extruder]
cs_pin = PA10
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 0.65
sense_resistor = 0.075
stealthchop_threshold = 0

[extruder]
rotation_distance = 5.7
full_steps_per_rotation = 200
sensor_type = PT1000
min_temp = 0
max_temp = 330
filament_diameter = 1.750
dir_pin = !PB6
step_pin = PG15
enable_pin = !PG14
heater_pin = PF6
sensor_pin = PB1
microsteps = 16
max_extrude_only_distance = 101
max_extrude_cross_section = 100
nozzle_diameter = 0.600
pressure_advance = 0.015
pressure_advance_smooth_time = 0.02
control = pid
pid_kp = 22.354
pid_ki = 1.552
pid_kd = 80.473

[tmc5160 stepper_x]
cs_pin = PD6
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
diag1_pin = PC15
run_current = 2.00
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_x]
dir_pin = !PC13
step_pin = PC14
enable_pin = !PE6
endstop_pin = PC15
microsteps = 16
rotation_distance = 40
position_endstop = -6
position_min = -6
position_max = 330
homing_speed = 20
full_steps_per_rotation = 200
homing_retract_dist = 0
homing_positive_dir = false
step_pulse_duration = 0.000001

[tmc5160 stepper_x1]
cs_pin = PD5
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2.00
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_x1]
dir_pin = !PE4
step_pin = PE5
enable_pin = !PE3
microsteps = 16
rotation_distance = 40
full_steps_per_rotation = 200
step_pulse_duration = 0.000001

[tmc5160 stepper_y]
cs_pin = PD4
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_y]
dir_pin = !PE1
step_pin = PE2
enable_pin = !PE0
endstop_pin = PF0
microsteps = 16
rotation_distance = 40
position_endstop = 0
position_min = 0
position_max = 315
homing_speed = 20
full_steps_per_rotation = 200
homing_retract_dist = 0
homing_positive_dir = false
step_pulse_duration = 0.000001

[tmc5160 stepper_y1]
cs_pin = PD3
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_y1]
dir_pin = !PB8
step_pin = PB9
enable_pin = !PB7
microsteps = 16
rotation_distance = 40
full_steps_per_rotation = 200
step_pulse_duration = 0.000001

[tmc5160 stepper_z]
cs_pin = PD2
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 1
sense_resistor = 0.075
stealthchop_threshold = 0

[stepper_z]
dir_pin = !PG10
step_pin = PG9
enable_pin = !PG13
endstop_pin = probe:z_virtual_endstop
microsteps = 16
rotation_distance = 8
position_min = -20
position_max = 400
full_steps_per_rotation = 200
homing_retract_dist = 5.0
homing_positive_dir = false
homing_speed = 3
second_homing_speed = 1
step_pulse_duration = 0.000004

[tmc5160 stepper_z1]
cs_pin = PA15
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 1
sense_resistor = 0.075
stealthchop_threshold = 0

[stepper_z1]
dir_pin = !PD7
step_pin = PG11
enable_pin = !PG12
microsteps = 16
rotation_distance = 8

[temperature_sensor Kraken]
sensor_type = temperature_mcu
min_temp = 10
max_temp = 100

[heater_fan hotend_fan]
pin = PA0
max_power = 1.0
kick_start_time = 0.5
heater = extruder
heater_temp = 50.0

[fan]
pin = PF12
enable_pin = PF7
hardware_pwm = false
max_power = 1
cycle_time = 0.00002
off_below = 0.012
kick_start_time = 0.01

[heater_bed]
heater_pin = PF5
sensor_pin = PC5
sensor_type = NTC 100K MGB18-104F39050L32
control = pid
pid_kp = 34.679
pid_ki = 1.492
pid_kd = 201.572
min_temp = 0
max_temp = 120
max_power = 1
pwm_cycle_time = 0.0166

[bed_screws]
screw1 = 10,0
screw2 = 10,260
screw3 = 320,260
screw4 = 320,0

[screws_tilt_adjust]
screw1 = 10, 0
screw1_name = front left screw
screw2 = 10, 260
screw2_name = rear left screw
screw3 = 300, 260
screw3_name = rear right screw
screw4 = 320, 0
screw4_name = front right screw
horizontal_move_z = 10.
speed = 250
screw_thread = CW-M3

[force_move]
enable_force_move = true

[bed_mesh]
speed = 200
horizontal_move_z = 1
mesh_min = 10, 22
mesh_max = 310, 260
mesh_pps = 3,3
probe_count = 25,25
algorithm = bicubic
relative_reference_index = 12
bicubic_tension = 0.2
fade_start = 1
fade_end = 10
split_delta_z = .025
move_check_distance = 5

[neopixel my_neopixel]
pin = PF11
chain_count = 13
color_order = GRB
initial_red = 1.0
initial_green = 1
initial_blue = 1

[gcode_macro BED_MESH]
gcode = 
	BED_MESH_CALIBRATE

[gcode_macro PA_TUNING]
gcode = 
	SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=1 ACCEL=500
	TUNING_TOWER COMMAND=SET_PRESSURE_ADVANCE PARAMETER=ADVANCE START=0 FACTOR=.005

[gcode_macro HOTEND_PID]
gcode = 
	{% set tool_temp = params.TEMPERATURE|default(220)|int %}
	{% set tool_name = printer.toolhead.extruder %}
	PID_CALIBRATE HEATER={tool_name} TARGET={tool_temp}

[gcode_macro BED_PID]
gcode = 
	{% set bed_temp = params.TEMPERATURE|default(60)|int %}
	PID_CALIBRATE HEATER=heater_bed TARGET={bed_temp}

[gcode_macro SCREWS_TILT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro DUMP_WARNINGS]
description = Debug: Print all warning messages from klipper
gcode = 
	{% set parameters = ["printer.configfile.warnings:"] %}
	{% for warning in printer.configfile.warnings %}
	{% set parameters = parameters.append("%s -> %s -> %s\n%s" % (warning.type, warning.section, warning.option, warning.message)) %}
	{% endfor %}
	{action_respond_info(parameters|join("\n"))}

[gcode_macro enable_stepper]
gcode = 
	SET_STEPPER_ENABLE STEPPER=stepper_x ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_x1 ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y1 ENABLE=1

[gcode_macro disable-steppers]
gcode = 
	m84

[gcode_macro M600]
gcode = 
	G4 P1500
	{% set X = params.X|default(50)|float %}
	{% set Y = params.Y|default(0)|float %}
	{% set Z = params.Z|default(10)|float %}
	
	SAVE_GCODE_STATE NAME=M600_state
	PAUSE
	
	G91
	G1 E-{1} F2100
	G1 Z{Z}
	G90
	G1 X{X} Y{Y} F4000
	G91
	M83
	G1 E5 F800
	G1 E-180 F2000
	M82
	RESTORE_GCODE_STATE NAME=M600_state

[gcode_macro PURGE]
gcode = 
	M83
	G1 E120 F250

[gcode_macro _UNLOAD_FILAMENT]
gcode = 
	{% set e_temp = params.TEMPERATURE|default(235)|int %}
	M118 Filament unloading!
	M117 Filament unloading!
	M82
	G92 E0
	{% if printer.extruder.can_extrude|lower != 'true' %}
	
	M118 Hotend heating!
	M109 S{e_temp} T0
	{% endif %}
	G1 E10 F{5*60}
	G0 E-5 F{60*60}
	G0 E-70 F{5*60}
	M400
	M118 Filament unload complete!
	M117 Filament unload complete!

[gcode_macro _LOAD_FILAMENT]
gcode = 
	{% set e_temp = params.TEMPERATURE|default(230)|int %}
	M109 S{e_temp}
	M83
	G1 E50 F300
	G1 E-1 F100
	M82
	M104 S0

[gcode_macro UNLOAD_PLA]
gcode = 
	_UNLOAD_FILAMENT TEMPERATURE=200

[gcode_macro LOAD_PLA]
gcode = 
	_LOAD_FILAMENT TEMPERATURE=200

[gcode_macro UNLOAD_ABS]
gcode = 
	_UNLOAD_FILAMENT TEMPERATURE=250

[gcode_macro LOAD_ABS]
gcode = 
	_LOAD_FILAMENT TEMPERATURE=250

[gcode_macro UNLOAD_PETG]
gcode = 
	_UNLOAD_FILAMENT TEMPERATURE=235

[gcode_macro LOAD_PETG]
gcode = 
	_LOAD_FILAMENT TEMPERATURE=235

[gcode_macro LOAD_FILAMENT]
gcode = 
	{% set speed = params.SPEED|default(300) %}
	{% set max_velocity = printer.configfile.settings['extruder'].max_extrude_only_velocity %}
	SAVE_GCODE_STATE NAME=load_state
	M300
	G91
	G92 E0
	G1 E350 F{max_velocity}
	G1 E25 F{speed}
	M300
	M300
	RESTORE_GCODE_STATE NAME=load_state

[gcode_macro UNLOAD_FILAMENT]
gcode = 
	{% set speed = params.SPEED|default(300) %}
	{% set max_velocity = printer.configfile.settings['extruder'].max_extrude_only_velocity %}
	SAVE_GCODE_STATE NAME=unload_state
	G91
	M300
	G92 E0
	G1 E25 F{speed}
	G1 E-420 F{max_velocity}
	M300
	M300
	RESTORE_GCODE_STATE NAME=unload_state

[gcode_macro START_PRINT]
gcode = 
	
	{% set DWELL = params.DWELL|default(00)|int %}
	{% set bedTemp = params.BED|default(70)|int %}
	{% set hotendTemp = params.HOTEND|default(210)|int %}
	SET_FAN_SPEED FAN=LED_Bar SPEED=0.5
	CLEAR_PAUSE
	RESETSPEEDS
	G21
	G90
	M83
	M140 S{bedTemp}; start heating the bed
	M104 S100
	SET_DISPLAY_TEXT MSG="Waiting for temperatures..."
	HEATSOAK DWELL={DWELL}
	G28 X Y
	ATTACH_PROBE_LOCK
	G28 Z
	SET_DISPLAY_TEXT MSG="Adjusting Z Tilt"
	Z_TILT_ADJUST
	G28 Z
	
	SET_DISPLAY_TEXT MSG="Calibrating Bed Mesh"
	BED_MESH_CLEAR
	BED_MESH_CALIBRATE
	BED_MESH_PROFILE LOAD=default
	SET_DISPLAY_TEXT MSG="Heating Extruder to temp"
	G1 X1 Y1 Z0.5 F9000
	M109 S{hotendTemp}; wait for extruder to heat up
	TR_UNLOAD_TOOLHEAD
	TR_HOME
	FIXED_PURGE_LINE
	M83
	SET_DISPLAY_TEXT MSG="Printing..."
	TR_SYNC_TO_EXTRUDER

[gcode_macro HEATSOAK]
gcode = 
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion..."
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 5% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 10% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 15% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 20% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 25% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 30% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 35% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 40% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 45% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 50% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 55% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 60% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 65% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 70% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 75% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 80% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 85% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 90% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 95% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Thermal expansion done"

[gcode_macro _CG28]
gcode = 
	{% if "xyz" not in printer.toolhead.homed_axes %}
	G28
	{% endif %}

[gcode_macro FIXED_PURGE_LINE]
gcode = 
	M83
	G92 E0
	G1 Z1 F3000
	G1 X1 Y80 Z0.3 E10  F1200
	G1 X1 Y120 E11  F1200
	G1 E-0.8 F1000
	G92 E0
	G1 Z1 F2000

[gcode_macro END_PRINT]
gcode = 
	TR_UNLOAD_TOOLHEAD
	
	TURN_OFF_HEATERS
	G91
	G1 Z10 E-2 F3600
	
	G90
	G1 X30 Y250 F7000; home X axis
	M106 S80
	G4 P10000
	M106 S0
	M221 S100
	CLEAR_PAUSE
	
	SET_GCODE_OFFSET Z=0.0
	RESETSPEEDS
	
	M84
	BED_MESH_CLEAR
	SET_FAN_SPEED FAN=LED_Bar SPEED=0
	TR_UNSYNC_TO_EXTRUDER
	UPDATE_GIT

[gcode_macro PARK]
description = Park the toolhead at the front and retract some filament if the nozzle is hot
gcode = 
	{% set E = params.E|default(1.7)|float %}
	
	{% set Px, Py = printer["gcode_macro _USER_VARIABLES"].park_position_xy|map('float') %}
	{% set park_lift_z = printer["gcode_macro _USER_VARIABLES"].park_lift_z %}
	
	{% set St = printer["gcode_macro _USER_VARIABLES"].travel_speed * 60 %}
	{% set Sz = printer["gcode_macro _USER_VARIABLES"].z_drop_speed * 60 %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	
	{% set z_safe = act_z + park_lift_z %}
	{% if z_safe > max_z %}
	{% set z_safe = max_z %}
	{% endif %}
	
	
	{% if printer.extruder.temperature > 185 %}
	G10
	{% endif %}
	G90
	G1 Z{z_safe} F{Sz}
	
	G0 X{Px} Y{Py} F{St}

[gcode_macro RESETSPEEDS]
gcode = 
	SET_VELOCITY_LIMIT VELOCITY={printer.configfile.settings.printer.max_velocity}
	SET_VELOCITY_LIMIT ACCEL={printer.configfile.settings.printer.max_accel}
	SET_VELOCITY_LIMIT ACCEL_TO_DECEL={printer.configfile.settings.printer.max_accel_to_decel}
	SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={printer.configfile.settings.printer.square_corner_velocity}

[gcode_macro DISABLEXYE]
gcode = 
	SET_STEPPER_ENABLE STEPPER=extruder ENABLE=0
	SET_STEPPER_ENABLE STEPPER=stepper_x ENABLE=0
	
	SET_STEPPER_ENABLE STEPPER=stepper_y ENABLE=0
	
	SET_STEPPER_ENABLE STEPPER=stepper_z ENABLE=1

[gcode_macro TEST_SPEED]
gcode = 
	
	{% set speed  = params.SPEED|default(printer.configfile.settings.printer.max_velocity)|int %}
	
	{% set iterations = params.ITERATIONS|default(5)|int %}
	
	{% set accel  = params.ACCEL|default(printer.configfile.settings.printer.max_accel)|int %}
	
	{% set bound = params.BOUND|default(20)|int %}
	
	{% set smallpatternsize = SMALLPATTERNSIZE|default(20)|int %}
	
	
	
	{% set x_min = 10 + bound %}
	{% set x_max = 300 - bound %}
	{% set y_min = 10 + bound %}
	{% set y_max = 300 - bound %}
	
	
	
	{% set x_center = (printer.toolhead.axis_minimum.x|float + printer.toolhead.axis_maximum.x|float ) / 2 %}
	{% set y_center = (printer.toolhead.axis_minimum.y|float + printer.toolhead.axis_maximum.y|float ) / 2 %}
	
	
	{% set x_center_min = x_center - (smallpatternsize/2) %}
	{% set x_center_max = x_center + (smallpatternsize/2) %}
	{% set y_center_min = y_center - (smallpatternsize/2) %}
	{% set y_center_max = y_center + (smallpatternsize/2) %}
	
	
	SAVE_GCODE_STATE NAME=TEST_SPEED
	
	
	{ action_respond_info("TEST_SPEED: starting %d iterations at speed %d, accel %d" % (iterations, speed, accel)) }
	
	
	M400
	G28
	
	{% if printer.configfile.settings.quad_gantry_level %}
	{% if printer.quad_gantry_level.applied == False %}
	QUAD_GANTRY_LEVEL
	G28 Z
	{% endif %}
	{% endif %}
	
	G90
	G1 X{printer.toolhead.axis_maximum.x-50} Y{printer.toolhead.axis_maximum.y-50} F{30*60}
	M400
	G28 X Y
	G0 X{300} Y{300} F{30*60}
	G4 P1000
	GET_POSITION
	
	
	G0 X{x_min} Y{y_min} Z{bound + 10} F{speed*60}
	
	
	SET_VELOCITY_LIMIT VELOCITY={speed} ACCEL={accel} ACCEL_TO_DECEL={accel / 2}
	
	{% for i in range(iterations) %}
	
	G0 X{x_min} Y{y_min} F{speed*60}
	G0 X{x_max} Y{y_max} F{speed*60}
	G0 X{x_min} Y{y_min} F{speed*60}
	G0 X{x_max} Y{y_min} F{speed*60}
	G0 X{x_min} Y{y_max} F{speed*60}
	G0 X{x_max} Y{y_min} F{speed*60}
	
	
	G0 X{x_min} Y{y_min} F{speed*60}
	G0 X{x_min} Y{y_max} F{speed*60}
	G0 X{x_max} Y{y_max} F{speed*60}
	G0 X{x_max} Y{y_min} F{speed*60}
	
	
	G0 X{x_center_min} Y{y_center_min} F{speed*60}
	G0 X{x_center_max} Y{y_center_max} F{speed*60}
	G0 X{x_center_min} Y{y_center_min} F{speed*60}
	G0 X{x_center_max} Y{y_center_min} F{speed*60}
	G0 X{x_center_min} Y{y_center_max} F{speed*60}
	G0 X{x_center_max} Y{y_center_min} F{speed*60}
	
	
	G0 X{x_center_min} Y{y_center_min} F{speed*60}
	G0 X{x_center_min} Y{y_center_max} F{speed*60}
	G0 X{x_center_max} Y{y_center_max} F{speed*60}
	G0 X{x_center_max} Y{y_center_min} F{speed*60}
	{% endfor %}
	
	
	SET_VELOCITY_LIMIT VELOCITY={printer.configfile.settings.printer.max_velocity} ACCEL={printer.configfile.settings.printer.max_accel} ACCEL_TO_DECEL={printer.configfile.settings.printer.max_accel_to_decel}
	
	
	M400
	G28
	
	G90
	G0 X{300} Y{300} F{30*60}
	G4 P1000
	GET_POSITION
	
	
	RESTORE_GCODE_STATE NAME=TEST_SPEED

[gcode_macro update_git]
gcode = 
	RUN_SHELL_COMMAND CMD=update_git_script

[gcode_shell_command update_git_script]
command = bash /home/pi/klipper-backup/script.sh
timeout = 90.0
verbose = True

[mcu tr]
serial = /dev/serial/by-id/usb-Klipper_stm32g0b1xx_290023000950415833323720-if00

[belay my_belay]
extruder_type = trad_rack
sensor_pin = ^tr:PB9
multiplier_high = 1.05
multiplier_low = 0.8
debug_level = 1

[trad_rack]
sync_to_extruder = true
selector_max_velocity = 400
selector_max_accel = 10000
lane_count = 4
lane_spacing = 17.26
servo_down_angle = 0
servo_up_angle = 130
toolhead_unload_speed = 20
extruder_load_speed = 2
toolhead_sense_speed = 20
selector_unload_length = 20
bowden_length = 865
extruder_load_length = 60
hotend_load_length = 20
toolhead_unload_length = 80
buffer_pull_speed = 100.0
pre_unload_gcode = 
	SAVE_GCODE_STATE NAME=PRE_UNLOAD_state
	{% if printer.virtual_sdcard.is_active %}
	{% set z_max = printer.toolhead.axis_maximum.z - printer.gcode_move.homing_origin.z %}
	{% set z_lift = printer["gcode_macro TR_Variables"].z_lift|float %}
	{% set x_park = printer["gcode_macro TR_Variables"].x_park|float %}
	{% set y_park = printer["gcode_macro TR_Variables"].y_park|float %}
	{% set do_x_park = printer["gcode_macro TR_Variables"].do_x_park %}
	{% set do_y_park = printer["gcode_macro TR_Variables"].do_y_park %}
	{% set st = printer["gcode_macro TR_Variables"].travel_speed * 60 %}
	{% set shape_tip = printer["gcode_macro TR_Variables"].shape_tip %}
	{% set use_wiper = printer["gcode_macro TR_Variables"].use_wiper %}
	{% set x = printer.gcode_move.gcode_position.x %}
	{% set y = printer.gcode_move.gcode_position.y %}
	{% set z = printer.gcode_move.gcode_position.z %}
	{% set z_park = [z + z_lift, z_max]|min %}
	
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=x VALUE={x}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=y VALUE={y}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=z VALUE={z}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=saved_pos VALUE={True}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=z_park VALUE={z_park}
	
	
	G90
	G1 Z{z_park}
	
	
	{% if use_wiper %}
	Go_To_Purge_Location
	
	
	{% else %}
	G90
	{% if do_x_park %}
	{% set x = x_park %}
	{% endif %}
	{% if do_y_park %}
	{% set y = y_park %}
	{% endif %}
	G1 X{x} Y{y} F{st}
	{% endif %}
	
	
	{% if shape_tip %}
	Shape_Tip
	{% endif %}
	{% else %}
	
	{% if use_wiper %}
	Go_To_Purge_Location
	{% endif %}
	
	
	Shape_Tip
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRE_UNLOAD_state
post_load_gcode = 
	SAVE_GCODE_STATE NAME=POST_LOAD_state
	{% set use_wiper = printer["gcode_macro TR_Variables"].use_wiper %}
	{% if printer.virtual_sdcard.is_active %}
	{% set st = printer["gcode_macro TR_Variables"].travel_speed * 60 %}
	{% set take_frame = printer["gcode_macro TR_Variables"].take_frame %}
	{% set x = printer["gcode_macro TR_Variables"].x %}
	{% set y = printer["gcode_macro TR_Variables"].y %}
	{% set z = printer["gcode_macro TR_Variables"].z %}
	{% set saved_pos = printer["gcode_macro TR_Variables"].saved_pos %}
	{% set z_park = printer["gcode_macro TR_Variables"].z_park %}
	
	
	{% if take_frame %}
	TIMELAPSE_TAKE_FRAME
	{% endif %}
	
	
	{% if use_wiper %}
	Home_and_Wipe_Nozzle
	{% endif %}
	
	
	{% if saved_pos %}
	G90
	G1 Z{z_park}
	G1 X{x} Y{y} F{st}
	G1 Z{z}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=saved_pos VALUE={False}
	{% endif %}
	
	Restore_Pressure_Advance
	{% elif use_wiper %}
	Home_and_Wipe_Nozzle
	{% endif %}
	RESTORE_GCODE_STATE NAME=POST_LOAD_state

[stepper_tr_selector]
step_pin = tr:PB15
dir_pin = !tr:PB14
enable_pin = !tr:PA8
rotation_distance = 40
microsteps = 16
full_steps_per_rotation = 400
endstop_pin = ^tr:PA3
position_min = 0.0
position_endstop = 0
position_max = 158
homing_speed = 30

[stepper_tr_fil_driver]
step_pin = tr:PD2
dir_pin = tr:PB13
enable_pin = !tr:PD1
rotation_distance = 22.67895
gear_ratio = 50:17
microsteps = 16
full_steps_per_rotation = 400
endstop_pin = ^tr:PA4
position_min = -5000
position_endstop = 0
position_max = 5000
homing_positive_dir = False

[tmc2209 stepper_tr_selector]
uart_pin = tr:PA10
interpolate = True
run_current = 1.3
sense_resistor = 0.110

[tmc2209 stepper_tr_fil_driver]
uart_pin = tr:PC7
interpolate = False
run_current = 1.3
sense_resistor = 0.110

[servo tr_servo]
pin = tr:PA0
maximum_servo_angle = 131
minimum_pulse_width = 0.000700
maximum_pulse_width = 0.002200

[gcode_macro ACTIVATE_EXTRUDER]
rename_existing = ACTIVATE_EXTRUDER.1
gcode = 
	{% set EXTRUDER = params.EXTRUDER|default('extruder')|lower|replace('extruder', '') %}
	{% if EXTRUDER == '' %}
	{% set EXTRUDER = '0' %}
	{% endif %}
	TR_LOAD_TOOLHEAD LANE={EXTRUDER}

[gcode_macro TR_Variables]
description = Variables for use with Trad Rack pre unload and post load gcode
variable_z_lift = 0.1
variable_x_park = 0.0
variable_y_park = 175.0
variable_do_x_park = False
variable_do_y_park = False
variable_travel_speed = 300
variable_shape_tip = False
variable_take_frame = False
variable_use_wiper = False
variable_x = 0
variable_y = 0
variable_z = 0
variable_saved_pos = False
variable_z_park = 0
gcode = 

[gcode_macro Shape_Tip]
description = Perform tip-shaping, retraction, and cooling moves
gcode = 
	SAVE_GCODE_STATE NAME=Shape_Tip_state
	Save_Pressure_Advance
	
	Slicer_Unload
	
	
	Restore_Pressure_Advance
	RESTORE_GCODE_STATE NAME=Shape_Tip_state

[gcode_macro Set_Slicer_Unload_Preset]
description = Apply a preset of values to use for the Slicer_Unload macro
variable_asa_ss = {
	"filament_ramming_parameters": "120 110 5.32258 5.45161 5.67742 6 6.48387 7.12903 7.90323 8.70968 9.3871 9.83871 10.0968 10.2258| 0.05 5.30967 0.45 5.50967 0.95 6.1871 1.45 7.39677 1.95 9.05484 2.45 10 2.95 10.3098 3.45 13.0839 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": True}
variable_pla_ss = {
	"filament_ramming_parameters": "130 120 2.70968 2.93548 3.32258 3.83871 4.58065 5.54839 6.51613 7.35484 7.93548 8.16129| 0.05 2.66451 0.45 3.05805 0.95 4.05807 1.45 5.97742 1.95 7.69999 2.45 8.1936 2.95 11.342 3.45 11.4065 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": True}
variable_asa_ps = {
	"filament_ramming_parameters": "120 110 5.32258 5.45161 5.67742 6 6.48387 7.12903 7.90323 8.70968 9.3871 9.83871 10.0968 10.2258| 0.05 5.30967 0.45 5.50967 0.95 6.1871 1.45 7.39677 1.95 9.05484 2.45 10 2.95 10.3098 3.45 13.0839 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": False}
variable_pla_ps = {
	"filament_ramming_parameters": "130 120 2.70968 2.93548 3.32258 3.83871 4.58065 5.54839 6.51613 7.35484 7.93548 8.16129| 0.05 2.66451 0.45 3.05805 0.95 4.05807 1.45 5.97742 1.95 7.69999 2.45 8.1936 2.95 11.342 3.45 11.4065 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": False}
gcode = 
	{% set preset_name = params.PRESET|lower %}
	{% if preset_name in printer['gcode_macro Set_Slicer_Unload_Preset'] %}
	{% set preset = printer['gcode_macro Set_Slicer_Unload_Preset'].preset_name %}
	{% for key in preset %}
	SET_GCODE_VARIABLE MACRO=Slicer_Unload VARIABLE={key} VALUE={preset[key]}
	{% endfor %}
	{% else %}
	{ action_raise_error("Preset \"%s\" does not exist" % preset_name) }
	{% endif %}

[gcode_macro Slicer_Unload]
description = Mimic ramming and unload behavior of PrusaSlicer or SuperSlicer
variable_cooling_tube_length = 14
variable_cooling_tube_retraction = 30
variable_filament_cooling_final_speed = 30
variable_filament_cooling_initial_speed = 20
variable_filament_cooling_moves = 4
variable_filament_diameter = 1.75
variable_filament_unloading_speed = 90
variable_filament_unloading_speed_start = 100
variable_filament_toolchange_delay = 0
variable_filament_ramming_parameters = "120 110 5.32258 5.45161 5.67742 6 6.48387 7.12903 7.90323 8.70968 9.3871 9.83871 10.0968 10.2258| 0.05 5.30967 0.45 5.50967 0.95 6.1871 1.45 7.39677 1.95 9.05484 2.45 10 2.95 10.3098 3.45 13.0839 3.95 7.6 4.45 7.6 4.95 7.6"
variable_filament_enable_toolchange_temp = False
variable_filament_toolchange_temp = 200
variable_filament_use_fast_skinnydip = False
variable_filament_enable_toolchange_part_fan = False
variable_filament_toolchange_part_fan_speed = 50
variable_filament_use_skinnydip = True
variable_filament_skinnydip_distance = 24
variable_filament_melt_zone_pause = 0
variable_filament_cooling_zone_pause = 0
variable_filament_dip_insertion_speed = 33
variable_filament_dip_extraction_speed = 70
variable_superslicer = False
variable_do_ramming = False
variable_do_unload = True
gcode = 
	{% set NEW_TEMPERATURE = params.NEW_TEMPERATURE|default(0)|float %}
	{% set prev_temp_target = printer.extruder.target %}
	
	SAVE_GCODE_STATE NAME=Slicer_Unload_state
	Save_Pressure_Advance
	
	M83
	M220 S100
	SET_PRESSURE_ADVANCE ADVANCE=0
	
	
	{% if do_ramming %}
	
	{% set ramming_speed = (filament_ramming_parameters.split('|')[0]).split(' ') %}
	
	
	{% set filament_area = 3.1415 * (filament_diameter / 2) ** 2 %}
	
	
	{% for i in range(2, ramming_speed|length) %}
	
	{% set f = ramming_speed[i]|float / filament_area %}
	
	
	{% set e = f * 0.25 %}
	
	
	G1 E{e} F{f * 60}
	{% endfor %}
	{% endif %}
	
	
	{% if do_unload %}
	
	{% if superslicer and filament_enable_toolchange_temp and not filament_use_fast_skinnydip %}
	_Wait_for_Toolchange_Temp
	{% endif %}
	
	
	{% set total_retraction_distance = cooling_tube_retraction + cooling_tube_length / 2 - 15 %}
	G1 E-15 F{filament_unloading_speed_start * 60}
	G1 E-{0.70 * total_retraction_distance} F{1.0 * filament_unloading_speed * 60}
	G1 E-{0.20 * total_retraction_distance} F{0.5 * filament_unloading_speed * 60}
	G1 E-{0.10 * total_retraction_distance} F{0.3 * filament_unloading_speed * 60}
	
	
	{% if not superslicer or not filament_enable_toolchange_temp %}
	{% if NEW_TEMPERATURE != 0 and (NEW_TEMPERATURE != prev_temp_target) %}
	M104 S{NEW_TEMPERATURE}
	{% endif %}
	
	
	{% elif superslicer and filament_enable_toolchange_temp and not filament_use_fast_skinnydip %}
	{% if NEW_TEMPERATURE != 0 %}
	M104 S{NEW_TEMPERATURE}
	{% else %}
	M104 S{prev_temp_target}
	{% endif %}
	{% endif %}
	
	
	{% set speed_inc = (filament_cooling_final_speed - filament_cooling_initial_speed) / (2 * filament_cooling_moves - 1) %}
	{% for i in range(filament_cooling_moves) %}
	{% set speed = filament_cooling_initial_speed + speed_inc * 2 * i %}
	G1 E{cooling_tube_length} F{speed * 60}
	{% set speed = speed + speed_inc %}
	G1 E-{cooling_tube_length} F{speed * 60}
	{% endfor %}
	
	
	{% if superslicer %}
	
	{% if filament_enable_toolchange_temp and filament_use_fast_skinnydip %}
	_Wait_for_Toolchange_Temp
	{% endif %}
	
	
	{% if filament_use_skinnydip %}
	G1 E{filament_skinnydip_distance} F{filament_dip_insertion_speed * 60}
	G4 P{filament_melt_zone_pause}
	G1 E-{filament_skinnydip_distance} F{filament_dip_extraction_speed * 60}
	G4 P{filament_cooling_zone_pause}
	{% endif %}
	
	
	{% if filament_enable_toolchange_temp and filament_use_fast_skinnydip %}
	{% if NEW_TEMPERATURE != 0 %}
	M109 S{NEW_TEMPERATURE}
	{% else %}
	M109 S{prev_temp_target}
	{% endif %}
	{% elif filament_enable_toolchange_temp and filament_use_fast_skinnydip %}
	{% if NEW_TEMPERATURE != 0 and (NEW_TEMPERATURE != prev_temp_target) %}
	M109 S{NEW_TEMPERATURE}
	{% endif %}
	{% endif %}
	{% endif %}
	
	
	G4 P{filament_toolchange_delay}
	
	
	
	{% endif %}
	
	Restore_Pressure_Advance
	RESTORE_GCODE_STATE NAME=Slicer_Unload_state

[gcode_macro _Wait_for_Toolchange_Temp]
description = Helper function for Slicer_Unload
gcode = 
	{% set tc_temp = printer["gcode_macro Slicer_Unload"].filament_toolchange_temp %}
	{% set fan_on = printer["gcode_macro Slicer_Unload"].filament_enable_toolchange_part_fan %}
	{% set fan_speed = printer["gcode_macro Slicer_Unload"].filament_toolchange_part_fan_speed %}
	
	{% set prev_fan_speed = printer.fan.speed %}
	{% if fan_on %}
	M106 S{(fan_speed / 100.0 * 255)|int}
	{% endif %}
	M109 S{filament_toolchange_temp}
	{% if fan_on %}
	M106 S{(prev_fan_speed * 255)|int}
	{% endif %}

[gcode_macro Home_and_Wipe_Nozzle]
description = Home x and y if needed, then wipe the nozzle
gcode = 
	
	{% if not 'xy' in printer.toolhead.homed_axes %}
	G28 X Y
	{% endif %}
	
	
	Wipe_Nozzle

[gcode_macro Save_Pressure_Advance]
description = Save the current pressure advance value
variable_pa = -1
gcode = 
	
	{% set pa = printer.extruder.pressure_advance %}
	{% if pa > 0 %}
	SET_GCODE_VARIABLE MACRO=Save_Pressure_Advance VARIABLE=pa VALUE={pa}
	{% endif %}

[gcode_macro Restore_Pressure_Advance]
description = Restore saved pressure advance value
gcode = 
	
	{% if not (printer["gcode_macro Save_Pressure_Advance"].pa == -1) %}
	SET_PRESSURE_ADVANCE ADVANCE={printer["gcode_macro Save_Pressure_Advance"].pa}
	{% endif %}

[safe_z_home]
home_xy_position = 165, 165
z_hop = 10

[z_tilt]
z_positions = 
	-80,  -20
	350, -20
points = 
	15, 150
	275, 150
speed = 50
horizontal_move_z = 10
retries = 30
retry_tolerance = 0.1

[input_shaper]
shaper_type_x = zv
shaper_freq_x = 120.6
shaper_type_y = zv
shaper_freq_y = 76.6

[cartographer]
serial = /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00
speed = 40.
lift_speed = 5.
backlash_comp = 0.5
x_offset = 0.
y_offset = 21.1
trigger_distance = 2.
trigger_dive_threshold = 1.5
trigger_hysteresis = 0.006
cal_nozzle_z = 0.1
cal_floor = 0.1
cal_ceil = 5.
cal_speed = 1.0
cal_move_speed = 10.
default_model_name = default
mesh_main_direction = x
mesh_cluster_size = 1
mesh_runs = 2

[lis2dw]
cs_pin = cartographer:PA3
spi_bus = spi1

[resonance_tester]
accel_chip = lis2dw
probe_points = 
	125, 125, 20

[printer]
kinematics = corexy
max_velocity = 3000
max_accel = 20000
max_z_velocity = 20
max_z_accel = 15
square_corner_velocity = 10

[exclude_object]

[gcode_arcs]
resolution = 0.05

[idle_timeout]
gcode = 
	{% if not printer.pause_resume.is_paused %}
	TURN_OFF_HEATERS
	M84
	{% endif %}

[save_variables]
filename = vars.cfg

[mcu]
serial = /dev/serial/by-id/usb-Klipper_stm32h723xx_4C0023001551313338343730-if00

[bed_mesh default]
version = 1
points = 
	-0.215000, -0.210000, -0.190000, -0.185000, -0.170000, -0.145000, -0.135000, -0.120000, -0.105000, -0.070000, -0.055000, -0.035000, 0.000000, 0.010000, 0.025000, 0.050000, 0.080000, 0.105000, 0.130000, 0.135000, 0.150000, 0.155000, 0.165000, 0.190000, 0.205000
	-0.160000, -0.155000, -0.160000, -0.150000, -0.130000, -0.110000, -0.105000, -0.085000, -0.055000, -0.035000, -0.025000, 0.000000, 0.025000, 0.055000, 0.075000, 0.100000, 0.110000, 0.130000, 0.160000, 0.170000, 0.190000, 0.190000, 0.205000, 0.205000, 0.220000
	-0.160000, -0.150000, -0.140000, -0.135000, -0.115000, -0.105000, -0.090000, -0.070000, -0.040000, -0.025000, -0.010000, 0.015000, 0.030000, 0.045000, 0.080000, 0.100000, 0.115000, 0.135000, 0.160000, 0.165000, 0.180000, 0.185000, 0.190000, 0.220000, 0.235000
	-0.120000, -0.115000, -0.115000, -0.100000, -0.080000, -0.070000, -0.065000, -0.040000, -0.015000, 0.010000, 0.030000, 0.050000, 0.065000, 0.090000, 0.110000, 0.130000, 0.145000, 0.175000, 0.195000, 0.195000, 0.195000, 0.205000, 0.210000, 0.235000, 0.240000
	-0.075000, -0.065000, -0.055000, -0.045000, -0.040000, -0.020000, -0.005000, 0.015000, 0.035000, 0.065000, 0.075000, 0.090000, 0.105000, 0.115000, 0.140000, 0.170000, 0.175000, 0.190000, 0.205000, 0.205000, 0.205000, 0.210000, 0.215000, 0.240000, 0.240000
	-0.045000, -0.050000, -0.055000, -0.045000, -0.015000, -0.005000, -0.005000, 0.020000, 0.060000, 0.065000, 0.075000, 0.100000, 0.115000, 0.125000, 0.135000, 0.170000, 0.175000, 0.175000, 0.205000, 0.205000, 0.205000, 0.205000, 0.210000, 0.220000, 0.225000
	-0.035000, -0.030000, -0.030000, -0.020000, 0.000000, 0.015000, 0.015000, 0.035000, 0.065000, 0.085000, 0.100000, 0.110000, 0.115000, 0.130000, 0.160000, 0.170000, 0.180000, 0.180000, 0.200000, 0.200000, 0.200000, 0.205000, 0.205000, 0.220000, 0.235000
	0.005000, 0.010000, 0.015000, 0.025000, 0.035000, 0.040000, 0.055000, 0.085000, 0.095000, 0.110000, 0.115000, 0.125000, 0.140000, 0.160000, 0.175000, 0.180000, 0.190000, 0.190000, 0.225000, 0.225000, 0.225000, 0.225000, 0.230000, 0.235000, 0.250000
	0.055000, 0.065000, 0.060000, 0.065000, 0.075000, 0.090000, 0.100000, 0.110000, 0.120000, 0.130000, 0.140000, 0.155000, 0.170000, 0.180000, 0.190000, 0.195000, 0.210000, 0.220000, 0.235000, 0.235000, 0.235000, 0.235000, 0.245000, 0.250000, 0.260000
	0.100000, 0.105000, 0.110000, 0.110000, 0.120000, 0.135000, 0.145000, 0.150000, 0.155000, 0.155000, 0.170000, 0.185000, 0.190000, 0.195000, 0.195000, 0.215000, 0.230000, 0.235000, 0.245000, 0.245000, 0.245000, 0.235000, 0.245000, 0.250000, 0.260000
	0.100000, 0.115000, 0.125000, 0.130000, 0.135000, 0.145000, 0.150000, 0.155000, 0.165000, 0.175000, 0.190000, 0.200000, 0.205000, 0.205000, 0.215000, 0.225000, 0.230000, 0.245000, 0.255000, 0.240000, 0.240000, 0.240000, 0.245000, 0.250000, 0.250000
	0.155000, 0.150000, 0.150000, 0.150000, 0.160000, 0.165000, 0.165000, 0.175000, 0.175000, 0.195000, 0.200000, 0.215000, 0.205000, 0.210000, 0.215000, 0.225000, 0.235000, 0.240000, 0.245000, 0.240000, 0.240000, 0.235000, 0.220000, 0.235000, 0.240000
	0.170000, 0.165000, 0.165000, 0.170000, 0.180000, 0.190000, 0.190000, 0.185000, 0.200000, 0.205000, 0.220000, 0.230000, 0.225000, 0.225000, 0.240000, 0.245000, 0.240000, 0.250000, 0.255000, 0.245000, 0.250000, 0.245000, 0.245000, 0.240000, 0.240000
	0.210000, 0.200000, 0.195000, 0.200000, 0.210000, 0.210000, 0.210000, 0.215000, 0.215000, 0.215000, 0.235000, 0.245000, 0.235000, 0.235000, 0.245000, 0.250000, 0.240000, 0.250000, 0.250000, 0.250000, 0.255000, 0.250000, 0.235000, 0.235000, 0.240000
	0.240000, 0.250000, 0.250000, 0.245000, 0.260000, 0.260000, 0.255000, 0.255000, 0.255000, 0.250000, 0.265000, 0.265000, 0.260000, 0.255000, 0.260000, 0.255000, 0.255000, 0.270000, 0.260000, 0.255000, 0.250000, 0.255000, 0.245000, 0.250000, 0.240000
	0.270000, 0.260000, 0.255000, 0.265000, 0.265000, 0.265000, 0.265000, 0.260000, 0.260000, 0.255000, 0.265000, 0.265000, 0.265000, 0.255000, 0.255000, 0.250000, 0.255000, 0.250000, 0.250000, 0.245000, 0.245000, 0.235000, 0.230000, 0.235000, 0.240000
	0.275000, 0.280000, 0.275000, 0.275000, 0.275000, 0.275000, 0.275000, 0.275000, 0.280000, 0.280000, 0.280000, 0.270000, 0.270000, 0.270000, 0.265000, 0.265000, 0.265000, 0.270000, 0.260000, 0.255000, 0.235000, 0.235000, 0.235000, 0.240000, 0.235000
	0.335000, 0.315000, 0.305000, 0.310000, 0.305000, 0.300000, 0.295000, 0.290000, 0.300000, 0.295000, 0.290000, 0.290000, 0.280000, 0.270000, 0.270000, 0.275000, 0.275000, 0.265000, 0.250000, 0.245000, 0.235000, 0.225000, 0.225000, 0.230000, 0.235000
	0.355000, 0.350000, 0.345000, 0.325000, 0.330000, 0.325000, 0.325000, 0.325000, 0.315000, 0.310000, 0.300000, 0.290000, 0.285000, 0.290000, 0.275000, 0.275000, 0.265000, 0.265000, 0.250000, 0.245000, 0.235000, 0.225000, 0.230000, 0.225000, 0.215000
	0.395000, 0.385000, 0.380000, 0.370000, 0.365000, 0.370000, 0.360000, 0.355000, 0.345000, 0.340000, 0.330000, 0.320000, 0.310000, 0.305000, 0.300000, 0.290000, 0.275000, 0.260000, 0.255000, 0.255000, 0.250000, 0.235000, 0.230000, 0.230000, 0.230000
	0.395000, 0.390000, 0.375000, 0.375000, 0.375000, 0.370000, 0.365000, 0.360000, 0.355000, 0.335000, 0.325000, 0.315000, 0.315000, 0.300000, 0.295000, 0.280000, 0.255000, 0.260000, 0.250000, 0.240000, 0.230000, 0.235000, 0.230000, 0.205000, 0.195000
	0.405000, 0.395000, 0.395000, 0.390000, 0.380000, 0.375000, 0.370000, 0.360000, 0.355000, 0.345000, 0.325000, 0.325000, 0.310000, 0.295000, 0.290000, 0.270000, 0.250000, 0.240000, 0.235000, 0.235000, 0.230000, 0.205000, 0.195000, 0.195000, 0.195000
	0.405000, 0.395000, 0.380000, 0.375000, 0.375000, 0.370000, 0.360000, 0.345000, 0.340000, 0.330000, 0.305000, 0.300000, 0.285000, 0.270000, 0.250000, 0.235000, 0.220000, 0.215000, 0.220000, 0.205000, 0.195000, 0.175000, 0.175000, 0.170000, 0.165000
	0.405000, 0.390000, 0.395000, 0.385000, 0.365000, 0.350000, 0.345000, 0.330000, 0.320000, 0.305000, 0.290000, 0.265000, 0.260000, 0.240000, 0.225000, 0.215000, 0.205000, 0.190000, 0.180000, 0.185000, 0.165000, 0.150000, 0.145000, 0.145000, 0.145000
	0.430000, 0.425000, 0.400000, 0.395000, 0.385000, 0.370000, 0.365000, 0.340000, 0.320000, 0.305000, 0.295000, 0.270000, 0.250000, 0.235000, 0.215000, 0.215000, 0.200000, 0.190000, 0.185000, 0.165000, 0.155000, 0.145000, 0.135000, 0.130000, 0.135000
x_count = 25
y_count = 25
mesh_x_pps = 3
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 310.0
min_y = 26.43
max_y = 281.31
=======================
Extruder max_extrude_ratio=41.575169
mcu 'mcu': Starting serial connect
webhooks client 140734127025168: New connection
webhooks client 140734127025168: Client info {'program': 'Moonraker', 'version': 'v0.8.0-308-g71b46cc'}
Loaded MCU 'mcu' 117 commands (v0.12.0-61-gb50d6669 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1_PB6_PB7=PB6,PB7 BUS_PINS_i2c1_PB8_PB9=PB8,PB9 BUS_PINS_i2c2_PB10_PB11=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi2a=PC2,PC3,PB10 BUS_PINS_spi3a=PC11,PC12,PC10 BUS_PINS_spi4=PE13,PE14,PE12 BUS_PINS_spi5=PF8,PF9,PF7 BUS_PINS_spi5a=PH7,PF11,PH6 BUS_PINS_spi6=PG12,PG14,PG13 CLOCK_FREQ=400000000 MCU=stm32h723xx PWM_MAX=255 RESERVE_PINS_USB=PA11,PA12 RESERVE_PINS_crystal=PH0,PH1 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
mcu 'tr': Starting serial connect
Loaded MCU 'tr' 106 commands (v0.12.0-102-g9f41f53c / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'tr' config: ADC_MAX=4095 BUS_PINS_i2c1_PA9_PA10=PA9,PA10 BUS_PINS_i2c1_PB6_PB7=PB6,PB7 BUS_PINS_i2c1_PB8_PB9=PB8,PB9 BUS_PINS_i2c2_PB10_PB11=PB10,PB11 BUS_PINS_i2c2_PB13_PB14=PB13,PB14 BUS_PINS_i2c3_PB3_PB4=PB3,PB4 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi2a=PC2,PC3,PB10 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=64000000 MCU=stm32g0b1xx PWM_MAX=255 RESERVE_PINS_USB=PA11,PA12 RESERVE_PINS_crystal=PF0,PF1 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
mcu_temperature 'mcu' nominal base=-274.819277 slope=1644.578313
mcu 'cartographer': Starting serial connect
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'

Printer is not ready
The klippy host software is attempting to connect.  Please
retry in a few moments.

mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
Attempting MCU 'mcu' reset command
b'Got EOF when reading from device'
Attempting MCU 'tr' reset command
b'Got EOF when reading from device'
Attempting MCU 'cartographer' reset
Unhandled exception during post run
Traceback (most recent call last):
  File "/home/pi/klippy-env/lib/python3.11/site-packages/serial/serialposix.py", line 265, in open
    self.fd = os.open(self.portstr, os.O_RDWR | os.O_NOCTTY | os.O_NONBLOCK)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
FileNotFoundError: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/pi/klipper/klippy/klippy.py", line 234, in run
    self.send_event("klippy:firmware_restart")
  File "/home/pi/klipper/klippy/klippy.py", line 263, in send_event
    return [cb(*params) for cb in self.event_handlers.get(event, [])]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/klippy.py", line 263, in <listcomp>
    return [cb(*params) for cb in self.event_handlers.get(event, [])]
            ^^^^^^^^^^^
  File "/home/pi/klipper/klippy/mcu.py", line 915, in _firmware_restart
    self._restart_arduino()
  File "/home/pi/klipper/klippy/mcu.py", line 875, in _restart_arduino
    serialhdl.arduino_reset(self._serialport, self._reactor)
  File "/home/pi/klipper/klippy/serialhdl.py", line 379, in arduino_reset
    ser = serial.Serial(serialport, 2400, timeout=0, exclusive=True)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klippy-env/lib/python3.11/site-packages/serial/serialutil.py", line 240, in __init__
    self.open()
  File "/home/pi/klippy-env/lib/python3.11/site-packages/serial/serialposix.py", line 268, in open
    raise SerialException(msg.errno, "could not open port {}: {}".format(self._port, msg))
serial.serialutil.SerialException: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
Restarting printer
Start printer at Mon Feb  5 14:50:21 2024 (1707144621.0 90536.9)
===== Config file =====
[virtual_sdcard]
path = /home/pi/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]
recover_velocity = 350

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	TURN_OFF_HEATERS
	G91
	G1 Z10 E-2 F3600
	G1 E-3 F3600
	G90
	G1 X30 Y250 F7000; home X axis
	M106 S80
	G4 P10000
	M106 S0
	M221 S100
	CANCEL_PRINT_BASE
	CLEAR_PAUSE
	
	SET_GCODE_OFFSET Z=0.0
	RESETSPEEDS
	M84
	
	BED_MESH_CLEAR

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	
	{% set x_park = printer.toolhead.axis_maximum.x|float - 5.0 %}
	{% set y_park = printer.toolhead.axis_maximum.y|float - 5.0 %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < (max_z - 2.0) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	
	SAVE_GCODE_STATE NAME=PAUSE_state
	BASE_PAUSE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	G91
	G1 E-{1} F2100
	G1 Z{10} F900
	G90
	G1 X{50} Y{0} F6000
variable_extrude = 1.0

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	G91
	G1 E{1} F2100
	RESTORE_GCODE_STATE NAME=PAUSE_state
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[tmc5160 extruder]
cs_pin = PA10
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 0.65
sense_resistor = 0.075
stealthchop_threshold = 0

[extruder]
rotation_distance = 5.7
full_steps_per_rotation = 200
sensor_type = PT1000
min_temp = 0
max_temp = 330
filament_diameter = 1.750
dir_pin = !PB6
step_pin = PG15
enable_pin = !PG14
heater_pin = PF6
sensor_pin = PB1
microsteps = 16
max_extrude_only_distance = 101
max_extrude_cross_section = 100
nozzle_diameter = 0.600
pressure_advance = 0.015
pressure_advance_smooth_time = 0.02
control = pid
pid_kp = 22.354
pid_ki = 1.552
pid_kd = 80.473

[tmc5160 stepper_x]
cs_pin = PD6
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
diag1_pin = PC15
run_current = 2.00
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_x]
dir_pin = !PC13
step_pin = PC14
enable_pin = !PE6
endstop_pin = PC15
microsteps = 16
rotation_distance = 40
position_endstop = -6
position_min = -6
position_max = 330
homing_speed = 20
full_steps_per_rotation = 200
homing_retract_dist = 0
homing_positive_dir = false
step_pulse_duration = 0.000001

[tmc5160 stepper_x1]
cs_pin = PD5
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2.00
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_x1]
dir_pin = !PE4
step_pin = PE5
enable_pin = !PE3
microsteps = 16
rotation_distance = 40
full_steps_per_rotation = 200
step_pulse_duration = 0.000001

[tmc5160 stepper_y]
cs_pin = PD4
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_y]
dir_pin = !PE1
step_pin = PE2
enable_pin = !PE0
endstop_pin = PF0
microsteps = 16
rotation_distance = 40
position_endstop = 0
position_min = 0
position_max = 315
homing_speed = 20
full_steps_per_rotation = 200
homing_retract_dist = 0
homing_positive_dir = false
step_pulse_duration = 0.000001

[tmc5160 stepper_y1]
cs_pin = PD3
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_y1]
dir_pin = !PB8
step_pin = PB9
enable_pin = !PB7
microsteps = 16
rotation_distance = 40
full_steps_per_rotation = 200
step_pulse_duration = 0.000001

[tmc5160 stepper_z]
cs_pin = PD2
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 1
sense_resistor = 0.075
stealthchop_threshold = 0

[stepper_z]
dir_pin = !PG10
step_pin = PG9
enable_pin = !PG13
endstop_pin = probe:z_virtual_endstop
microsteps = 16
rotation_distance = 8
position_min = -20
position_max = 400
full_steps_per_rotation = 200
homing_retract_dist = 5.0
homing_positive_dir = false
homing_speed = 3
second_homing_speed = 1
step_pulse_duration = 0.000004

[tmc5160 stepper_z1]
cs_pin = PA15
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 1
sense_resistor = 0.075
stealthchop_threshold = 0

[stepper_z1]
dir_pin = !PD7
step_pin = PG11
enable_pin = !PG12
microsteps = 16
rotation_distance = 8

[temperature_sensor Kraken]
sensor_type = temperature_mcu
min_temp = 10
max_temp = 100

[heater_fan hotend_fan]
pin = PA0
max_power = 1.0
kick_start_time = 0.5
heater = extruder
heater_temp = 50.0

[fan]
pin = PF12
enable_pin = PF7
hardware_pwm = false
max_power = 1
cycle_time = 0.00002
off_below = 0.012
kick_start_time = 0.01

[heater_bed]
heater_pin = PF5
sensor_pin = PC5
sensor_type = NTC 100K MGB18-104F39050L32
control = pid
pid_kp = 34.679
pid_ki = 1.492
pid_kd = 201.572
min_temp = 0
max_temp = 120
max_power = 1
pwm_cycle_time = 0.0166

[bed_screws]
screw1 = 10,0
screw2 = 10,260
screw3 = 320,260
screw4 = 320,0

[screws_tilt_adjust]
screw1 = 10, 0
screw1_name = front left screw
screw2 = 10, 260
screw2_name = rear left screw
screw3 = 300, 260
screw3_name = rear right screw
screw4 = 320, 0
screw4_name = front right screw
horizontal_move_z = 10.
speed = 250
screw_thread = CW-M3

[force_move]
enable_force_move = true

[bed_mesh]
speed = 200
horizontal_move_z = 1
mesh_min = 10, 22
mesh_max = 310, 260
mesh_pps = 3,3
probe_count = 25,25
algorithm = bicubic
relative_reference_index = 12
bicubic_tension = 0.2
fade_start = 1
fade_end = 10
split_delta_z = .025
move_check_distance = 5

[neopixel my_neopixel]
pin = PF11
chain_count = 13
color_order = GRB
initial_red = 1.0
initial_green = 1
initial_blue = 1

[gcode_macro BED_MESH]
gcode = 
	BED_MESH_CALIBRATE

[gcode_macro PA_TUNING]
gcode = 
	SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=1 ACCEL=500
	TUNING_TOWER COMMAND=SET_PRESSURE_ADVANCE PARAMETER=ADVANCE START=0 FACTOR=.005

[gcode_macro HOTEND_PID]
gcode = 
	{% set tool_temp = params.TEMPERATURE|default(220)|int %}
	{% set tool_name = printer.toolhead.extruder %}
	PID_CALIBRATE HEATER={tool_name} TARGET={tool_temp}

[gcode_macro BED_PID]
gcode = 
	{% set bed_temp = params.TEMPERATURE|default(60)|int %}
	PID_CALIBRATE HEATER=heater_bed TARGET={bed_temp}

[gcode_macro SCREWS_TILT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro DUMP_WARNINGS]
description = Debug: Print all warning messages from klipper
gcode = 
	{% set parameters = ["printer.configfile.warnings:"] %}
	{% for warning in printer.configfile.warnings %}
	{% set parameters = parameters.append("%s -> %s -> %s\n%s" % (warning.type, warning.section, warning.option, warning.message)) %}
	{% endfor %}
	{action_respond_info(parameters|join("\n"))}

[gcode_macro enable_stepper]
gcode = 
	SET_STEPPER_ENABLE STEPPER=stepper_x ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_x1 ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y1 ENABLE=1

[gcode_macro disable-steppers]
gcode = 
	m84

[gcode_macro M600]
gcode = 
	G4 P1500
	{% set X = params.X|default(50)|float %}
	{% set Y = params.Y|default(0)|float %}
	{% set Z = params.Z|default(10)|float %}
	
	SAVE_GCODE_STATE NAME=M600_state
	PAUSE
	
	G91
	G1 E-{1} F2100
	G1 Z{Z}
	G90
	G1 X{X} Y{Y} F4000
	G91
	M83
	G1 E5 F800
	G1 E-180 F2000
	M82
	RESTORE_GCODE_STATE NAME=M600_state

[gcode_macro PURGE]
gcode = 
	M83
	G1 E120 F250

[gcode_macro _UNLOAD_FILAMENT]
gcode = 
	{% set e_temp = params.TEMPERATURE|default(235)|int %}
	M118 Filament unloading!
	M117 Filament unloading!
	M82
	G92 E0
	{% if printer.extruder.can_extrude|lower != 'true' %}
	
	M118 Hotend heating!
	M109 S{e_temp} T0
	{% endif %}
	G1 E10 F{5*60}
	G0 E-5 F{60*60}
	G0 E-70 F{5*60}
	M400
	M118 Filament unload complete!
	M117 Filament unload complete!

[gcode_macro _LOAD_FILAMENT]
gcode = 
	{% set e_temp = params.TEMPERATURE|default(230)|int %}
	M109 S{e_temp}
	M83
	G1 E50 F300
	G1 E-1 F100
	M82
	M104 S0

[gcode_macro UNLOAD_PLA]
gcode = 
	_UNLOAD_FILAMENT TEMPERATURE=200

[gcode_macro LOAD_PLA]
gcode = 
	_LOAD_FILAMENT TEMPERATURE=200

[gcode_macro UNLOAD_ABS]
gcode = 
	_UNLOAD_FILAMENT TEMPERATURE=250

[gcode_macro LOAD_ABS]
gcode = 
	_LOAD_FILAMENT TEMPERATURE=250

[gcode_macro UNLOAD_PETG]
gcode = 
	_UNLOAD_FILAMENT TEMPERATURE=235

[gcode_macro LOAD_PETG]
gcode = 
	_LOAD_FILAMENT TEMPERATURE=235

[gcode_macro LOAD_FILAMENT]
gcode = 
	{% set speed = params.SPEED|default(300) %}
	{% set max_velocity = printer.configfile.settings['extruder'].max_extrude_only_velocity %}
	SAVE_GCODE_STATE NAME=load_state
	M300
	G91
	G92 E0
	G1 E350 F{max_velocity}
	G1 E25 F{speed}
	M300
	M300
	RESTORE_GCODE_STATE NAME=load_state

[gcode_macro UNLOAD_FILAMENT]
gcode = 
	{% set speed = params.SPEED|default(300) %}
	{% set max_velocity = printer.configfile.settings['extruder'].max_extrude_only_velocity %}
	SAVE_GCODE_STATE NAME=unload_state
	G91
	M300
	G92 E0
	G1 E25 F{speed}
	G1 E-420 F{max_velocity}
	M300
	M300
	RESTORE_GCODE_STATE NAME=unload_state

[gcode_macro START_PRINT]
gcode = 
	
	{% set DWELL = params.DWELL|default(00)|int %}
	{% set bedTemp = params.BED|default(70)|int %}
	{% set hotendTemp = params.HOTEND|default(210)|int %}
	SET_FAN_SPEED FAN=LED_Bar SPEED=0.5
	CLEAR_PAUSE
	RESETSPEEDS
	G21
	G90
	M83
	M140 S{bedTemp}; start heating the bed
	M104 S100
	SET_DISPLAY_TEXT MSG="Waiting for temperatures..."
	HEATSOAK DWELL={DWELL}
	G28 X Y
	ATTACH_PROBE_LOCK
	G28 Z
	SET_DISPLAY_TEXT MSG="Adjusting Z Tilt"
	Z_TILT_ADJUST
	G28 Z
	
	SET_DISPLAY_TEXT MSG="Calibrating Bed Mesh"
	BED_MESH_CLEAR
	BED_MESH_CALIBRATE
	BED_MESH_PROFILE LOAD=default
	SET_DISPLAY_TEXT MSG="Heating Extruder to temp"
	G1 X1 Y1 Z0.5 F9000
	M109 S{hotendTemp}; wait for extruder to heat up
	TR_UNLOAD_TOOLHEAD
	TR_HOME
	FIXED_PURGE_LINE
	M83
	SET_DISPLAY_TEXT MSG="Printing..."
	TR_SYNC_TO_EXTRUDER

[gcode_macro HEATSOAK]
gcode = 
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion..."
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 5% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 10% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 15% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 20% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 25% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 30% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 35% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 40% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 45% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 50% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 55% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 60% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 65% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 70% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 75% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 80% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 85% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 90% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 95% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Thermal expansion done"

[gcode_macro _CG28]
gcode = 
	{% if "xyz" not in printer.toolhead.homed_axes %}
	G28
	{% endif %}

[gcode_macro FIXED_PURGE_LINE]
gcode = 
	M83
	G92 E0
	G1 Z1 F3000
	G1 X1 Y80 Z0.3 E10  F1200
	G1 X1 Y120 E11  F1200
	G1 E-0.8 F1000
	G92 E0
	G1 Z1 F2000

[gcode_macro END_PRINT]
gcode = 
	TR_UNLOAD_TOOLHEAD
	
	TURN_OFF_HEATERS
	G91
	G1 Z10 E-2 F3600
	
	G90
	G1 X30 Y250 F7000; home X axis
	M106 S80
	G4 P10000
	M106 S0
	M221 S100
	CLEAR_PAUSE
	
	SET_GCODE_OFFSET Z=0.0
	RESETSPEEDS
	
	M84
	BED_MESH_CLEAR
	SET_FAN_SPEED FAN=LED_Bar SPEED=0
	TR_UNSYNC_TO_EXTRUDER
	UPDATE_GIT

[gcode_macro PARK]
description = Park the toolhead at the front and retract some filament if the nozzle is hot
gcode = 
	{% set E = params.E|default(1.7)|float %}
	
	{% set Px, Py = printer["gcode_macro _USER_VARIABLES"].park_position_xy|map('float') %}
	{% set park_lift_z = printer["gcode_macro _USER_VARIABLES"].park_lift_z %}
	
	{% set St = printer["gcode_macro _USER_VARIABLES"].travel_speed * 60 %}
	{% set Sz = printer["gcode_macro _USER_VARIABLES"].z_drop_speed * 60 %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	
	{% set z_safe = act_z + park_lift_z %}
	{% if z_safe > max_z %}
	{% set z_safe = max_z %}
	{% endif %}
	
	
	{% if printer.extruder.temperature > 185 %}
	G10
	{% endif %}
	G90
	G1 Z{z_safe} F{Sz}
	
	G0 X{Px} Y{Py} F{St}

[gcode_macro RESETSPEEDS]
gcode = 
	SET_VELOCITY_LIMIT VELOCITY={printer.configfile.settings.printer.max_velocity}
	SET_VELOCITY_LIMIT ACCEL={printer.configfile.settings.printer.max_accel}
	SET_VELOCITY_LIMIT ACCEL_TO_DECEL={printer.configfile.settings.printer.max_accel_to_decel}
	SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={printer.configfile.settings.printer.square_corner_velocity}

[gcode_macro DISABLEXYE]
gcode = 
	SET_STEPPER_ENABLE STEPPER=extruder ENABLE=0
	SET_STEPPER_ENABLE STEPPER=stepper_x ENABLE=0
	
	SET_STEPPER_ENABLE STEPPER=stepper_y ENABLE=0
	
	SET_STEPPER_ENABLE STEPPER=stepper_z ENABLE=1

[gcode_macro TEST_SPEED]
gcode = 
	
	{% set speed  = params.SPEED|default(printer.configfile.settings.printer.max_velocity)|int %}
	
	{% set iterations = params.ITERATIONS|default(5)|int %}
	
	{% set accel  = params.ACCEL|default(printer.configfile.settings.printer.max_accel)|int %}
	
	{% set bound = params.BOUND|default(20)|int %}
	
	{% set smallpatternsize = SMALLPATTERNSIZE|default(20)|int %}
	
	
	
	{% set x_min = 10 + bound %}
	{% set x_max = 300 - bound %}
	{% set y_min = 10 + bound %}
	{% set y_max = 300 - bound %}
	
	
	
	{% set x_center = (printer.toolhead.axis_minimum.x|float + printer.toolhead.axis_maximum.x|float ) / 2 %}
	{% set y_center = (printer.toolhead.axis_minimum.y|float + printer.toolhead.axis_maximum.y|float ) / 2 %}
	
	
	{% set x_center_min = x_center - (smallpatternsize/2) %}
	{% set x_center_max = x_center + (smallpatternsize/2) %}
	{% set y_center_min = y_center - (smallpatternsize/2) %}
	{% set y_center_max = y_center + (smallpatternsize/2) %}
	
	
	SAVE_GCODE_STATE NAME=TEST_SPEED
	
	
	{ action_respond_info("TEST_SPEED: starting %d iterations at speed %d, accel %d" % (iterations, speed, accel)) }
	
	
	M400
	G28
	
	{% if printer.configfile.settings.quad_gantry_level %}
	{% if printer.quad_gantry_level.applied == False %}
	QUAD_GANTRY_LEVEL
	G28 Z
	{% endif %}
	{% endif %}
	
	G90
	G1 X{printer.toolhead.axis_maximum.x-50} Y{printer.toolhead.axis_maximum.y-50} F{30*60}
	M400
	G28 X Y
	G0 X{300} Y{300} F{30*60}
	G4 P1000
	GET_POSITION
	
	
	G0 X{x_min} Y{y_min} Z{bound + 10} F{speed*60}
	
	
	SET_VELOCITY_LIMIT VELOCITY={speed} ACCEL={accel} ACCEL_TO_DECEL={accel / 2}
	
	{% for i in range(iterations) %}
	
	G0 X{x_min} Y{y_min} F{speed*60}
	G0 X{x_max} Y{y_max} F{speed*60}
	G0 X{x_min} Y{y_min} F{speed*60}
	G0 X{x_max} Y{y_min} F{speed*60}
	G0 X{x_min} Y{y_max} F{speed*60}
	G0 X{x_max} Y{y_min} F{speed*60}
	
	
	G0 X{x_min} Y{y_min} F{speed*60}
	G0 X{x_min} Y{y_max} F{speed*60}
	G0 X{x_max} Y{y_max} F{speed*60}
	G0 X{x_max} Y{y_min} F{speed*60}
	
	
	G0 X{x_center_min} Y{y_center_min} F{speed*60}
	G0 X{x_center_max} Y{y_center_max} F{speed*60}
	G0 X{x_center_min} Y{y_center_min} F{speed*60}
	G0 X{x_center_max} Y{y_center_min} F{speed*60}
	G0 X{x_center_min} Y{y_center_max} F{speed*60}
	G0 X{x_center_max} Y{y_center_min} F{speed*60}
	
	
	G0 X{x_center_min} Y{y_center_min} F{speed*60}
	G0 X{x_center_min} Y{y_center_max} F{speed*60}
	G0 X{x_center_max} Y{y_center_max} F{speed*60}
	G0 X{x_center_max} Y{y_center_min} F{speed*60}
	{% endfor %}
	
	
	SET_VELOCITY_LIMIT VELOCITY={printer.configfile.settings.printer.max_velocity} ACCEL={printer.configfile.settings.printer.max_accel} ACCEL_TO_DECEL={printer.configfile.settings.printer.max_accel_to_decel}
	
	
	M400
	G28
	
	G90
	G0 X{300} Y{300} F{30*60}
	G4 P1000
	GET_POSITION
	
	
	RESTORE_GCODE_STATE NAME=TEST_SPEED

[gcode_macro update_git]
gcode = 
	RUN_SHELL_COMMAND CMD=update_git_script

[gcode_shell_command update_git_script]
command = bash /home/pi/klipper-backup/script.sh
timeout = 90.0
verbose = True

[mcu tr]
serial = /dev/serial/by-id/usb-Klipper_stm32g0b1xx_290023000950415833323720-if00

[belay my_belay]
extruder_type = trad_rack
sensor_pin = ^tr:PB9
multiplier_high = 1.05
multiplier_low = 0.8
debug_level = 1

[trad_rack]
sync_to_extruder = true
selector_max_velocity = 400
selector_max_accel = 10000
lane_count = 4
lane_spacing = 17.26
servo_down_angle = 0
servo_up_angle = 130
toolhead_unload_speed = 20
extruder_load_speed = 2
toolhead_sense_speed = 20
selector_unload_length = 20
bowden_length = 865
extruder_load_length = 60
hotend_load_length = 20
toolhead_unload_length = 80
buffer_pull_speed = 100.0
pre_unload_gcode = 
	SAVE_GCODE_STATE NAME=PRE_UNLOAD_state
	{% if printer.virtual_sdcard.is_active %}
	{% set z_max = printer.toolhead.axis_maximum.z - printer.gcode_move.homing_origin.z %}
	{% set z_lift = printer["gcode_macro TR_Variables"].z_lift|float %}
	{% set x_park = printer["gcode_macro TR_Variables"].x_park|float %}
	{% set y_park = printer["gcode_macro TR_Variables"].y_park|float %}
	{% set do_x_park = printer["gcode_macro TR_Variables"].do_x_park %}
	{% set do_y_park = printer["gcode_macro TR_Variables"].do_y_park %}
	{% set st = printer["gcode_macro TR_Variables"].travel_speed * 60 %}
	{% set shape_tip = printer["gcode_macro TR_Variables"].shape_tip %}
	{% set use_wiper = printer["gcode_macro TR_Variables"].use_wiper %}
	{% set x = printer.gcode_move.gcode_position.x %}
	{% set y = printer.gcode_move.gcode_position.y %}
	{% set z = printer.gcode_move.gcode_position.z %}
	{% set z_park = [z + z_lift, z_max]|min %}
	
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=x VALUE={x}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=y VALUE={y}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=z VALUE={z}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=saved_pos VALUE={True}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=z_park VALUE={z_park}
	
	
	G90
	G1 Z{z_park}
	
	
	{% if use_wiper %}
	Go_To_Purge_Location
	
	
	{% else %}
	G90
	{% if do_x_park %}
	{% set x = x_park %}
	{% endif %}
	{% if do_y_park %}
	{% set y = y_park %}
	{% endif %}
	G1 X{x} Y{y} F{st}
	{% endif %}
	
	
	{% if shape_tip %}
	Shape_Tip
	{% endif %}
	{% else %}
	
	{% if use_wiper %}
	Go_To_Purge_Location
	{% endif %}
	
	
	Shape_Tip
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRE_UNLOAD_state
post_load_gcode = 
	SAVE_GCODE_STATE NAME=POST_LOAD_state
	{% set use_wiper = printer["gcode_macro TR_Variables"].use_wiper %}
	{% if printer.virtual_sdcard.is_active %}
	{% set st = printer["gcode_macro TR_Variables"].travel_speed * 60 %}
	{% set take_frame = printer["gcode_macro TR_Variables"].take_frame %}
	{% set x = printer["gcode_macro TR_Variables"].x %}
	{% set y = printer["gcode_macro TR_Variables"].y %}
	{% set z = printer["gcode_macro TR_Variables"].z %}
	{% set saved_pos = printer["gcode_macro TR_Variables"].saved_pos %}
	{% set z_park = printer["gcode_macro TR_Variables"].z_park %}
	
	
	{% if take_frame %}
	TIMELAPSE_TAKE_FRAME
	{% endif %}
	
	
	{% if use_wiper %}
	Home_and_Wipe_Nozzle
	{% endif %}
	
	
	{% if saved_pos %}
	G90
	G1 Z{z_park}
	G1 X{x} Y{y} F{st}
	G1 Z{z}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=saved_pos VALUE={False}
	{% endif %}
	
	Restore_Pressure_Advance
	{% elif use_wiper %}
	Home_and_Wipe_Nozzle
	{% endif %}
	RESTORE_GCODE_STATE NAME=POST_LOAD_state

[stepper_tr_selector]
step_pin = tr:PB15
dir_pin = !tr:PB14
enable_pin = !tr:PA8
rotation_distance = 40
microsteps = 16
full_steps_per_rotation = 400
endstop_pin = ^tr:PA3
position_min = 0.0
position_endstop = 0
position_max = 158
homing_speed = 30

[stepper_tr_fil_driver]
step_pin = tr:PD2
dir_pin = tr:PB13
enable_pin = !tr:PD1
rotation_distance = 22.67895
gear_ratio = 50:17
microsteps = 16
full_steps_per_rotation = 400
endstop_pin = ^tr:PA4
position_min = -5000
position_endstop = 0
position_max = 5000
homing_positive_dir = False

[tmc2209 stepper_tr_selector]
uart_pin = tr:PA10
interpolate = True
run_current = 1.3
sense_resistor = 0.110

[tmc2209 stepper_tr_fil_driver]
uart_pin = tr:PC7
interpolate = False
run_current = 1.3
sense_resistor = 0.110

[servo tr_servo]
pin = tr:PA0
maximum_servo_angle = 131
minimum_pulse_width = 0.000700
maximum_pulse_width = 0.002200

[gcode_macro ACTIVATE_EXTRUDER]
rename_existing = ACTIVATE_EXTRUDER.1
gcode = 
	{% set EXTRUDER = params.EXTRUDER|default('extruder')|lower|replace('extruder', '') %}
	{% if EXTRUDER == '' %}
	{% set EXTRUDER = '0' %}
	{% endif %}
	TR_LOAD_TOOLHEAD LANE={EXTRUDER}

[gcode_macro TR_Variables]
description = Variables for use with Trad Rack pre unload and post load gcode
variable_z_lift = 0.1
variable_x_park = 0.0
variable_y_park = 175.0
variable_do_x_park = False
variable_do_y_park = False
variable_travel_speed = 300
variable_shape_tip = False
variable_take_frame = False
variable_use_wiper = False
variable_x = 0
variable_y = 0
variable_z = 0
variable_saved_pos = False
variable_z_park = 0
gcode = 

[gcode_macro Shape_Tip]
description = Perform tip-shaping, retraction, and cooling moves
gcode = 
	SAVE_GCODE_STATE NAME=Shape_Tip_state
	Save_Pressure_Advance
	
	Slicer_Unload
	
	
	Restore_Pressure_Advance
	RESTORE_GCODE_STATE NAME=Shape_Tip_state

[gcode_macro Set_Slicer_Unload_Preset]
description = Apply a preset of values to use for the Slicer_Unload macro
variable_asa_ss = {
	"filament_ramming_parameters": "120 110 5.32258 5.45161 5.67742 6 6.48387 7.12903 7.90323 8.70968 9.3871 9.83871 10.0968 10.2258| 0.05 5.30967 0.45 5.50967 0.95 6.1871 1.45 7.39677 1.95 9.05484 2.45 10 2.95 10.3098 3.45 13.0839 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": True}
variable_pla_ss = {
	"filament_ramming_parameters": "130 120 2.70968 2.93548 3.32258 3.83871 4.58065 5.54839 6.51613 7.35484 7.93548 8.16129| 0.05 2.66451 0.45 3.05805 0.95 4.05807 1.45 5.97742 1.95 7.69999 2.45 8.1936 2.95 11.342 3.45 11.4065 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": True}
variable_asa_ps = {
	"filament_ramming_parameters": "120 110 5.32258 5.45161 5.67742 6 6.48387 7.12903 7.90323 8.70968 9.3871 9.83871 10.0968 10.2258| 0.05 5.30967 0.45 5.50967 0.95 6.1871 1.45 7.39677 1.95 9.05484 2.45 10 2.95 10.3098 3.45 13.0839 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": False}
variable_pla_ps = {
	"filament_ramming_parameters": "130 120 2.70968 2.93548 3.32258 3.83871 4.58065 5.54839 6.51613 7.35484 7.93548 8.16129| 0.05 2.66451 0.45 3.05805 0.95 4.05807 1.45 5.97742 1.95 7.69999 2.45 8.1936 2.95 11.342 3.45 11.4065 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": False}
gcode = 
	{% set preset_name = params.PRESET|lower %}
	{% if preset_name in printer['gcode_macro Set_Slicer_Unload_Preset'] %}
	{% set preset = printer['gcode_macro Set_Slicer_Unload_Preset'].preset_name %}
	{% for key in preset %}
	SET_GCODE_VARIABLE MACRO=Slicer_Unload VARIABLE={key} VALUE={preset[key]}
	{% endfor %}
	{% else %}
	{ action_raise_error("Preset \"%s\" does not exist" % preset_name) }
	{% endif %}

[gcode_macro Slicer_Unload]
description = Mimic ramming and unload behavior of PrusaSlicer or SuperSlicer
variable_cooling_tube_length = 14
variable_cooling_tube_retraction = 30
variable_filament_cooling_final_speed = 30
variable_filament_cooling_initial_speed = 20
variable_filament_cooling_moves = 4
variable_filament_diameter = 1.75
variable_filament_unloading_speed = 90
variable_filament_unloading_speed_start = 100
variable_filament_toolchange_delay = 0
variable_filament_ramming_parameters = "120 110 5.32258 5.45161 5.67742 6 6.48387 7.12903 7.90323 8.70968 9.3871 9.83871 10.0968 10.2258| 0.05 5.30967 0.45 5.50967 0.95 6.1871 1.45 7.39677 1.95 9.05484 2.45 10 2.95 10.3098 3.45 13.0839 3.95 7.6 4.45 7.6 4.95 7.6"
variable_filament_enable_toolchange_temp = False
variable_filament_toolchange_temp = 200
variable_filament_use_fast_skinnydip = False
variable_filament_enable_toolchange_part_fan = False
variable_filament_toolchange_part_fan_speed = 50
variable_filament_use_skinnydip = True
variable_filament_skinnydip_distance = 24
variable_filament_melt_zone_pause = 0
variable_filament_cooling_zone_pause = 0
variable_filament_dip_insertion_speed = 33
variable_filament_dip_extraction_speed = 70
variable_superslicer = False
variable_do_ramming = False
variable_do_unload = True
gcode = 
	{% set NEW_TEMPERATURE = params.NEW_TEMPERATURE|default(0)|float %}
	{% set prev_temp_target = printer.extruder.target %}
	
	SAVE_GCODE_STATE NAME=Slicer_Unload_state
	Save_Pressure_Advance
	
	M83
	M220 S100
	SET_PRESSURE_ADVANCE ADVANCE=0
	
	
	{% if do_ramming %}
	
	{% set ramming_speed = (filament_ramming_parameters.split('|')[0]).split(' ') %}
	
	
	{% set filament_area = 3.1415 * (filament_diameter / 2) ** 2 %}
	
	
	{% for i in range(2, ramming_speed|length) %}
	
	{% set f = ramming_speed[i]|float / filament_area %}
	
	
	{% set e = f * 0.25 %}
	
	
	G1 E{e} F{f * 60}
	{% endfor %}
	{% endif %}
	
	
	{% if do_unload %}
	
	{% if superslicer and filament_enable_toolchange_temp and not filament_use_fast_skinnydip %}
	_Wait_for_Toolchange_Temp
	{% endif %}
	
	
	{% set total_retraction_distance = cooling_tube_retraction + cooling_tube_length / 2 - 15 %}
	G1 E-15 F{filament_unloading_speed_start * 60}
	G1 E-{0.70 * total_retraction_distance} F{1.0 * filament_unloading_speed * 60}
	G1 E-{0.20 * total_retraction_distance} F{0.5 * filament_unloading_speed * 60}
	G1 E-{0.10 * total_retraction_distance} F{0.3 * filament_unloading_speed * 60}
	
	
	{% if not superslicer or not filament_enable_toolchange_temp %}
	{% if NEW_TEMPERATURE != 0 and (NEW_TEMPERATURE != prev_temp_target) %}
	M104 S{NEW_TEMPERATURE}
	{% endif %}
	
	
	{% elif superslicer and filament_enable_toolchange_temp and not filament_use_fast_skinnydip %}
	{% if NEW_TEMPERATURE != 0 %}
	M104 S{NEW_TEMPERATURE}
	{% else %}
	M104 S{prev_temp_target}
	{% endif %}
	{% endif %}
	
	
	{% set speed_inc = (filament_cooling_final_speed - filament_cooling_initial_speed) / (2 * filament_cooling_moves - 1) %}
	{% for i in range(filament_cooling_moves) %}
	{% set speed = filament_cooling_initial_speed + speed_inc * 2 * i %}
	G1 E{cooling_tube_length} F{speed * 60}
	{% set speed = speed + speed_inc %}
	G1 E-{cooling_tube_length} F{speed * 60}
	{% endfor %}
	
	
	{% if superslicer %}
	
	{% if filament_enable_toolchange_temp and filament_use_fast_skinnydip %}
	_Wait_for_Toolchange_Temp
	{% endif %}
	
	
	{% if filament_use_skinnydip %}
	G1 E{filament_skinnydip_distance} F{filament_dip_insertion_speed * 60}
	G4 P{filament_melt_zone_pause}
	G1 E-{filament_skinnydip_distance} F{filament_dip_extraction_speed * 60}
	G4 P{filament_cooling_zone_pause}
	{% endif %}
	
	
	{% if filament_enable_toolchange_temp and filament_use_fast_skinnydip %}
	{% if NEW_TEMPERATURE != 0 %}
	M109 S{NEW_TEMPERATURE}
	{% else %}
	M109 S{prev_temp_target}
	{% endif %}
	{% elif filament_enable_toolchange_temp and filament_use_fast_skinnydip %}
	{% if NEW_TEMPERATURE != 0 and (NEW_TEMPERATURE != prev_temp_target) %}
	M109 S{NEW_TEMPERATURE}
	{% endif %}
	{% endif %}
	{% endif %}
	
	
	G4 P{filament_toolchange_delay}
	
	
	
	{% endif %}
	
	Restore_Pressure_Advance
	RESTORE_GCODE_STATE NAME=Slicer_Unload_state

[gcode_macro _Wait_for_Toolchange_Temp]
description = Helper function for Slicer_Unload
gcode = 
	{% set tc_temp = printer["gcode_macro Slicer_Unload"].filament_toolchange_temp %}
	{% set fan_on = printer["gcode_macro Slicer_Unload"].filament_enable_toolchange_part_fan %}
	{% set fan_speed = printer["gcode_macro Slicer_Unload"].filament_toolchange_part_fan_speed %}
	
	{% set prev_fan_speed = printer.fan.speed %}
	{% if fan_on %}
	M106 S{(fan_speed / 100.0 * 255)|int}
	{% endif %}
	M109 S{filament_toolchange_temp}
	{% if fan_on %}
	M106 S{(prev_fan_speed * 255)|int}
	{% endif %}

[gcode_macro Home_and_Wipe_Nozzle]
description = Home x and y if needed, then wipe the nozzle
gcode = 
	
	{% if not 'xy' in printer.toolhead.homed_axes %}
	G28 X Y
	{% endif %}
	
	
	Wipe_Nozzle

[gcode_macro Save_Pressure_Advance]
description = Save the current pressure advance value
variable_pa = -1
gcode = 
	
	{% set pa = printer.extruder.pressure_advance %}
	{% if pa > 0 %}
	SET_GCODE_VARIABLE MACRO=Save_Pressure_Advance VARIABLE=pa VALUE={pa}
	{% endif %}

[gcode_macro Restore_Pressure_Advance]
description = Restore saved pressure advance value
gcode = 
	
	{% if not (printer["gcode_macro Save_Pressure_Advance"].pa == -1) %}
	SET_PRESSURE_ADVANCE ADVANCE={printer["gcode_macro Save_Pressure_Advance"].pa}
	{% endif %}

[safe_z_home]
home_xy_position = 165, 165
z_hop = 10

[z_tilt]
z_positions = 
	-80,  -20
	350, -20
points = 
	15, 150
	275, 150
speed = 50
horizontal_move_z = 10
retries = 30
retry_tolerance = 0.1

[input_shaper]
shaper_type_x = zv
shaper_freq_x = 120.6
shaper_type_y = zv
shaper_freq_y = 76.6

[printer]
kinematics = corexy
max_velocity = 3000
max_accel = 20000
max_z_velocity = 20
max_z_accel = 15
square_corner_velocity = 10

[exclude_object]

[gcode_arcs]
resolution = 0.05

[idle_timeout]
gcode = 
	{% if not printer.pause_resume.is_paused %}
	TURN_OFF_HEATERS
	M84
	{% endif %}

[save_variables]
filename = vars.cfg

[mcu]
serial = /dev/serial/by-id/usb-Klipper_stm32h723xx_4C0023001551313338343730-if00

[bed_mesh default]
version = 1
points = 
	-0.215000, -0.210000, -0.190000, -0.185000, -0.170000, -0.145000, -0.135000, -0.120000, -0.105000, -0.070000, -0.055000, -0.035000, 0.000000, 0.010000, 0.025000, 0.050000, 0.080000, 0.105000, 0.130000, 0.135000, 0.150000, 0.155000, 0.165000, 0.190000, 0.205000
	-0.160000, -0.155000, -0.160000, -0.150000, -0.130000, -0.110000, -0.105000, -0.085000, -0.055000, -0.035000, -0.025000, 0.000000, 0.025000, 0.055000, 0.075000, 0.100000, 0.110000, 0.130000, 0.160000, 0.170000, 0.190000, 0.190000, 0.205000, 0.205000, 0.220000
	-0.160000, -0.150000, -0.140000, -0.135000, -0.115000, -0.105000, -0.090000, -0.070000, -0.040000, -0.025000, -0.010000, 0.015000, 0.030000, 0.045000, 0.080000, 0.100000, 0.115000, 0.135000, 0.160000, 0.165000, 0.180000, 0.185000, 0.190000, 0.220000, 0.235000
	-0.120000, -0.115000, -0.115000, -0.100000, -0.080000, -0.070000, -0.065000, -0.040000, -0.015000, 0.010000, 0.030000, 0.050000, 0.065000, 0.090000, 0.110000, 0.130000, 0.145000, 0.175000, 0.195000, 0.195000, 0.195000, 0.205000, 0.210000, 0.235000, 0.240000
	-0.075000, -0.065000, -0.055000, -0.045000, -0.040000, -0.020000, -0.005000, 0.015000, 0.035000, 0.065000, 0.075000, 0.090000, 0.105000, 0.115000, 0.140000, 0.170000, 0.175000, 0.190000, 0.205000, 0.205000, 0.205000, 0.210000, 0.215000, 0.240000, 0.240000
	-0.045000, -0.050000, -0.055000, -0.045000, -0.015000, -0.005000, -0.005000, 0.020000, 0.060000, 0.065000, 0.075000, 0.100000, 0.115000, 0.125000, 0.135000, 0.170000, 0.175000, 0.175000, 0.205000, 0.205000, 0.205000, 0.205000, 0.210000, 0.220000, 0.225000
	-0.035000, -0.030000, -0.030000, -0.020000, 0.000000, 0.015000, 0.015000, 0.035000, 0.065000, 0.085000, 0.100000, 0.110000, 0.115000, 0.130000, 0.160000, 0.170000, 0.180000, 0.180000, 0.200000, 0.200000, 0.200000, 0.205000, 0.205000, 0.220000, 0.235000
	0.005000, 0.010000, 0.015000, 0.025000, 0.035000, 0.040000, 0.055000, 0.085000, 0.095000, 0.110000, 0.115000, 0.125000, 0.140000, 0.160000, 0.175000, 0.180000, 0.190000, 0.190000, 0.225000, 0.225000, 0.225000, 0.225000, 0.230000, 0.235000, 0.250000
	0.055000, 0.065000, 0.060000, 0.065000, 0.075000, 0.090000, 0.100000, 0.110000, 0.120000, 0.130000, 0.140000, 0.155000, 0.170000, 0.180000, 0.190000, 0.195000, 0.210000, 0.220000, 0.235000, 0.235000, 0.235000, 0.235000, 0.245000, 0.250000, 0.260000
	0.100000, 0.105000, 0.110000, 0.110000, 0.120000, 0.135000, 0.145000, 0.150000, 0.155000, 0.155000, 0.170000, 0.185000, 0.190000, 0.195000, 0.195000, 0.215000, 0.230000, 0.235000, 0.245000, 0.245000, 0.245000, 0.235000, 0.245000, 0.250000, 0.260000
	0.100000, 0.115000, 0.125000, 0.130000, 0.135000, 0.145000, 0.150000, 0.155000, 0.165000, 0.175000, 0.190000, 0.200000, 0.205000, 0.205000, 0.215000, 0.225000, 0.230000, 0.245000, 0.255000, 0.240000, 0.240000, 0.240000, 0.245000, 0.250000, 0.250000
	0.155000, 0.150000, 0.150000, 0.150000, 0.160000, 0.165000, 0.165000, 0.175000, 0.175000, 0.195000, 0.200000, 0.215000, 0.205000, 0.210000, 0.215000, 0.225000, 0.235000, 0.240000, 0.245000, 0.240000, 0.240000, 0.235000, 0.220000, 0.235000, 0.240000
	0.170000, 0.165000, 0.165000, 0.170000, 0.180000, 0.190000, 0.190000, 0.185000, 0.200000, 0.205000, 0.220000, 0.230000, 0.225000, 0.225000, 0.240000, 0.245000, 0.240000, 0.250000, 0.255000, 0.245000, 0.250000, 0.245000, 0.245000, 0.240000, 0.240000
	0.210000, 0.200000, 0.195000, 0.200000, 0.210000, 0.210000, 0.210000, 0.215000, 0.215000, 0.215000, 0.235000, 0.245000, 0.235000, 0.235000, 0.245000, 0.250000, 0.240000, 0.250000, 0.250000, 0.250000, 0.255000, 0.250000, 0.235000, 0.235000, 0.240000
	0.240000, 0.250000, 0.250000, 0.245000, 0.260000, 0.260000, 0.255000, 0.255000, 0.255000, 0.250000, 0.265000, 0.265000, 0.260000, 0.255000, 0.260000, 0.255000, 0.255000, 0.270000, 0.260000, 0.255000, 0.250000, 0.255000, 0.245000, 0.250000, 0.240000
	0.270000, 0.260000, 0.255000, 0.265000, 0.265000, 0.265000, 0.265000, 0.260000, 0.260000, 0.255000, 0.265000, 0.265000, 0.265000, 0.255000, 0.255000, 0.250000, 0.255000, 0.250000, 0.250000, 0.245000, 0.245000, 0.235000, 0.230000, 0.235000, 0.240000
	0.275000, 0.280000, 0.275000, 0.275000, 0.275000, 0.275000, 0.275000, 0.275000, 0.280000, 0.280000, 0.280000, 0.270000, 0.270000, 0.270000, 0.265000, 0.265000, 0.265000, 0.270000, 0.260000, 0.255000, 0.235000, 0.235000, 0.235000, 0.240000, 0.235000
	0.335000, 0.315000, 0.305000, 0.310000, 0.305000, 0.300000, 0.295000, 0.290000, 0.300000, 0.295000, 0.290000, 0.290000, 0.280000, 0.270000, 0.270000, 0.275000, 0.275000, 0.265000, 0.250000, 0.245000, 0.235000, 0.225000, 0.225000, 0.230000, 0.235000
	0.355000, 0.350000, 0.345000, 0.325000, 0.330000, 0.325000, 0.325000, 0.325000, 0.315000, 0.310000, 0.300000, 0.290000, 0.285000, 0.290000, 0.275000, 0.275000, 0.265000, 0.265000, 0.250000, 0.245000, 0.235000, 0.225000, 0.230000, 0.225000, 0.215000
	0.395000, 0.385000, 0.380000, 0.370000, 0.365000, 0.370000, 0.360000, 0.355000, 0.345000, 0.340000, 0.330000, 0.320000, 0.310000, 0.305000, 0.300000, 0.290000, 0.275000, 0.260000, 0.255000, 0.255000, 0.250000, 0.235000, 0.230000, 0.230000, 0.230000
	0.395000, 0.390000, 0.375000, 0.375000, 0.375000, 0.370000, 0.365000, 0.360000, 0.355000, 0.335000, 0.325000, 0.315000, 0.315000, 0.300000, 0.295000, 0.280000, 0.255000, 0.260000, 0.250000, 0.240000, 0.230000, 0.235000, 0.230000, 0.205000, 0.195000
	0.405000, 0.395000, 0.395000, 0.390000, 0.380000, 0.375000, 0.370000, 0.360000, 0.355000, 0.345000, 0.325000, 0.325000, 0.310000, 0.295000, 0.290000, 0.270000, 0.250000, 0.240000, 0.235000, 0.235000, 0.230000, 0.205000, 0.195000, 0.195000, 0.195000
	0.405000, 0.395000, 0.380000, 0.375000, 0.375000, 0.370000, 0.360000, 0.345000, 0.340000, 0.330000, 0.305000, 0.300000, 0.285000, 0.270000, 0.250000, 0.235000, 0.220000, 0.215000, 0.220000, 0.205000, 0.195000, 0.175000, 0.175000, 0.170000, 0.165000
	0.405000, 0.390000, 0.395000, 0.385000, 0.365000, 0.350000, 0.345000, 0.330000, 0.320000, 0.305000, 0.290000, 0.265000, 0.260000, 0.240000, 0.225000, 0.215000, 0.205000, 0.190000, 0.180000, 0.185000, 0.165000, 0.150000, 0.145000, 0.145000, 0.145000
	0.430000, 0.425000, 0.400000, 0.395000, 0.385000, 0.370000, 0.365000, 0.340000, 0.320000, 0.305000, 0.295000, 0.270000, 0.250000, 0.235000, 0.215000, 0.215000, 0.200000, 0.190000, 0.185000, 0.165000, 0.155000, 0.145000, 0.135000, 0.130000, 0.135000
x_count = 25
y_count = 25
mesh_x_pps = 3
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 310.0
min_y = 26.43
max_y = 281.31
=======================
Config error
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/klippy.py", line 175, in _connect
    self._read_config()
  File "/home/pi/klipper/klippy/klippy.py", line 143, in _read_config
    m.add_printer_objects(config)
  File "/home/pi/klipper/klippy/toolhead.py", line 658, in add_printer_objects
    config.get_printer().add_object('toolhead', ToolHead(config))
                                                ^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/toolhead.py", line 261, in __init__
    self.kin = mod.load_kinematics(self, config)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/kinematics/corexy.py", line 99, in load_kinematics
    return CoreXYKinematics(toolhead, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/kinematics/corexy.py", line 12, in __init__
    self.rails = [stepper.LookupMultiRail(config.getsection('stepper_' + n))
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/kinematics/corexy.py", line 12, in <listcomp>
    self.rails = [stepper.LookupMultiRail(config.getsection('stepper_' + n))
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/stepper.py", line 423, in LookupMultiRail
    rail = PrinterRail(config, need_position_minmax,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/stepper.py", line 304, in __init__
    self.add_extra_stepper(config)
  File "/home/pi/klipper/klippy/stepper.py", line 383, in add_extra_stepper
    pin_params = ppins.parse_pin(endstop_pin, True, True)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/pins.py", line 83, in parse_pin
    raise error("Unknown pin chip name '%s'" % (chip_name,))
pins.error: Unknown pin chip name 'probe'
webhooks client 140734128763344: New connection
webhooks client 140734128763344: Client info {'program': 'Moonraker', 'version': 'v0.8.0-308-g71b46cc'}
Attempting MCU 'mcu' reset
Attempting MCU 'tr' reset
webhooks client 140734128763344: Disconnected
Restarting printer
Start printer at Mon Feb  5 14:50:54 2024 (1707144654.2 90570.0)
===== Config file =====
[virtual_sdcard]
path = /home/pi/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]
recover_velocity = 350

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	TURN_OFF_HEATERS
	G91
	G1 Z10 E-2 F3600
	G1 E-3 F3600
	G90
	G1 X30 Y250 F7000; home X axis
	M106 S80
	G4 P10000
	M106 S0
	M221 S100
	CANCEL_PRINT_BASE
	CLEAR_PAUSE
	
	SET_GCODE_OFFSET Z=0.0
	RESETSPEEDS
	M84
	
	BED_MESH_CLEAR

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	
	{% set x_park = printer.toolhead.axis_maximum.x|float - 5.0 %}
	{% set y_park = printer.toolhead.axis_maximum.y|float - 5.0 %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < (max_z - 2.0) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	
	SAVE_GCODE_STATE NAME=PAUSE_state
	BASE_PAUSE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	G91
	G1 E-{1} F2100
	G1 Z{10} F900
	G90
	G1 X{50} Y{0} F6000
variable_extrude = 1.0

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	G91
	G1 E{1} F2100
	RESTORE_GCODE_STATE NAME=PAUSE_state
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[tmc5160 extruder]
cs_pin = PA10
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 0.65
sense_resistor = 0.075
stealthchop_threshold = 0

[extruder]
rotation_distance = 5.7
full_steps_per_rotation = 200
sensor_type = PT1000
min_temp = 0
max_temp = 330
filament_diameter = 1.750
dir_pin = !PB6
step_pin = PG15
enable_pin = !PG14
heater_pin = PF6
sensor_pin = PB1
microsteps = 16
max_extrude_only_distance = 101
max_extrude_cross_section = 100
nozzle_diameter = 0.600
pressure_advance = 0.015
pressure_advance_smooth_time = 0.02
control = pid
pid_kp = 22.354
pid_ki = 1.552
pid_kd = 80.473

[tmc5160 stepper_x]
cs_pin = PD6
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
diag1_pin = PC15
run_current = 2.00
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_x]
dir_pin = !PC13
step_pin = PC14
enable_pin = !PE6
endstop_pin = PC15
microsteps = 16
rotation_distance = 40
position_endstop = -6
position_min = -6
position_max = 330
homing_speed = 20
full_steps_per_rotation = 200
homing_retract_dist = 0
homing_positive_dir = false
step_pulse_duration = 0.000001

[tmc5160 stepper_x1]
cs_pin = PD5
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2.00
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_x1]
dir_pin = !PE4
step_pin = PE5
enable_pin = !PE3
microsteps = 16
rotation_distance = 40
full_steps_per_rotation = 200
step_pulse_duration = 0.000001

[tmc5160 stepper_y]
cs_pin = PD4
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_y]
dir_pin = !PE1
step_pin = PE2
enable_pin = !PE0
endstop_pin = PF0
microsteps = 16
rotation_distance = 40
position_endstop = 0
position_min = 0
position_max = 315
homing_speed = 20
full_steps_per_rotation = 200
homing_retract_dist = 0
homing_positive_dir = false
step_pulse_duration = 0.000001

[tmc5160 stepper_y1]
cs_pin = PD3
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_y1]
dir_pin = !PB8
step_pin = PB9
enable_pin = !PB7
microsteps = 16
rotation_distance = 40
full_steps_per_rotation = 200
step_pulse_duration = 0.000001

[tmc5160 stepper_z]
cs_pin = PD2
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 1
sense_resistor = 0.075
stealthchop_threshold = 0

[stepper_z]
dir_pin = !PG10
step_pin = PG9
enable_pin = !PG13
endstop_pin = probe:z_virtual_endstop
microsteps = 16
rotation_distance = 8
position_min = -20
position_max = 400
full_steps_per_rotation = 200
homing_retract_dist = 5.0
homing_positive_dir = false
homing_speed = 3
second_homing_speed = 1
step_pulse_duration = 0.000004

[tmc5160 stepper_z1]
cs_pin = PA15
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 1
sense_resistor = 0.075
stealthchop_threshold = 0

[stepper_z1]
dir_pin = !PD7
step_pin = PG11
enable_pin = !PG12
microsteps = 16
rotation_distance = 8

[temperature_sensor Kraken]
sensor_type = temperature_mcu
min_temp = 10
max_temp = 100

[heater_fan hotend_fan]
pin = PA0
max_power = 1.0
kick_start_time = 0.5
heater = extruder
heater_temp = 50.0

[fan]
pin = PF12
enable_pin = PF7
hardware_pwm = false
max_power = 1
cycle_time = 0.00002
off_below = 0.012
kick_start_time = 0.01

[heater_bed]
heater_pin = PF5
sensor_pin = PC5
sensor_type = NTC 100K MGB18-104F39050L32
control = pid
pid_kp = 34.679
pid_ki = 1.492
pid_kd = 201.572
min_temp = 0
max_temp = 120
max_power = 1
pwm_cycle_time = 0.0166

[bed_screws]
screw1 = 10,0
screw2 = 10,260
screw3 = 320,260
screw4 = 320,0

[screws_tilt_adjust]
screw1 = 10, 0
screw1_name = front left screw
screw2 = 10, 260
screw2_name = rear left screw
screw3 = 300, 260
screw3_name = rear right screw
screw4 = 320, 0
screw4_name = front right screw
horizontal_move_z = 10.
speed = 250
screw_thread = CW-M3

[force_move]
enable_force_move = true

[bed_mesh]
speed = 200
horizontal_move_z = 1
mesh_min = 10, 22
mesh_max = 310, 260
mesh_pps = 3,3
probe_count = 25,25
algorithm = bicubic
relative_reference_index = 12
bicubic_tension = 0.2
fade_start = 1
fade_end = 10
split_delta_z = .025
move_check_distance = 5

[neopixel my_neopixel]
pin = PF11
chain_count = 13
color_order = GRB
initial_red = 1.0
initial_green = 1
initial_blue = 1

[gcode_macro BED_MESH]
gcode = 
	BED_MESH_CALIBRATE

[gcode_macro PA_TUNING]
gcode = 
	SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=1 ACCEL=500
	TUNING_TOWER COMMAND=SET_PRESSURE_ADVANCE PARAMETER=ADVANCE START=0 FACTOR=.005

[gcode_macro HOTEND_PID]
gcode = 
	{% set tool_temp = params.TEMPERATURE|default(220)|int %}
	{% set tool_name = printer.toolhead.extruder %}
	PID_CALIBRATE HEATER={tool_name} TARGET={tool_temp}

[gcode_macro BED_PID]
gcode = 
	{% set bed_temp = params.TEMPERATURE|default(60)|int %}
	PID_CALIBRATE HEATER=heater_bed TARGET={bed_temp}

[gcode_macro SCREWS_TILT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro DUMP_WARNINGS]
description = Debug: Print all warning messages from klipper
gcode = 
	{% set parameters = ["printer.configfile.warnings:"] %}
	{% for warning in printer.configfile.warnings %}
	{% set parameters = parameters.append("%s -> %s -> %s\n%s" % (warning.type, warning.section, warning.option, warning.message)) %}
	{% endfor %}
	{action_respond_info(parameters|join("\n"))}

[gcode_macro enable_stepper]
gcode = 
	SET_STEPPER_ENABLE STEPPER=stepper_x ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_x1 ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y1 ENABLE=1

[gcode_macro disable-steppers]
gcode = 
	m84

[gcode_macro M600]
gcode = 
	G4 P1500
	{% set X = params.X|default(50)|float %}
	{% set Y = params.Y|default(0)|float %}
	{% set Z = params.Z|default(10)|float %}
	
	SAVE_GCODE_STATE NAME=M600_state
	PAUSE
	
	G91
	G1 E-{1} F2100
	G1 Z{Z}
	G90
	G1 X{X} Y{Y} F4000
	G91
	M83
	G1 E5 F800
	G1 E-180 F2000
	M82
	RESTORE_GCODE_STATE NAME=M600_state

[gcode_macro PURGE]
gcode = 
	M83
	G1 E120 F250

[gcode_macro _UNLOAD_FILAMENT]
gcode = 
	{% set e_temp = params.TEMPERATURE|default(235)|int %}
	M118 Filament unloading!
	M117 Filament unloading!
	M82
	G92 E0
	{% if printer.extruder.can_extrude|lower != 'true' %}
	
	M118 Hotend heating!
	M109 S{e_temp} T0
	{% endif %}
	G1 E10 F{5*60}
	G0 E-5 F{60*60}
	G0 E-70 F{5*60}
	M400
	M118 Filament unload complete!
	M117 Filament unload complete!

[gcode_macro _LOAD_FILAMENT]
gcode = 
	{% set e_temp = params.TEMPERATURE|default(230)|int %}
	M109 S{e_temp}
	M83
	G1 E50 F300
	G1 E-1 F100
	M82
	M104 S0

[gcode_macro UNLOAD_PLA]
gcode = 
	_UNLOAD_FILAMENT TEMPERATURE=200

[gcode_macro LOAD_PLA]
gcode = 
	_LOAD_FILAMENT TEMPERATURE=200

[gcode_macro UNLOAD_ABS]
gcode = 
	_UNLOAD_FILAMENT TEMPERATURE=250

[gcode_macro LOAD_ABS]
gcode = 
	_LOAD_FILAMENT TEMPERATURE=250

[gcode_macro UNLOAD_PETG]
gcode = 
	_UNLOAD_FILAMENT TEMPERATURE=235

[gcode_macro LOAD_PETG]
gcode = 
	_LOAD_FILAMENT TEMPERATURE=235

[gcode_macro LOAD_FILAMENT]
gcode = 
	{% set speed = params.SPEED|default(300) %}
	{% set max_velocity = printer.configfile.settings['extruder'].max_extrude_only_velocity %}
	SAVE_GCODE_STATE NAME=load_state
	M300
	G91
	G92 E0
	G1 E350 F{max_velocity}
	G1 E25 F{speed}
	M300
	M300
	RESTORE_GCODE_STATE NAME=load_state

[gcode_macro UNLOAD_FILAMENT]
gcode = 
	{% set speed = params.SPEED|default(300) %}
	{% set max_velocity = printer.configfile.settings['extruder'].max_extrude_only_velocity %}
	SAVE_GCODE_STATE NAME=unload_state
	G91
	M300
	G92 E0
	G1 E25 F{speed}
	G1 E-420 F{max_velocity}
	M300
	M300
	RESTORE_GCODE_STATE NAME=unload_state

[gcode_macro START_PRINT]
gcode = 
	
	{% set DWELL = params.DWELL|default(00)|int %}
	{% set bedTemp = params.BED|default(70)|int %}
	{% set hotendTemp = params.HOTEND|default(210)|int %}
	SET_FAN_SPEED FAN=LED_Bar SPEED=0.5
	CLEAR_PAUSE
	RESETSPEEDS
	G21
	G90
	M83
	M140 S{bedTemp}; start heating the bed
	M104 S100
	SET_DISPLAY_TEXT MSG="Waiting for temperatures..."
	HEATSOAK DWELL={DWELL}
	G28 X Y
	ATTACH_PROBE_LOCK
	G28 Z
	SET_DISPLAY_TEXT MSG="Adjusting Z Tilt"
	Z_TILT_ADJUST
	G28 Z
	
	SET_DISPLAY_TEXT MSG="Calibrating Bed Mesh"
	BED_MESH_CLEAR
	BED_MESH_CALIBRATE
	BED_MESH_PROFILE LOAD=default
	SET_DISPLAY_TEXT MSG="Heating Extruder to temp"
	G1 X1 Y1 Z0.5 F9000
	M109 S{hotendTemp}; wait for extruder to heat up
	TR_UNLOAD_TOOLHEAD
	TR_HOME
	FIXED_PURGE_LINE
	M83
	SET_DISPLAY_TEXT MSG="Printing..."
	TR_SYNC_TO_EXTRUDER

[gcode_macro HEATSOAK]
gcode = 
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion..."
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 5% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 10% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 15% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 20% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 25% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 30% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 35% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 40% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 45% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 50% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 55% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 60% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 65% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 70% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 75% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 80% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 85% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 90% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 95% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Thermal expansion done"

[gcode_macro _CG28]
gcode = 
	{% if "xyz" not in printer.toolhead.homed_axes %}
	G28
	{% endif %}

[gcode_macro FIXED_PURGE_LINE]
gcode = 
	M83
	G92 E0
	G1 Z1 F3000
	G1 X1 Y80 Z0.3 E10  F1200
	G1 X1 Y120 E11  F1200
	G1 E-0.8 F1000
	G92 E0
	G1 Z1 F2000

[gcode_macro END_PRINT]
gcode = 
	TR_UNLOAD_TOOLHEAD
	
	TURN_OFF_HEATERS
	G91
	G1 Z10 E-2 F3600
	
	G90
	G1 X30 Y250 F7000; home X axis
	M106 S80
	G4 P10000
	M106 S0
	M221 S100
	CLEAR_PAUSE
	
	SET_GCODE_OFFSET Z=0.0
	RESETSPEEDS
	
	M84
	BED_MESH_CLEAR
	SET_FAN_SPEED FAN=LED_Bar SPEED=0
	TR_UNSYNC_TO_EXTRUDER
	UPDATE_GIT

[gcode_macro PARK]
description = Park the toolhead at the front and retract some filament if the nozzle is hot
gcode = 
	{% set E = params.E|default(1.7)|float %}
	
	{% set Px, Py = printer["gcode_macro _USER_VARIABLES"].park_position_xy|map('float') %}
	{% set park_lift_z = printer["gcode_macro _USER_VARIABLES"].park_lift_z %}
	
	{% set St = printer["gcode_macro _USER_VARIABLES"].travel_speed * 60 %}
	{% set Sz = printer["gcode_macro _USER_VARIABLES"].z_drop_speed * 60 %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	
	{% set z_safe = act_z + park_lift_z %}
	{% if z_safe > max_z %}
	{% set z_safe = max_z %}
	{% endif %}
	
	
	{% if printer.extruder.temperature > 185 %}
	G10
	{% endif %}
	G90
	G1 Z{z_safe} F{Sz}
	
	G0 X{Px} Y{Py} F{St}

[gcode_macro RESETSPEEDS]
gcode = 
	SET_VELOCITY_LIMIT VELOCITY={printer.configfile.settings.printer.max_velocity}
	SET_VELOCITY_LIMIT ACCEL={printer.configfile.settings.printer.max_accel}
	SET_VELOCITY_LIMIT ACCEL_TO_DECEL={printer.configfile.settings.printer.max_accel_to_decel}
	SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={printer.configfile.settings.printer.square_corner_velocity}

[gcode_macro DISABLEXYE]
gcode = 
	SET_STEPPER_ENABLE STEPPER=extruder ENABLE=0
	SET_STEPPER_ENABLE STEPPER=stepper_x ENABLE=0
	
	SET_STEPPER_ENABLE STEPPER=stepper_y ENABLE=0
	
	SET_STEPPER_ENABLE STEPPER=stepper_z ENABLE=1

[gcode_macro TEST_SPEED]
gcode = 
	
	{% set speed  = params.SPEED|default(printer.configfile.settings.printer.max_velocity)|int %}
	
	{% set iterations = params.ITERATIONS|default(5)|int %}
	
	{% set accel  = params.ACCEL|default(printer.configfile.settings.printer.max_accel)|int %}
	
	{% set bound = params.BOUND|default(20)|int %}
	
	{% set smallpatternsize = SMALLPATTERNSIZE|default(20)|int %}
	
	
	
	{% set x_min = 10 + bound %}
	{% set x_max = 300 - bound %}
	{% set y_min = 10 + bound %}
	{% set y_max = 300 - bound %}
	
	
	
	{% set x_center = (printer.toolhead.axis_minimum.x|float + printer.toolhead.axis_maximum.x|float ) / 2 %}
	{% set y_center = (printer.toolhead.axis_minimum.y|float + printer.toolhead.axis_maximum.y|float ) / 2 %}
	
	
	{% set x_center_min = x_center - (smallpatternsize/2) %}
	{% set x_center_max = x_center + (smallpatternsize/2) %}
	{% set y_center_min = y_center - (smallpatternsize/2) %}
	{% set y_center_max = y_center + (smallpatternsize/2) %}
	
	
	SAVE_GCODE_STATE NAME=TEST_SPEED
	
	
	{ action_respond_info("TEST_SPEED: starting %d iterations at speed %d, accel %d" % (iterations, speed, accel)) }
	
	
	M400
	G28
	
	{% if printer.configfile.settings.quad_gantry_level %}
	{% if printer.quad_gantry_level.applied == False %}
	QUAD_GANTRY_LEVEL
	G28 Z
	{% endif %}
	{% endif %}
	
	G90
	G1 X{printer.toolhead.axis_maximum.x-50} Y{printer.toolhead.axis_maximum.y-50} F{30*60}
	M400
	G28 X Y
	G0 X{300} Y{300} F{30*60}
	G4 P1000
	GET_POSITION
	
	
	G0 X{x_min} Y{y_min} Z{bound + 10} F{speed*60}
	
	
	SET_VELOCITY_LIMIT VELOCITY={speed} ACCEL={accel} ACCEL_TO_DECEL={accel / 2}
	
	{% for i in range(iterations) %}
	
	G0 X{x_min} Y{y_min} F{speed*60}
	G0 X{x_max} Y{y_max} F{speed*60}
	G0 X{x_min} Y{y_min} F{speed*60}
	G0 X{x_max} Y{y_min} F{speed*60}
	G0 X{x_min} Y{y_max} F{speed*60}
	G0 X{x_max} Y{y_min} F{speed*60}
	
	
	G0 X{x_min} Y{y_min} F{speed*60}
	G0 X{x_min} Y{y_max} F{speed*60}
	G0 X{x_max} Y{y_max} F{speed*60}
	G0 X{x_max} Y{y_min} F{speed*60}
	
	
	G0 X{x_center_min} Y{y_center_min} F{speed*60}
	G0 X{x_center_max} Y{y_center_max} F{speed*60}
	G0 X{x_center_min} Y{y_center_min} F{speed*60}
	G0 X{x_center_max} Y{y_center_min} F{speed*60}
	G0 X{x_center_min} Y{y_center_max} F{speed*60}
	G0 X{x_center_max} Y{y_center_min} F{speed*60}
	
	
	G0 X{x_center_min} Y{y_center_min} F{speed*60}
	G0 X{x_center_min} Y{y_center_max} F{speed*60}
	G0 X{x_center_max} Y{y_center_max} F{speed*60}
	G0 X{x_center_max} Y{y_center_min} F{speed*60}
	{% endfor %}
	
	
	SET_VELOCITY_LIMIT VELOCITY={printer.configfile.settings.printer.max_velocity} ACCEL={printer.configfile.settings.printer.max_accel} ACCEL_TO_DECEL={printer.configfile.settings.printer.max_accel_to_decel}
	
	
	M400
	G28
	
	G90
	G0 X{300} Y{300} F{30*60}
	G4 P1000
	GET_POSITION
	
	
	RESTORE_GCODE_STATE NAME=TEST_SPEED

[gcode_macro update_git]
gcode = 
	RUN_SHELL_COMMAND CMD=update_git_script

[gcode_shell_command update_git_script]
command = bash /home/pi/klipper-backup/script.sh
timeout = 90.0
verbose = True

[mcu tr]
serial = /dev/serial/by-id/usb-Klipper_stm32g0b1xx_290023000950415833323720-if00

[belay my_belay]
extruder_type = trad_rack
sensor_pin = ^tr:PB9
multiplier_high = 1.05
multiplier_low = 0.8
debug_level = 1

[trad_rack]
sync_to_extruder = true
selector_max_velocity = 400
selector_max_accel = 10000
lane_count = 4
lane_spacing = 17.26
servo_down_angle = 0
servo_up_angle = 130
toolhead_unload_speed = 20
extruder_load_speed = 2
toolhead_sense_speed = 20
selector_unload_length = 20
bowden_length = 865
extruder_load_length = 60
hotend_load_length = 20
toolhead_unload_length = 80
buffer_pull_speed = 100.0
pre_unload_gcode = 
	SAVE_GCODE_STATE NAME=PRE_UNLOAD_state
	{% if printer.virtual_sdcard.is_active %}
	{% set z_max = printer.toolhead.axis_maximum.z - printer.gcode_move.homing_origin.z %}
	{% set z_lift = printer["gcode_macro TR_Variables"].z_lift|float %}
	{% set x_park = printer["gcode_macro TR_Variables"].x_park|float %}
	{% set y_park = printer["gcode_macro TR_Variables"].y_park|float %}
	{% set do_x_park = printer["gcode_macro TR_Variables"].do_x_park %}
	{% set do_y_park = printer["gcode_macro TR_Variables"].do_y_park %}
	{% set st = printer["gcode_macro TR_Variables"].travel_speed * 60 %}
	{% set shape_tip = printer["gcode_macro TR_Variables"].shape_tip %}
	{% set use_wiper = printer["gcode_macro TR_Variables"].use_wiper %}
	{% set x = printer.gcode_move.gcode_position.x %}
	{% set y = printer.gcode_move.gcode_position.y %}
	{% set z = printer.gcode_move.gcode_position.z %}
	{% set z_park = [z + z_lift, z_max]|min %}
	
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=x VALUE={x}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=y VALUE={y}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=z VALUE={z}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=saved_pos VALUE={True}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=z_park VALUE={z_park}
	
	
	G90
	G1 Z{z_park}
	
	
	{% if use_wiper %}
	Go_To_Purge_Location
	
	
	{% else %}
	G90
	{% if do_x_park %}
	{% set x = x_park %}
	{% endif %}
	{% if do_y_park %}
	{% set y = y_park %}
	{% endif %}
	G1 X{x} Y{y} F{st}
	{% endif %}
	
	
	{% if shape_tip %}
	Shape_Tip
	{% endif %}
	{% else %}
	
	{% if use_wiper %}
	Go_To_Purge_Location
	{% endif %}
	
	
	Shape_Tip
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRE_UNLOAD_state
post_load_gcode = 
	SAVE_GCODE_STATE NAME=POST_LOAD_state
	{% set use_wiper = printer["gcode_macro TR_Variables"].use_wiper %}
	{% if printer.virtual_sdcard.is_active %}
	{% set st = printer["gcode_macro TR_Variables"].travel_speed * 60 %}
	{% set take_frame = printer["gcode_macro TR_Variables"].take_frame %}
	{% set x = printer["gcode_macro TR_Variables"].x %}
	{% set y = printer["gcode_macro TR_Variables"].y %}
	{% set z = printer["gcode_macro TR_Variables"].z %}
	{% set saved_pos = printer["gcode_macro TR_Variables"].saved_pos %}
	{% set z_park = printer["gcode_macro TR_Variables"].z_park %}
	
	
	{% if take_frame %}
	TIMELAPSE_TAKE_FRAME
	{% endif %}
	
	
	{% if use_wiper %}
	Home_and_Wipe_Nozzle
	{% endif %}
	
	
	{% if saved_pos %}
	G90
	G1 Z{z_park}
	G1 X{x} Y{y} F{st}
	G1 Z{z}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=saved_pos VALUE={False}
	{% endif %}
	
	Restore_Pressure_Advance
	{% elif use_wiper %}
	Home_and_Wipe_Nozzle
	{% endif %}
	RESTORE_GCODE_STATE NAME=POST_LOAD_state

[stepper_tr_selector]
step_pin = tr:PB15
dir_pin = !tr:PB14
enable_pin = !tr:PA8
rotation_distance = 40
microsteps = 16
full_steps_per_rotation = 400
endstop_pin = ^tr:PA3
position_min = 0.0
position_endstop = 0
position_max = 158
homing_speed = 30

[stepper_tr_fil_driver]
step_pin = tr:PD2
dir_pin = tr:PB13
enable_pin = !tr:PD1
rotation_distance = 22.67895
gear_ratio = 50:17
microsteps = 16
full_steps_per_rotation = 400
endstop_pin = ^tr:PA4
position_min = -5000
position_endstop = 0
position_max = 5000
homing_positive_dir = False

[tmc2209 stepper_tr_selector]
uart_pin = tr:PA10
interpolate = True
run_current = 1.3
sense_resistor = 0.110

[tmc2209 stepper_tr_fil_driver]
uart_pin = tr:PC7
interpolate = False
run_current = 1.3
sense_resistor = 0.110

[servo tr_servo]
pin = tr:PA0
maximum_servo_angle = 131
minimum_pulse_width = 0.000700
maximum_pulse_width = 0.002200

[gcode_macro ACTIVATE_EXTRUDER]
rename_existing = ACTIVATE_EXTRUDER.1
gcode = 
	{% set EXTRUDER = params.EXTRUDER|default('extruder')|lower|replace('extruder', '') %}
	{% if EXTRUDER == '' %}
	{% set EXTRUDER = '0' %}
	{% endif %}
	TR_LOAD_TOOLHEAD LANE={EXTRUDER}

[gcode_macro TR_Variables]
description = Variables for use with Trad Rack pre unload and post load gcode
variable_z_lift = 0.1
variable_x_park = 0.0
variable_y_park = 175.0
variable_do_x_park = False
variable_do_y_park = False
variable_travel_speed = 300
variable_shape_tip = False
variable_take_frame = False
variable_use_wiper = False
variable_x = 0
variable_y = 0
variable_z = 0
variable_saved_pos = False
variable_z_park = 0
gcode = 

[gcode_macro Shape_Tip]
description = Perform tip-shaping, retraction, and cooling moves
gcode = 
	SAVE_GCODE_STATE NAME=Shape_Tip_state
	Save_Pressure_Advance
	
	Slicer_Unload
	
	
	Restore_Pressure_Advance
	RESTORE_GCODE_STATE NAME=Shape_Tip_state

[gcode_macro Set_Slicer_Unload_Preset]
description = Apply a preset of values to use for the Slicer_Unload macro
variable_asa_ss = {
	"filament_ramming_parameters": "120 110 5.32258 5.45161 5.67742 6 6.48387 7.12903 7.90323 8.70968 9.3871 9.83871 10.0968 10.2258| 0.05 5.30967 0.45 5.50967 0.95 6.1871 1.45 7.39677 1.95 9.05484 2.45 10 2.95 10.3098 3.45 13.0839 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": True}
variable_pla_ss = {
	"filament_ramming_parameters": "130 120 2.70968 2.93548 3.32258 3.83871 4.58065 5.54839 6.51613 7.35484 7.93548 8.16129| 0.05 2.66451 0.45 3.05805 0.95 4.05807 1.45 5.97742 1.95 7.69999 2.45 8.1936 2.95 11.342 3.45 11.4065 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": True}
variable_asa_ps = {
	"filament_ramming_parameters": "120 110 5.32258 5.45161 5.67742 6 6.48387 7.12903 7.90323 8.70968 9.3871 9.83871 10.0968 10.2258| 0.05 5.30967 0.45 5.50967 0.95 6.1871 1.45 7.39677 1.95 9.05484 2.45 10 2.95 10.3098 3.45 13.0839 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": False}
variable_pla_ps = {
	"filament_ramming_parameters": "130 120 2.70968 2.93548 3.32258 3.83871 4.58065 5.54839 6.51613 7.35484 7.93548 8.16129| 0.05 2.66451 0.45 3.05805 0.95 4.05807 1.45 5.97742 1.95 7.69999 2.45 8.1936 2.95 11.342 3.45 11.4065 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": False}
gcode = 
	{% set preset_name = params.PRESET|lower %}
	{% if preset_name in printer['gcode_macro Set_Slicer_Unload_Preset'] %}
	{% set preset = printer['gcode_macro Set_Slicer_Unload_Preset'].preset_name %}
	{% for key in preset %}
	SET_GCODE_VARIABLE MACRO=Slicer_Unload VARIABLE={key} VALUE={preset[key]}
	{% endfor %}
	{% else %}
	{ action_raise_error("Preset \"%s\" does not exist" % preset_name) }
	{% endif %}

[gcode_macro Slicer_Unload]
description = Mimic ramming and unload behavior of PrusaSlicer or SuperSlicer
variable_cooling_tube_length = 14
variable_cooling_tube_retraction = 30
variable_filament_cooling_final_speed = 30
variable_filament_cooling_initial_speed = 20
variable_filament_cooling_moves = 4
variable_filament_diameter = 1.75
variable_filament_unloading_speed = 90
variable_filament_unloading_speed_start = 100
variable_filament_toolchange_delay = 0
variable_filament_ramming_parameters = "120 110 5.32258 5.45161 5.67742 6 6.48387 7.12903 7.90323 8.70968 9.3871 9.83871 10.0968 10.2258| 0.05 5.30967 0.45 5.50967 0.95 6.1871 1.45 7.39677 1.95 9.05484 2.45 10 2.95 10.3098 3.45 13.0839 3.95 7.6 4.45 7.6 4.95 7.6"
variable_filament_enable_toolchange_temp = False
variable_filament_toolchange_temp = 200
variable_filament_use_fast_skinnydip = False
variable_filament_enable_toolchange_part_fan = False
variable_filament_toolchange_part_fan_speed = 50
variable_filament_use_skinnydip = True
variable_filament_skinnydip_distance = 24
variable_filament_melt_zone_pause = 0
variable_filament_cooling_zone_pause = 0
variable_filament_dip_insertion_speed = 33
variable_filament_dip_extraction_speed = 70
variable_superslicer = False
variable_do_ramming = False
variable_do_unload = True
gcode = 
	{% set NEW_TEMPERATURE = params.NEW_TEMPERATURE|default(0)|float %}
	{% set prev_temp_target = printer.extruder.target %}
	
	SAVE_GCODE_STATE NAME=Slicer_Unload_state
	Save_Pressure_Advance
	
	M83
	M220 S100
	SET_PRESSURE_ADVANCE ADVANCE=0
	
	
	{% if do_ramming %}
	
	{% set ramming_speed = (filament_ramming_parameters.split('|')[0]).split(' ') %}
	
	
	{% set filament_area = 3.1415 * (filament_diameter / 2) ** 2 %}
	
	
	{% for i in range(2, ramming_speed|length) %}
	
	{% set f = ramming_speed[i]|float / filament_area %}
	
	
	{% set e = f * 0.25 %}
	
	
	G1 E{e} F{f * 60}
	{% endfor %}
	{% endif %}
	
	
	{% if do_unload %}
	
	{% if superslicer and filament_enable_toolchange_temp and not filament_use_fast_skinnydip %}
	_Wait_for_Toolchange_Temp
	{% endif %}
	
	
	{% set total_retraction_distance = cooling_tube_retraction + cooling_tube_length / 2 - 15 %}
	G1 E-15 F{filament_unloading_speed_start * 60}
	G1 E-{0.70 * total_retraction_distance} F{1.0 * filament_unloading_speed * 60}
	G1 E-{0.20 * total_retraction_distance} F{0.5 * filament_unloading_speed * 60}
	G1 E-{0.10 * total_retraction_distance} F{0.3 * filament_unloading_speed * 60}
	
	
	{% if not superslicer or not filament_enable_toolchange_temp %}
	{% if NEW_TEMPERATURE != 0 and (NEW_TEMPERATURE != prev_temp_target) %}
	M104 S{NEW_TEMPERATURE}
	{% endif %}
	
	
	{% elif superslicer and filament_enable_toolchange_temp and not filament_use_fast_skinnydip %}
	{% if NEW_TEMPERATURE != 0 %}
	M104 S{NEW_TEMPERATURE}
	{% else %}
	M104 S{prev_temp_target}
	{% endif %}
	{% endif %}
	
	
	{% set speed_inc = (filament_cooling_final_speed - filament_cooling_initial_speed) / (2 * filament_cooling_moves - 1) %}
	{% for i in range(filament_cooling_moves) %}
	{% set speed = filament_cooling_initial_speed + speed_inc * 2 * i %}
	G1 E{cooling_tube_length} F{speed * 60}
	{% set speed = speed + speed_inc %}
	G1 E-{cooling_tube_length} F{speed * 60}
	{% endfor %}
	
	
	{% if superslicer %}
	
	{% if filament_enable_toolchange_temp and filament_use_fast_skinnydip %}
	_Wait_for_Toolchange_Temp
	{% endif %}
	
	
	{% if filament_use_skinnydip %}
	G1 E{filament_skinnydip_distance} F{filament_dip_insertion_speed * 60}
	G4 P{filament_melt_zone_pause}
	G1 E-{filament_skinnydip_distance} F{filament_dip_extraction_speed * 60}
	G4 P{filament_cooling_zone_pause}
	{% endif %}
	
	
	{% if filament_enable_toolchange_temp and filament_use_fast_skinnydip %}
	{% if NEW_TEMPERATURE != 0 %}
	M109 S{NEW_TEMPERATURE}
	{% else %}
	M109 S{prev_temp_target}
	{% endif %}
	{% elif filament_enable_toolchange_temp and filament_use_fast_skinnydip %}
	{% if NEW_TEMPERATURE != 0 and (NEW_TEMPERATURE != prev_temp_target) %}
	M109 S{NEW_TEMPERATURE}
	{% endif %}
	{% endif %}
	{% endif %}
	
	
	G4 P{filament_toolchange_delay}
	
	
	
	{% endif %}
	
	Restore_Pressure_Advance
	RESTORE_GCODE_STATE NAME=Slicer_Unload_state

[gcode_macro _Wait_for_Toolchange_Temp]
description = Helper function for Slicer_Unload
gcode = 
	{% set tc_temp = printer["gcode_macro Slicer_Unload"].filament_toolchange_temp %}
	{% set fan_on = printer["gcode_macro Slicer_Unload"].filament_enable_toolchange_part_fan %}
	{% set fan_speed = printer["gcode_macro Slicer_Unload"].filament_toolchange_part_fan_speed %}
	
	{% set prev_fan_speed = printer.fan.speed %}
	{% if fan_on %}
	M106 S{(fan_speed / 100.0 * 255)|int}
	{% endif %}
	M109 S{filament_toolchange_temp}
	{% if fan_on %}
	M106 S{(prev_fan_speed * 255)|int}
	{% endif %}

[gcode_macro Home_and_Wipe_Nozzle]
description = Home x and y if needed, then wipe the nozzle
gcode = 
	
	{% if not 'xy' in printer.toolhead.homed_axes %}
	G28 X Y
	{% endif %}
	
	
	Wipe_Nozzle

[gcode_macro Save_Pressure_Advance]
description = Save the current pressure advance value
variable_pa = -1
gcode = 
	
	{% set pa = printer.extruder.pressure_advance %}
	{% if pa > 0 %}
	SET_GCODE_VARIABLE MACRO=Save_Pressure_Advance VARIABLE=pa VALUE={pa}
	{% endif %}

[gcode_macro Restore_Pressure_Advance]
description = Restore saved pressure advance value
gcode = 
	
	{% if not (printer["gcode_macro Save_Pressure_Advance"].pa == -1) %}
	SET_PRESSURE_ADVANCE ADVANCE={printer["gcode_macro Save_Pressure_Advance"].pa}
	{% endif %}

[safe_z_home]
home_xy_position = 165, 165
z_hop = 10

[z_tilt]
z_positions = 
	-80,  -20
	350, -20
points = 
	15, 150
	275, 150
speed = 50
horizontal_move_z = 10
retries = 30
retry_tolerance = 0.1

[input_shaper]
shaper_type_x = zv
shaper_freq_x = 120.6
shaper_type_y = zv
shaper_freq_y = 76.6

[printer]
kinematics = corexy
max_velocity = 3000
max_accel = 20000
max_z_velocity = 20
max_z_accel = 15
square_corner_velocity = 10

[exclude_object]

[gcode_arcs]
resolution = 0.05

[idle_timeout]
gcode = 
	{% if not printer.pause_resume.is_paused %}
	TURN_OFF_HEATERS
	M84
	{% endif %}

[save_variables]
filename = vars.cfg

[mcu]
serial = /dev/serial/by-id/usb-Klipper_stm32h723xx_4C0023001551313338343730-if00

[bed_mesh default]
version = 1
points = 
	-0.215000, -0.210000, -0.190000, -0.185000, -0.170000, -0.145000, -0.135000, -0.120000, -0.105000, -0.070000, -0.055000, -0.035000, 0.000000, 0.010000, 0.025000, 0.050000, 0.080000, 0.105000, 0.130000, 0.135000, 0.150000, 0.155000, 0.165000, 0.190000, 0.205000
	-0.160000, -0.155000, -0.160000, -0.150000, -0.130000, -0.110000, -0.105000, -0.085000, -0.055000, -0.035000, -0.025000, 0.000000, 0.025000, 0.055000, 0.075000, 0.100000, 0.110000, 0.130000, 0.160000, 0.170000, 0.190000, 0.190000, 0.205000, 0.205000, 0.220000
	-0.160000, -0.150000, -0.140000, -0.135000, -0.115000, -0.105000, -0.090000, -0.070000, -0.040000, -0.025000, -0.010000, 0.015000, 0.030000, 0.045000, 0.080000, 0.100000, 0.115000, 0.135000, 0.160000, 0.165000, 0.180000, 0.185000, 0.190000, 0.220000, 0.235000
	-0.120000, -0.115000, -0.115000, -0.100000, -0.080000, -0.070000, -0.065000, -0.040000, -0.015000, 0.010000, 0.030000, 0.050000, 0.065000, 0.090000, 0.110000, 0.130000, 0.145000, 0.175000, 0.195000, 0.195000, 0.195000, 0.205000, 0.210000, 0.235000, 0.240000
	-0.075000, -0.065000, -0.055000, -0.045000, -0.040000, -0.020000, -0.005000, 0.015000, 0.035000, 0.065000, 0.075000, 0.090000, 0.105000, 0.115000, 0.140000, 0.170000, 0.175000, 0.190000, 0.205000, 0.205000, 0.205000, 0.210000, 0.215000, 0.240000, 0.240000
	-0.045000, -0.050000, -0.055000, -0.045000, -0.015000, -0.005000, -0.005000, 0.020000, 0.060000, 0.065000, 0.075000, 0.100000, 0.115000, 0.125000, 0.135000, 0.170000, 0.175000, 0.175000, 0.205000, 0.205000, 0.205000, 0.205000, 0.210000, 0.220000, 0.225000
	-0.035000, -0.030000, -0.030000, -0.020000, 0.000000, 0.015000, 0.015000, 0.035000, 0.065000, 0.085000, 0.100000, 0.110000, 0.115000, 0.130000, 0.160000, 0.170000, 0.180000, 0.180000, 0.200000, 0.200000, 0.200000, 0.205000, 0.205000, 0.220000, 0.235000
	0.005000, 0.010000, 0.015000, 0.025000, 0.035000, 0.040000, 0.055000, 0.085000, 0.095000, 0.110000, 0.115000, 0.125000, 0.140000, 0.160000, 0.175000, 0.180000, 0.190000, 0.190000, 0.225000, 0.225000, 0.225000, 0.225000, 0.230000, 0.235000, 0.250000
	0.055000, 0.065000, 0.060000, 0.065000, 0.075000, 0.090000, 0.100000, 0.110000, 0.120000, 0.130000, 0.140000, 0.155000, 0.170000, 0.180000, 0.190000, 0.195000, 0.210000, 0.220000, 0.235000, 0.235000, 0.235000, 0.235000, 0.245000, 0.250000, 0.260000
	0.100000, 0.105000, 0.110000, 0.110000, 0.120000, 0.135000, 0.145000, 0.150000, 0.155000, 0.155000, 0.170000, 0.185000, 0.190000, 0.195000, 0.195000, 0.215000, 0.230000, 0.235000, 0.245000, 0.245000, 0.245000, 0.235000, 0.245000, 0.250000, 0.260000
	0.100000, 0.115000, 0.125000, 0.130000, 0.135000, 0.145000, 0.150000, 0.155000, 0.165000, 0.175000, 0.190000, 0.200000, 0.205000, 0.205000, 0.215000, 0.225000, 0.230000, 0.245000, 0.255000, 0.240000, 0.240000, 0.240000, 0.245000, 0.250000, 0.250000
	0.155000, 0.150000, 0.150000, 0.150000, 0.160000, 0.165000, 0.165000, 0.175000, 0.175000, 0.195000, 0.200000, 0.215000, 0.205000, 0.210000, 0.215000, 0.225000, 0.235000, 0.240000, 0.245000, 0.240000, 0.240000, 0.235000, 0.220000, 0.235000, 0.240000
	0.170000, 0.165000, 0.165000, 0.170000, 0.180000, 0.190000, 0.190000, 0.185000, 0.200000, 0.205000, 0.220000, 0.230000, 0.225000, 0.225000, 0.240000, 0.245000, 0.240000, 0.250000, 0.255000, 0.245000, 0.250000, 0.245000, 0.245000, 0.240000, 0.240000
	0.210000, 0.200000, 0.195000, 0.200000, 0.210000, 0.210000, 0.210000, 0.215000, 0.215000, 0.215000, 0.235000, 0.245000, 0.235000, 0.235000, 0.245000, 0.250000, 0.240000, 0.250000, 0.250000, 0.250000, 0.255000, 0.250000, 0.235000, 0.235000, 0.240000
	0.240000, 0.250000, 0.250000, 0.245000, 0.260000, 0.260000, 0.255000, 0.255000, 0.255000, 0.250000, 0.265000, 0.265000, 0.260000, 0.255000, 0.260000, 0.255000, 0.255000, 0.270000, 0.260000, 0.255000, 0.250000, 0.255000, 0.245000, 0.250000, 0.240000
	0.270000, 0.260000, 0.255000, 0.265000, 0.265000, 0.265000, 0.265000, 0.260000, 0.260000, 0.255000, 0.265000, 0.265000, 0.265000, 0.255000, 0.255000, 0.250000, 0.255000, 0.250000, 0.250000, 0.245000, 0.245000, 0.235000, 0.230000, 0.235000, 0.240000
	0.275000, 0.280000, 0.275000, 0.275000, 0.275000, 0.275000, 0.275000, 0.275000, 0.280000, 0.280000, 0.280000, 0.270000, 0.270000, 0.270000, 0.265000, 0.265000, 0.265000, 0.270000, 0.260000, 0.255000, 0.235000, 0.235000, 0.235000, 0.240000, 0.235000
	0.335000, 0.315000, 0.305000, 0.310000, 0.305000, 0.300000, 0.295000, 0.290000, 0.300000, 0.295000, 0.290000, 0.290000, 0.280000, 0.270000, 0.270000, 0.275000, 0.275000, 0.265000, 0.250000, 0.245000, 0.235000, 0.225000, 0.225000, 0.230000, 0.235000
	0.355000, 0.350000, 0.345000, 0.325000, 0.330000, 0.325000, 0.325000, 0.325000, 0.315000, 0.310000, 0.300000, 0.290000, 0.285000, 0.290000, 0.275000, 0.275000, 0.265000, 0.265000, 0.250000, 0.245000, 0.235000, 0.225000, 0.230000, 0.225000, 0.215000
	0.395000, 0.385000, 0.380000, 0.370000, 0.365000, 0.370000, 0.360000, 0.355000, 0.345000, 0.340000, 0.330000, 0.320000, 0.310000, 0.305000, 0.300000, 0.290000, 0.275000, 0.260000, 0.255000, 0.255000, 0.250000, 0.235000, 0.230000, 0.230000, 0.230000
	0.395000, 0.390000, 0.375000, 0.375000, 0.375000, 0.370000, 0.365000, 0.360000, 0.355000, 0.335000, 0.325000, 0.315000, 0.315000, 0.300000, 0.295000, 0.280000, 0.255000, 0.260000, 0.250000, 0.240000, 0.230000, 0.235000, 0.230000, 0.205000, 0.195000
	0.405000, 0.395000, 0.395000, 0.390000, 0.380000, 0.375000, 0.370000, 0.360000, 0.355000, 0.345000, 0.325000, 0.325000, 0.310000, 0.295000, 0.290000, 0.270000, 0.250000, 0.240000, 0.235000, 0.235000, 0.230000, 0.205000, 0.195000, 0.195000, 0.195000
	0.405000, 0.395000, 0.380000, 0.375000, 0.375000, 0.370000, 0.360000, 0.345000, 0.340000, 0.330000, 0.305000, 0.300000, 0.285000, 0.270000, 0.250000, 0.235000, 0.220000, 0.215000, 0.220000, 0.205000, 0.195000, 0.175000, 0.175000, 0.170000, 0.165000
	0.405000, 0.390000, 0.395000, 0.385000, 0.365000, 0.350000, 0.345000, 0.330000, 0.320000, 0.305000, 0.290000, 0.265000, 0.260000, 0.240000, 0.225000, 0.215000, 0.205000, 0.190000, 0.180000, 0.185000, 0.165000, 0.150000, 0.145000, 0.145000, 0.145000
	0.430000, 0.425000, 0.400000, 0.395000, 0.385000, 0.370000, 0.365000, 0.340000, 0.320000, 0.305000, 0.295000, 0.270000, 0.250000, 0.235000, 0.215000, 0.215000, 0.200000, 0.190000, 0.185000, 0.165000, 0.155000, 0.145000, 0.135000, 0.130000, 0.135000
x_count = 25
y_count = 25
mesh_x_pps = 3
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 310.0
min_y = 26.43
max_y = 281.31
=======================
Config error
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/klippy.py", line 175, in _connect
    self._read_config()
  File "/home/pi/klipper/klippy/klippy.py", line 143, in _read_config
    m.add_printer_objects(config)
  File "/home/pi/klipper/klippy/toolhead.py", line 658, in add_printer_objects
    config.get_printer().add_object('toolhead', ToolHead(config))
                                                ^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/toolhead.py", line 261, in __init__
    self.kin = mod.load_kinematics(self, config)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/kinematics/corexy.py", line 99, in load_kinematics
    return CoreXYKinematics(toolhead, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/kinematics/corexy.py", line 12, in __init__
    self.rails = [stepper.LookupMultiRail(config.getsection('stepper_' + n))
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/kinematics/corexy.py", line 12, in <listcomp>
    self.rails = [stepper.LookupMultiRail(config.getsection('stepper_' + n))
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/stepper.py", line 423, in LookupMultiRail
    rail = PrinterRail(config, need_position_minmax,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/stepper.py", line 304, in __init__
    self.add_extra_stepper(config)
  File "/home/pi/klipper/klippy/stepper.py", line 383, in add_extra_stepper
    pin_params = ppins.parse_pin(endstop_pin, True, True)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/pins.py", line 83, in parse_pin
    raise error("Unknown pin chip name '%s'" % (chip_name,))
pins.error: Unknown pin chip name 'probe'
webhooks client 140733886813264: New connection
webhooks client 140733886813264: Client info {'program': 'Moonraker', 'version': 'v0.8.0-308-g71b46cc'}
Attempting MCU 'mcu' reset
Attempting MCU 'tr' reset
webhooks client 140733886813264: Disconnected
Restarting printer
Start printer at Mon Feb  5 14:51:56 2024 (1707144716.9 90632.8)
===== Config file =====
[virtual_sdcard]
path = /home/pi/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]
recover_velocity = 350

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	TURN_OFF_HEATERS
	G91
	G1 Z10 E-2 F3600
	G1 E-3 F3600
	G90
	G1 X30 Y250 F7000; home X axis
	M106 S80
	G4 P10000
	M106 S0
	M221 S100
	CANCEL_PRINT_BASE
	CLEAR_PAUSE
	
	SET_GCODE_OFFSET Z=0.0
	RESETSPEEDS
	M84
	
	BED_MESH_CLEAR

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	
	{% set x_park = printer.toolhead.axis_maximum.x|float - 5.0 %}
	{% set y_park = printer.toolhead.axis_maximum.y|float - 5.0 %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < (max_z - 2.0) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	
	SAVE_GCODE_STATE NAME=PAUSE_state
	BASE_PAUSE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	G91
	G1 E-{1} F2100
	G1 Z{10} F900
	G90
	G1 X{50} Y{0} F6000
variable_extrude = 1.0

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	G91
	G1 E{1} F2100
	RESTORE_GCODE_STATE NAME=PAUSE_state
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[tmc5160 extruder]
cs_pin = PA10
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 0.65
sense_resistor = 0.075
stealthchop_threshold = 0

[extruder]
rotation_distance = 5.7
full_steps_per_rotation = 200
sensor_type = PT1000
min_temp = 0
max_temp = 330
filament_diameter = 1.750
dir_pin = !PB6
step_pin = PG15
enable_pin = !PG14
heater_pin = PF6
sensor_pin = PB1
microsteps = 16
max_extrude_only_distance = 101
max_extrude_cross_section = 100
nozzle_diameter = 0.600
pressure_advance = 0.015
pressure_advance_smooth_time = 0.02
control = pid
pid_kp = 22.354
pid_ki = 1.552
pid_kd = 80.473

[tmc5160 stepper_x]
cs_pin = PD6
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
diag1_pin = PC15
run_current = 2.00
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_x]
dir_pin = !PC13
step_pin = PC14
enable_pin = !PE6
endstop_pin = PC15
microsteps = 16
rotation_distance = 40
position_endstop = -6
position_min = -6
position_max = 330
homing_speed = 20
full_steps_per_rotation = 200
homing_retract_dist = 0
homing_positive_dir = false
step_pulse_duration = 0.000001

[tmc5160 stepper_x1]
cs_pin = PD5
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2.00
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_x1]
dir_pin = !PE4
step_pin = PE5
enable_pin = !PE3
microsteps = 16
rotation_distance = 40
full_steps_per_rotation = 200
step_pulse_duration = 0.000001

[tmc5160 stepper_y]
cs_pin = PD4
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_y]
dir_pin = !PE1
step_pin = PE2
enable_pin = !PE0
endstop_pin = PF0
microsteps = 16
rotation_distance = 40
position_endstop = 0
position_min = 0
position_max = 315
homing_speed = 20
full_steps_per_rotation = 200
homing_retract_dist = 0
homing_positive_dir = false
step_pulse_duration = 0.000001

[tmc5160 stepper_y1]
cs_pin = PD3
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_y1]
dir_pin = !PB8
step_pin = PB9
enable_pin = !PB7
microsteps = 16
rotation_distance = 40
full_steps_per_rotation = 200
step_pulse_duration = 0.000001

[tmc5160 stepper_z]
cs_pin = PD2
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 1
sense_resistor = 0.075
stealthchop_threshold = 0

[stepper_z]
dir_pin = !PG10
step_pin = PG9
enable_pin = !PG13
endstop_pin = probe:z_virtual_endstop
microsteps = 16
rotation_distance = 8
position_min = -20
position_max = 400
full_steps_per_rotation = 200
homing_retract_dist = 5.0
homing_positive_dir = false
homing_speed = 3
second_homing_speed = 1
step_pulse_duration = 0.000004

[tmc5160 stepper_z1]
cs_pin = PA15
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 1
sense_resistor = 0.075
stealthchop_threshold = 0

[stepper_z1]
dir_pin = !PD7
step_pin = PG11
enable_pin = !PG12
microsteps = 16
rotation_distance = 8

[temperature_sensor Kraken]
sensor_type = temperature_mcu
min_temp = 10
max_temp = 100

[heater_fan hotend_fan]
pin = PA0
max_power = 1.0
kick_start_time = 0.5
heater = extruder
heater_temp = 50.0

[fan]
pin = PF12
enable_pin = PF7
hardware_pwm = false
max_power = 1
cycle_time = 0.00002
off_below = 0.012
kick_start_time = 0.01

[heater_bed]
heater_pin = PF5
sensor_pin = PC5
sensor_type = NTC 100K MGB18-104F39050L32
control = pid
pid_kp = 34.679
pid_ki = 1.492
pid_kd = 201.572
min_temp = 0
max_temp = 120
max_power = 1
pwm_cycle_time = 0.0166

[bed_screws]
screw1 = 10,0
screw2 = 10,260
screw3 = 320,260
screw4 = 320,0

[screws_tilt_adjust]
screw1 = 10, 0
screw1_name = front left screw
screw2 = 10, 260
screw2_name = rear left screw
screw3 = 300, 260
screw3_name = rear right screw
screw4 = 320, 0
screw4_name = front right screw
horizontal_move_z = 10.
speed = 250
screw_thread = CW-M3

[force_move]
enable_force_move = true

[bed_mesh]
speed = 200
horizontal_move_z = 1
mesh_min = 10, 22
mesh_max = 310, 260
mesh_pps = 3,3
probe_count = 25,25
algorithm = bicubic
relative_reference_index = 12
bicubic_tension = 0.2
fade_start = 1
fade_end = 10
split_delta_z = .025
move_check_distance = 5

[neopixel my_neopixel]
pin = PF11
chain_count = 13
color_order = GRB
initial_red = 1.0
initial_green = 1
initial_blue = 1

[gcode_macro BED_MESH]
gcode = 
	BED_MESH_CALIBRATE

[gcode_macro PA_TUNING]
gcode = 
	SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=1 ACCEL=500
	TUNING_TOWER COMMAND=SET_PRESSURE_ADVANCE PARAMETER=ADVANCE START=0 FACTOR=.005

[gcode_macro HOTEND_PID]
gcode = 
	{% set tool_temp = params.TEMPERATURE|default(220)|int %}
	{% set tool_name = printer.toolhead.extruder %}
	PID_CALIBRATE HEATER={tool_name} TARGET={tool_temp}

[gcode_macro BED_PID]
gcode = 
	{% set bed_temp = params.TEMPERATURE|default(60)|int %}
	PID_CALIBRATE HEATER=heater_bed TARGET={bed_temp}

[gcode_macro SCREWS_TILT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro DUMP_WARNINGS]
description = Debug: Print all warning messages from klipper
gcode = 
	{% set parameters = ["printer.configfile.warnings:"] %}
	{% for warning in printer.configfile.warnings %}
	{% set parameters = parameters.append("%s -> %s -> %s\n%s" % (warning.type, warning.section, warning.option, warning.message)) %}
	{% endfor %}
	{action_respond_info(parameters|join("\n"))}

[gcode_macro enable_stepper]
gcode = 
	SET_STEPPER_ENABLE STEPPER=stepper_x ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_x1 ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y1 ENABLE=1

[gcode_macro disable-steppers]
gcode = 
	m84

[gcode_macro M600]
gcode = 
	G4 P1500
	{% set X = params.X|default(50)|float %}
	{% set Y = params.Y|default(0)|float %}
	{% set Z = params.Z|default(10)|float %}
	
	SAVE_GCODE_STATE NAME=M600_state
	PAUSE
	
	G91
	G1 E-{1} F2100
	G1 Z{Z}
	G90
	G1 X{X} Y{Y} F4000
	G91
	M83
	G1 E5 F800
	G1 E-180 F2000
	M82
	RESTORE_GCODE_STATE NAME=M600_state

[gcode_macro PURGE]
gcode = 
	M83
	G1 E120 F250

[gcode_macro _UNLOAD_FILAMENT]
gcode = 
	{% set e_temp = params.TEMPERATURE|default(235)|int %}
	M118 Filament unloading!
	M117 Filament unloading!
	M82
	G92 E0
	{% if printer.extruder.can_extrude|lower != 'true' %}
	
	M118 Hotend heating!
	M109 S{e_temp} T0
	{% endif %}
	G1 E10 F{5*60}
	G0 E-5 F{60*60}
	G0 E-70 F{5*60}
	M400
	M118 Filament unload complete!
	M117 Filament unload complete!

[gcode_macro _LOAD_FILAMENT]
gcode = 
	{% set e_temp = params.TEMPERATURE|default(230)|int %}
	M109 S{e_temp}
	M83
	G1 E50 F300
	G1 E-1 F100
	M82
	M104 S0

[gcode_macro UNLOAD_PLA]
gcode = 
	_UNLOAD_FILAMENT TEMPERATURE=200

[gcode_macro LOAD_PLA]
gcode = 
	_LOAD_FILAMENT TEMPERATURE=200

[gcode_macro UNLOAD_ABS]
gcode = 
	_UNLOAD_FILAMENT TEMPERATURE=250

[gcode_macro LOAD_ABS]
gcode = 
	_LOAD_FILAMENT TEMPERATURE=250

[gcode_macro UNLOAD_PETG]
gcode = 
	_UNLOAD_FILAMENT TEMPERATURE=235

[gcode_macro LOAD_PETG]
gcode = 
	_LOAD_FILAMENT TEMPERATURE=235

[gcode_macro LOAD_FILAMENT]
gcode = 
	{% set speed = params.SPEED|default(300) %}
	{% set max_velocity = printer.configfile.settings['extruder'].max_extrude_only_velocity %}
	SAVE_GCODE_STATE NAME=load_state
	M300
	G91
	G92 E0
	G1 E350 F{max_velocity}
	G1 E25 F{speed}
	M300
	M300
	RESTORE_GCODE_STATE NAME=load_state

[gcode_macro UNLOAD_FILAMENT]
gcode = 
	{% set speed = params.SPEED|default(300) %}
	{% set max_velocity = printer.configfile.settings['extruder'].max_extrude_only_velocity %}
	SAVE_GCODE_STATE NAME=unload_state
	G91
	M300
	G92 E0
	G1 E25 F{speed}
	G1 E-420 F{max_velocity}
	M300
	M300
	RESTORE_GCODE_STATE NAME=unload_state

[gcode_macro START_PRINT]
gcode = 
	
	{% set DWELL = params.DWELL|default(00)|int %}
	{% set bedTemp = params.BED|default(70)|int %}
	{% set hotendTemp = params.HOTEND|default(210)|int %}
	SET_FAN_SPEED FAN=LED_Bar SPEED=0.5
	CLEAR_PAUSE
	RESETSPEEDS
	G21
	G90
	M83
	M140 S{bedTemp}; start heating the bed
	M104 S100
	SET_DISPLAY_TEXT MSG="Waiting for temperatures..."
	HEATSOAK DWELL={DWELL}
	G28 X Y
	ATTACH_PROBE_LOCK
	G28 Z
	SET_DISPLAY_TEXT MSG="Adjusting Z Tilt"
	Z_TILT_ADJUST
	G28 Z
	
	SET_DISPLAY_TEXT MSG="Calibrating Bed Mesh"
	BED_MESH_CLEAR
	BED_MESH_CALIBRATE
	BED_MESH_PROFILE LOAD=default
	SET_DISPLAY_TEXT MSG="Heating Extruder to temp"
	G1 X1 Y1 Z0.5 F9000
	M109 S{hotendTemp}; wait for extruder to heat up
	TR_UNLOAD_TOOLHEAD
	TR_HOME
	FIXED_PURGE_LINE
	M83
	SET_DISPLAY_TEXT MSG="Printing..."
	TR_SYNC_TO_EXTRUDER

[gcode_macro HEATSOAK]
gcode = 
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion..."
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 5% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 10% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 15% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 20% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 25% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 30% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 35% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 40% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 45% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 50% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 55% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 60% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 65% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 70% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 75% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 80% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 85% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 90% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 95% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Thermal expansion done"

[gcode_macro _CG28]
gcode = 
	{% if "xyz" not in printer.toolhead.homed_axes %}
	G28
	{% endif %}

[gcode_macro FIXED_PURGE_LINE]
gcode = 
	M83
	G92 E0
	G1 Z1 F3000
	G1 X1 Y80 Z0.3 E10  F1200
	G1 X1 Y120 E11  F1200
	G1 E-0.8 F1000
	G92 E0
	G1 Z1 F2000

[gcode_macro END_PRINT]
gcode = 
	TR_UNLOAD_TOOLHEAD
	
	TURN_OFF_HEATERS
	G91
	G1 Z10 E-2 F3600
	
	G90
	G1 X30 Y250 F7000; home X axis
	M106 S80
	G4 P10000
	M106 S0
	M221 S100
	CLEAR_PAUSE
	
	SET_GCODE_OFFSET Z=0.0
	RESETSPEEDS
	
	M84
	BED_MESH_CLEAR
	SET_FAN_SPEED FAN=LED_Bar SPEED=0
	TR_UNSYNC_TO_EXTRUDER
	UPDATE_GIT

[gcode_macro PARK]
description = Park the toolhead at the front and retract some filament if the nozzle is hot
gcode = 
	{% set E = params.E|default(1.7)|float %}
	
	{% set Px, Py = printer["gcode_macro _USER_VARIABLES"].park_position_xy|map('float') %}
	{% set park_lift_z = printer["gcode_macro _USER_VARIABLES"].park_lift_z %}
	
	{% set St = printer["gcode_macro _USER_VARIABLES"].travel_speed * 60 %}
	{% set Sz = printer["gcode_macro _USER_VARIABLES"].z_drop_speed * 60 %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	
	{% set z_safe = act_z + park_lift_z %}
	{% if z_safe > max_z %}
	{% set z_safe = max_z %}
	{% endif %}
	
	
	{% if printer.extruder.temperature > 185 %}
	G10
	{% endif %}
	G90
	G1 Z{z_safe} F{Sz}
	
	G0 X{Px} Y{Py} F{St}

[gcode_macro RESETSPEEDS]
gcode = 
	SET_VELOCITY_LIMIT VELOCITY={printer.configfile.settings.printer.max_velocity}
	SET_VELOCITY_LIMIT ACCEL={printer.configfile.settings.printer.max_accel}
	SET_VELOCITY_LIMIT ACCEL_TO_DECEL={printer.configfile.settings.printer.max_accel_to_decel}
	SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={printer.configfile.settings.printer.square_corner_velocity}

[gcode_macro DISABLEXYE]
gcode = 
	SET_STEPPER_ENABLE STEPPER=extruder ENABLE=0
	SET_STEPPER_ENABLE STEPPER=stepper_x ENABLE=0
	
	SET_STEPPER_ENABLE STEPPER=stepper_y ENABLE=0
	
	SET_STEPPER_ENABLE STEPPER=stepper_z ENABLE=1

[gcode_macro TEST_SPEED]
gcode = 
	
	{% set speed  = params.SPEED|default(printer.configfile.settings.printer.max_velocity)|int %}
	
	{% set iterations = params.ITERATIONS|default(5)|int %}
	
	{% set accel  = params.ACCEL|default(printer.configfile.settings.printer.max_accel)|int %}
	
	{% set bound = params.BOUND|default(20)|int %}
	
	{% set smallpatternsize = SMALLPATTERNSIZE|default(20)|int %}
	
	
	
	{% set x_min = 10 + bound %}
	{% set x_max = 300 - bound %}
	{% set y_min = 10 + bound %}
	{% set y_max = 300 - bound %}
	
	
	
	{% set x_center = (printer.toolhead.axis_minimum.x|float + printer.toolhead.axis_maximum.x|float ) / 2 %}
	{% set y_center = (printer.toolhead.axis_minimum.y|float + printer.toolhead.axis_maximum.y|float ) / 2 %}
	
	
	{% set x_center_min = x_center - (smallpatternsize/2) %}
	{% set x_center_max = x_center + (smallpatternsize/2) %}
	{% set y_center_min = y_center - (smallpatternsize/2) %}
	{% set y_center_max = y_center + (smallpatternsize/2) %}
	
	
	SAVE_GCODE_STATE NAME=TEST_SPEED
	
	
	{ action_respond_info("TEST_SPEED: starting %d iterations at speed %d, accel %d" % (iterations, speed, accel)) }
	
	
	M400
	G28
	
	{% if printer.configfile.settings.quad_gantry_level %}
	{% if printer.quad_gantry_level.applied == False %}
	QUAD_GANTRY_LEVEL
	G28 Z
	{% endif %}
	{% endif %}
	
	G90
	G1 X{printer.toolhead.axis_maximum.x-50} Y{printer.toolhead.axis_maximum.y-50} F{30*60}
	M400
	G28 X Y
	G0 X{300} Y{300} F{30*60}
	G4 P1000
	GET_POSITION
	
	
	G0 X{x_min} Y{y_min} Z{bound + 10} F{speed*60}
	
	
	SET_VELOCITY_LIMIT VELOCITY={speed} ACCEL={accel} ACCEL_TO_DECEL={accel / 2}
	
	{% for i in range(iterations) %}
	
	G0 X{x_min} Y{y_min} F{speed*60}
	G0 X{x_max} Y{y_max} F{speed*60}
	G0 X{x_min} Y{y_min} F{speed*60}
	G0 X{x_max} Y{y_min} F{speed*60}
	G0 X{x_min} Y{y_max} F{speed*60}
	G0 X{x_max} Y{y_min} F{speed*60}
	
	
	G0 X{x_min} Y{y_min} F{speed*60}
	G0 X{x_min} Y{y_max} F{speed*60}
	G0 X{x_max} Y{y_max} F{speed*60}
	G0 X{x_max} Y{y_min} F{speed*60}
	
	
	G0 X{x_center_min} Y{y_center_min} F{speed*60}
	G0 X{x_center_max} Y{y_center_max} F{speed*60}
	G0 X{x_center_min} Y{y_center_min} F{speed*60}
	G0 X{x_center_max} Y{y_center_min} F{speed*60}
	G0 X{x_center_min} Y{y_center_max} F{speed*60}
	G0 X{x_center_max} Y{y_center_min} F{speed*60}
	
	
	G0 X{x_center_min} Y{y_center_min} F{speed*60}
	G0 X{x_center_min} Y{y_center_max} F{speed*60}
	G0 X{x_center_max} Y{y_center_max} F{speed*60}
	G0 X{x_center_max} Y{y_center_min} F{speed*60}
	{% endfor %}
	
	
	SET_VELOCITY_LIMIT VELOCITY={printer.configfile.settings.printer.max_velocity} ACCEL={printer.configfile.settings.printer.max_accel} ACCEL_TO_DECEL={printer.configfile.settings.printer.max_accel_to_decel}
	
	
	M400
	G28
	
	G90
	G0 X{300} Y{300} F{30*60}
	G4 P1000
	GET_POSITION
	
	
	RESTORE_GCODE_STATE NAME=TEST_SPEED

[gcode_macro update_git]
gcode = 
	RUN_SHELL_COMMAND CMD=update_git_script

[gcode_shell_command update_git_script]
command = bash /home/pi/klipper-backup/script.sh
timeout = 90.0
verbose = True

[mcu tr]
serial = /dev/serial/by-id/usb-Klipper_stm32g0b1xx_290023000950415833323720-if00

[belay my_belay]
extruder_type = trad_rack
sensor_pin = ^tr:PB9
multiplier_high = 1.05
multiplier_low = 0.8
debug_level = 1

[trad_rack]
sync_to_extruder = true
selector_max_velocity = 400
selector_max_accel = 10000
lane_count = 4
lane_spacing = 17.26
servo_down_angle = 0
servo_up_angle = 130
toolhead_unload_speed = 20
extruder_load_speed = 2
toolhead_sense_speed = 20
selector_unload_length = 20
bowden_length = 865
extruder_load_length = 60
hotend_load_length = 20
toolhead_unload_length = 80
buffer_pull_speed = 100.0
pre_unload_gcode = 
	SAVE_GCODE_STATE NAME=PRE_UNLOAD_state
	{% if printer.virtual_sdcard.is_active %}
	{% set z_max = printer.toolhead.axis_maximum.z - printer.gcode_move.homing_origin.z %}
	{% set z_lift = printer["gcode_macro TR_Variables"].z_lift|float %}
	{% set x_park = printer["gcode_macro TR_Variables"].x_park|float %}
	{% set y_park = printer["gcode_macro TR_Variables"].y_park|float %}
	{% set do_x_park = printer["gcode_macro TR_Variables"].do_x_park %}
	{% set do_y_park = printer["gcode_macro TR_Variables"].do_y_park %}
	{% set st = printer["gcode_macro TR_Variables"].travel_speed * 60 %}
	{% set shape_tip = printer["gcode_macro TR_Variables"].shape_tip %}
	{% set use_wiper = printer["gcode_macro TR_Variables"].use_wiper %}
	{% set x = printer.gcode_move.gcode_position.x %}
	{% set y = printer.gcode_move.gcode_position.y %}
	{% set z = printer.gcode_move.gcode_position.z %}
	{% set z_park = [z + z_lift, z_max]|min %}
	
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=x VALUE={x}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=y VALUE={y}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=z VALUE={z}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=saved_pos VALUE={True}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=z_park VALUE={z_park}
	
	
	G90
	G1 Z{z_park}
	
	
	{% if use_wiper %}
	Go_To_Purge_Location
	
	
	{% else %}
	G90
	{% if do_x_park %}
	{% set x = x_park %}
	{% endif %}
	{% if do_y_park %}
	{% set y = y_park %}
	{% endif %}
	G1 X{x} Y{y} F{st}
	{% endif %}
	
	
	{% if shape_tip %}
	Shape_Tip
	{% endif %}
	{% else %}
	
	{% if use_wiper %}
	Go_To_Purge_Location
	{% endif %}
	
	
	Shape_Tip
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRE_UNLOAD_state
post_load_gcode = 
	SAVE_GCODE_STATE NAME=POST_LOAD_state
	{% set use_wiper = printer["gcode_macro TR_Variables"].use_wiper %}
	{% if printer.virtual_sdcard.is_active %}
	{% set st = printer["gcode_macro TR_Variables"].travel_speed * 60 %}
	{% set take_frame = printer["gcode_macro TR_Variables"].take_frame %}
	{% set x = printer["gcode_macro TR_Variables"].x %}
	{% set y = printer["gcode_macro TR_Variables"].y %}
	{% set z = printer["gcode_macro TR_Variables"].z %}
	{% set saved_pos = printer["gcode_macro TR_Variables"].saved_pos %}
	{% set z_park = printer["gcode_macro TR_Variables"].z_park %}
	
	
	{% if take_frame %}
	TIMELAPSE_TAKE_FRAME
	{% endif %}
	
	
	{% if use_wiper %}
	Home_and_Wipe_Nozzle
	{% endif %}
	
	
	{% if saved_pos %}
	G90
	G1 Z{z_park}
	G1 X{x} Y{y} F{st}
	G1 Z{z}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=saved_pos VALUE={False}
	{% endif %}
	
	Restore_Pressure_Advance
	{% elif use_wiper %}
	Home_and_Wipe_Nozzle
	{% endif %}
	RESTORE_GCODE_STATE NAME=POST_LOAD_state

[stepper_tr_selector]
step_pin = tr:PB15
dir_pin = !tr:PB14
enable_pin = !tr:PA8
rotation_distance = 40
microsteps = 16
full_steps_per_rotation = 400
endstop_pin = ^tr:PA3
position_min = 0.0
position_endstop = 0
position_max = 158
homing_speed = 30

[stepper_tr_fil_driver]
step_pin = tr:PD2
dir_pin = tr:PB13
enable_pin = !tr:PD1
rotation_distance = 22.67895
gear_ratio = 50:17
microsteps = 16
full_steps_per_rotation = 400
endstop_pin = ^tr:PA4
position_min = -5000
position_endstop = 0
position_max = 5000
homing_positive_dir = False

[tmc2209 stepper_tr_selector]
uart_pin = tr:PA10
interpolate = True
run_current = 1.3
sense_resistor = 0.110

[tmc2209 stepper_tr_fil_driver]
uart_pin = tr:PC7
interpolate = False
run_current = 1.3
sense_resistor = 0.110

[servo tr_servo]
pin = tr:PA0
maximum_servo_angle = 131
minimum_pulse_width = 0.000700
maximum_pulse_width = 0.002200

[gcode_macro ACTIVATE_EXTRUDER]
rename_existing = ACTIVATE_EXTRUDER.1
gcode = 
	{% set EXTRUDER = params.EXTRUDER|default('extruder')|lower|replace('extruder', '') %}
	{% if EXTRUDER == '' %}
	{% set EXTRUDER = '0' %}
	{% endif %}
	TR_LOAD_TOOLHEAD LANE={EXTRUDER}

[gcode_macro TR_Variables]
description = Variables for use with Trad Rack pre unload and post load gcode
variable_z_lift = 0.1
variable_x_park = 0.0
variable_y_park = 175.0
variable_do_x_park = False
variable_do_y_park = False
variable_travel_speed = 300
variable_shape_tip = False
variable_take_frame = False
variable_use_wiper = False
variable_x = 0
variable_y = 0
variable_z = 0
variable_saved_pos = False
variable_z_park = 0
gcode = 

[gcode_macro Shape_Tip]
description = Perform tip-shaping, retraction, and cooling moves
gcode = 
	SAVE_GCODE_STATE NAME=Shape_Tip_state
	Save_Pressure_Advance
	
	Slicer_Unload
	
	
	Restore_Pressure_Advance
	RESTORE_GCODE_STATE NAME=Shape_Tip_state

[gcode_macro Set_Slicer_Unload_Preset]
description = Apply a preset of values to use for the Slicer_Unload macro
variable_asa_ss = {
	"filament_ramming_parameters": "120 110 5.32258 5.45161 5.67742 6 6.48387 7.12903 7.90323 8.70968 9.3871 9.83871 10.0968 10.2258| 0.05 5.30967 0.45 5.50967 0.95 6.1871 1.45 7.39677 1.95 9.05484 2.45 10 2.95 10.3098 3.45 13.0839 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": True}
variable_pla_ss = {
	"filament_ramming_parameters": "130 120 2.70968 2.93548 3.32258 3.83871 4.58065 5.54839 6.51613 7.35484 7.93548 8.16129| 0.05 2.66451 0.45 3.05805 0.95 4.05807 1.45 5.97742 1.95 7.69999 2.45 8.1936 2.95 11.342 3.45 11.4065 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": True}
variable_asa_ps = {
	"filament_ramming_parameters": "120 110 5.32258 5.45161 5.67742 6 6.48387 7.12903 7.90323 8.70968 9.3871 9.83871 10.0968 10.2258| 0.05 5.30967 0.45 5.50967 0.95 6.1871 1.45 7.39677 1.95 9.05484 2.45 10 2.95 10.3098 3.45 13.0839 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": False}
variable_pla_ps = {
	"filament_ramming_parameters": "130 120 2.70968 2.93548 3.32258 3.83871 4.58065 5.54839 6.51613 7.35484 7.93548 8.16129| 0.05 2.66451 0.45 3.05805 0.95 4.05807 1.45 5.97742 1.95 7.69999 2.45 8.1936 2.95 11.342 3.45 11.4065 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": False}
gcode = 
	{% set preset_name = params.PRESET|lower %}
	{% if preset_name in printer['gcode_macro Set_Slicer_Unload_Preset'] %}
	{% set preset = printer['gcode_macro Set_Slicer_Unload_Preset'].preset_name %}
	{% for key in preset %}
	SET_GCODE_VARIABLE MACRO=Slicer_Unload VARIABLE={key} VALUE={preset[key]}
	{% endfor %}
	{% else %}
	{ action_raise_error("Preset \"%s\" does not exist" % preset_name) }
	{% endif %}

[gcode_macro Slicer_Unload]
description = Mimic ramming and unload behavior of PrusaSlicer or SuperSlicer
variable_cooling_tube_length = 14
variable_cooling_tube_retraction = 30
variable_filament_cooling_final_speed = 30
variable_filament_cooling_initial_speed = 20
variable_filament_cooling_moves = 4
variable_filament_diameter = 1.75
variable_filament_unloading_speed = 90
variable_filament_unloading_speed_start = 100
variable_filament_toolchange_delay = 0
variable_filament_ramming_parameters = "120 110 5.32258 5.45161 5.67742 6 6.48387 7.12903 7.90323 8.70968 9.3871 9.83871 10.0968 10.2258| 0.05 5.30967 0.45 5.50967 0.95 6.1871 1.45 7.39677 1.95 9.05484 2.45 10 2.95 10.3098 3.45 13.0839 3.95 7.6 4.45 7.6 4.95 7.6"
variable_filament_enable_toolchange_temp = False
variable_filament_toolchange_temp = 200
variable_filament_use_fast_skinnydip = False
variable_filament_enable_toolchange_part_fan = False
variable_filament_toolchange_part_fan_speed = 50
variable_filament_use_skinnydip = True
variable_filament_skinnydip_distance = 24
variable_filament_melt_zone_pause = 0
variable_filament_cooling_zone_pause = 0
variable_filament_dip_insertion_speed = 33
variable_filament_dip_extraction_speed = 70
variable_superslicer = False
variable_do_ramming = False
variable_do_unload = True
gcode = 
	{% set NEW_TEMPERATURE = params.NEW_TEMPERATURE|default(0)|float %}
	{% set prev_temp_target = printer.extruder.target %}
	
	SAVE_GCODE_STATE NAME=Slicer_Unload_state
	Save_Pressure_Advance
	
	M83
	M220 S100
	SET_PRESSURE_ADVANCE ADVANCE=0
	
	
	{% if do_ramming %}
	
	{% set ramming_speed = (filament_ramming_parameters.split('|')[0]).split(' ') %}
	
	
	{% set filament_area = 3.1415 * (filament_diameter / 2) ** 2 %}
	
	
	{% for i in range(2, ramming_speed|length) %}
	
	{% set f = ramming_speed[i]|float / filament_area %}
	
	
	{% set e = f * 0.25 %}
	
	
	G1 E{e} F{f * 60}
	{% endfor %}
	{% endif %}
	
	
	{% if do_unload %}
	
	{% if superslicer and filament_enable_toolchange_temp and not filament_use_fast_skinnydip %}
	_Wait_for_Toolchange_Temp
	{% endif %}
	
	
	{% set total_retraction_distance = cooling_tube_retraction + cooling_tube_length / 2 - 15 %}
	G1 E-15 F{filament_unloading_speed_start * 60}
	G1 E-{0.70 * total_retraction_distance} F{1.0 * filament_unloading_speed * 60}
	G1 E-{0.20 * total_retraction_distance} F{0.5 * filament_unloading_speed * 60}
	G1 E-{0.10 * total_retraction_distance} F{0.3 * filament_unloading_speed * 60}
	
	
	{% if not superslicer or not filament_enable_toolchange_temp %}
	{% if NEW_TEMPERATURE != 0 and (NEW_TEMPERATURE != prev_temp_target) %}
	M104 S{NEW_TEMPERATURE}
	{% endif %}
	
	
	{% elif superslicer and filament_enable_toolchange_temp and not filament_use_fast_skinnydip %}
	{% if NEW_TEMPERATURE != 0 %}
	M104 S{NEW_TEMPERATURE}
	{% else %}
	M104 S{prev_temp_target}
	{% endif %}
	{% endif %}
	
	
	{% set speed_inc = (filament_cooling_final_speed - filament_cooling_initial_speed) / (2 * filament_cooling_moves - 1) %}
	{% for i in range(filament_cooling_moves) %}
	{% set speed = filament_cooling_initial_speed + speed_inc * 2 * i %}
	G1 E{cooling_tube_length} F{speed * 60}
	{% set speed = speed + speed_inc %}
	G1 E-{cooling_tube_length} F{speed * 60}
	{% endfor %}
	
	
	{% if superslicer %}
	
	{% if filament_enable_toolchange_temp and filament_use_fast_skinnydip %}
	_Wait_for_Toolchange_Temp
	{% endif %}
	
	
	{% if filament_use_skinnydip %}
	G1 E{filament_skinnydip_distance} F{filament_dip_insertion_speed * 60}
	G4 P{filament_melt_zone_pause}
	G1 E-{filament_skinnydip_distance} F{filament_dip_extraction_speed * 60}
	G4 P{filament_cooling_zone_pause}
	{% endif %}
	
	
	{% if filament_enable_toolchange_temp and filament_use_fast_skinnydip %}
	{% if NEW_TEMPERATURE != 0 %}
	M109 S{NEW_TEMPERATURE}
	{% else %}
	M109 S{prev_temp_target}
	{% endif %}
	{% elif filament_enable_toolchange_temp and filament_use_fast_skinnydip %}
	{% if NEW_TEMPERATURE != 0 and (NEW_TEMPERATURE != prev_temp_target) %}
	M109 S{NEW_TEMPERATURE}
	{% endif %}
	{% endif %}
	{% endif %}
	
	
	G4 P{filament_toolchange_delay}
	
	
	
	{% endif %}
	
	Restore_Pressure_Advance
	RESTORE_GCODE_STATE NAME=Slicer_Unload_state

[gcode_macro _Wait_for_Toolchange_Temp]
description = Helper function for Slicer_Unload
gcode = 
	{% set tc_temp = printer["gcode_macro Slicer_Unload"].filament_toolchange_temp %}
	{% set fan_on = printer["gcode_macro Slicer_Unload"].filament_enable_toolchange_part_fan %}
	{% set fan_speed = printer["gcode_macro Slicer_Unload"].filament_toolchange_part_fan_speed %}
	
	{% set prev_fan_speed = printer.fan.speed %}
	{% if fan_on %}
	M106 S{(fan_speed / 100.0 * 255)|int}
	{% endif %}
	M109 S{filament_toolchange_temp}
	{% if fan_on %}
	M106 S{(prev_fan_speed * 255)|int}
	{% endif %}

[gcode_macro Home_and_Wipe_Nozzle]
description = Home x and y if needed, then wipe the nozzle
gcode = 
	
	{% if not 'xy' in printer.toolhead.homed_axes %}
	G28 X Y
	{% endif %}
	
	
	Wipe_Nozzle

[gcode_macro Save_Pressure_Advance]
description = Save the current pressure advance value
variable_pa = -1
gcode = 
	
	{% set pa = printer.extruder.pressure_advance %}
	{% if pa > 0 %}
	SET_GCODE_VARIABLE MACRO=Save_Pressure_Advance VARIABLE=pa VALUE={pa}
	{% endif %}

[gcode_macro Restore_Pressure_Advance]
description = Restore saved pressure advance value
gcode = 
	
	{% if not (printer["gcode_macro Save_Pressure_Advance"].pa == -1) %}
	SET_PRESSURE_ADVANCE ADVANCE={printer["gcode_macro Save_Pressure_Advance"].pa}
	{% endif %}

[safe_z_home]
home_xy_position = 165, 165
z_hop = 10

[z_tilt]
z_positions = 
	-80,  -20
	350, -20
points = 
	15, 150
	275, 150
speed = 50
horizontal_move_z = 10
retries = 30
retry_tolerance = 0.1

[input_shaper]
shaper_type_x = zv
shaper_freq_x = 120.6
shaper_type_y = zv
shaper_freq_y = 76.6

[printer]
kinematics = corexy
max_velocity = 3000
max_accel = 20000
max_z_velocity = 20
max_z_accel = 15
square_corner_velocity = 10

[exclude_object]

[gcode_arcs]
resolution = 0.05

[idle_timeout]
gcode = 
	{% if not printer.pause_resume.is_paused %}
	TURN_OFF_HEATERS
	M84
	{% endif %}

[save_variables]
filename = vars.cfg

[mcu]
serial = /dev/serial/by-id/usb-Klipper_stm32h723xx_4C0023001551313338343730-if00

[bed_mesh default]
version = 1
points = 
	-0.215000, -0.210000, -0.190000, -0.185000, -0.170000, -0.145000, -0.135000, -0.120000, -0.105000, -0.070000, -0.055000, -0.035000, 0.000000, 0.010000, 0.025000, 0.050000, 0.080000, 0.105000, 0.130000, 0.135000, 0.150000, 0.155000, 0.165000, 0.190000, 0.205000
	-0.160000, -0.155000, -0.160000, -0.150000, -0.130000, -0.110000, -0.105000, -0.085000, -0.055000, -0.035000, -0.025000, 0.000000, 0.025000, 0.055000, 0.075000, 0.100000, 0.110000, 0.130000, 0.160000, 0.170000, 0.190000, 0.190000, 0.205000, 0.205000, 0.220000
	-0.160000, -0.150000, -0.140000, -0.135000, -0.115000, -0.105000, -0.090000, -0.070000, -0.040000, -0.025000, -0.010000, 0.015000, 0.030000, 0.045000, 0.080000, 0.100000, 0.115000, 0.135000, 0.160000, 0.165000, 0.180000, 0.185000, 0.190000, 0.220000, 0.235000
	-0.120000, -0.115000, -0.115000, -0.100000, -0.080000, -0.070000, -0.065000, -0.040000, -0.015000, 0.010000, 0.030000, 0.050000, 0.065000, 0.090000, 0.110000, 0.130000, 0.145000, 0.175000, 0.195000, 0.195000, 0.195000, 0.205000, 0.210000, 0.235000, 0.240000
	-0.075000, -0.065000, -0.055000, -0.045000, -0.040000, -0.020000, -0.005000, 0.015000, 0.035000, 0.065000, 0.075000, 0.090000, 0.105000, 0.115000, 0.140000, 0.170000, 0.175000, 0.190000, 0.205000, 0.205000, 0.205000, 0.210000, 0.215000, 0.240000, 0.240000
	-0.045000, -0.050000, -0.055000, -0.045000, -0.015000, -0.005000, -0.005000, 0.020000, 0.060000, 0.065000, 0.075000, 0.100000, 0.115000, 0.125000, 0.135000, 0.170000, 0.175000, 0.175000, 0.205000, 0.205000, 0.205000, 0.205000, 0.210000, 0.220000, 0.225000
	-0.035000, -0.030000, -0.030000, -0.020000, 0.000000, 0.015000, 0.015000, 0.035000, 0.065000, 0.085000, 0.100000, 0.110000, 0.115000, 0.130000, 0.160000, 0.170000, 0.180000, 0.180000, 0.200000, 0.200000, 0.200000, 0.205000, 0.205000, 0.220000, 0.235000
	0.005000, 0.010000, 0.015000, 0.025000, 0.035000, 0.040000, 0.055000, 0.085000, 0.095000, 0.110000, 0.115000, 0.125000, 0.140000, 0.160000, 0.175000, 0.180000, 0.190000, 0.190000, 0.225000, 0.225000, 0.225000, 0.225000, 0.230000, 0.235000, 0.250000
	0.055000, 0.065000, 0.060000, 0.065000, 0.075000, 0.090000, 0.100000, 0.110000, 0.120000, 0.130000, 0.140000, 0.155000, 0.170000, 0.180000, 0.190000, 0.195000, 0.210000, 0.220000, 0.235000, 0.235000, 0.235000, 0.235000, 0.245000, 0.250000, 0.260000
	0.100000, 0.105000, 0.110000, 0.110000, 0.120000, 0.135000, 0.145000, 0.150000, 0.155000, 0.155000, 0.170000, 0.185000, 0.190000, 0.195000, 0.195000, 0.215000, 0.230000, 0.235000, 0.245000, 0.245000, 0.245000, 0.235000, 0.245000, 0.250000, 0.260000
	0.100000, 0.115000, 0.125000, 0.130000, 0.135000, 0.145000, 0.150000, 0.155000, 0.165000, 0.175000, 0.190000, 0.200000, 0.205000, 0.205000, 0.215000, 0.225000, 0.230000, 0.245000, 0.255000, 0.240000, 0.240000, 0.240000, 0.245000, 0.250000, 0.250000
	0.155000, 0.150000, 0.150000, 0.150000, 0.160000, 0.165000, 0.165000, 0.175000, 0.175000, 0.195000, 0.200000, 0.215000, 0.205000, 0.210000, 0.215000, 0.225000, 0.235000, 0.240000, 0.245000, 0.240000, 0.240000, 0.235000, 0.220000, 0.235000, 0.240000
	0.170000, 0.165000, 0.165000, 0.170000, 0.180000, 0.190000, 0.190000, 0.185000, 0.200000, 0.205000, 0.220000, 0.230000, 0.225000, 0.225000, 0.240000, 0.245000, 0.240000, 0.250000, 0.255000, 0.245000, 0.250000, 0.245000, 0.245000, 0.240000, 0.240000
	0.210000, 0.200000, 0.195000, 0.200000, 0.210000, 0.210000, 0.210000, 0.215000, 0.215000, 0.215000, 0.235000, 0.245000, 0.235000, 0.235000, 0.245000, 0.250000, 0.240000, 0.250000, 0.250000, 0.250000, 0.255000, 0.250000, 0.235000, 0.235000, 0.240000
	0.240000, 0.250000, 0.250000, 0.245000, 0.260000, 0.260000, 0.255000, 0.255000, 0.255000, 0.250000, 0.265000, 0.265000, 0.260000, 0.255000, 0.260000, 0.255000, 0.255000, 0.270000, 0.260000, 0.255000, 0.250000, 0.255000, 0.245000, 0.250000, 0.240000
	0.270000, 0.260000, 0.255000, 0.265000, 0.265000, 0.265000, 0.265000, 0.260000, 0.260000, 0.255000, 0.265000, 0.265000, 0.265000, 0.255000, 0.255000, 0.250000, 0.255000, 0.250000, 0.250000, 0.245000, 0.245000, 0.235000, 0.230000, 0.235000, 0.240000
	0.275000, 0.280000, 0.275000, 0.275000, 0.275000, 0.275000, 0.275000, 0.275000, 0.280000, 0.280000, 0.280000, 0.270000, 0.270000, 0.270000, 0.265000, 0.265000, 0.265000, 0.270000, 0.260000, 0.255000, 0.235000, 0.235000, 0.235000, 0.240000, 0.235000
	0.335000, 0.315000, 0.305000, 0.310000, 0.305000, 0.300000, 0.295000, 0.290000, 0.300000, 0.295000, 0.290000, 0.290000, 0.280000, 0.270000, 0.270000, 0.275000, 0.275000, 0.265000, 0.250000, 0.245000, 0.235000, 0.225000, 0.225000, 0.230000, 0.235000
	0.355000, 0.350000, 0.345000, 0.325000, 0.330000, 0.325000, 0.325000, 0.325000, 0.315000, 0.310000, 0.300000, 0.290000, 0.285000, 0.290000, 0.275000, 0.275000, 0.265000, 0.265000, 0.250000, 0.245000, 0.235000, 0.225000, 0.230000, 0.225000, 0.215000
	0.395000, 0.385000, 0.380000, 0.370000, 0.365000, 0.370000, 0.360000, 0.355000, 0.345000, 0.340000, 0.330000, 0.320000, 0.310000, 0.305000, 0.300000, 0.290000, 0.275000, 0.260000, 0.255000, 0.255000, 0.250000, 0.235000, 0.230000, 0.230000, 0.230000
	0.395000, 0.390000, 0.375000, 0.375000, 0.375000, 0.370000, 0.365000, 0.360000, 0.355000, 0.335000, 0.325000, 0.315000, 0.315000, 0.300000, 0.295000, 0.280000, 0.255000, 0.260000, 0.250000, 0.240000, 0.230000, 0.235000, 0.230000, 0.205000, 0.195000
	0.405000, 0.395000, 0.395000, 0.390000, 0.380000, 0.375000, 0.370000, 0.360000, 0.355000, 0.345000, 0.325000, 0.325000, 0.310000, 0.295000, 0.290000, 0.270000, 0.250000, 0.240000, 0.235000, 0.235000, 0.230000, 0.205000, 0.195000, 0.195000, 0.195000
	0.405000, 0.395000, 0.380000, 0.375000, 0.375000, 0.370000, 0.360000, 0.345000, 0.340000, 0.330000, 0.305000, 0.300000, 0.285000, 0.270000, 0.250000, 0.235000, 0.220000, 0.215000, 0.220000, 0.205000, 0.195000, 0.175000, 0.175000, 0.170000, 0.165000
	0.405000, 0.390000, 0.395000, 0.385000, 0.365000, 0.350000, 0.345000, 0.330000, 0.320000, 0.305000, 0.290000, 0.265000, 0.260000, 0.240000, 0.225000, 0.215000, 0.205000, 0.190000, 0.180000, 0.185000, 0.165000, 0.150000, 0.145000, 0.145000, 0.145000
	0.430000, 0.425000, 0.400000, 0.395000, 0.385000, 0.370000, 0.365000, 0.340000, 0.320000, 0.305000, 0.295000, 0.270000, 0.250000, 0.235000, 0.215000, 0.215000, 0.200000, 0.190000, 0.185000, 0.165000, 0.155000, 0.145000, 0.135000, 0.130000, 0.135000
x_count = 25
y_count = 25
mesh_x_pps = 3
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 310.0
min_y = 26.43
max_y = 281.31
=======================
Config error
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/klippy.py", line 175, in _connect
    self._read_config()
  File "/home/pi/klipper/klippy/klippy.py", line 143, in _read_config
    m.add_printer_objects(config)
  File "/home/pi/klipper/klippy/toolhead.py", line 658, in add_printer_objects
    config.get_printer().add_object('toolhead', ToolHead(config))
                                                ^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/toolhead.py", line 261, in __init__
    self.kin = mod.load_kinematics(self, config)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/kinematics/corexy.py", line 99, in load_kinematics
    return CoreXYKinematics(toolhead, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/kinematics/corexy.py", line 12, in __init__
    self.rails = [stepper.LookupMultiRail(config.getsection('stepper_' + n))
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/kinematics/corexy.py", line 12, in <listcomp>
    self.rails = [stepper.LookupMultiRail(config.getsection('stepper_' + n))
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/stepper.py", line 423, in LookupMultiRail
    rail = PrinterRail(config, need_position_minmax,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/stepper.py", line 304, in __init__
    self.add_extra_stepper(config)
  File "/home/pi/klipper/klippy/stepper.py", line 383, in add_extra_stepper
    pin_params = ppins.parse_pin(endstop_pin, True, True)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/pins.py", line 83, in parse_pin
    raise error("Unknown pin chip name '%s'" % (chip_name,))
pins.error: Unknown pin chip name 'probe'
webhooks client 140734118051792: New connection
webhooks client 140734118051792: Client info {'program': 'Moonraker', 'version': 'v0.8.0-308-g71b46cc'}
Attempting MCU 'mcu' reset
Attempting MCU 'tr' reset
webhooks client 140734118051792: Disconnected
Restarting printer
Start printer at Mon Feb  5 14:52:07 2024 (1707144727.6 90643.4)
===== Config file =====
[virtual_sdcard]
path = /home/pi/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]
recover_velocity = 350

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	TURN_OFF_HEATERS
	G91
	G1 Z10 E-2 F3600
	G1 E-3 F3600
	G90
	G1 X30 Y250 F7000; home X axis
	M106 S80
	G4 P10000
	M106 S0
	M221 S100
	CANCEL_PRINT_BASE
	CLEAR_PAUSE
	
	SET_GCODE_OFFSET Z=0.0
	RESETSPEEDS
	M84
	
	BED_MESH_CLEAR

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	
	{% set x_park = printer.toolhead.axis_maximum.x|float - 5.0 %}
	{% set y_park = printer.toolhead.axis_maximum.y|float - 5.0 %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < (max_z - 2.0) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	
	SAVE_GCODE_STATE NAME=PAUSE_state
	BASE_PAUSE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	G91
	G1 E-{1} F2100
	G1 Z{10} F900
	G90
	G1 X{50} Y{0} F6000
variable_extrude = 1.0

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	G91
	G1 E{1} F2100
	RESTORE_GCODE_STATE NAME=PAUSE_state
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[tmc5160 extruder]
cs_pin = PA10
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 0.65
sense_resistor = 0.075
stealthchop_threshold = 0

[extruder]
rotation_distance = 5.7
full_steps_per_rotation = 200
sensor_type = PT1000
min_temp = 0
max_temp = 330
filament_diameter = 1.750
dir_pin = !PB6
step_pin = PG15
enable_pin = !PG14
heater_pin = PF6
sensor_pin = PB1
microsteps = 16
max_extrude_only_distance = 101
max_extrude_cross_section = 100
nozzle_diameter = 0.600
pressure_advance = 0.015
pressure_advance_smooth_time = 0.02
control = pid
pid_kp = 22.354
pid_ki = 1.552
pid_kd = 80.473

[tmc5160 stepper_x]
cs_pin = PD6
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
diag1_pin = PC15
run_current = 2.00
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_x]
dir_pin = !PC13
step_pin = PC14
enable_pin = !PE6
endstop_pin = PC15
microsteps = 16
rotation_distance = 40
position_endstop = -6
position_min = -6
position_max = 330
homing_speed = 20
full_steps_per_rotation = 200
homing_retract_dist = 0
homing_positive_dir = false
step_pulse_duration = 0.000001

[tmc5160 stepper_x1]
cs_pin = PD5
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2.00
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_x1]
dir_pin = !PE4
step_pin = PE5
enable_pin = !PE3
microsteps = 16
rotation_distance = 40
full_steps_per_rotation = 200
step_pulse_duration = 0.000001

[tmc5160 stepper_y]
cs_pin = PD4
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_y]
dir_pin = !PE1
step_pin = PE2
enable_pin = !PE0
endstop_pin = PF0
microsteps = 16
rotation_distance = 40
position_endstop = 0
position_min = 0
position_max = 315
homing_speed = 20
full_steps_per_rotation = 200
homing_retract_dist = 0
homing_positive_dir = false
step_pulse_duration = 0.000001

[tmc5160 stepper_y1]
cs_pin = PD3
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_y1]
dir_pin = !PB8
step_pin = PB9
enable_pin = !PB7
microsteps = 16
rotation_distance = 40
full_steps_per_rotation = 200
step_pulse_duration = 0.000001

[tmc5160 stepper_z]
cs_pin = PD2
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 1
sense_resistor = 0.075
stealthchop_threshold = 0

[stepper_z]
dir_pin = !PG10
step_pin = PG9
enable_pin = !PG13
endstop_pin = probe:z_virtual_endstop
microsteps = 16
rotation_distance = 8
position_min = -20
position_max = 400
full_steps_per_rotation = 200
homing_retract_dist = 5.0
homing_positive_dir = false
homing_speed = 3
second_homing_speed = 1
step_pulse_duration = 0.000004

[tmc5160 stepper_z1]
cs_pin = PA15
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 1
sense_resistor = 0.075
stealthchop_threshold = 0

[stepper_z1]
dir_pin = !PD7
step_pin = PG11
enable_pin = !PG12
microsteps = 16
rotation_distance = 8

[temperature_sensor Kraken]
sensor_type = temperature_mcu
min_temp = 10
max_temp = 100

[heater_fan hotend_fan]
pin = PA0
max_power = 1.0
kick_start_time = 0.5
heater = extruder
heater_temp = 50.0

[fan]
pin = PF12
enable_pin = PF7
hardware_pwm = false
max_power = 1
cycle_time = 0.00002
off_below = 0.012
kick_start_time = 0.01

[heater_bed]
heater_pin = PF5
sensor_pin = PC5
sensor_type = NTC 100K MGB18-104F39050L32
control = pid
pid_kp = 34.679
pid_ki = 1.492
pid_kd = 201.572
min_temp = 0
max_temp = 120
max_power = 1
pwm_cycle_time = 0.0166

[bed_screws]
screw1 = 10,0
screw2 = 10,260
screw3 = 320,260
screw4 = 320,0

[screws_tilt_adjust]
screw1 = 10, 0
screw1_name = front left screw
screw2 = 10, 260
screw2_name = rear left screw
screw3 = 300, 260
screw3_name = rear right screw
screw4 = 320, 0
screw4_name = front right screw
horizontal_move_z = 10.
speed = 250
screw_thread = CW-M3

[force_move]
enable_force_move = true

[bed_mesh]
speed = 200
horizontal_move_z = 1
mesh_min = 10, 22
mesh_max = 310, 260
mesh_pps = 3,3
probe_count = 25,25
algorithm = bicubic
relative_reference_index = 12
bicubic_tension = 0.2
fade_start = 1
fade_end = 10
split_delta_z = .025
move_check_distance = 5

[neopixel my_neopixel]
pin = PF11
chain_count = 13
color_order = GRB
initial_red = 1.0
initial_green = 1
initial_blue = 1

[gcode_macro BED_MESH]
gcode = 
	BED_MESH_CALIBRATE

[gcode_macro PA_TUNING]
gcode = 
	SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=1 ACCEL=500
	TUNING_TOWER COMMAND=SET_PRESSURE_ADVANCE PARAMETER=ADVANCE START=0 FACTOR=.005

[gcode_macro HOTEND_PID]
gcode = 
	{% set tool_temp = params.TEMPERATURE|default(220)|int %}
	{% set tool_name = printer.toolhead.extruder %}
	PID_CALIBRATE HEATER={tool_name} TARGET={tool_temp}

[gcode_macro BED_PID]
gcode = 
	{% set bed_temp = params.TEMPERATURE|default(60)|int %}
	PID_CALIBRATE HEATER=heater_bed TARGET={bed_temp}

[gcode_macro SCREWS_TILT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro DUMP_WARNINGS]
description = Debug: Print all warning messages from klipper
gcode = 
	{% set parameters = ["printer.configfile.warnings:"] %}
	{% for warning in printer.configfile.warnings %}
	{% set parameters = parameters.append("%s -> %s -> %s\n%s" % (warning.type, warning.section, warning.option, warning.message)) %}
	{% endfor %}
	{action_respond_info(parameters|join("\n"))}

[gcode_macro enable_stepper]
gcode = 
	SET_STEPPER_ENABLE STEPPER=stepper_x ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_x1 ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y1 ENABLE=1

[gcode_macro disable-steppers]
gcode = 
	m84

[gcode_macro M600]
gcode = 
	G4 P1500
	{% set X = params.X|default(50)|float %}
	{% set Y = params.Y|default(0)|float %}
	{% set Z = params.Z|default(10)|float %}
	
	SAVE_GCODE_STATE NAME=M600_state
	PAUSE
	
	G91
	G1 E-{1} F2100
	G1 Z{Z}
	G90
	G1 X{X} Y{Y} F4000
	G91
	M83
	G1 E5 F800
	G1 E-180 F2000
	M82
	RESTORE_GCODE_STATE NAME=M600_state

[gcode_macro PURGE]
gcode = 
	M83
	G1 E120 F250

[gcode_macro _UNLOAD_FILAMENT]
gcode = 
	{% set e_temp = params.TEMPERATURE|default(235)|int %}
	M118 Filament unloading!
	M117 Filament unloading!
	M82
	G92 E0
	{% if printer.extruder.can_extrude|lower != 'true' %}
	
	M118 Hotend heating!
	M109 S{e_temp} T0
	{% endif %}
	G1 E10 F{5*60}
	G0 E-5 F{60*60}
	G0 E-70 F{5*60}
	M400
	M118 Filament unload complete!
	M117 Filament unload complete!

[gcode_macro _LOAD_FILAMENT]
gcode = 
	{% set e_temp = params.TEMPERATURE|default(230)|int %}
	M109 S{e_temp}
	M83
	G1 E50 F300
	G1 E-1 F100
	M82
	M104 S0

[gcode_macro UNLOAD_PLA]
gcode = 
	_UNLOAD_FILAMENT TEMPERATURE=200

[gcode_macro LOAD_PLA]
gcode = 
	_LOAD_FILAMENT TEMPERATURE=200

[gcode_macro UNLOAD_ABS]
gcode = 
	_UNLOAD_FILAMENT TEMPERATURE=250

[gcode_macro LOAD_ABS]
gcode = 
	_LOAD_FILAMENT TEMPERATURE=250

[gcode_macro UNLOAD_PETG]
gcode = 
	_UNLOAD_FILAMENT TEMPERATURE=235

[gcode_macro LOAD_PETG]
gcode = 
	_LOAD_FILAMENT TEMPERATURE=235

[gcode_macro LOAD_FILAMENT]
gcode = 
	{% set speed = params.SPEED|default(300) %}
	{% set max_velocity = printer.configfile.settings['extruder'].max_extrude_only_velocity %}
	SAVE_GCODE_STATE NAME=load_state
	M300
	G91
	G92 E0
	G1 E350 F{max_velocity}
	G1 E25 F{speed}
	M300
	M300
	RESTORE_GCODE_STATE NAME=load_state

[gcode_macro UNLOAD_FILAMENT]
gcode = 
	{% set speed = params.SPEED|default(300) %}
	{% set max_velocity = printer.configfile.settings['extruder'].max_extrude_only_velocity %}
	SAVE_GCODE_STATE NAME=unload_state
	G91
	M300
	G92 E0
	G1 E25 F{speed}
	G1 E-420 F{max_velocity}
	M300
	M300
	RESTORE_GCODE_STATE NAME=unload_state

[gcode_macro START_PRINT]
gcode = 
	
	{% set DWELL = params.DWELL|default(00)|int %}
	{% set bedTemp = params.BED|default(70)|int %}
	{% set hotendTemp = params.HOTEND|default(210)|int %}
	SET_FAN_SPEED FAN=LED_Bar SPEED=0.5
	CLEAR_PAUSE
	RESETSPEEDS
	G21
	G90
	M83
	M140 S{bedTemp}; start heating the bed
	M104 S100
	SET_DISPLAY_TEXT MSG="Waiting for temperatures..."
	HEATSOAK DWELL={DWELL}
	G28 X Y
	ATTACH_PROBE_LOCK
	G28 Z
	SET_DISPLAY_TEXT MSG="Adjusting Z Tilt"
	Z_TILT_ADJUST
	G28 Z
	
	SET_DISPLAY_TEXT MSG="Calibrating Bed Mesh"
	BED_MESH_CLEAR
	BED_MESH_CALIBRATE
	BED_MESH_PROFILE LOAD=default
	SET_DISPLAY_TEXT MSG="Heating Extruder to temp"
	G1 X1 Y1 Z0.5 F9000
	M109 S{hotendTemp}; wait for extruder to heat up
	TR_UNLOAD_TOOLHEAD
	TR_HOME
	FIXED_PURGE_LINE
	M83
	SET_DISPLAY_TEXT MSG="Printing..."
	TR_SYNC_TO_EXTRUDER

[gcode_macro HEATSOAK]
gcode = 
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion..."
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 5% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 10% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 15% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 20% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 25% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 30% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 35% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 40% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 45% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 50% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 55% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 60% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 65% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 70% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 75% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 80% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 85% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 90% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 95% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Thermal expansion done"

[gcode_macro _CG28]
gcode = 
	{% if "xyz" not in printer.toolhead.homed_axes %}
	G28
	{% endif %}

[gcode_macro FIXED_PURGE_LINE]
gcode = 
	M83
	G92 E0
	G1 Z1 F3000
	G1 X1 Y80 Z0.3 E10  F1200
	G1 X1 Y120 E11  F1200
	G1 E-0.8 F1000
	G92 E0
	G1 Z1 F2000

[gcode_macro END_PRINT]
gcode = 
	TR_UNLOAD_TOOLHEAD
	
	TURN_OFF_HEATERS
	G91
	G1 Z10 E-2 F3600
	
	G90
	G1 X30 Y250 F7000; home X axis
	M106 S80
	G4 P10000
	M106 S0
	M221 S100
	CLEAR_PAUSE
	
	SET_GCODE_OFFSET Z=0.0
	RESETSPEEDS
	
	M84
	BED_MESH_CLEAR
	SET_FAN_SPEED FAN=LED_Bar SPEED=0
	TR_UNSYNC_TO_EXTRUDER
	UPDATE_GIT

[gcode_macro PARK]
description = Park the toolhead at the front and retract some filament if the nozzle is hot
gcode = 
	{% set E = params.E|default(1.7)|float %}
	
	{% set Px, Py = printer["gcode_macro _USER_VARIABLES"].park_position_xy|map('float') %}
	{% set park_lift_z = printer["gcode_macro _USER_VARIABLES"].park_lift_z %}
	
	{% set St = printer["gcode_macro _USER_VARIABLES"].travel_speed * 60 %}
	{% set Sz = printer["gcode_macro _USER_VARIABLES"].z_drop_speed * 60 %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	
	{% set z_safe = act_z + park_lift_z %}
	{% if z_safe > max_z %}
	{% set z_safe = max_z %}
	{% endif %}
	
	
	{% if printer.extruder.temperature > 185 %}
	G10
	{% endif %}
	G90
	G1 Z{z_safe} F{Sz}
	
	G0 X{Px} Y{Py} F{St}

[gcode_macro RESETSPEEDS]
gcode = 
	SET_VELOCITY_LIMIT VELOCITY={printer.configfile.settings.printer.max_velocity}
	SET_VELOCITY_LIMIT ACCEL={printer.configfile.settings.printer.max_accel}
	SET_VELOCITY_LIMIT ACCEL_TO_DECEL={printer.configfile.settings.printer.max_accel_to_decel}
	SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={printer.configfile.settings.printer.square_corner_velocity}

[gcode_macro DISABLEXYE]
gcode = 
	SET_STEPPER_ENABLE STEPPER=extruder ENABLE=0
	SET_STEPPER_ENABLE STEPPER=stepper_x ENABLE=0
	
	SET_STEPPER_ENABLE STEPPER=stepper_y ENABLE=0
	
	SET_STEPPER_ENABLE STEPPER=stepper_z ENABLE=1

[gcode_macro TEST_SPEED]
gcode = 
	
	{% set speed  = params.SPEED|default(printer.configfile.settings.printer.max_velocity)|int %}
	
	{% set iterations = params.ITERATIONS|default(5)|int %}
	
	{% set accel  = params.ACCEL|default(printer.configfile.settings.printer.max_accel)|int %}
	
	{% set bound = params.BOUND|default(20)|int %}
	
	{% set smallpatternsize = SMALLPATTERNSIZE|default(20)|int %}
	
	
	
	{% set x_min = 10 + bound %}
	{% set x_max = 300 - bound %}
	{% set y_min = 10 + bound %}
	{% set y_max = 300 - bound %}
	
	
	
	{% set x_center = (printer.toolhead.axis_minimum.x|float + printer.toolhead.axis_maximum.x|float ) / 2 %}
	{% set y_center = (printer.toolhead.axis_minimum.y|float + printer.toolhead.axis_maximum.y|float ) / 2 %}
	
	
	{% set x_center_min = x_center - (smallpatternsize/2) %}
	{% set x_center_max = x_center + (smallpatternsize/2) %}
	{% set y_center_min = y_center - (smallpatternsize/2) %}
	{% set y_center_max = y_center + (smallpatternsize/2) %}
	
	
	SAVE_GCODE_STATE NAME=TEST_SPEED
	
	
	{ action_respond_info("TEST_SPEED: starting %d iterations at speed %d, accel %d" % (iterations, speed, accel)) }
	
	
	M400
	G28
	
	{% if printer.configfile.settings.quad_gantry_level %}
	{% if printer.quad_gantry_level.applied == False %}
	QUAD_GANTRY_LEVEL
	G28 Z
	{% endif %}
	{% endif %}
	
	G90
	G1 X{printer.toolhead.axis_maximum.x-50} Y{printer.toolhead.axis_maximum.y-50} F{30*60}
	M400
	G28 X Y
	G0 X{300} Y{300} F{30*60}
	G4 P1000
	GET_POSITION
	
	
	G0 X{x_min} Y{y_min} Z{bound + 10} F{speed*60}
	
	
	SET_VELOCITY_LIMIT VELOCITY={speed} ACCEL={accel} ACCEL_TO_DECEL={accel / 2}
	
	{% for i in range(iterations) %}
	
	G0 X{x_min} Y{y_min} F{speed*60}
	G0 X{x_max} Y{y_max} F{speed*60}
	G0 X{x_min} Y{y_min} F{speed*60}
	G0 X{x_max} Y{y_min} F{speed*60}
	G0 X{x_min} Y{y_max} F{speed*60}
	G0 X{x_max} Y{y_min} F{speed*60}
	
	
	G0 X{x_min} Y{y_min} F{speed*60}
	G0 X{x_min} Y{y_max} F{speed*60}
	G0 X{x_max} Y{y_max} F{speed*60}
	G0 X{x_max} Y{y_min} F{speed*60}
	
	
	G0 X{x_center_min} Y{y_center_min} F{speed*60}
	G0 X{x_center_max} Y{y_center_max} F{speed*60}
	G0 X{x_center_min} Y{y_center_min} F{speed*60}
	G0 X{x_center_max} Y{y_center_min} F{speed*60}
	G0 X{x_center_min} Y{y_center_max} F{speed*60}
	G0 X{x_center_max} Y{y_center_min} F{speed*60}
	
	
	G0 X{x_center_min} Y{y_center_min} F{speed*60}
	G0 X{x_center_min} Y{y_center_max} F{speed*60}
	G0 X{x_center_max} Y{y_center_max} F{speed*60}
	G0 X{x_center_max} Y{y_center_min} F{speed*60}
	{% endfor %}
	
	
	SET_VELOCITY_LIMIT VELOCITY={printer.configfile.settings.printer.max_velocity} ACCEL={printer.configfile.settings.printer.max_accel} ACCEL_TO_DECEL={printer.configfile.settings.printer.max_accel_to_decel}
	
	
	M400
	G28
	
	G90
	G0 X{300} Y{300} F{30*60}
	G4 P1000
	GET_POSITION
	
	
	RESTORE_GCODE_STATE NAME=TEST_SPEED

[gcode_macro update_git]
gcode = 
	RUN_SHELL_COMMAND CMD=update_git_script

[gcode_shell_command update_git_script]
command = bash /home/pi/klipper-backup/script.sh
timeout = 90.0
verbose = True

[mcu tr]
serial = /dev/serial/by-id/usb-Klipper_stm32g0b1xx_290023000950415833323720-if00

[belay my_belay]
extruder_type = trad_rack
sensor_pin = ^tr:PB9
multiplier_high = 1.05
multiplier_low = 0.8
debug_level = 1

[trad_rack]
sync_to_extruder = true
selector_max_velocity = 400
selector_max_accel = 10000
lane_count = 4
lane_spacing = 17.26
servo_down_angle = 0
servo_up_angle = 130
toolhead_unload_speed = 20
extruder_load_speed = 2
toolhead_sense_speed = 20
selector_unload_length = 20
bowden_length = 865
extruder_load_length = 60
hotend_load_length = 20
toolhead_unload_length = 80
buffer_pull_speed = 100.0
pre_unload_gcode = 
	SAVE_GCODE_STATE NAME=PRE_UNLOAD_state
	{% if printer.virtual_sdcard.is_active %}
	{% set z_max = printer.toolhead.axis_maximum.z - printer.gcode_move.homing_origin.z %}
	{% set z_lift = printer["gcode_macro TR_Variables"].z_lift|float %}
	{% set x_park = printer["gcode_macro TR_Variables"].x_park|float %}
	{% set y_park = printer["gcode_macro TR_Variables"].y_park|float %}
	{% set do_x_park = printer["gcode_macro TR_Variables"].do_x_park %}
	{% set do_y_park = printer["gcode_macro TR_Variables"].do_y_park %}
	{% set st = printer["gcode_macro TR_Variables"].travel_speed * 60 %}
	{% set shape_tip = printer["gcode_macro TR_Variables"].shape_tip %}
	{% set use_wiper = printer["gcode_macro TR_Variables"].use_wiper %}
	{% set x = printer.gcode_move.gcode_position.x %}
	{% set y = printer.gcode_move.gcode_position.y %}
	{% set z = printer.gcode_move.gcode_position.z %}
	{% set z_park = [z + z_lift, z_max]|min %}
	
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=x VALUE={x}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=y VALUE={y}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=z VALUE={z}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=saved_pos VALUE={True}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=z_park VALUE={z_park}
	
	
	G90
	G1 Z{z_park}
	
	
	{% if use_wiper %}
	Go_To_Purge_Location
	
	
	{% else %}
	G90
	{% if do_x_park %}
	{% set x = x_park %}
	{% endif %}
	{% if do_y_park %}
	{% set y = y_park %}
	{% endif %}
	G1 X{x} Y{y} F{st}
	{% endif %}
	
	
	{% if shape_tip %}
	Shape_Tip
	{% endif %}
	{% else %}
	
	{% if use_wiper %}
	Go_To_Purge_Location
	{% endif %}
	
	
	Shape_Tip
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRE_UNLOAD_state
post_load_gcode = 
	SAVE_GCODE_STATE NAME=POST_LOAD_state
	{% set use_wiper = printer["gcode_macro TR_Variables"].use_wiper %}
	{% if printer.virtual_sdcard.is_active %}
	{% set st = printer["gcode_macro TR_Variables"].travel_speed * 60 %}
	{% set take_frame = printer["gcode_macro TR_Variables"].take_frame %}
	{% set x = printer["gcode_macro TR_Variables"].x %}
	{% set y = printer["gcode_macro TR_Variables"].y %}
	{% set z = printer["gcode_macro TR_Variables"].z %}
	{% set saved_pos = printer["gcode_macro TR_Variables"].saved_pos %}
	{% set z_park = printer["gcode_macro TR_Variables"].z_park %}
	
	
	{% if take_frame %}
	TIMELAPSE_TAKE_FRAME
	{% endif %}
	
	
	{% if use_wiper %}
	Home_and_Wipe_Nozzle
	{% endif %}
	
	
	{% if saved_pos %}
	G90
	G1 Z{z_park}
	G1 X{x} Y{y} F{st}
	G1 Z{z}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=saved_pos VALUE={False}
	{% endif %}
	
	Restore_Pressure_Advance
	{% elif use_wiper %}
	Home_and_Wipe_Nozzle
	{% endif %}
	RESTORE_GCODE_STATE NAME=POST_LOAD_state

[stepper_tr_selector]
step_pin = tr:PB15
dir_pin = !tr:PB14
enable_pin = !tr:PA8
rotation_distance = 40
microsteps = 16
full_steps_per_rotation = 400
endstop_pin = ^tr:PA3
position_min = 0.0
position_endstop = 0
position_max = 158
homing_speed = 30

[stepper_tr_fil_driver]
step_pin = tr:PD2
dir_pin = tr:PB13
enable_pin = !tr:PD1
rotation_distance = 22.67895
gear_ratio = 50:17
microsteps = 16
full_steps_per_rotation = 400
endstop_pin = ^tr:PA4
position_min = -5000
position_endstop = 0
position_max = 5000
homing_positive_dir = False

[tmc2209 stepper_tr_selector]
uart_pin = tr:PA10
interpolate = True
run_current = 1.3
sense_resistor = 0.110

[tmc2209 stepper_tr_fil_driver]
uart_pin = tr:PC7
interpolate = False
run_current = 1.3
sense_resistor = 0.110

[servo tr_servo]
pin = tr:PA0
maximum_servo_angle = 131
minimum_pulse_width = 0.000700
maximum_pulse_width = 0.002200

[gcode_macro ACTIVATE_EXTRUDER]
rename_existing = ACTIVATE_EXTRUDER.1
gcode = 
	{% set EXTRUDER = params.EXTRUDER|default('extruder')|lower|replace('extruder', '') %}
	{% if EXTRUDER == '' %}
	{% set EXTRUDER = '0' %}
	{% endif %}
	TR_LOAD_TOOLHEAD LANE={EXTRUDER}

[gcode_macro TR_Variables]
description = Variables for use with Trad Rack pre unload and post load gcode
variable_z_lift = 0.1
variable_x_park = 0.0
variable_y_park = 175.0
variable_do_x_park = False
variable_do_y_park = False
variable_travel_speed = 300
variable_shape_tip = False
variable_take_frame = False
variable_use_wiper = False
variable_x = 0
variable_y = 0
variable_z = 0
variable_saved_pos = False
variable_z_park = 0
gcode = 

[gcode_macro Shape_Tip]
description = Perform tip-shaping, retraction, and cooling moves
gcode = 
	SAVE_GCODE_STATE NAME=Shape_Tip_state
	Save_Pressure_Advance
	
	Slicer_Unload
	
	
	Restore_Pressure_Advance
	RESTORE_GCODE_STATE NAME=Shape_Tip_state

[gcode_macro Set_Slicer_Unload_Preset]
description = Apply a preset of values to use for the Slicer_Unload macro
variable_asa_ss = {
	"filament_ramming_parameters": "120 110 5.32258 5.45161 5.67742 6 6.48387 7.12903 7.90323 8.70968 9.3871 9.83871 10.0968 10.2258| 0.05 5.30967 0.45 5.50967 0.95 6.1871 1.45 7.39677 1.95 9.05484 2.45 10 2.95 10.3098 3.45 13.0839 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": True}
variable_pla_ss = {
	"filament_ramming_parameters": "130 120 2.70968 2.93548 3.32258 3.83871 4.58065 5.54839 6.51613 7.35484 7.93548 8.16129| 0.05 2.66451 0.45 3.05805 0.95 4.05807 1.45 5.97742 1.95 7.69999 2.45 8.1936 2.95 11.342 3.45 11.4065 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": True}
variable_asa_ps = {
	"filament_ramming_parameters": "120 110 5.32258 5.45161 5.67742 6 6.48387 7.12903 7.90323 8.70968 9.3871 9.83871 10.0968 10.2258| 0.05 5.30967 0.45 5.50967 0.95 6.1871 1.45 7.39677 1.95 9.05484 2.45 10 2.95 10.3098 3.45 13.0839 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": False}
variable_pla_ps = {
	"filament_ramming_parameters": "130 120 2.70968 2.93548 3.32258 3.83871 4.58065 5.54839 6.51613 7.35484 7.93548 8.16129| 0.05 2.66451 0.45 3.05805 0.95 4.05807 1.45 5.97742 1.95 7.69999 2.45 8.1936 2.95 11.342 3.45 11.4065 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": False}
gcode = 
	{% set preset_name = params.PRESET|lower %}
	{% if preset_name in printer['gcode_macro Set_Slicer_Unload_Preset'] %}
	{% set preset = printer['gcode_macro Set_Slicer_Unload_Preset'].preset_name %}
	{% for key in preset %}
	SET_GCODE_VARIABLE MACRO=Slicer_Unload VARIABLE={key} VALUE={preset[key]}
	{% endfor %}
	{% else %}
	{ action_raise_error("Preset \"%s\" does not exist" % preset_name) }
	{% endif %}

[gcode_macro Slicer_Unload]
description = Mimic ramming and unload behavior of PrusaSlicer or SuperSlicer
variable_cooling_tube_length = 14
variable_cooling_tube_retraction = 30
variable_filament_cooling_final_speed = 30
variable_filament_cooling_initial_speed = 20
variable_filament_cooling_moves = 4
variable_filament_diameter = 1.75
variable_filament_unloading_speed = 90
variable_filament_unloading_speed_start = 100
variable_filament_toolchange_delay = 0
variable_filament_ramming_parameters = "120 110 5.32258 5.45161 5.67742 6 6.48387 7.12903 7.90323 8.70968 9.3871 9.83871 10.0968 10.2258| 0.05 5.30967 0.45 5.50967 0.95 6.1871 1.45 7.39677 1.95 9.05484 2.45 10 2.95 10.3098 3.45 13.0839 3.95 7.6 4.45 7.6 4.95 7.6"
variable_filament_enable_toolchange_temp = False
variable_filament_toolchange_temp = 200
variable_filament_use_fast_skinnydip = False
variable_filament_enable_toolchange_part_fan = False
variable_filament_toolchange_part_fan_speed = 50
variable_filament_use_skinnydip = True
variable_filament_skinnydip_distance = 24
variable_filament_melt_zone_pause = 0
variable_filament_cooling_zone_pause = 0
variable_filament_dip_insertion_speed = 33
variable_filament_dip_extraction_speed = 70
variable_superslicer = False
variable_do_ramming = False
variable_do_unload = True
gcode = 
	{% set NEW_TEMPERATURE = params.NEW_TEMPERATURE|default(0)|float %}
	{% set prev_temp_target = printer.extruder.target %}
	
	SAVE_GCODE_STATE NAME=Slicer_Unload_state
	Save_Pressure_Advance
	
	M83
	M220 S100
	SET_PRESSURE_ADVANCE ADVANCE=0
	
	
	{% if do_ramming %}
	
	{% set ramming_speed = (filament_ramming_parameters.split('|')[0]).split(' ') %}
	
	
	{% set filament_area = 3.1415 * (filament_diameter / 2) ** 2 %}
	
	
	{% for i in range(2, ramming_speed|length) %}
	
	{% set f = ramming_speed[i]|float / filament_area %}
	
	
	{% set e = f * 0.25 %}
	
	
	G1 E{e} F{f * 60}
	{% endfor %}
	{% endif %}
	
	
	{% if do_unload %}
	
	{% if superslicer and filament_enable_toolchange_temp and not filament_use_fast_skinnydip %}
	_Wait_for_Toolchange_Temp
	{% endif %}
	
	
	{% set total_retraction_distance = cooling_tube_retraction + cooling_tube_length / 2 - 15 %}
	G1 E-15 F{filament_unloading_speed_start * 60}
	G1 E-{0.70 * total_retraction_distance} F{1.0 * filament_unloading_speed * 60}
	G1 E-{0.20 * total_retraction_distance} F{0.5 * filament_unloading_speed * 60}
	G1 E-{0.10 * total_retraction_distance} F{0.3 * filament_unloading_speed * 60}
	
	
	{% if not superslicer or not filament_enable_toolchange_temp %}
	{% if NEW_TEMPERATURE != 0 and (NEW_TEMPERATURE != prev_temp_target) %}
	M104 S{NEW_TEMPERATURE}
	{% endif %}
	
	
	{% elif superslicer and filament_enable_toolchange_temp and not filament_use_fast_skinnydip %}
	{% if NEW_TEMPERATURE != 0 %}
	M104 S{NEW_TEMPERATURE}
	{% else %}
	M104 S{prev_temp_target}
	{% endif %}
	{% endif %}
	
	
	{% set speed_inc = (filament_cooling_final_speed - filament_cooling_initial_speed) / (2 * filament_cooling_moves - 1) %}
	{% for i in range(filament_cooling_moves) %}
	{% set speed = filament_cooling_initial_speed + speed_inc * 2 * i %}
	G1 E{cooling_tube_length} F{speed * 60}
	{% set speed = speed + speed_inc %}
	G1 E-{cooling_tube_length} F{speed * 60}
	{% endfor %}
	
	
	{% if superslicer %}
	
	{% if filament_enable_toolchange_temp and filament_use_fast_skinnydip %}
	_Wait_for_Toolchange_Temp
	{% endif %}
	
	
	{% if filament_use_skinnydip %}
	G1 E{filament_skinnydip_distance} F{filament_dip_insertion_speed * 60}
	G4 P{filament_melt_zone_pause}
	G1 E-{filament_skinnydip_distance} F{filament_dip_extraction_speed * 60}
	G4 P{filament_cooling_zone_pause}
	{% endif %}
	
	
	{% if filament_enable_toolchange_temp and filament_use_fast_skinnydip %}
	{% if NEW_TEMPERATURE != 0 %}
	M109 S{NEW_TEMPERATURE}
	{% else %}
	M109 S{prev_temp_target}
	{% endif %}
	{% elif filament_enable_toolchange_temp and filament_use_fast_skinnydip %}
	{% if NEW_TEMPERATURE != 0 and (NEW_TEMPERATURE != prev_temp_target) %}
	M109 S{NEW_TEMPERATURE}
	{% endif %}
	{% endif %}
	{% endif %}
	
	
	G4 P{filament_toolchange_delay}
	
	
	
	{% endif %}
	
	Restore_Pressure_Advance
	RESTORE_GCODE_STATE NAME=Slicer_Unload_state

[gcode_macro _Wait_for_Toolchange_Temp]
description = Helper function for Slicer_Unload
gcode = 
	{% set tc_temp = printer["gcode_macro Slicer_Unload"].filament_toolchange_temp %}
	{% set fan_on = printer["gcode_macro Slicer_Unload"].filament_enable_toolchange_part_fan %}
	{% set fan_speed = printer["gcode_macro Slicer_Unload"].filament_toolchange_part_fan_speed %}
	
	{% set prev_fan_speed = printer.fan.speed %}
	{% if fan_on %}
	M106 S{(fan_speed / 100.0 * 255)|int}
	{% endif %}
	M109 S{filament_toolchange_temp}
	{% if fan_on %}
	M106 S{(prev_fan_speed * 255)|int}
	{% endif %}

[gcode_macro Home_and_Wipe_Nozzle]
description = Home x and y if needed, then wipe the nozzle
gcode = 
	
	{% if not 'xy' in printer.toolhead.homed_axes %}
	G28 X Y
	{% endif %}
	
	
	Wipe_Nozzle

[gcode_macro Save_Pressure_Advance]
description = Save the current pressure advance value
variable_pa = -1
gcode = 
	
	{% set pa = printer.extruder.pressure_advance %}
	{% if pa > 0 %}
	SET_GCODE_VARIABLE MACRO=Save_Pressure_Advance VARIABLE=pa VALUE={pa}
	{% endif %}

[gcode_macro Restore_Pressure_Advance]
description = Restore saved pressure advance value
gcode = 
	
	{% if not (printer["gcode_macro Save_Pressure_Advance"].pa == -1) %}
	SET_PRESSURE_ADVANCE ADVANCE={printer["gcode_macro Save_Pressure_Advance"].pa}
	{% endif %}

[safe_z_home]
home_xy_position = 165, 165
z_hop = 10

[z_tilt]
z_positions = 
	-80,  -20
	350, -20
points = 
	15, 150
	275, 150
speed = 50
horizontal_move_z = 10
retries = 30
retry_tolerance = 0.1

[input_shaper]
shaper_type_x = zv
shaper_freq_x = 120.6
shaper_type_y = zv
shaper_freq_y = 76.6

[printer]
kinematics = corexy
max_velocity = 3000
max_accel = 20000
max_z_velocity = 20
max_z_accel = 15
square_corner_velocity = 10

[exclude_object]

[gcode_arcs]
resolution = 0.05

[idle_timeout]
gcode = 
	{% if not printer.pause_resume.is_paused %}
	TURN_OFF_HEATERS
	M84
	{% endif %}

[save_variables]
filename = vars.cfg

[mcu]
serial = /dev/serial/by-id/usb-Klipper_stm32h723xx_4C0023001551313338343730-if00

[bed_mesh default]
version = 1
points = 
	-0.215000, -0.210000, -0.190000, -0.185000, -0.170000, -0.145000, -0.135000, -0.120000, -0.105000, -0.070000, -0.055000, -0.035000, 0.000000, 0.010000, 0.025000, 0.050000, 0.080000, 0.105000, 0.130000, 0.135000, 0.150000, 0.155000, 0.165000, 0.190000, 0.205000
	-0.160000, -0.155000, -0.160000, -0.150000, -0.130000, -0.110000, -0.105000, -0.085000, -0.055000, -0.035000, -0.025000, 0.000000, 0.025000, 0.055000, 0.075000, 0.100000, 0.110000, 0.130000, 0.160000, 0.170000, 0.190000, 0.190000, 0.205000, 0.205000, 0.220000
	-0.160000, -0.150000, -0.140000, -0.135000, -0.115000, -0.105000, -0.090000, -0.070000, -0.040000, -0.025000, -0.010000, 0.015000, 0.030000, 0.045000, 0.080000, 0.100000, 0.115000, 0.135000, 0.160000, 0.165000, 0.180000, 0.185000, 0.190000, 0.220000, 0.235000
	-0.120000, -0.115000, -0.115000, -0.100000, -0.080000, -0.070000, -0.065000, -0.040000, -0.015000, 0.010000, 0.030000, 0.050000, 0.065000, 0.090000, 0.110000, 0.130000, 0.145000, 0.175000, 0.195000, 0.195000, 0.195000, 0.205000, 0.210000, 0.235000, 0.240000
	-0.075000, -0.065000, -0.055000, -0.045000, -0.040000, -0.020000, -0.005000, 0.015000, 0.035000, 0.065000, 0.075000, 0.090000, 0.105000, 0.115000, 0.140000, 0.170000, 0.175000, 0.190000, 0.205000, 0.205000, 0.205000, 0.210000, 0.215000, 0.240000, 0.240000
	-0.045000, -0.050000, -0.055000, -0.045000, -0.015000, -0.005000, -0.005000, 0.020000, 0.060000, 0.065000, 0.075000, 0.100000, 0.115000, 0.125000, 0.135000, 0.170000, 0.175000, 0.175000, 0.205000, 0.205000, 0.205000, 0.205000, 0.210000, 0.220000, 0.225000
	-0.035000, -0.030000, -0.030000, -0.020000, 0.000000, 0.015000, 0.015000, 0.035000, 0.065000, 0.085000, 0.100000, 0.110000, 0.115000, 0.130000, 0.160000, 0.170000, 0.180000, 0.180000, 0.200000, 0.200000, 0.200000, 0.205000, 0.205000, 0.220000, 0.235000
	0.005000, 0.010000, 0.015000, 0.025000, 0.035000, 0.040000, 0.055000, 0.085000, 0.095000, 0.110000, 0.115000, 0.125000, 0.140000, 0.160000, 0.175000, 0.180000, 0.190000, 0.190000, 0.225000, 0.225000, 0.225000, 0.225000, 0.230000, 0.235000, 0.250000
	0.055000, 0.065000, 0.060000, 0.065000, 0.075000, 0.090000, 0.100000, 0.110000, 0.120000, 0.130000, 0.140000, 0.155000, 0.170000, 0.180000, 0.190000, 0.195000, 0.210000, 0.220000, 0.235000, 0.235000, 0.235000, 0.235000, 0.245000, 0.250000, 0.260000
	0.100000, 0.105000, 0.110000, 0.110000, 0.120000, 0.135000, 0.145000, 0.150000, 0.155000, 0.155000, 0.170000, 0.185000, 0.190000, 0.195000, 0.195000, 0.215000, 0.230000, 0.235000, 0.245000, 0.245000, 0.245000, 0.235000, 0.245000, 0.250000, 0.260000
	0.100000, 0.115000, 0.125000, 0.130000, 0.135000, 0.145000, 0.150000, 0.155000, 0.165000, 0.175000, 0.190000, 0.200000, 0.205000, 0.205000, 0.215000, 0.225000, 0.230000, 0.245000, 0.255000, 0.240000, 0.240000, 0.240000, 0.245000, 0.250000, 0.250000
	0.155000, 0.150000, 0.150000, 0.150000, 0.160000, 0.165000, 0.165000, 0.175000, 0.175000, 0.195000, 0.200000, 0.215000, 0.205000, 0.210000, 0.215000, 0.225000, 0.235000, 0.240000, 0.245000, 0.240000, 0.240000, 0.235000, 0.220000, 0.235000, 0.240000
	0.170000, 0.165000, 0.165000, 0.170000, 0.180000, 0.190000, 0.190000, 0.185000, 0.200000, 0.205000, 0.220000, 0.230000, 0.225000, 0.225000, 0.240000, 0.245000, 0.240000, 0.250000, 0.255000, 0.245000, 0.250000, 0.245000, 0.245000, 0.240000, 0.240000
	0.210000, 0.200000, 0.195000, 0.200000, 0.210000, 0.210000, 0.210000, 0.215000, 0.215000, 0.215000, 0.235000, 0.245000, 0.235000, 0.235000, 0.245000, 0.250000, 0.240000, 0.250000, 0.250000, 0.250000, 0.255000, 0.250000, 0.235000, 0.235000, 0.240000
	0.240000, 0.250000, 0.250000, 0.245000, 0.260000, 0.260000, 0.255000, 0.255000, 0.255000, 0.250000, 0.265000, 0.265000, 0.260000, 0.255000, 0.260000, 0.255000, 0.255000, 0.270000, 0.260000, 0.255000, 0.250000, 0.255000, 0.245000, 0.250000, 0.240000
	0.270000, 0.260000, 0.255000, 0.265000, 0.265000, 0.265000, 0.265000, 0.260000, 0.260000, 0.255000, 0.265000, 0.265000, 0.265000, 0.255000, 0.255000, 0.250000, 0.255000, 0.250000, 0.250000, 0.245000, 0.245000, 0.235000, 0.230000, 0.235000, 0.240000
	0.275000, 0.280000, 0.275000, 0.275000, 0.275000, 0.275000, 0.275000, 0.275000, 0.280000, 0.280000, 0.280000, 0.270000, 0.270000, 0.270000, 0.265000, 0.265000, 0.265000, 0.270000, 0.260000, 0.255000, 0.235000, 0.235000, 0.235000, 0.240000, 0.235000
	0.335000, 0.315000, 0.305000, 0.310000, 0.305000, 0.300000, 0.295000, 0.290000, 0.300000, 0.295000, 0.290000, 0.290000, 0.280000, 0.270000, 0.270000, 0.275000, 0.275000, 0.265000, 0.250000, 0.245000, 0.235000, 0.225000, 0.225000, 0.230000, 0.235000
	0.355000, 0.350000, 0.345000, 0.325000, 0.330000, 0.325000, 0.325000, 0.325000, 0.315000, 0.310000, 0.300000, 0.290000, 0.285000, 0.290000, 0.275000, 0.275000, 0.265000, 0.265000, 0.250000, 0.245000, 0.235000, 0.225000, 0.230000, 0.225000, 0.215000
	0.395000, 0.385000, 0.380000, 0.370000, 0.365000, 0.370000, 0.360000, 0.355000, 0.345000, 0.340000, 0.330000, 0.320000, 0.310000, 0.305000, 0.300000, 0.290000, 0.275000, 0.260000, 0.255000, 0.255000, 0.250000, 0.235000, 0.230000, 0.230000, 0.230000
	0.395000, 0.390000, 0.375000, 0.375000, 0.375000, 0.370000, 0.365000, 0.360000, 0.355000, 0.335000, 0.325000, 0.315000, 0.315000, 0.300000, 0.295000, 0.280000, 0.255000, 0.260000, 0.250000, 0.240000, 0.230000, 0.235000, 0.230000, 0.205000, 0.195000
	0.405000, 0.395000, 0.395000, 0.390000, 0.380000, 0.375000, 0.370000, 0.360000, 0.355000, 0.345000, 0.325000, 0.325000, 0.310000, 0.295000, 0.290000, 0.270000, 0.250000, 0.240000, 0.235000, 0.235000, 0.230000, 0.205000, 0.195000, 0.195000, 0.195000
	0.405000, 0.395000, 0.380000, 0.375000, 0.375000, 0.370000, 0.360000, 0.345000, 0.340000, 0.330000, 0.305000, 0.300000, 0.285000, 0.270000, 0.250000, 0.235000, 0.220000, 0.215000, 0.220000, 0.205000, 0.195000, 0.175000, 0.175000, 0.170000, 0.165000
	0.405000, 0.390000, 0.395000, 0.385000, 0.365000, 0.350000, 0.345000, 0.330000, 0.320000, 0.305000, 0.290000, 0.265000, 0.260000, 0.240000, 0.225000, 0.215000, 0.205000, 0.190000, 0.180000, 0.185000, 0.165000, 0.150000, 0.145000, 0.145000, 0.145000
	0.430000, 0.425000, 0.400000, 0.395000, 0.385000, 0.370000, 0.365000, 0.340000, 0.320000, 0.305000, 0.295000, 0.270000, 0.250000, 0.235000, 0.215000, 0.215000, 0.200000, 0.190000, 0.185000, 0.165000, 0.155000, 0.145000, 0.135000, 0.130000, 0.135000
x_count = 25
y_count = 25
mesh_x_pps = 3
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 310.0
min_y = 26.43
max_y = 281.31
=======================
Config error
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/klippy.py", line 175, in _connect
    self._read_config()
  File "/home/pi/klipper/klippy/klippy.py", line 143, in _read_config
    m.add_printer_objects(config)
  File "/home/pi/klipper/klippy/toolhead.py", line 658, in add_printer_objects
    config.get_printer().add_object('toolhead', ToolHead(config))
                                                ^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/toolhead.py", line 261, in __init__
    self.kin = mod.load_kinematics(self, config)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/kinematics/corexy.py", line 99, in load_kinematics
    return CoreXYKinematics(toolhead, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/kinematics/corexy.py", line 12, in __init__
    self.rails = [stepper.LookupMultiRail(config.getsection('stepper_' + n))
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/kinematics/corexy.py", line 12, in <listcomp>
    self.rails = [stepper.LookupMultiRail(config.getsection('stepper_' + n))
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/stepper.py", line 423, in LookupMultiRail
    rail = PrinterRail(config, need_position_minmax,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/stepper.py", line 304, in __init__
    self.add_extra_stepper(config)
  File "/home/pi/klipper/klippy/stepper.py", line 383, in add_extra_stepper
    pin_params = ppins.parse_pin(endstop_pin, True, True)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/pins.py", line 83, in parse_pin
    raise error("Unknown pin chip name '%s'" % (chip_name,))
pins.error: Unknown pin chip name 'probe'
webhooks client 140734118203088: New connection
webhooks client 140734118203088: Client info {'program': 'Moonraker', 'version': 'v0.8.0-308-g71b46cc'}
Attempting MCU 'mcu' reset
Attempting MCU 'tr' reset
webhooks client 140734118203088: Disconnected
Restarting printer
Start printer at Mon Feb  5 14:52:32 2024 (1707144753.0 90668.8)
===== Config file =====
[virtual_sdcard]
path = /home/pi/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]
recover_velocity = 350

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	TURN_OFF_HEATERS
	G91
	G1 Z10 E-2 F3600
	G1 E-3 F3600
	G90
	G1 X30 Y250 F7000; home X axis
	M106 S80
	G4 P10000
	M106 S0
	M221 S100
	CANCEL_PRINT_BASE
	CLEAR_PAUSE
	
	SET_GCODE_OFFSET Z=0.0
	RESETSPEEDS
	M84
	
	BED_MESH_CLEAR

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	
	{% set x_park = printer.toolhead.axis_maximum.x|float - 5.0 %}
	{% set y_park = printer.toolhead.axis_maximum.y|float - 5.0 %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < (max_z - 2.0) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	
	SAVE_GCODE_STATE NAME=PAUSE_state
	BASE_PAUSE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	G91
	G1 E-{1} F2100
	G1 Z{10} F900
	G90
	G1 X{50} Y{0} F6000
variable_extrude = 1.0

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	G91
	G1 E{1} F2100
	RESTORE_GCODE_STATE NAME=PAUSE_state
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[tmc5160 extruder]
cs_pin = PA10
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 0.65
sense_resistor = 0.075
stealthchop_threshold = 0

[extruder]
rotation_distance = 5.7
full_steps_per_rotation = 200
sensor_type = PT1000
min_temp = 0
max_temp = 330
filament_diameter = 1.750
dir_pin = !PB6
step_pin = PG15
enable_pin = !PG14
heater_pin = PF6
sensor_pin = PB1
microsteps = 16
max_extrude_only_distance = 101
max_extrude_cross_section = 100
nozzle_diameter = 0.600
pressure_advance = 0.015
pressure_advance_smooth_time = 0.02
control = pid
pid_kp = 22.354
pid_ki = 1.552
pid_kd = 80.473

[tmc5160 stepper_x]
cs_pin = PD6
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
diag1_pin = PC15
run_current = 2.00
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_x]
dir_pin = !PC13
step_pin = PC14
enable_pin = !PE6
endstop_pin = PC15
microsteps = 16
rotation_distance = 40
position_endstop = -6
position_min = -6
position_max = 330
homing_speed = 20
full_steps_per_rotation = 200
homing_retract_dist = 0
homing_positive_dir = false
step_pulse_duration = 0.000001

[tmc5160 stepper_x1]
cs_pin = PD5
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2.00
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_x1]
dir_pin = !PE4
step_pin = PE5
enable_pin = !PE3
microsteps = 16
rotation_distance = 40
full_steps_per_rotation = 200
step_pulse_duration = 0.000001

[tmc5160 stepper_y]
cs_pin = PD4
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_y]
dir_pin = !PE1
step_pin = PE2
enable_pin = !PE0
endstop_pin = PF0
microsteps = 16
rotation_distance = 40
position_endstop = 0
position_min = 0
position_max = 315
homing_speed = 20
full_steps_per_rotation = 200
homing_retract_dist = 0
homing_positive_dir = false
step_pulse_duration = 0.000001

[tmc5160 stepper_y1]
cs_pin = PD3
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_y1]
dir_pin = !PB8
step_pin = PB9
enable_pin = !PB7
microsteps = 16
rotation_distance = 40
full_steps_per_rotation = 200
step_pulse_duration = 0.000001

[tmc5160 stepper_z]
cs_pin = PD2
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 1
sense_resistor = 0.075
stealthchop_threshold = 0

[stepper_z]
dir_pin = !PG10
step_pin = PG9
enable_pin = !PG13
endstop_pin = probe:z_virtual_endstop
microsteps = 16
rotation_distance = 8
position_min = -20
position_max = 400
full_steps_per_rotation = 200
homing_retract_dist = 5.0
homing_positive_dir = false
homing_speed = 3
second_homing_speed = 1
step_pulse_duration = 0.000004

[tmc5160 stepper_z1]
cs_pin = PA15
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 1
sense_resistor = 0.075
stealthchop_threshold = 0

[stepper_z1]
dir_pin = !PD7
step_pin = PG11
enable_pin = !PG12
microsteps = 16
rotation_distance = 8

[temperature_sensor Kraken]
sensor_type = temperature_mcu
min_temp = 10
max_temp = 100

[heater_fan hotend_fan]
pin = PA0
max_power = 1.0
kick_start_time = 0.5
heater = extruder
heater_temp = 50.0

[fan]
pin = PF12
enable_pin = PF7
hardware_pwm = false
max_power = 1
cycle_time = 0.00002
off_below = 0.012
kick_start_time = 0.01

[heater_bed]
heater_pin = PF5
sensor_pin = PC5
sensor_type = NTC 100K MGB18-104F39050L32
control = pid
pid_kp = 34.679
pid_ki = 1.492
pid_kd = 201.572
min_temp = 0
max_temp = 120
max_power = 1
pwm_cycle_time = 0.0166

[bed_screws]
screw1 = 10,0
screw2 = 10,260
screw3 = 320,260
screw4 = 320,0

[screws_tilt_adjust]
screw1 = 10, 0
screw1_name = front left screw
screw2 = 10, 260
screw2_name = rear left screw
screw3 = 300, 260
screw3_name = rear right screw
screw4 = 320, 0
screw4_name = front right screw
horizontal_move_z = 10.
speed = 250
screw_thread = CW-M3

[force_move]
enable_force_move = true

[bed_mesh]
speed = 200
horizontal_move_z = 1
mesh_min = 10, 22
mesh_max = 310, 260
mesh_pps = 3,3
probe_count = 25,25
algorithm = bicubic
relative_reference_index = 12
bicubic_tension = 0.2
fade_start = 1
fade_end = 10
split_delta_z = .025
move_check_distance = 5

[neopixel my_neopixel]
pin = PF11
chain_count = 13
color_order = GRB
initial_red = 1.0
initial_green = 1
initial_blue = 1

[gcode_macro BED_MESH]
gcode = 
	BED_MESH_CALIBRATE

[gcode_macro PA_TUNING]
gcode = 
	SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=1 ACCEL=500
	TUNING_TOWER COMMAND=SET_PRESSURE_ADVANCE PARAMETER=ADVANCE START=0 FACTOR=.005

[gcode_macro HOTEND_PID]
gcode = 
	{% set tool_temp = params.TEMPERATURE|default(220)|int %}
	{% set tool_name = printer.toolhead.extruder %}
	PID_CALIBRATE HEATER={tool_name} TARGET={tool_temp}

[gcode_macro BED_PID]
gcode = 
	{% set bed_temp = params.TEMPERATURE|default(60)|int %}
	PID_CALIBRATE HEATER=heater_bed TARGET={bed_temp}

[gcode_macro SCREWS_TILT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro DUMP_WARNINGS]
description = Debug: Print all warning messages from klipper
gcode = 
	{% set parameters = ["printer.configfile.warnings:"] %}
	{% for warning in printer.configfile.warnings %}
	{% set parameters = parameters.append("%s -> %s -> %s\n%s" % (warning.type, warning.section, warning.option, warning.message)) %}
	{% endfor %}
	{action_respond_info(parameters|join("\n"))}

[gcode_macro enable_stepper]
gcode = 
	SET_STEPPER_ENABLE STEPPER=stepper_x ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_x1 ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y1 ENABLE=1

[gcode_macro disable-steppers]
gcode = 
	m84

[gcode_macro M600]
gcode = 
	G4 P1500
	{% set X = params.X|default(50)|float %}
	{% set Y = params.Y|default(0)|float %}
	{% set Z = params.Z|default(10)|float %}
	
	SAVE_GCODE_STATE NAME=M600_state
	PAUSE
	
	G91
	G1 E-{1} F2100
	G1 Z{Z}
	G90
	G1 X{X} Y{Y} F4000
	G91
	M83
	G1 E5 F800
	G1 E-180 F2000
	M82
	RESTORE_GCODE_STATE NAME=M600_state

[gcode_macro PURGE]
gcode = 
	M83
	G1 E120 F250

[gcode_macro _UNLOAD_FILAMENT]
gcode = 
	{% set e_temp = params.TEMPERATURE|default(235)|int %}
	M118 Filament unloading!
	M117 Filament unloading!
	M82
	G92 E0
	{% if printer.extruder.can_extrude|lower != 'true' %}
	
	M118 Hotend heating!
	M109 S{e_temp} T0
	{% endif %}
	G1 E10 F{5*60}
	G0 E-5 F{60*60}
	G0 E-70 F{5*60}
	M400
	M118 Filament unload complete!
	M117 Filament unload complete!

[gcode_macro _LOAD_FILAMENT]
gcode = 
	{% set e_temp = params.TEMPERATURE|default(230)|int %}
	M109 S{e_temp}
	M83
	G1 E50 F300
	G1 E-1 F100
	M82
	M104 S0

[gcode_macro UNLOAD_PLA]
gcode = 
	_UNLOAD_FILAMENT TEMPERATURE=200

[gcode_macro LOAD_PLA]
gcode = 
	_LOAD_FILAMENT TEMPERATURE=200

[gcode_macro UNLOAD_ABS]
gcode = 
	_UNLOAD_FILAMENT TEMPERATURE=250

[gcode_macro LOAD_ABS]
gcode = 
	_LOAD_FILAMENT TEMPERATURE=250

[gcode_macro UNLOAD_PETG]
gcode = 
	_UNLOAD_FILAMENT TEMPERATURE=235

[gcode_macro LOAD_PETG]
gcode = 
	_LOAD_FILAMENT TEMPERATURE=235

[gcode_macro LOAD_FILAMENT]
gcode = 
	{% set speed = params.SPEED|default(300) %}
	{% set max_velocity = printer.configfile.settings['extruder'].max_extrude_only_velocity %}
	SAVE_GCODE_STATE NAME=load_state
	M300
	G91
	G92 E0
	G1 E350 F{max_velocity}
	G1 E25 F{speed}
	M300
	M300
	RESTORE_GCODE_STATE NAME=load_state

[gcode_macro UNLOAD_FILAMENT]
gcode = 
	{% set speed = params.SPEED|default(300) %}
	{% set max_velocity = printer.configfile.settings['extruder'].max_extrude_only_velocity %}
	SAVE_GCODE_STATE NAME=unload_state
	G91
	M300
	G92 E0
	G1 E25 F{speed}
	G1 E-420 F{max_velocity}
	M300
	M300
	RESTORE_GCODE_STATE NAME=unload_state

[gcode_macro START_PRINT]
gcode = 
	
	{% set DWELL = params.DWELL|default(00)|int %}
	{% set bedTemp = params.BED|default(70)|int %}
	{% set hotendTemp = params.HOTEND|default(210)|int %}
	SET_FAN_SPEED FAN=LED_Bar SPEED=0.5
	CLEAR_PAUSE
	RESETSPEEDS
	G21
	G90
	M83
	M140 S{bedTemp}; start heating the bed
	M104 S100
	SET_DISPLAY_TEXT MSG="Waiting for temperatures..."
	HEATSOAK DWELL={DWELL}
	G28 X Y
	ATTACH_PROBE_LOCK
	G28 Z
	SET_DISPLAY_TEXT MSG="Adjusting Z Tilt"
	Z_TILT_ADJUST
	G28 Z
	
	SET_DISPLAY_TEXT MSG="Calibrating Bed Mesh"
	BED_MESH_CLEAR
	BED_MESH_CALIBRATE
	BED_MESH_PROFILE LOAD=default
	SET_DISPLAY_TEXT MSG="Heating Extruder to temp"
	G1 X1 Y1 Z0.5 F9000
	M109 S{hotendTemp}; wait for extruder to heat up
	TR_UNLOAD_TOOLHEAD
	TR_HOME
	FIXED_PURGE_LINE
	M83
	SET_DISPLAY_TEXT MSG="Printing..."
	TR_SYNC_TO_EXTRUDER

[gcode_macro HEATSOAK]
gcode = 
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion..."
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 5% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 10% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 15% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 20% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 25% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 30% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 35% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 40% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 45% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 50% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 55% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 60% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 65% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 70% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 75% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 80% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 85% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 90% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 95% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Thermal expansion done"

[gcode_macro _CG28]
gcode = 
	{% if "xyz" not in printer.toolhead.homed_axes %}
	G28
	{% endif %}

[gcode_macro FIXED_PURGE_LINE]
gcode = 
	M83
	G92 E0
	G1 Z1 F3000
	G1 X1 Y80 Z0.3 E10  F1200
	G1 X1 Y120 E11  F1200
	G1 E-0.8 F1000
	G92 E0
	G1 Z1 F2000

[gcode_macro END_PRINT]
gcode = 
	TR_UNLOAD_TOOLHEAD
	
	TURN_OFF_HEATERS
	G91
	G1 Z10 E-2 F3600
	
	G90
	G1 X30 Y250 F7000; home X axis
	M106 S80
	G4 P10000
	M106 S0
	M221 S100
	CLEAR_PAUSE
	
	SET_GCODE_OFFSET Z=0.0
	RESETSPEEDS
	
	M84
	BED_MESH_CLEAR
	SET_FAN_SPEED FAN=LED_Bar SPEED=0
	TR_UNSYNC_TO_EXTRUDER
	UPDATE_GIT

[gcode_macro PARK]
description = Park the toolhead at the front and retract some filament if the nozzle is hot
gcode = 
	{% set E = params.E|default(1.7)|float %}
	
	{% set Px, Py = printer["gcode_macro _USER_VARIABLES"].park_position_xy|map('float') %}
	{% set park_lift_z = printer["gcode_macro _USER_VARIABLES"].park_lift_z %}
	
	{% set St = printer["gcode_macro _USER_VARIABLES"].travel_speed * 60 %}
	{% set Sz = printer["gcode_macro _USER_VARIABLES"].z_drop_speed * 60 %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	
	{% set z_safe = act_z + park_lift_z %}
	{% if z_safe > max_z %}
	{% set z_safe = max_z %}
	{% endif %}
	
	
	{% if printer.extruder.temperature > 185 %}
	G10
	{% endif %}
	G90
	G1 Z{z_safe} F{Sz}
	
	G0 X{Px} Y{Py} F{St}

[gcode_macro RESETSPEEDS]
gcode = 
	SET_VELOCITY_LIMIT VELOCITY={printer.configfile.settings.printer.max_velocity}
	SET_VELOCITY_LIMIT ACCEL={printer.configfile.settings.printer.max_accel}
	SET_VELOCITY_LIMIT ACCEL_TO_DECEL={printer.configfile.settings.printer.max_accel_to_decel}
	SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={printer.configfile.settings.printer.square_corner_velocity}

[gcode_macro DISABLEXYE]
gcode = 
	SET_STEPPER_ENABLE STEPPER=extruder ENABLE=0
	SET_STEPPER_ENABLE STEPPER=stepper_x ENABLE=0
	
	SET_STEPPER_ENABLE STEPPER=stepper_y ENABLE=0
	
	SET_STEPPER_ENABLE STEPPER=stepper_z ENABLE=1

[gcode_macro TEST_SPEED]
gcode = 
	
	{% set speed  = params.SPEED|default(printer.configfile.settings.printer.max_velocity)|int %}
	
	{% set iterations = params.ITERATIONS|default(5)|int %}
	
	{% set accel  = params.ACCEL|default(printer.configfile.settings.printer.max_accel)|int %}
	
	{% set bound = params.BOUND|default(20)|int %}
	
	{% set smallpatternsize = SMALLPATTERNSIZE|default(20)|int %}
	
	
	
	{% set x_min = 10 + bound %}
	{% set x_max = 300 - bound %}
	{% set y_min = 10 + bound %}
	{% set y_max = 300 - bound %}
	
	
	
	{% set x_center = (printer.toolhead.axis_minimum.x|float + printer.toolhead.axis_maximum.x|float ) / 2 %}
	{% set y_center = (printer.toolhead.axis_minimum.y|float + printer.toolhead.axis_maximum.y|float ) / 2 %}
	
	
	{% set x_center_min = x_center - (smallpatternsize/2) %}
	{% set x_center_max = x_center + (smallpatternsize/2) %}
	{% set y_center_min = y_center - (smallpatternsize/2) %}
	{% set y_center_max = y_center + (smallpatternsize/2) %}
	
	
	SAVE_GCODE_STATE NAME=TEST_SPEED
	
	
	{ action_respond_info("TEST_SPEED: starting %d iterations at speed %d, accel %d" % (iterations, speed, accel)) }
	
	
	M400
	G28
	
	{% if printer.configfile.settings.quad_gantry_level %}
	{% if printer.quad_gantry_level.applied == False %}
	QUAD_GANTRY_LEVEL
	G28 Z
	{% endif %}
	{% endif %}
	
	G90
	G1 X{printer.toolhead.axis_maximum.x-50} Y{printer.toolhead.axis_maximum.y-50} F{30*60}
	M400
	G28 X Y
	G0 X{300} Y{300} F{30*60}
	G4 P1000
	GET_POSITION
	
	
	G0 X{x_min} Y{y_min} Z{bound + 10} F{speed*60}
	
	
	SET_VELOCITY_LIMIT VELOCITY={speed} ACCEL={accel} ACCEL_TO_DECEL={accel / 2}
	
	{% for i in range(iterations) %}
	
	G0 X{x_min} Y{y_min} F{speed*60}
	G0 X{x_max} Y{y_max} F{speed*60}
	G0 X{x_min} Y{y_min} F{speed*60}
	G0 X{x_max} Y{y_min} F{speed*60}
	G0 X{x_min} Y{y_max} F{speed*60}
	G0 X{x_max} Y{y_min} F{speed*60}
	
	
	G0 X{x_min} Y{y_min} F{speed*60}
	G0 X{x_min} Y{y_max} F{speed*60}
	G0 X{x_max} Y{y_max} F{speed*60}
	G0 X{x_max} Y{y_min} F{speed*60}
	
	
	G0 X{x_center_min} Y{y_center_min} F{speed*60}
	G0 X{x_center_max} Y{y_center_max} F{speed*60}
	G0 X{x_center_min} Y{y_center_min} F{speed*60}
	G0 X{x_center_max} Y{y_center_min} F{speed*60}
	G0 X{x_center_min} Y{y_center_max} F{speed*60}
	G0 X{x_center_max} Y{y_center_min} F{speed*60}
	
	
	G0 X{x_center_min} Y{y_center_min} F{speed*60}
	G0 X{x_center_min} Y{y_center_max} F{speed*60}
	G0 X{x_center_max} Y{y_center_max} F{speed*60}
	G0 X{x_center_max} Y{y_center_min} F{speed*60}
	{% endfor %}
	
	
	SET_VELOCITY_LIMIT VELOCITY={printer.configfile.settings.printer.max_velocity} ACCEL={printer.configfile.settings.printer.max_accel} ACCEL_TO_DECEL={printer.configfile.settings.printer.max_accel_to_decel}
	
	
	M400
	G28
	
	G90
	G0 X{300} Y{300} F{30*60}
	G4 P1000
	GET_POSITION
	
	
	RESTORE_GCODE_STATE NAME=TEST_SPEED

[gcode_macro update_git]
gcode = 
	RUN_SHELL_COMMAND CMD=update_git_script

[gcode_shell_command update_git_script]
command = bash /home/pi/klipper-backup/script.sh
timeout = 90.0
verbose = True

[mcu tr]
serial = /dev/serial/by-id/usb-Klipper_stm32g0b1xx_290023000950415833323720-if00

[belay my_belay]
extruder_type = trad_rack
sensor_pin = ^tr:PB9
multiplier_high = 1.05
multiplier_low = 0.8
debug_level = 1

[trad_rack]
sync_to_extruder = true
selector_max_velocity = 400
selector_max_accel = 10000
lane_count = 4
lane_spacing = 17.26
servo_down_angle = 0
servo_up_angle = 130
toolhead_unload_speed = 20
extruder_load_speed = 2
toolhead_sense_speed = 20
selector_unload_length = 20
bowden_length = 865
extruder_load_length = 60
hotend_load_length = 20
toolhead_unload_length = 80
buffer_pull_speed = 100.0
pre_unload_gcode = 
	SAVE_GCODE_STATE NAME=PRE_UNLOAD_state
	{% if printer.virtual_sdcard.is_active %}
	{% set z_max = printer.toolhead.axis_maximum.z - printer.gcode_move.homing_origin.z %}
	{% set z_lift = printer["gcode_macro TR_Variables"].z_lift|float %}
	{% set x_park = printer["gcode_macro TR_Variables"].x_park|float %}
	{% set y_park = printer["gcode_macro TR_Variables"].y_park|float %}
	{% set do_x_park = printer["gcode_macro TR_Variables"].do_x_park %}
	{% set do_y_park = printer["gcode_macro TR_Variables"].do_y_park %}
	{% set st = printer["gcode_macro TR_Variables"].travel_speed * 60 %}
	{% set shape_tip = printer["gcode_macro TR_Variables"].shape_tip %}
	{% set use_wiper = printer["gcode_macro TR_Variables"].use_wiper %}
	{% set x = printer.gcode_move.gcode_position.x %}
	{% set y = printer.gcode_move.gcode_position.y %}
	{% set z = printer.gcode_move.gcode_position.z %}
	{% set z_park = [z + z_lift, z_max]|min %}
	
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=x VALUE={x}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=y VALUE={y}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=z VALUE={z}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=saved_pos VALUE={True}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=z_park VALUE={z_park}
	
	
	G90
	G1 Z{z_park}
	
	
	{% if use_wiper %}
	Go_To_Purge_Location
	
	
	{% else %}
	G90
	{% if do_x_park %}
	{% set x = x_park %}
	{% endif %}
	{% if do_y_park %}
	{% set y = y_park %}
	{% endif %}
	G1 X{x} Y{y} F{st}
	{% endif %}
	
	
	{% if shape_tip %}
	Shape_Tip
	{% endif %}
	{% else %}
	
	{% if use_wiper %}
	Go_To_Purge_Location
	{% endif %}
	
	
	Shape_Tip
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRE_UNLOAD_state
post_load_gcode = 
	SAVE_GCODE_STATE NAME=POST_LOAD_state
	{% set use_wiper = printer["gcode_macro TR_Variables"].use_wiper %}
	{% if printer.virtual_sdcard.is_active %}
	{% set st = printer["gcode_macro TR_Variables"].travel_speed * 60 %}
	{% set take_frame = printer["gcode_macro TR_Variables"].take_frame %}
	{% set x = printer["gcode_macro TR_Variables"].x %}
	{% set y = printer["gcode_macro TR_Variables"].y %}
	{% set z = printer["gcode_macro TR_Variables"].z %}
	{% set saved_pos = printer["gcode_macro TR_Variables"].saved_pos %}
	{% set z_park = printer["gcode_macro TR_Variables"].z_park %}
	
	
	{% if take_frame %}
	TIMELAPSE_TAKE_FRAME
	{% endif %}
	
	
	{% if use_wiper %}
	Home_and_Wipe_Nozzle
	{% endif %}
	
	
	{% if saved_pos %}
	G90
	G1 Z{z_park}
	G1 X{x} Y{y} F{st}
	G1 Z{z}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=saved_pos VALUE={False}
	{% endif %}
	
	Restore_Pressure_Advance
	{% elif use_wiper %}
	Home_and_Wipe_Nozzle
	{% endif %}
	RESTORE_GCODE_STATE NAME=POST_LOAD_state

[stepper_tr_selector]
step_pin = tr:PB15
dir_pin = !tr:PB14
enable_pin = !tr:PA8
rotation_distance = 40
microsteps = 16
full_steps_per_rotation = 400
endstop_pin = ^tr:PA3
position_min = 0.0
position_endstop = 0
position_max = 158
homing_speed = 30

[stepper_tr_fil_driver]
step_pin = tr:PD2
dir_pin = tr:PB13
enable_pin = !tr:PD1
rotation_distance = 22.67895
gear_ratio = 50:17
microsteps = 16
full_steps_per_rotation = 400
endstop_pin = ^tr:PA4
position_min = -5000
position_endstop = 0
position_max = 5000
homing_positive_dir = False

[tmc2209 stepper_tr_selector]
uart_pin = tr:PA10
interpolate = True
run_current = 1.3
sense_resistor = 0.110

[tmc2209 stepper_tr_fil_driver]
uart_pin = tr:PC7
interpolate = False
run_current = 1.3
sense_resistor = 0.110

[servo tr_servo]
pin = tr:PA0
maximum_servo_angle = 131
minimum_pulse_width = 0.000700
maximum_pulse_width = 0.002200

[gcode_macro ACTIVATE_EXTRUDER]
rename_existing = ACTIVATE_EXTRUDER.1
gcode = 
	{% set EXTRUDER = params.EXTRUDER|default('extruder')|lower|replace('extruder', '') %}
	{% if EXTRUDER == '' %}
	{% set EXTRUDER = '0' %}
	{% endif %}
	TR_LOAD_TOOLHEAD LANE={EXTRUDER}

[gcode_macro TR_Variables]
description = Variables for use with Trad Rack pre unload and post load gcode
variable_z_lift = 0.1
variable_x_park = 0.0
variable_y_park = 175.0
variable_do_x_park = False
variable_do_y_park = False
variable_travel_speed = 300
variable_shape_tip = False
variable_take_frame = False
variable_use_wiper = False
variable_x = 0
variable_y = 0
variable_z = 0
variable_saved_pos = False
variable_z_park = 0
gcode = 

[gcode_macro Shape_Tip]
description = Perform tip-shaping, retraction, and cooling moves
gcode = 
	SAVE_GCODE_STATE NAME=Shape_Tip_state
	Save_Pressure_Advance
	
	Slicer_Unload
	
	
	Restore_Pressure_Advance
	RESTORE_GCODE_STATE NAME=Shape_Tip_state

[gcode_macro Set_Slicer_Unload_Preset]
description = Apply a preset of values to use for the Slicer_Unload macro
variable_asa_ss = {
	"filament_ramming_parameters": "120 110 5.32258 5.45161 5.67742 6 6.48387 7.12903 7.90323 8.70968 9.3871 9.83871 10.0968 10.2258| 0.05 5.30967 0.45 5.50967 0.95 6.1871 1.45 7.39677 1.95 9.05484 2.45 10 2.95 10.3098 3.45 13.0839 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": True}
variable_pla_ss = {
	"filament_ramming_parameters": "130 120 2.70968 2.93548 3.32258 3.83871 4.58065 5.54839 6.51613 7.35484 7.93548 8.16129| 0.05 2.66451 0.45 3.05805 0.95 4.05807 1.45 5.97742 1.95 7.69999 2.45 8.1936 2.95 11.342 3.45 11.4065 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": True}
variable_asa_ps = {
	"filament_ramming_parameters": "120 110 5.32258 5.45161 5.67742 6 6.48387 7.12903 7.90323 8.70968 9.3871 9.83871 10.0968 10.2258| 0.05 5.30967 0.45 5.50967 0.95 6.1871 1.45 7.39677 1.95 9.05484 2.45 10 2.95 10.3098 3.45 13.0839 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": False}
variable_pla_ps = {
	"filament_ramming_parameters": "130 120 2.70968 2.93548 3.32258 3.83871 4.58065 5.54839 6.51613 7.35484 7.93548 8.16129| 0.05 2.66451 0.45 3.05805 0.95 4.05807 1.45 5.97742 1.95 7.69999 2.45 8.1936 2.95 11.342 3.45 11.4065 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": False}
gcode = 
	{% set preset_name = params.PRESET|lower %}
	{% if preset_name in printer['gcode_macro Set_Slicer_Unload_Preset'] %}
	{% set preset = printer['gcode_macro Set_Slicer_Unload_Preset'].preset_name %}
	{% for key in preset %}
	SET_GCODE_VARIABLE MACRO=Slicer_Unload VARIABLE={key} VALUE={preset[key]}
	{% endfor %}
	{% else %}
	{ action_raise_error("Preset \"%s\" does not exist" % preset_name) }
	{% endif %}

[gcode_macro Slicer_Unload]
description = Mimic ramming and unload behavior of PrusaSlicer or SuperSlicer
variable_cooling_tube_length = 14
variable_cooling_tube_retraction = 30
variable_filament_cooling_final_speed = 30
variable_filament_cooling_initial_speed = 20
variable_filament_cooling_moves = 4
variable_filament_diameter = 1.75
variable_filament_unloading_speed = 90
variable_filament_unloading_speed_start = 100
variable_filament_toolchange_delay = 0
variable_filament_ramming_parameters = "120 110 5.32258 5.45161 5.67742 6 6.48387 7.12903 7.90323 8.70968 9.3871 9.83871 10.0968 10.2258| 0.05 5.30967 0.45 5.50967 0.95 6.1871 1.45 7.39677 1.95 9.05484 2.45 10 2.95 10.3098 3.45 13.0839 3.95 7.6 4.45 7.6 4.95 7.6"
variable_filament_enable_toolchange_temp = False
variable_filament_toolchange_temp = 200
variable_filament_use_fast_skinnydip = False
variable_filament_enable_toolchange_part_fan = False
variable_filament_toolchange_part_fan_speed = 50
variable_filament_use_skinnydip = True
variable_filament_skinnydip_distance = 24
variable_filament_melt_zone_pause = 0
variable_filament_cooling_zone_pause = 0
variable_filament_dip_insertion_speed = 33
variable_filament_dip_extraction_speed = 70
variable_superslicer = False
variable_do_ramming = False
variable_do_unload = True
gcode = 
	{% set NEW_TEMPERATURE = params.NEW_TEMPERATURE|default(0)|float %}
	{% set prev_temp_target = printer.extruder.target %}
	
	SAVE_GCODE_STATE NAME=Slicer_Unload_state
	Save_Pressure_Advance
	
	M83
	M220 S100
	SET_PRESSURE_ADVANCE ADVANCE=0
	
	
	{% if do_ramming %}
	
	{% set ramming_speed = (filament_ramming_parameters.split('|')[0]).split(' ') %}
	
	
	{% set filament_area = 3.1415 * (filament_diameter / 2) ** 2 %}
	
	
	{% for i in range(2, ramming_speed|length) %}
	
	{% set f = ramming_speed[i]|float / filament_area %}
	
	
	{% set e = f * 0.25 %}
	
	
	G1 E{e} F{f * 60}
	{% endfor %}
	{% endif %}
	
	
	{% if do_unload %}
	
	{% if superslicer and filament_enable_toolchange_temp and not filament_use_fast_skinnydip %}
	_Wait_for_Toolchange_Temp
	{% endif %}
	
	
	{% set total_retraction_distance = cooling_tube_retraction + cooling_tube_length / 2 - 15 %}
	G1 E-15 F{filament_unloading_speed_start * 60}
	G1 E-{0.70 * total_retraction_distance} F{1.0 * filament_unloading_speed * 60}
	G1 E-{0.20 * total_retraction_distance} F{0.5 * filament_unloading_speed * 60}
	G1 E-{0.10 * total_retraction_distance} F{0.3 * filament_unloading_speed * 60}
	
	
	{% if not superslicer or not filament_enable_toolchange_temp %}
	{% if NEW_TEMPERATURE != 0 and (NEW_TEMPERATURE != prev_temp_target) %}
	M104 S{NEW_TEMPERATURE}
	{% endif %}
	
	
	{% elif superslicer and filament_enable_toolchange_temp and not filament_use_fast_skinnydip %}
	{% if NEW_TEMPERATURE != 0 %}
	M104 S{NEW_TEMPERATURE}
	{% else %}
	M104 S{prev_temp_target}
	{% endif %}
	{% endif %}
	
	
	{% set speed_inc = (filament_cooling_final_speed - filament_cooling_initial_speed) / (2 * filament_cooling_moves - 1) %}
	{% for i in range(filament_cooling_moves) %}
	{% set speed = filament_cooling_initial_speed + speed_inc * 2 * i %}
	G1 E{cooling_tube_length} F{speed * 60}
	{% set speed = speed + speed_inc %}
	G1 E-{cooling_tube_length} F{speed * 60}
	{% endfor %}
	
	
	{% if superslicer %}
	
	{% if filament_enable_toolchange_temp and filament_use_fast_skinnydip %}
	_Wait_for_Toolchange_Temp
	{% endif %}
	
	
	{% if filament_use_skinnydip %}
	G1 E{filament_skinnydip_distance} F{filament_dip_insertion_speed * 60}
	G4 P{filament_melt_zone_pause}
	G1 E-{filament_skinnydip_distance} F{filament_dip_extraction_speed * 60}
	G4 P{filament_cooling_zone_pause}
	{% endif %}
	
	
	{% if filament_enable_toolchange_temp and filament_use_fast_skinnydip %}
	{% if NEW_TEMPERATURE != 0 %}
	M109 S{NEW_TEMPERATURE}
	{% else %}
	M109 S{prev_temp_target}
	{% endif %}
	{% elif filament_enable_toolchange_temp and filament_use_fast_skinnydip %}
	{% if NEW_TEMPERATURE != 0 and (NEW_TEMPERATURE != prev_temp_target) %}
	M109 S{NEW_TEMPERATURE}
	{% endif %}
	{% endif %}
	{% endif %}
	
	
	G4 P{filament_toolchange_delay}
	
	
	
	{% endif %}
	
	Restore_Pressure_Advance
	RESTORE_GCODE_STATE NAME=Slicer_Unload_state

[gcode_macro _Wait_for_Toolchange_Temp]
description = Helper function for Slicer_Unload
gcode = 
	{% set tc_temp = printer["gcode_macro Slicer_Unload"].filament_toolchange_temp %}
	{% set fan_on = printer["gcode_macro Slicer_Unload"].filament_enable_toolchange_part_fan %}
	{% set fan_speed = printer["gcode_macro Slicer_Unload"].filament_toolchange_part_fan_speed %}
	
	{% set prev_fan_speed = printer.fan.speed %}
	{% if fan_on %}
	M106 S{(fan_speed / 100.0 * 255)|int}
	{% endif %}
	M109 S{filament_toolchange_temp}
	{% if fan_on %}
	M106 S{(prev_fan_speed * 255)|int}
	{% endif %}

[gcode_macro Home_and_Wipe_Nozzle]
description = Home x and y if needed, then wipe the nozzle
gcode = 
	
	{% if not 'xy' in printer.toolhead.homed_axes %}
	G28 X Y
	{% endif %}
	
	
	Wipe_Nozzle

[gcode_macro Save_Pressure_Advance]
description = Save the current pressure advance value
variable_pa = -1
gcode = 
	
	{% set pa = printer.extruder.pressure_advance %}
	{% if pa > 0 %}
	SET_GCODE_VARIABLE MACRO=Save_Pressure_Advance VARIABLE=pa VALUE={pa}
	{% endif %}

[gcode_macro Restore_Pressure_Advance]
description = Restore saved pressure advance value
gcode = 
	
	{% if not (printer["gcode_macro Save_Pressure_Advance"].pa == -1) %}
	SET_PRESSURE_ADVANCE ADVANCE={printer["gcode_macro Save_Pressure_Advance"].pa}
	{% endif %}

[safe_z_home]
home_xy_position = 165, 165
z_hop = 10

[z_tilt]
z_positions = 
	-80,  -20
	350, -20
points = 
	15, 150
	275, 150
speed = 50
horizontal_move_z = 10
retries = 30
retry_tolerance = 0.1

[input_shaper]
shaper_type_x = zv
shaper_freq_x = 120.6
shaper_type_y = zv
shaper_freq_y = 76.6

[printer]
kinematics = corexy
max_velocity = 3000
max_accel = 20000
max_z_velocity = 20
max_z_accel = 15
square_corner_velocity = 10

[exclude_object]

[gcode_arcs]
resolution = 0.05

[idle_timeout]
gcode = 
	{% if not printer.pause_resume.is_paused %}
	TURN_OFF_HEATERS
	M84
	{% endif %}

[save_variables]
filename = vars.cfg

[mcu]
serial = /dev/serial/by-id/usb-Klipper_stm32h723xx_4C0023001551313338343730-if00

[bed_mesh default]
version = 1
points = 
	-0.215000, -0.210000, -0.190000, -0.185000, -0.170000, -0.145000, -0.135000, -0.120000, -0.105000, -0.070000, -0.055000, -0.035000, 0.000000, 0.010000, 0.025000, 0.050000, 0.080000, 0.105000, 0.130000, 0.135000, 0.150000, 0.155000, 0.165000, 0.190000, 0.205000
	-0.160000, -0.155000, -0.160000, -0.150000, -0.130000, -0.110000, -0.105000, -0.085000, -0.055000, -0.035000, -0.025000, 0.000000, 0.025000, 0.055000, 0.075000, 0.100000, 0.110000, 0.130000, 0.160000, 0.170000, 0.190000, 0.190000, 0.205000, 0.205000, 0.220000
	-0.160000, -0.150000, -0.140000, -0.135000, -0.115000, -0.105000, -0.090000, -0.070000, -0.040000, -0.025000, -0.010000, 0.015000, 0.030000, 0.045000, 0.080000, 0.100000, 0.115000, 0.135000, 0.160000, 0.165000, 0.180000, 0.185000, 0.190000, 0.220000, 0.235000
	-0.120000, -0.115000, -0.115000, -0.100000, -0.080000, -0.070000, -0.065000, -0.040000, -0.015000, 0.010000, 0.030000, 0.050000, 0.065000, 0.090000, 0.110000, 0.130000, 0.145000, 0.175000, 0.195000, 0.195000, 0.195000, 0.205000, 0.210000, 0.235000, 0.240000
	-0.075000, -0.065000, -0.055000, -0.045000, -0.040000, -0.020000, -0.005000, 0.015000, 0.035000, 0.065000, 0.075000, 0.090000, 0.105000, 0.115000, 0.140000, 0.170000, 0.175000, 0.190000, 0.205000, 0.205000, 0.205000, 0.210000, 0.215000, 0.240000, 0.240000
	-0.045000, -0.050000, -0.055000, -0.045000, -0.015000, -0.005000, -0.005000, 0.020000, 0.060000, 0.065000, 0.075000, 0.100000, 0.115000, 0.125000, 0.135000, 0.170000, 0.175000, 0.175000, 0.205000, 0.205000, 0.205000, 0.205000, 0.210000, 0.220000, 0.225000
	-0.035000, -0.030000, -0.030000, -0.020000, 0.000000, 0.015000, 0.015000, 0.035000, 0.065000, 0.085000, 0.100000, 0.110000, 0.115000, 0.130000, 0.160000, 0.170000, 0.180000, 0.180000, 0.200000, 0.200000, 0.200000, 0.205000, 0.205000, 0.220000, 0.235000
	0.005000, 0.010000, 0.015000, 0.025000, 0.035000, 0.040000, 0.055000, 0.085000, 0.095000, 0.110000, 0.115000, 0.125000, 0.140000, 0.160000, 0.175000, 0.180000, 0.190000, 0.190000, 0.225000, 0.225000, 0.225000, 0.225000, 0.230000, 0.235000, 0.250000
	0.055000, 0.065000, 0.060000, 0.065000, 0.075000, 0.090000, 0.100000, 0.110000, 0.120000, 0.130000, 0.140000, 0.155000, 0.170000, 0.180000, 0.190000, 0.195000, 0.210000, 0.220000, 0.235000, 0.235000, 0.235000, 0.235000, 0.245000, 0.250000, 0.260000
	0.100000, 0.105000, 0.110000, 0.110000, 0.120000, 0.135000, 0.145000, 0.150000, 0.155000, 0.155000, 0.170000, 0.185000, 0.190000, 0.195000, 0.195000, 0.215000, 0.230000, 0.235000, 0.245000, 0.245000, 0.245000, 0.235000, 0.245000, 0.250000, 0.260000
	0.100000, 0.115000, 0.125000, 0.130000, 0.135000, 0.145000, 0.150000, 0.155000, 0.165000, 0.175000, 0.190000, 0.200000, 0.205000, 0.205000, 0.215000, 0.225000, 0.230000, 0.245000, 0.255000, 0.240000, 0.240000, 0.240000, 0.245000, 0.250000, 0.250000
	0.155000, 0.150000, 0.150000, 0.150000, 0.160000, 0.165000, 0.165000, 0.175000, 0.175000, 0.195000, 0.200000, 0.215000, 0.205000, 0.210000, 0.215000, 0.225000, 0.235000, 0.240000, 0.245000, 0.240000, 0.240000, 0.235000, 0.220000, 0.235000, 0.240000
	0.170000, 0.165000, 0.165000, 0.170000, 0.180000, 0.190000, 0.190000, 0.185000, 0.200000, 0.205000, 0.220000, 0.230000, 0.225000, 0.225000, 0.240000, 0.245000, 0.240000, 0.250000, 0.255000, 0.245000, 0.250000, 0.245000, 0.245000, 0.240000, 0.240000
	0.210000, 0.200000, 0.195000, 0.200000, 0.210000, 0.210000, 0.210000, 0.215000, 0.215000, 0.215000, 0.235000, 0.245000, 0.235000, 0.235000, 0.245000, 0.250000, 0.240000, 0.250000, 0.250000, 0.250000, 0.255000, 0.250000, 0.235000, 0.235000, 0.240000
	0.240000, 0.250000, 0.250000, 0.245000, 0.260000, 0.260000, 0.255000, 0.255000, 0.255000, 0.250000, 0.265000, 0.265000, 0.260000, 0.255000, 0.260000, 0.255000, 0.255000, 0.270000, 0.260000, 0.255000, 0.250000, 0.255000, 0.245000, 0.250000, 0.240000
	0.270000, 0.260000, 0.255000, 0.265000, 0.265000, 0.265000, 0.265000, 0.260000, 0.260000, 0.255000, 0.265000, 0.265000, 0.265000, 0.255000, 0.255000, 0.250000, 0.255000, 0.250000, 0.250000, 0.245000, 0.245000, 0.235000, 0.230000, 0.235000, 0.240000
	0.275000, 0.280000, 0.275000, 0.275000, 0.275000, 0.275000, 0.275000, 0.275000, 0.280000, 0.280000, 0.280000, 0.270000, 0.270000, 0.270000, 0.265000, 0.265000, 0.265000, 0.270000, 0.260000, 0.255000, 0.235000, 0.235000, 0.235000, 0.240000, 0.235000
	0.335000, 0.315000, 0.305000, 0.310000, 0.305000, 0.300000, 0.295000, 0.290000, 0.300000, 0.295000, 0.290000, 0.290000, 0.280000, 0.270000, 0.270000, 0.275000, 0.275000, 0.265000, 0.250000, 0.245000, 0.235000, 0.225000, 0.225000, 0.230000, 0.235000
	0.355000, 0.350000, 0.345000, 0.325000, 0.330000, 0.325000, 0.325000, 0.325000, 0.315000, 0.310000, 0.300000, 0.290000, 0.285000, 0.290000, 0.275000, 0.275000, 0.265000, 0.265000, 0.250000, 0.245000, 0.235000, 0.225000, 0.230000, 0.225000, 0.215000
	0.395000, 0.385000, 0.380000, 0.370000, 0.365000, 0.370000, 0.360000, 0.355000, 0.345000, 0.340000, 0.330000, 0.320000, 0.310000, 0.305000, 0.300000, 0.290000, 0.275000, 0.260000, 0.255000, 0.255000, 0.250000, 0.235000, 0.230000, 0.230000, 0.230000
	0.395000, 0.390000, 0.375000, 0.375000, 0.375000, 0.370000, 0.365000, 0.360000, 0.355000, 0.335000, 0.325000, 0.315000, 0.315000, 0.300000, 0.295000, 0.280000, 0.255000, 0.260000, 0.250000, 0.240000, 0.230000, 0.235000, 0.230000, 0.205000, 0.195000
	0.405000, 0.395000, 0.395000, 0.390000, 0.380000, 0.375000, 0.370000, 0.360000, 0.355000, 0.345000, 0.325000, 0.325000, 0.310000, 0.295000, 0.290000, 0.270000, 0.250000, 0.240000, 0.235000, 0.235000, 0.230000, 0.205000, 0.195000, 0.195000, 0.195000
	0.405000, 0.395000, 0.380000, 0.375000, 0.375000, 0.370000, 0.360000, 0.345000, 0.340000, 0.330000, 0.305000, 0.300000, 0.285000, 0.270000, 0.250000, 0.235000, 0.220000, 0.215000, 0.220000, 0.205000, 0.195000, 0.175000, 0.175000, 0.170000, 0.165000
	0.405000, 0.390000, 0.395000, 0.385000, 0.365000, 0.350000, 0.345000, 0.330000, 0.320000, 0.305000, 0.290000, 0.265000, 0.260000, 0.240000, 0.225000, 0.215000, 0.205000, 0.190000, 0.180000, 0.185000, 0.165000, 0.150000, 0.145000, 0.145000, 0.145000
	0.430000, 0.425000, 0.400000, 0.395000, 0.385000, 0.370000, 0.365000, 0.340000, 0.320000, 0.305000, 0.295000, 0.270000, 0.250000, 0.235000, 0.215000, 0.215000, 0.200000, 0.190000, 0.185000, 0.165000, 0.155000, 0.145000, 0.135000, 0.130000, 0.135000
x_count = 25
y_count = 25
mesh_x_pps = 3
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 310.0
min_y = 26.43
max_y = 281.31
=======================
Config error
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/klippy.py", line 175, in _connect
    self._read_config()
  File "/home/pi/klipper/klippy/klippy.py", line 143, in _read_config
    m.add_printer_objects(config)
  File "/home/pi/klipper/klippy/toolhead.py", line 658, in add_printer_objects
    config.get_printer().add_object('toolhead', ToolHead(config))
                                                ^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/toolhead.py", line 261, in __init__
    self.kin = mod.load_kinematics(self, config)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/kinematics/corexy.py", line 99, in load_kinematics
    return CoreXYKinematics(toolhead, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/kinematics/corexy.py", line 12, in __init__
    self.rails = [stepper.LookupMultiRail(config.getsection('stepper_' + n))
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/kinematics/corexy.py", line 12, in <listcomp>
    self.rails = [stepper.LookupMultiRail(config.getsection('stepper_' + n))
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/stepper.py", line 423, in LookupMultiRail
    rail = PrinterRail(config, need_position_minmax,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/stepper.py", line 304, in __init__
    self.add_extra_stepper(config)
  File "/home/pi/klipper/klippy/stepper.py", line 383, in add_extra_stepper
    pin_params = ppins.parse_pin(endstop_pin, True, True)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/pins.py", line 83, in parse_pin
    raise error("Unknown pin chip name '%s'" % (chip_name,))
pins.error: Unknown pin chip name 'probe'
webhooks client 140734119407056: New connection
webhooks client 140734119407056: Client info {'program': 'Moonraker', 'version': 'v0.8.0-308-g71b46cc'}
Attempting MCU 'mcu' reset
Attempting MCU 'tr' reset
webhooks client 140734119407056: Disconnected
Restarting printer
Start printer at Mon Feb  5 14:52:56 2024 (1707144776.1 90691.9)
===== Config file =====
[virtual_sdcard]
path = /home/pi/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]
recover_velocity = 350

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	TURN_OFF_HEATERS
	G91
	G1 Z10 E-2 F3600
	G1 E-3 F3600
	G90
	G1 X30 Y250 F7000; home X axis
	M106 S80
	G4 P10000
	M106 S0
	M221 S100
	CANCEL_PRINT_BASE
	CLEAR_PAUSE
	
	SET_GCODE_OFFSET Z=0.0
	RESETSPEEDS
	M84
	
	BED_MESH_CLEAR

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	
	{% set x_park = printer.toolhead.axis_maximum.x|float - 5.0 %}
	{% set y_park = printer.toolhead.axis_maximum.y|float - 5.0 %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < (max_z - 2.0) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	
	SAVE_GCODE_STATE NAME=PAUSE_state
	BASE_PAUSE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	G91
	G1 E-{1} F2100
	G1 Z{10} F900
	G90
	G1 X{50} Y{0} F6000
variable_extrude = 1.0

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	G91
	G1 E{1} F2100
	RESTORE_GCODE_STATE NAME=PAUSE_state
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[tmc5160 extruder]
cs_pin = PA10
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 0.65
sense_resistor = 0.075
stealthchop_threshold = 0

[extruder]
rotation_distance = 5.7
full_steps_per_rotation = 200
sensor_type = PT1000
min_temp = 0
max_temp = 330
filament_diameter = 1.750
dir_pin = !PB6
step_pin = PG15
enable_pin = !PG14
heater_pin = PF6
sensor_pin = PB1
microsteps = 16
nozzle_diameter = 0.600
pressure_advance = 0.015
pressure_advance_smooth_time = 0.02
max_extrude_only_distance = 101
control = pid
pid_kp = 22.354
pid_ki = 1.552
pid_kd = 80.473

[tmc5160 stepper_x]
cs_pin = PD6
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
diag1_pin = PC15
run_current = 2.00
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_x]
dir_pin = !PC13
step_pin = PC14
enable_pin = !PE6
endstop_pin = PC15
microsteps = 16
rotation_distance = 40
position_endstop = -6
position_min = -6
position_max = 330
homing_speed = 20
full_steps_per_rotation = 200
homing_retract_dist = 0
homing_positive_dir = false
step_pulse_duration = 0.000001

[tmc5160 stepper_x1]
cs_pin = PD5
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2.00
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_x1]
dir_pin = !PE4
step_pin = PE5
enable_pin = !PE3
microsteps = 16
rotation_distance = 40
full_steps_per_rotation = 200
step_pulse_duration = 0.000001

[tmc5160 stepper_y]
cs_pin = PD4
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_y]
dir_pin = !PE1
step_pin = PE2
enable_pin = !PE0
endstop_pin = PF0
microsteps = 16
rotation_distance = 40
position_endstop = 0
position_min = 0
position_max = 315
homing_speed = 20
full_steps_per_rotation = 200
homing_retract_dist = 0
homing_positive_dir = false
step_pulse_duration = 0.000001

[tmc5160 stepper_y1]
cs_pin = PD3
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_y1]
dir_pin = !PB8
step_pin = PB9
enable_pin = !PB7
microsteps = 16
rotation_distance = 40
full_steps_per_rotation = 200
step_pulse_duration = 0.000001

[tmc5160 stepper_z]
cs_pin = PD2
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 1
sense_resistor = 0.075
stealthchop_threshold = 0

[stepper_z]
dir_pin = !PG10
step_pin = PG9
enable_pin = !PG13
endstop_pin = probe:z_virtual_endstop
microsteps = 16
rotation_distance = 8
position_min = -20
position_max = 400
full_steps_per_rotation = 200
homing_retract_dist = 5.0
homing_positive_dir = false
homing_speed = 3
second_homing_speed = 1
step_pulse_duration = 0.000004

[tmc5160 stepper_z1]
cs_pin = PA15
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 1
sense_resistor = 0.075
stealthchop_threshold = 0

[stepper_z1]
dir_pin = !PD7
step_pin = PG11
enable_pin = !PG12
microsteps = 16
rotation_distance = 8

[temperature_sensor Kraken]
sensor_type = temperature_mcu
min_temp = 10
max_temp = 100

[heater_fan hotend_fan]
pin = PA0
max_power = 1.0
kick_start_time = 0.5
heater = extruder
heater_temp = 50.0

[fan]
pin = PF12
enable_pin = PF7
hardware_pwm = false
max_power = 1
cycle_time = 0.00002
off_below = 0.012
kick_start_time = 0.01

[neopixel my_neopixel]
pin = PF11
chain_count = 13
color_order = GRB
initial_red = 1.0
initial_green = 1
initial_blue = 1

[gcode_macro BED_MESH]
gcode = 
	BED_MESH_CALIBRATE

[gcode_macro PA_TUNING]
gcode = 
	SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=1 ACCEL=500
	TUNING_TOWER COMMAND=SET_PRESSURE_ADVANCE PARAMETER=ADVANCE START=0 FACTOR=.005

[gcode_macro HOTEND_PID]
gcode = 
	{% set tool_temp = params.TEMPERATURE|default(220)|int %}
	{% set tool_name = printer.toolhead.extruder %}
	PID_CALIBRATE HEATER={tool_name} TARGET={tool_temp}

[gcode_macro BED_PID]
gcode = 
	{% set bed_temp = params.TEMPERATURE|default(60)|int %}
	PID_CALIBRATE HEATER=heater_bed TARGET={bed_temp}

[gcode_macro SCREWS_TILT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro DUMP_WARNINGS]
description = Debug: Print all warning messages from klipper
gcode = 
	{% set parameters = ["printer.configfile.warnings:"] %}
	{% for warning in printer.configfile.warnings %}
	{% set parameters = parameters.append("%s -> %s -> %s\n%s" % (warning.type, warning.section, warning.option, warning.message)) %}
	{% endfor %}
	{action_respond_info(parameters|join("\n"))}

[gcode_macro enable_stepper]
gcode = 
	SET_STEPPER_ENABLE STEPPER=stepper_x ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_x1 ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y1 ENABLE=1

[gcode_macro disable-steppers]
gcode = 
	m84

[gcode_macro M600]
gcode = 
	G4 P1500
	{% set X = params.X|default(50)|float %}
	{% set Y = params.Y|default(0)|float %}
	{% set Z = params.Z|default(10)|float %}
	
	SAVE_GCODE_STATE NAME=M600_state
	PAUSE
	
	G91
	G1 E-{1} F2100
	G1 Z{Z}
	G90
	G1 X{X} Y{Y} F4000
	G91
	M83
	G1 E5 F800
	G1 E-180 F2000
	M82
	RESTORE_GCODE_STATE NAME=M600_state

[gcode_macro PURGE]
gcode = 
	M83
	G1 E120 F250

[gcode_macro _UNLOAD_FILAMENT]
gcode = 
	{% set e_temp = params.TEMPERATURE|default(235)|int %}
	M118 Filament unloading!
	M117 Filament unloading!
	M82
	G92 E0
	{% if printer.extruder.can_extrude|lower != 'true' %}
	
	M118 Hotend heating!
	M109 S{e_temp} T0
	{% endif %}
	G1 E10 F{5*60}
	G0 E-5 F{60*60}
	G0 E-70 F{5*60}
	M400
	M118 Filament unload complete!
	M117 Filament unload complete!

[gcode_macro _LOAD_FILAMENT]
gcode = 
	{% set e_temp = params.TEMPERATURE|default(230)|int %}
	M109 S{e_temp}
	M83
	G1 E50 F300
	G1 E-1 F100
	M82
	M104 S0

[gcode_macro UNLOAD_PLA]
gcode = 
	_UNLOAD_FILAMENT TEMPERATURE=200

[gcode_macro LOAD_PLA]
gcode = 
	_LOAD_FILAMENT TEMPERATURE=200

[gcode_macro UNLOAD_ABS]
gcode = 
	_UNLOAD_FILAMENT TEMPERATURE=250

[gcode_macro LOAD_ABS]
gcode = 
	_LOAD_FILAMENT TEMPERATURE=250

[gcode_macro UNLOAD_PETG]
gcode = 
	_UNLOAD_FILAMENT TEMPERATURE=235

[gcode_macro LOAD_PETG]
gcode = 
	_LOAD_FILAMENT TEMPERATURE=235

[gcode_macro LOAD_FILAMENT]
gcode = 
	{% set speed = params.SPEED|default(300) %}
	{% set max_velocity = printer.configfile.settings['extruder'].max_extrude_only_velocity %}
	SAVE_GCODE_STATE NAME=load_state
	M300
	G91
	G92 E0
	G1 E350 F{max_velocity}
	G1 E25 F{speed}
	M300
	M300
	RESTORE_GCODE_STATE NAME=load_state

[gcode_macro UNLOAD_FILAMENT]
gcode = 
	{% set speed = params.SPEED|default(300) %}
	{% set max_velocity = printer.configfile.settings['extruder'].max_extrude_only_velocity %}
	SAVE_GCODE_STATE NAME=unload_state
	G91
	M300
	G92 E0
	G1 E25 F{speed}
	G1 E-420 F{max_velocity}
	M300
	M300
	RESTORE_GCODE_STATE NAME=unload_state

[gcode_macro START_PRINT]
gcode = 
	
	{% set DWELL = params.DWELL|default(00)|int %}
	{% set bedTemp = params.BED|default(70)|int %}
	{% set hotendTemp = params.HOTEND|default(210)|int %}
	SET_FAN_SPEED FAN=LED_Bar SPEED=0.5
	CLEAR_PAUSE
	RESETSPEEDS
	G21
	G90
	M83
	M140 S{bedTemp}; start heating the bed
	M104 S100
	SET_DISPLAY_TEXT MSG="Waiting for temperatures..."
	HEATSOAK DWELL={DWELL}
	G28 X Y
	ATTACH_PROBE_LOCK
	G28 Z
	SET_DISPLAY_TEXT MSG="Adjusting Z Tilt"
	Z_TILT_ADJUST
	G28 Z
	
	SET_DISPLAY_TEXT MSG="Calibrating Bed Mesh"
	BED_MESH_CLEAR
	BED_MESH_CALIBRATE
	BED_MESH_PROFILE LOAD=default
	SET_DISPLAY_TEXT MSG="Heating Extruder to temp"
	G1 X1 Y1 Z0.5 F9000
	M109 S{hotendTemp}; wait for extruder to heat up
	TR_UNLOAD_TOOLHEAD
	TR_HOME
	FIXED_PURGE_LINE
	M83
	SET_DISPLAY_TEXT MSG="Printing..."
	TR_SYNC_TO_EXTRUDER

[gcode_macro HEATSOAK]
gcode = 
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion..."
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 5% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 10% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 15% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 20% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 25% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 30% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 35% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 40% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 45% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 50% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 55% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 60% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 65% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 70% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 75% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 80% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 85% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 90% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 95% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Thermal expansion done"

[gcode_macro _CG28]
gcode = 
	{% if "xyz" not in printer.toolhead.homed_axes %}
	G28
	{% endif %}

[gcode_macro FIXED_PURGE_LINE]
gcode = 
	M83
	G92 E0
	G1 Z1 F3000
	G1 X1 Y80 Z0.3 E10  F1200
	G1 X1 Y120 E11  F1200
	G1 E-0.8 F1000
	G92 E0
	G1 Z1 F2000

[gcode_macro END_PRINT]
gcode = 
	TR_UNLOAD_TOOLHEAD
	
	TURN_OFF_HEATERS
	G91
	G1 Z10 E-2 F3600
	
	G90
	G1 X30 Y250 F7000; home X axis
	M106 S80
	G4 P10000
	M106 S0
	M221 S100
	CLEAR_PAUSE
	
	SET_GCODE_OFFSET Z=0.0
	RESETSPEEDS
	
	M84
	BED_MESH_CLEAR
	SET_FAN_SPEED FAN=LED_Bar SPEED=0
	TR_UNSYNC_TO_EXTRUDER
	UPDATE_GIT

[gcode_macro PARK]
description = Park the toolhead at the front and retract some filament if the nozzle is hot
gcode = 
	{% set E = params.E|default(1.7)|float %}
	
	{% set Px, Py = printer["gcode_macro _USER_VARIABLES"].park_position_xy|map('float') %}
	{% set park_lift_z = printer["gcode_macro _USER_VARIABLES"].park_lift_z %}
	
	{% set St = printer["gcode_macro _USER_VARIABLES"].travel_speed * 60 %}
	{% set Sz = printer["gcode_macro _USER_VARIABLES"].z_drop_speed * 60 %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	
	{% set z_safe = act_z + park_lift_z %}
	{% if z_safe > max_z %}
	{% set z_safe = max_z %}
	{% endif %}
	
	
	{% if printer.extruder.temperature > 185 %}
	G10
	{% endif %}
	G90
	G1 Z{z_safe} F{Sz}
	
	G0 X{Px} Y{Py} F{St}

[gcode_macro RESETSPEEDS]
gcode = 
	SET_VELOCITY_LIMIT VELOCITY={printer.configfile.settings.printer.max_velocity}
	SET_VELOCITY_LIMIT ACCEL={printer.configfile.settings.printer.max_accel}
	SET_VELOCITY_LIMIT ACCEL_TO_DECEL={printer.configfile.settings.printer.max_accel_to_decel}
	SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={printer.configfile.settings.printer.square_corner_velocity}

[gcode_macro DISABLEXYE]
gcode = 
	SET_STEPPER_ENABLE STEPPER=extruder ENABLE=0
	SET_STEPPER_ENABLE STEPPER=stepper_x ENABLE=0
	
	SET_STEPPER_ENABLE STEPPER=stepper_y ENABLE=0
	
	SET_STEPPER_ENABLE STEPPER=stepper_z ENABLE=1

[gcode_macro TEST_SPEED]
gcode = 
	
	{% set speed  = params.SPEED|default(printer.configfile.settings.printer.max_velocity)|int %}
	
	{% set iterations = params.ITERATIONS|default(5)|int %}
	
	{% set accel  = params.ACCEL|default(printer.configfile.settings.printer.max_accel)|int %}
	
	{% set bound = params.BOUND|default(20)|int %}
	
	{% set smallpatternsize = SMALLPATTERNSIZE|default(20)|int %}
	
	
	
	{% set x_min = 10 + bound %}
	{% set x_max = 300 - bound %}
	{% set y_min = 10 + bound %}
	{% set y_max = 300 - bound %}
	
	
	
	{% set x_center = (printer.toolhead.axis_minimum.x|float + printer.toolhead.axis_maximum.x|float ) / 2 %}
	{% set y_center = (printer.toolhead.axis_minimum.y|float + printer.toolhead.axis_maximum.y|float ) / 2 %}
	
	
	{% set x_center_min = x_center - (smallpatternsize/2) %}
	{% set x_center_max = x_center + (smallpatternsize/2) %}
	{% set y_center_min = y_center - (smallpatternsize/2) %}
	{% set y_center_max = y_center + (smallpatternsize/2) %}
	
	
	SAVE_GCODE_STATE NAME=TEST_SPEED
	
	
	{ action_respond_info("TEST_SPEED: starting %d iterations at speed %d, accel %d" % (iterations, speed, accel)) }
	
	
	M400
	G28
	
	{% if printer.configfile.settings.quad_gantry_level %}
	{% if printer.quad_gantry_level.applied == False %}
	QUAD_GANTRY_LEVEL
	G28 Z
	{% endif %}
	{% endif %}
	
	G90
	G1 X{printer.toolhead.axis_maximum.x-50} Y{printer.toolhead.axis_maximum.y-50} F{30*60}
	M400
	G28 X Y
	G0 X{300} Y{300} F{30*60}
	G4 P1000
	GET_POSITION
	
	
	G0 X{x_min} Y{y_min} Z{bound + 10} F{speed*60}
	
	
	SET_VELOCITY_LIMIT VELOCITY={speed} ACCEL={accel} ACCEL_TO_DECEL={accel / 2}
	
	{% for i in range(iterations) %}
	
	G0 X{x_min} Y{y_min} F{speed*60}
	G0 X{x_max} Y{y_max} F{speed*60}
	G0 X{x_min} Y{y_min} F{speed*60}
	G0 X{x_max} Y{y_min} F{speed*60}
	G0 X{x_min} Y{y_max} F{speed*60}
	G0 X{x_max} Y{y_min} F{speed*60}
	
	
	G0 X{x_min} Y{y_min} F{speed*60}
	G0 X{x_min} Y{y_max} F{speed*60}
	G0 X{x_max} Y{y_max} F{speed*60}
	G0 X{x_max} Y{y_min} F{speed*60}
	
	
	G0 X{x_center_min} Y{y_center_min} F{speed*60}
	G0 X{x_center_max} Y{y_center_max} F{speed*60}
	G0 X{x_center_min} Y{y_center_min} F{speed*60}
	G0 X{x_center_max} Y{y_center_min} F{speed*60}
	G0 X{x_center_min} Y{y_center_max} F{speed*60}
	G0 X{x_center_max} Y{y_center_min} F{speed*60}
	
	
	G0 X{x_center_min} Y{y_center_min} F{speed*60}
	G0 X{x_center_min} Y{y_center_max} F{speed*60}
	G0 X{x_center_max} Y{y_center_max} F{speed*60}
	G0 X{x_center_max} Y{y_center_min} F{speed*60}
	{% endfor %}
	
	
	SET_VELOCITY_LIMIT VELOCITY={printer.configfile.settings.printer.max_velocity} ACCEL={printer.configfile.settings.printer.max_accel} ACCEL_TO_DECEL={printer.configfile.settings.printer.max_accel_to_decel}
	
	
	M400
	G28
	
	G90
	G0 X{300} Y{300} F{30*60}
	G4 P1000
	GET_POSITION
	
	
	RESTORE_GCODE_STATE NAME=TEST_SPEED

[gcode_macro update_git]
gcode = 
	RUN_SHELL_COMMAND CMD=update_git_script

[gcode_shell_command update_git_script]
command = bash /home/pi/klipper-backup/script.sh
timeout = 90.0
verbose = True

[safe_z_home]
home_xy_position = 165, 165
z_hop = 10

[z_tilt]
z_positions = 
	-80,  -20
	350, -20
points = 
	15, 150
	275, 150
speed = 50
horizontal_move_z = 10
retries = 30
retry_tolerance = 0.1

[input_shaper]
shaper_type_x = zv
shaper_freq_x = 120.6
shaper_type_y = zv
shaper_freq_y = 76.6

[printer]
kinematics = corexy
max_velocity = 3000
max_accel = 20000
max_z_velocity = 20
max_z_accel = 15
square_corner_velocity = 10

[exclude_object]

[gcode_arcs]
resolution = 0.05

[idle_timeout]
gcode = 
	{% if not printer.pause_resume.is_paused %}
	TURN_OFF_HEATERS
	M84
	{% endif %}

[save_variables]
filename = vars.cfg

[mcu]
serial = /dev/serial/by-id/usb-Klipper_stm32h723xx_4C0023001551313338343730-if00

[bed_mesh default]
version = 1
points = 
	-0.215000, -0.210000, -0.190000, -0.185000, -0.170000, -0.145000, -0.135000, -0.120000, -0.105000, -0.070000, -0.055000, -0.035000, 0.000000, 0.010000, 0.025000, 0.050000, 0.080000, 0.105000, 0.130000, 0.135000, 0.150000, 0.155000, 0.165000, 0.190000, 0.205000
	-0.160000, -0.155000, -0.160000, -0.150000, -0.130000, -0.110000, -0.105000, -0.085000, -0.055000, -0.035000, -0.025000, 0.000000, 0.025000, 0.055000, 0.075000, 0.100000, 0.110000, 0.130000, 0.160000, 0.170000, 0.190000, 0.190000, 0.205000, 0.205000, 0.220000
	-0.160000, -0.150000, -0.140000, -0.135000, -0.115000, -0.105000, -0.090000, -0.070000, -0.040000, -0.025000, -0.010000, 0.015000, 0.030000, 0.045000, 0.080000, 0.100000, 0.115000, 0.135000, 0.160000, 0.165000, 0.180000, 0.185000, 0.190000, 0.220000, 0.235000
	-0.120000, -0.115000, -0.115000, -0.100000, -0.080000, -0.070000, -0.065000, -0.040000, -0.015000, 0.010000, 0.030000, 0.050000, 0.065000, 0.090000, 0.110000, 0.130000, 0.145000, 0.175000, 0.195000, 0.195000, 0.195000, 0.205000, 0.210000, 0.235000, 0.240000
	-0.075000, -0.065000, -0.055000, -0.045000, -0.040000, -0.020000, -0.005000, 0.015000, 0.035000, 0.065000, 0.075000, 0.090000, 0.105000, 0.115000, 0.140000, 0.170000, 0.175000, 0.190000, 0.205000, 0.205000, 0.205000, 0.210000, 0.215000, 0.240000, 0.240000
	-0.045000, -0.050000, -0.055000, -0.045000, -0.015000, -0.005000, -0.005000, 0.020000, 0.060000, 0.065000, 0.075000, 0.100000, 0.115000, 0.125000, 0.135000, 0.170000, 0.175000, 0.175000, 0.205000, 0.205000, 0.205000, 0.205000, 0.210000, 0.220000, 0.225000
	-0.035000, -0.030000, -0.030000, -0.020000, 0.000000, 0.015000, 0.015000, 0.035000, 0.065000, 0.085000, 0.100000, 0.110000, 0.115000, 0.130000, 0.160000, 0.170000, 0.180000, 0.180000, 0.200000, 0.200000, 0.200000, 0.205000, 0.205000, 0.220000, 0.235000
	0.005000, 0.010000, 0.015000, 0.025000, 0.035000, 0.040000, 0.055000, 0.085000, 0.095000, 0.110000, 0.115000, 0.125000, 0.140000, 0.160000, 0.175000, 0.180000, 0.190000, 0.190000, 0.225000, 0.225000, 0.225000, 0.225000, 0.230000, 0.235000, 0.250000
	0.055000, 0.065000, 0.060000, 0.065000, 0.075000, 0.090000, 0.100000, 0.110000, 0.120000, 0.130000, 0.140000, 0.155000, 0.170000, 0.180000, 0.190000, 0.195000, 0.210000, 0.220000, 0.235000, 0.235000, 0.235000, 0.235000, 0.245000, 0.250000, 0.260000
	0.100000, 0.105000, 0.110000, 0.110000, 0.120000, 0.135000, 0.145000, 0.150000, 0.155000, 0.155000, 0.170000, 0.185000, 0.190000, 0.195000, 0.195000, 0.215000, 0.230000, 0.235000, 0.245000, 0.245000, 0.245000, 0.235000, 0.245000, 0.250000, 0.260000
	0.100000, 0.115000, 0.125000, 0.130000, 0.135000, 0.145000, 0.150000, 0.155000, 0.165000, 0.175000, 0.190000, 0.200000, 0.205000, 0.205000, 0.215000, 0.225000, 0.230000, 0.245000, 0.255000, 0.240000, 0.240000, 0.240000, 0.245000, 0.250000, 0.250000
	0.155000, 0.150000, 0.150000, 0.150000, 0.160000, 0.165000, 0.165000, 0.175000, 0.175000, 0.195000, 0.200000, 0.215000, 0.205000, 0.210000, 0.215000, 0.225000, 0.235000, 0.240000, 0.245000, 0.240000, 0.240000, 0.235000, 0.220000, 0.235000, 0.240000
	0.170000, 0.165000, 0.165000, 0.170000, 0.180000, 0.190000, 0.190000, 0.185000, 0.200000, 0.205000, 0.220000, 0.230000, 0.225000, 0.225000, 0.240000, 0.245000, 0.240000, 0.250000, 0.255000, 0.245000, 0.250000, 0.245000, 0.245000, 0.240000, 0.240000
	0.210000, 0.200000, 0.195000, 0.200000, 0.210000, 0.210000, 0.210000, 0.215000, 0.215000, 0.215000, 0.235000, 0.245000, 0.235000, 0.235000, 0.245000, 0.250000, 0.240000, 0.250000, 0.250000, 0.250000, 0.255000, 0.250000, 0.235000, 0.235000, 0.240000
	0.240000, 0.250000, 0.250000, 0.245000, 0.260000, 0.260000, 0.255000, 0.255000, 0.255000, 0.250000, 0.265000, 0.265000, 0.260000, 0.255000, 0.260000, 0.255000, 0.255000, 0.270000, 0.260000, 0.255000, 0.250000, 0.255000, 0.245000, 0.250000, 0.240000
	0.270000, 0.260000, 0.255000, 0.265000, 0.265000, 0.265000, 0.265000, 0.260000, 0.260000, 0.255000, 0.265000, 0.265000, 0.265000, 0.255000, 0.255000, 0.250000, 0.255000, 0.250000, 0.250000, 0.245000, 0.245000, 0.235000, 0.230000, 0.235000, 0.240000
	0.275000, 0.280000, 0.275000, 0.275000, 0.275000, 0.275000, 0.275000, 0.275000, 0.280000, 0.280000, 0.280000, 0.270000, 0.270000, 0.270000, 0.265000, 0.265000, 0.265000, 0.270000, 0.260000, 0.255000, 0.235000, 0.235000, 0.235000, 0.240000, 0.235000
	0.335000, 0.315000, 0.305000, 0.310000, 0.305000, 0.300000, 0.295000, 0.290000, 0.300000, 0.295000, 0.290000, 0.290000, 0.280000, 0.270000, 0.270000, 0.275000, 0.275000, 0.265000, 0.250000, 0.245000, 0.235000, 0.225000, 0.225000, 0.230000, 0.235000
	0.355000, 0.350000, 0.345000, 0.325000, 0.330000, 0.325000, 0.325000, 0.325000, 0.315000, 0.310000, 0.300000, 0.290000, 0.285000, 0.290000, 0.275000, 0.275000, 0.265000, 0.265000, 0.250000, 0.245000, 0.235000, 0.225000, 0.230000, 0.225000, 0.215000
	0.395000, 0.385000, 0.380000, 0.370000, 0.365000, 0.370000, 0.360000, 0.355000, 0.345000, 0.340000, 0.330000, 0.320000, 0.310000, 0.305000, 0.300000, 0.290000, 0.275000, 0.260000, 0.255000, 0.255000, 0.250000, 0.235000, 0.230000, 0.230000, 0.230000
	0.395000, 0.390000, 0.375000, 0.375000, 0.375000, 0.370000, 0.365000, 0.360000, 0.355000, 0.335000, 0.325000, 0.315000, 0.315000, 0.300000, 0.295000, 0.280000, 0.255000, 0.260000, 0.250000, 0.240000, 0.230000, 0.235000, 0.230000, 0.205000, 0.195000
	0.405000, 0.395000, 0.395000, 0.390000, 0.380000, 0.375000, 0.370000, 0.360000, 0.355000, 0.345000, 0.325000, 0.325000, 0.310000, 0.295000, 0.290000, 0.270000, 0.250000, 0.240000, 0.235000, 0.235000, 0.230000, 0.205000, 0.195000, 0.195000, 0.195000
	0.405000, 0.395000, 0.380000, 0.375000, 0.375000, 0.370000, 0.360000, 0.345000, 0.340000, 0.330000, 0.305000, 0.300000, 0.285000, 0.270000, 0.250000, 0.235000, 0.220000, 0.215000, 0.220000, 0.205000, 0.195000, 0.175000, 0.175000, 0.170000, 0.165000
	0.405000, 0.390000, 0.395000, 0.385000, 0.365000, 0.350000, 0.345000, 0.330000, 0.320000, 0.305000, 0.290000, 0.265000, 0.260000, 0.240000, 0.225000, 0.215000, 0.205000, 0.190000, 0.180000, 0.185000, 0.165000, 0.150000, 0.145000, 0.145000, 0.145000
	0.430000, 0.425000, 0.400000, 0.395000, 0.385000, 0.370000, 0.365000, 0.340000, 0.320000, 0.305000, 0.295000, 0.270000, 0.250000, 0.235000, 0.215000, 0.215000, 0.200000, 0.190000, 0.185000, 0.165000, 0.155000, 0.145000, 0.135000, 0.130000, 0.135000
x_count = 25
y_count = 25
mesh_x_pps = 3
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 310.0
min_y = 26.43
max_y = 281.31
=======================
Config error
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/klippy.py", line 175, in _connect
    self._read_config()
  File "/home/pi/klipper/klippy/klippy.py", line 143, in _read_config
    m.add_printer_objects(config)
  File "/home/pi/klipper/klippy/toolhead.py", line 658, in add_printer_objects
    config.get_printer().add_object('toolhead', ToolHead(config))
                                                ^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/toolhead.py", line 261, in __init__
    self.kin = mod.load_kinematics(self, config)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/kinematics/corexy.py", line 99, in load_kinematics
    return CoreXYKinematics(toolhead, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/kinematics/corexy.py", line 12, in __init__
    self.rails = [stepper.LookupMultiRail(config.getsection('stepper_' + n))
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/kinematics/corexy.py", line 12, in <listcomp>
    self.rails = [stepper.LookupMultiRail(config.getsection('stepper_' + n))
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/stepper.py", line 423, in LookupMultiRail
    rail = PrinterRail(config, need_position_minmax,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/stepper.py", line 304, in __init__
    self.add_extra_stepper(config)
  File "/home/pi/klipper/klippy/stepper.py", line 383, in add_extra_stepper
    pin_params = ppins.parse_pin(endstop_pin, True, True)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/pins.py", line 83, in parse_pin
    raise error("Unknown pin chip name '%s'" % (chip_name,))
pins.error: Unknown pin chip name 'probe'
webhooks client 140734067342288: New connection
webhooks client 140734067342288: Client info {'program': 'Moonraker', 'version': 'v0.8.0-308-g71b46cc'}
Attempting MCU 'mcu' reset
webhooks client 140734067342288: Disconnected
Restarting printer
Start printer at Mon Feb  5 14:53:14 2024 (1707144794.3 90710.2)
===== Config file =====
[virtual_sdcard]
path = /home/pi/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]
recover_velocity = 350

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set allow_park = client.park_at_cancel|default(false)|lower == 'true' %}
	{% set retract = client.cancel_retract|default(5.0)|abs %}
	
	{% set park_x = "" if (client.park_at_cancel_x|default(none) is none)
	else "X=" ~ client.park_at_cancel_x %}
	{% set park_y = "" if (client.park_at_cancel_y|default(none) is none)
	else "Y=" ~ client.park_at_cancel_y %}
	{% set custom_park = park_x|length > 0 or park_y|length > 0 %}
	
	
	{% if printer['gcode_macro RESUME'].restore_idle_timeout > 0 %}
	SET_IDLE_TIMEOUT TIMEOUT={printer['gcode_macro RESUME'].restore_idle_timeout}
	{% endif %}
	{% if (custom_park or not printer.pause_resume.is_paused) and allow_park %} _TOOLHEAD_PARK_PAUSE_CANCEL {park_x} {park_y} {% endif %}
	_CLIENT_RETRACT LENGTH={retract}
	TURN_OFF_HEATERS
	M106 S0
	{client.user_cancel_macro|default("")}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=idle_state VALUE=False
	
	SET_PAUSE_NEXT_LAYER ENABLE=0
	SET_PAUSE_AT_LAYER ENABLE=0 LAYER=0
	CANCEL_PRINT_BASE

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = PAUSE_BASE
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set idle_timeout = client.idle_timeout|default(0) %}
	{% set temp = printer[printer.toolhead.extruder].target if printer.toolhead.extruder != '' else 0 %}
	{% set restore = False if printer.toolhead.extruder == ''
	else True  if params.RESTORE|default(1)|int == 1 else False %}
	
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=last_extruder_temp VALUE="{{'restore': restore, 'temp': temp}}"
	
	{% if idle_timeout > 0 %}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=restore_idle_timeout VALUE={printer.configfile.settings.idle_timeout.timeout}
	SET_IDLE_TIMEOUT TIMEOUT={idle_timeout}
	{% endif %}
	PAUSE_BASE
	{client.user_pause_macro|default("")}
	_TOOLHEAD_PARK_PAUSE_CANCEL {rawparams}

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = RESUME_BASE
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set sp_move = client.speed_move|default(velocity) %}
	{% set runout_resume = True if client.runout_sensor|default("") == ""
	else True if not printer[client.runout_sensor].enabled
	else printer[client.runout_sensor].filament_detected %}
	{% set can_extrude = True if printer.toolhead.extruder == ''
	else printer[printer.toolhead.extruder].can_extrude %}
	{% set do_resume = False %}
	{% set prompt_txt = [] %}
	
	
	{% if printer.idle_timeout.state|upper == "IDLE" or idle_state %}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=idle_state VALUE=False
	{% if last_extruder_temp.restore %}
	
	RESPOND TYPE=echo MSG='{"Restoring \"%s\" temperature to %3.1f\u00B0C, this may take some time" % (printer.toolhead.extruder, last_extruder_temp.temp) }'
	M109 S{last_extruder_temp.temp}
	{% set do_resume = True %}
	{% elif can_extrude %}
	{% set do_resume = True %}
	{% else %}
	RESPOND TYPE=error MSG='{"Resume aborted !!! \"%s\" not hot enough, please heat up again and press RESUME" % printer.toolhead.extruder}'
	{% set _d = prompt_txt.append("\"%s\" not hot enough, please heat up again and press RESUME" % printer.toolhead.extruder) %}
	{% endif %}
	
	{% elif can_extrude %}
	{% set do_resume = True %}
	{% else %}
	RESPOND TYPE=error MSG='{"Resume aborted !!! \"%s\" not hot enough, please heat up again and press RESUME" % printer.toolhead.extruder}'
	{% set _d = prompt_txt.append("\"%s\" not hot enough, please heat up again and press RESUME" % printer.toolhead.extruder) %}
	{% endif %}
	{% if runout_resume %}
	{% if do_resume %}
	{% if restore_idle_timeout > 0 %} SET_IDLE_TIMEOUT TIMEOUT={restore_idle_timeout} {% endif %}
	{client.user_resume_macro|default("")}
	_CLIENT_EXTRUDE
	RESUME_BASE VELOCITY={params.VELOCITY|default(sp_move)}
	{% endif %}
	{% else %}
	RESPOND TYPE=error MSG='{"Resume aborted !!! \"%s\" detects no filament, please load filament and press RESUME" % (client.runout_sensor.split(" "))[1]}'
	{% set _d = prompt_txt.append("\"%s\" detects no filament, please load filament and press RESUME" % (client.runout_sensor.split(" "))[1]) %}
	{% endif %}
	
	{% if not (runout_resume and do_resume) %}
	RESPOND TYPE=command MSG="action:prompt_begin RESUME aborted !!!"
	{% for element in prompt_txt %}
	RESPOND TYPE=command MSG='{"action:prompt_text %s" % element}'
	{% endfor %}
	RESPOND TYPE=command MSG="action:prompt_footer_button Ok|RESPOND TYPE=command MSG=action:prompt_end|info"
	RESPOND TYPE=command MSG="action:prompt_show"
	{% endif %}

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[safe_z_home]
home_xy_position = 165, 165
z_hop = 10

[extruder]
nozzle_diameter = 0.600
pressure_advance = 0.015
pressure_advance_smooth_time = 0.02
max_extrude_only_distance = 101
control = pid
pid_kp = 22.354
pid_ki = 1.552
pid_kd = 80.473

[z_tilt]
z_positions = 
	-80,  -20
	350, -20
points = 
	15, 150
	275, 150
speed = 50
horizontal_move_z = 10
retries = 30
retry_tolerance = 0.1

[input_shaper]
shaper_type_x = zv
shaper_freq_x = 120.6
shaper_type_y = zv
shaper_freq_y = 76.6

[printer]
kinematics = corexy
max_velocity = 3000
max_accel = 20000
max_z_velocity = 20
max_z_accel = 15
square_corner_velocity = 10

[exclude_object]

[gcode_arcs]
resolution = 0.05

[idle_timeout]
gcode = 
	{% if not printer.pause_resume.is_paused %}
	TURN_OFF_HEATERS
	M84
	{% endif %}

[save_variables]
filename = vars.cfg

[mcu]
serial = /dev/serial/by-id/usb-Klipper_stm32h723xx_4C0023001551313338343730-if00

[bed_mesh default]
version = 1
points = 
	-0.215000, -0.210000, -0.190000, -0.185000, -0.170000, -0.145000, -0.135000, -0.120000, -0.105000, -0.070000, -0.055000, -0.035000, 0.000000, 0.010000, 0.025000, 0.050000, 0.080000, 0.105000, 0.130000, 0.135000, 0.150000, 0.155000, 0.165000, 0.190000, 0.205000
	-0.160000, -0.155000, -0.160000, -0.150000, -0.130000, -0.110000, -0.105000, -0.085000, -0.055000, -0.035000, -0.025000, 0.000000, 0.025000, 0.055000, 0.075000, 0.100000, 0.110000, 0.130000, 0.160000, 0.170000, 0.190000, 0.190000, 0.205000, 0.205000, 0.220000
	-0.160000, -0.150000, -0.140000, -0.135000, -0.115000, -0.105000, -0.090000, -0.070000, -0.040000, -0.025000, -0.010000, 0.015000, 0.030000, 0.045000, 0.080000, 0.100000, 0.115000, 0.135000, 0.160000, 0.165000, 0.180000, 0.185000, 0.190000, 0.220000, 0.235000
	-0.120000, -0.115000, -0.115000, -0.100000, -0.080000, -0.070000, -0.065000, -0.040000, -0.015000, 0.010000, 0.030000, 0.050000, 0.065000, 0.090000, 0.110000, 0.130000, 0.145000, 0.175000, 0.195000, 0.195000, 0.195000, 0.205000, 0.210000, 0.235000, 0.240000
	-0.075000, -0.065000, -0.055000, -0.045000, -0.040000, -0.020000, -0.005000, 0.015000, 0.035000, 0.065000, 0.075000, 0.090000, 0.105000, 0.115000, 0.140000, 0.170000, 0.175000, 0.190000, 0.205000, 0.205000, 0.205000, 0.210000, 0.215000, 0.240000, 0.240000
	-0.045000, -0.050000, -0.055000, -0.045000, -0.015000, -0.005000, -0.005000, 0.020000, 0.060000, 0.065000, 0.075000, 0.100000, 0.115000, 0.125000, 0.135000, 0.170000, 0.175000, 0.175000, 0.205000, 0.205000, 0.205000, 0.205000, 0.210000, 0.220000, 0.225000
	-0.035000, -0.030000, -0.030000, -0.020000, 0.000000, 0.015000, 0.015000, 0.035000, 0.065000, 0.085000, 0.100000, 0.110000, 0.115000, 0.130000, 0.160000, 0.170000, 0.180000, 0.180000, 0.200000, 0.200000, 0.200000, 0.205000, 0.205000, 0.220000, 0.235000
	0.005000, 0.010000, 0.015000, 0.025000, 0.035000, 0.040000, 0.055000, 0.085000, 0.095000, 0.110000, 0.115000, 0.125000, 0.140000, 0.160000, 0.175000, 0.180000, 0.190000, 0.190000, 0.225000, 0.225000, 0.225000, 0.225000, 0.230000, 0.235000, 0.250000
	0.055000, 0.065000, 0.060000, 0.065000, 0.075000, 0.090000, 0.100000, 0.110000, 0.120000, 0.130000, 0.140000, 0.155000, 0.170000, 0.180000, 0.190000, 0.195000, 0.210000, 0.220000, 0.235000, 0.235000, 0.235000, 0.235000, 0.245000, 0.250000, 0.260000
	0.100000, 0.105000, 0.110000, 0.110000, 0.120000, 0.135000, 0.145000, 0.150000, 0.155000, 0.155000, 0.170000, 0.185000, 0.190000, 0.195000, 0.195000, 0.215000, 0.230000, 0.235000, 0.245000, 0.245000, 0.245000, 0.235000, 0.245000, 0.250000, 0.260000
	0.100000, 0.115000, 0.125000, 0.130000, 0.135000, 0.145000, 0.150000, 0.155000, 0.165000, 0.175000, 0.190000, 0.200000, 0.205000, 0.205000, 0.215000, 0.225000, 0.230000, 0.245000, 0.255000, 0.240000, 0.240000, 0.240000, 0.245000, 0.250000, 0.250000
	0.155000, 0.150000, 0.150000, 0.150000, 0.160000, 0.165000, 0.165000, 0.175000, 0.175000, 0.195000, 0.200000, 0.215000, 0.205000, 0.210000, 0.215000, 0.225000, 0.235000, 0.240000, 0.245000, 0.240000, 0.240000, 0.235000, 0.220000, 0.235000, 0.240000
	0.170000, 0.165000, 0.165000, 0.170000, 0.180000, 0.190000, 0.190000, 0.185000, 0.200000, 0.205000, 0.220000, 0.230000, 0.225000, 0.225000, 0.240000, 0.245000, 0.240000, 0.250000, 0.255000, 0.245000, 0.250000, 0.245000, 0.245000, 0.240000, 0.240000
	0.210000, 0.200000, 0.195000, 0.200000, 0.210000, 0.210000, 0.210000, 0.215000, 0.215000, 0.215000, 0.235000, 0.245000, 0.235000, 0.235000, 0.245000, 0.250000, 0.240000, 0.250000, 0.250000, 0.250000, 0.255000, 0.250000, 0.235000, 0.235000, 0.240000
	0.240000, 0.250000, 0.250000, 0.245000, 0.260000, 0.260000, 0.255000, 0.255000, 0.255000, 0.250000, 0.265000, 0.265000, 0.260000, 0.255000, 0.260000, 0.255000, 0.255000, 0.270000, 0.260000, 0.255000, 0.250000, 0.255000, 0.245000, 0.250000, 0.240000
	0.270000, 0.260000, 0.255000, 0.265000, 0.265000, 0.265000, 0.265000, 0.260000, 0.260000, 0.255000, 0.265000, 0.265000, 0.265000, 0.255000, 0.255000, 0.250000, 0.255000, 0.250000, 0.250000, 0.245000, 0.245000, 0.235000, 0.230000, 0.235000, 0.240000
	0.275000, 0.280000, 0.275000, 0.275000, 0.275000, 0.275000, 0.275000, 0.275000, 0.280000, 0.280000, 0.280000, 0.270000, 0.270000, 0.270000, 0.265000, 0.265000, 0.265000, 0.270000, 0.260000, 0.255000, 0.235000, 0.235000, 0.235000, 0.240000, 0.235000
	0.335000, 0.315000, 0.305000, 0.310000, 0.305000, 0.300000, 0.295000, 0.290000, 0.300000, 0.295000, 0.290000, 0.290000, 0.280000, 0.270000, 0.270000, 0.275000, 0.275000, 0.265000, 0.250000, 0.245000, 0.235000, 0.225000, 0.225000, 0.230000, 0.235000
	0.355000, 0.350000, 0.345000, 0.325000, 0.330000, 0.325000, 0.325000, 0.325000, 0.315000, 0.310000, 0.300000, 0.290000, 0.285000, 0.290000, 0.275000, 0.275000, 0.265000, 0.265000, 0.250000, 0.245000, 0.235000, 0.225000, 0.230000, 0.225000, 0.215000
	0.395000, 0.385000, 0.380000, 0.370000, 0.365000, 0.370000, 0.360000, 0.355000, 0.345000, 0.340000, 0.330000, 0.320000, 0.310000, 0.305000, 0.300000, 0.290000, 0.275000, 0.260000, 0.255000, 0.255000, 0.250000, 0.235000, 0.230000, 0.230000, 0.230000
	0.395000, 0.390000, 0.375000, 0.375000, 0.375000, 0.370000, 0.365000, 0.360000, 0.355000, 0.335000, 0.325000, 0.315000, 0.315000, 0.300000, 0.295000, 0.280000, 0.255000, 0.260000, 0.250000, 0.240000, 0.230000, 0.235000, 0.230000, 0.205000, 0.195000
	0.405000, 0.395000, 0.395000, 0.390000, 0.380000, 0.375000, 0.370000, 0.360000, 0.355000, 0.345000, 0.325000, 0.325000, 0.310000, 0.295000, 0.290000, 0.270000, 0.250000, 0.240000, 0.235000, 0.235000, 0.230000, 0.205000, 0.195000, 0.195000, 0.195000
	0.405000, 0.395000, 0.380000, 0.375000, 0.375000, 0.370000, 0.360000, 0.345000, 0.340000, 0.330000, 0.305000, 0.300000, 0.285000, 0.270000, 0.250000, 0.235000, 0.220000, 0.215000, 0.220000, 0.205000, 0.195000, 0.175000, 0.175000, 0.170000, 0.165000
	0.405000, 0.390000, 0.395000, 0.385000, 0.365000, 0.350000, 0.345000, 0.330000, 0.320000, 0.305000, 0.290000, 0.265000, 0.260000, 0.240000, 0.225000, 0.215000, 0.205000, 0.190000, 0.180000, 0.185000, 0.165000, 0.150000, 0.145000, 0.145000, 0.145000
	0.430000, 0.425000, 0.400000, 0.395000, 0.385000, 0.370000, 0.365000, 0.340000, 0.320000, 0.305000, 0.295000, 0.270000, 0.250000, 0.235000, 0.215000, 0.215000, 0.200000, 0.190000, 0.185000, 0.165000, 0.155000, 0.145000, 0.135000, 0.130000, 0.135000
x_count = 25
y_count = 25
mesh_x_pps = 3
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 310.0
min_y = 26.43
max_y = 281.31
=======================
Config error
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/klippy.py", line 175, in _connect
    self._read_config()
  File "/home/pi/klipper/klippy/klippy.py", line 141, in _read_config
    self.load_object(config, section_config.get_name(), None)
  File "/home/pi/klipper/klippy/klippy.py", line 130, in load_object
    self.objects[section] = init_func(config.getsection(section))
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/extras/safe_z_home.py", line 91, in load_config
    return SafeZHoming(config)
           ^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/extras/safe_z_home.py", line 15, in __init__
    self.max_z = zconfig.getfloat('position_max', note_valid=False)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/configfile.py", line 65, in getfloat
    return self._get_wrapper(self.fileconfig.getfloat, option, default,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/configfile.py", line 32, in _get_wrapper
    raise error("Option '%s' in section '%s' must be specified"
configparser.Error: Option 'position_max' in section 'stepper_z' must be specified
webhooks client 140734128275408: New connection
webhooks client 140734128275408: Client info {'program': 'Moonraker', 'version': 'v0.8.0-308-g71b46cc'}
Attempting MCU 'mcu' reset
webhooks client 140734128275408: Disconnected
Restarting printer
Start printer at Mon Feb  5 14:53:27 2024 (1707144807.1 90723.0)
===== Config file =====
[virtual_sdcard]
path = /home/pi/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]
recover_velocity = 350

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set allow_park = client.park_at_cancel|default(false)|lower == 'true' %}
	{% set retract = client.cancel_retract|default(5.0)|abs %}
	
	{% set park_x = "" if (client.park_at_cancel_x|default(none) is none)
	else "X=" ~ client.park_at_cancel_x %}
	{% set park_y = "" if (client.park_at_cancel_y|default(none) is none)
	else "Y=" ~ client.park_at_cancel_y %}
	{% set custom_park = park_x|length > 0 or park_y|length > 0 %}
	
	
	{% if printer['gcode_macro RESUME'].restore_idle_timeout > 0 %}
	SET_IDLE_TIMEOUT TIMEOUT={printer['gcode_macro RESUME'].restore_idle_timeout}
	{% endif %}
	{% if (custom_park or not printer.pause_resume.is_paused) and allow_park %} _TOOLHEAD_PARK_PAUSE_CANCEL {park_x} {park_y} {% endif %}
	_CLIENT_RETRACT LENGTH={retract}
	TURN_OFF_HEATERS
	M106 S0
	{client.user_cancel_macro|default("")}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=idle_state VALUE=False
	
	SET_PAUSE_NEXT_LAYER ENABLE=0
	SET_PAUSE_AT_LAYER ENABLE=0 LAYER=0
	CANCEL_PRINT_BASE

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = PAUSE_BASE
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set idle_timeout = client.idle_timeout|default(0) %}
	{% set temp = printer[printer.toolhead.extruder].target if printer.toolhead.extruder != '' else 0 %}
	{% set restore = False if printer.toolhead.extruder == ''
	else True  if params.RESTORE|default(1)|int == 1 else False %}
	
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=last_extruder_temp VALUE="{{'restore': restore, 'temp': temp}}"
	
	{% if idle_timeout > 0 %}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=restore_idle_timeout VALUE={printer.configfile.settings.idle_timeout.timeout}
	SET_IDLE_TIMEOUT TIMEOUT={idle_timeout}
	{% endif %}
	PAUSE_BASE
	{client.user_pause_macro|default("")}
	_TOOLHEAD_PARK_PAUSE_CANCEL {rawparams}

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = RESUME_BASE
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set sp_move = client.speed_move|default(velocity) %}
	{% set runout_resume = True if client.runout_sensor|default("") == ""
	else True if not printer[client.runout_sensor].enabled
	else printer[client.runout_sensor].filament_detected %}
	{% set can_extrude = True if printer.toolhead.extruder == ''
	else printer[printer.toolhead.extruder].can_extrude %}
	{% set do_resume = False %}
	{% set prompt_txt = [] %}
	
	
	{% if printer.idle_timeout.state|upper == "IDLE" or idle_state %}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=idle_state VALUE=False
	{% if last_extruder_temp.restore %}
	
	RESPOND TYPE=echo MSG='{"Restoring \"%s\" temperature to %3.1f\u00B0C, this may take some time" % (printer.toolhead.extruder, last_extruder_temp.temp) }'
	M109 S{last_extruder_temp.temp}
	{% set do_resume = True %}
	{% elif can_extrude %}
	{% set do_resume = True %}
	{% else %}
	RESPOND TYPE=error MSG='{"Resume aborted !!! \"%s\" not hot enough, please heat up again and press RESUME" % printer.toolhead.extruder}'
	{% set _d = prompt_txt.append("\"%s\" not hot enough, please heat up again and press RESUME" % printer.toolhead.extruder) %}
	{% endif %}
	
	{% elif can_extrude %}
	{% set do_resume = True %}
	{% else %}
	RESPOND TYPE=error MSG='{"Resume aborted !!! \"%s\" not hot enough, please heat up again and press RESUME" % printer.toolhead.extruder}'
	{% set _d = prompt_txt.append("\"%s\" not hot enough, please heat up again and press RESUME" % printer.toolhead.extruder) %}
	{% endif %}
	{% if runout_resume %}
	{% if do_resume %}
	{% if restore_idle_timeout > 0 %} SET_IDLE_TIMEOUT TIMEOUT={restore_idle_timeout} {% endif %}
	{client.user_resume_macro|default("")}
	_CLIENT_EXTRUDE
	RESUME_BASE VELOCITY={params.VELOCITY|default(sp_move)}
	{% endif %}
	{% else %}
	RESPOND TYPE=error MSG='{"Resume aborted !!! \"%s\" detects no filament, please load filament and press RESUME" % (client.runout_sensor.split(" "))[1]}'
	{% set _d = prompt_txt.append("\"%s\" detects no filament, please load filament and press RESUME" % (client.runout_sensor.split(" "))[1]) %}
	{% endif %}
	
	{% if not (runout_resume and do_resume) %}
	RESPOND TYPE=command MSG="action:prompt_begin RESUME aborted !!!"
	{% for element in prompt_txt %}
	RESPOND TYPE=command MSG='{"action:prompt_text %s" % element}'
	{% endfor %}
	RESPOND TYPE=command MSG="action:prompt_footer_button Ok|RESPOND TYPE=command MSG=action:prompt_end|info"
	RESPOND TYPE=command MSG="action:prompt_show"
	{% endif %}

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[tmc5160 extruder]
cs_pin = PA10
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 0.65
sense_resistor = 0.075
stealthchop_threshold = 0

[extruder]
rotation_distance = 5.7
full_steps_per_rotation = 200
sensor_type = PT1000
min_temp = 0
max_temp = 330
filament_diameter = 1.750
dir_pin = !PB6
step_pin = PG15
enable_pin = !PG14
heater_pin = PF6
sensor_pin = PB1
microsteps = 16
nozzle_diameter = 0.600
pressure_advance = 0.015
pressure_advance_smooth_time = 0.02
max_extrude_only_distance = 101
control = pid
pid_kp = 22.354
pid_ki = 1.552
pid_kd = 80.473

[tmc5160 stepper_x]
cs_pin = PD6
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
diag1_pin = PC15
run_current = 2.00
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_x]
dir_pin = !PC13
step_pin = PC14
enable_pin = !PE6
endstop_pin = PC15
microsteps = 16
rotation_distance = 40
position_endstop = -6
position_min = -6
position_max = 330
homing_speed = 20
full_steps_per_rotation = 200
homing_retract_dist = 0
homing_positive_dir = false
step_pulse_duration = 0.000001

[tmc5160 stepper_x1]
cs_pin = PD5
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2.00
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_x1]
dir_pin = !PE4
step_pin = PE5
enable_pin = !PE3
microsteps = 16
rotation_distance = 40
full_steps_per_rotation = 200
step_pulse_duration = 0.000001

[tmc5160 stepper_y]
cs_pin = PD4
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_y]
dir_pin = !PE1
step_pin = PE2
enable_pin = !PE0
endstop_pin = PF0
microsteps = 16
rotation_distance = 40
position_endstop = 0
position_min = 0
position_max = 315
homing_speed = 20
full_steps_per_rotation = 200
homing_retract_dist = 0
homing_positive_dir = false
step_pulse_duration = 0.000001

[tmc5160 stepper_y1]
cs_pin = PD3
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_y1]
dir_pin = !PB8
step_pin = PB9
enable_pin = !PB7
microsteps = 16
rotation_distance = 40
full_steps_per_rotation = 200
step_pulse_duration = 0.000001

[tmc5160 stepper_z]
cs_pin = PD2
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 1
sense_resistor = 0.075
stealthchop_threshold = 0

[stepper_z]
dir_pin = !PG10
step_pin = PG9
enable_pin = !PG13
endstop_pin = probe:z_virtual_endstop
microsteps = 16
rotation_distance = 8
position_min = -20
position_max = 400
full_steps_per_rotation = 200
homing_retract_dist = 5.0
homing_positive_dir = false
homing_speed = 3
second_homing_speed = 1
step_pulse_duration = 0.000004

[tmc5160 stepper_z1]
cs_pin = PA15
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 1
sense_resistor = 0.075
stealthchop_threshold = 0

[stepper_z1]
dir_pin = !PD7
step_pin = PG11
enable_pin = !PG12
microsteps = 16
rotation_distance = 8

[safe_z_home]
home_xy_position = 165, 165
z_hop = 10

[z_tilt]
z_positions = 
	-80,  -20
	350, -20
points = 
	15, 150
	275, 150
speed = 50
horizontal_move_z = 10
retries = 30
retry_tolerance = 0.1

[input_shaper]
shaper_type_x = zv
shaper_freq_x = 120.6
shaper_type_y = zv
shaper_freq_y = 76.6

[printer]
kinematics = corexy
max_velocity = 3000
max_accel = 20000
max_z_velocity = 20
max_z_accel = 15
square_corner_velocity = 10

[exclude_object]

[gcode_arcs]
resolution = 0.05

[idle_timeout]
gcode = 
	{% if not printer.pause_resume.is_paused %}
	TURN_OFF_HEATERS
	M84
	{% endif %}

[save_variables]
filename = vars.cfg

[mcu]
serial = /dev/serial/by-id/usb-Klipper_stm32h723xx_4C0023001551313338343730-if00

[bed_mesh default]
version = 1
points = 
	-0.215000, -0.210000, -0.190000, -0.185000, -0.170000, -0.145000, -0.135000, -0.120000, -0.105000, -0.070000, -0.055000, -0.035000, 0.000000, 0.010000, 0.025000, 0.050000, 0.080000, 0.105000, 0.130000, 0.135000, 0.150000, 0.155000, 0.165000, 0.190000, 0.205000
	-0.160000, -0.155000, -0.160000, -0.150000, -0.130000, -0.110000, -0.105000, -0.085000, -0.055000, -0.035000, -0.025000, 0.000000, 0.025000, 0.055000, 0.075000, 0.100000, 0.110000, 0.130000, 0.160000, 0.170000, 0.190000, 0.190000, 0.205000, 0.205000, 0.220000
	-0.160000, -0.150000, -0.140000, -0.135000, -0.115000, -0.105000, -0.090000, -0.070000, -0.040000, -0.025000, -0.010000, 0.015000, 0.030000, 0.045000, 0.080000, 0.100000, 0.115000, 0.135000, 0.160000, 0.165000, 0.180000, 0.185000, 0.190000, 0.220000, 0.235000
	-0.120000, -0.115000, -0.115000, -0.100000, -0.080000, -0.070000, -0.065000, -0.040000, -0.015000, 0.010000, 0.030000, 0.050000, 0.065000, 0.090000, 0.110000, 0.130000, 0.145000, 0.175000, 0.195000, 0.195000, 0.195000, 0.205000, 0.210000, 0.235000, 0.240000
	-0.075000, -0.065000, -0.055000, -0.045000, -0.040000, -0.020000, -0.005000, 0.015000, 0.035000, 0.065000, 0.075000, 0.090000, 0.105000, 0.115000, 0.140000, 0.170000, 0.175000, 0.190000, 0.205000, 0.205000, 0.205000, 0.210000, 0.215000, 0.240000, 0.240000
	-0.045000, -0.050000, -0.055000, -0.045000, -0.015000, -0.005000, -0.005000, 0.020000, 0.060000, 0.065000, 0.075000, 0.100000, 0.115000, 0.125000, 0.135000, 0.170000, 0.175000, 0.175000, 0.205000, 0.205000, 0.205000, 0.205000, 0.210000, 0.220000, 0.225000
	-0.035000, -0.030000, -0.030000, -0.020000, 0.000000, 0.015000, 0.015000, 0.035000, 0.065000, 0.085000, 0.100000, 0.110000, 0.115000, 0.130000, 0.160000, 0.170000, 0.180000, 0.180000, 0.200000, 0.200000, 0.200000, 0.205000, 0.205000, 0.220000, 0.235000
	0.005000, 0.010000, 0.015000, 0.025000, 0.035000, 0.040000, 0.055000, 0.085000, 0.095000, 0.110000, 0.115000, 0.125000, 0.140000, 0.160000, 0.175000, 0.180000, 0.190000, 0.190000, 0.225000, 0.225000, 0.225000, 0.225000, 0.230000, 0.235000, 0.250000
	0.055000, 0.065000, 0.060000, 0.065000, 0.075000, 0.090000, 0.100000, 0.110000, 0.120000, 0.130000, 0.140000, 0.155000, 0.170000, 0.180000, 0.190000, 0.195000, 0.210000, 0.220000, 0.235000, 0.235000, 0.235000, 0.235000, 0.245000, 0.250000, 0.260000
	0.100000, 0.105000, 0.110000, 0.110000, 0.120000, 0.135000, 0.145000, 0.150000, 0.155000, 0.155000, 0.170000, 0.185000, 0.190000, 0.195000, 0.195000, 0.215000, 0.230000, 0.235000, 0.245000, 0.245000, 0.245000, 0.235000, 0.245000, 0.250000, 0.260000
	0.100000, 0.115000, 0.125000, 0.130000, 0.135000, 0.145000, 0.150000, 0.155000, 0.165000, 0.175000, 0.190000, 0.200000, 0.205000, 0.205000, 0.215000, 0.225000, 0.230000, 0.245000, 0.255000, 0.240000, 0.240000, 0.240000, 0.245000, 0.250000, 0.250000
	0.155000, 0.150000, 0.150000, 0.150000, 0.160000, 0.165000, 0.165000, 0.175000, 0.175000, 0.195000, 0.200000, 0.215000, 0.205000, 0.210000, 0.215000, 0.225000, 0.235000, 0.240000, 0.245000, 0.240000, 0.240000, 0.235000, 0.220000, 0.235000, 0.240000
	0.170000, 0.165000, 0.165000, 0.170000, 0.180000, 0.190000, 0.190000, 0.185000, 0.200000, 0.205000, 0.220000, 0.230000, 0.225000, 0.225000, 0.240000, 0.245000, 0.240000, 0.250000, 0.255000, 0.245000, 0.250000, 0.245000, 0.245000, 0.240000, 0.240000
	0.210000, 0.200000, 0.195000, 0.200000, 0.210000, 0.210000, 0.210000, 0.215000, 0.215000, 0.215000, 0.235000, 0.245000, 0.235000, 0.235000, 0.245000, 0.250000, 0.240000, 0.250000, 0.250000, 0.250000, 0.255000, 0.250000, 0.235000, 0.235000, 0.240000
	0.240000, 0.250000, 0.250000, 0.245000, 0.260000, 0.260000, 0.255000, 0.255000, 0.255000, 0.250000, 0.265000, 0.265000, 0.260000, 0.255000, 0.260000, 0.255000, 0.255000, 0.270000, 0.260000, 0.255000, 0.250000, 0.255000, 0.245000, 0.250000, 0.240000
	0.270000, 0.260000, 0.255000, 0.265000, 0.265000, 0.265000, 0.265000, 0.260000, 0.260000, 0.255000, 0.265000, 0.265000, 0.265000, 0.255000, 0.255000, 0.250000, 0.255000, 0.250000, 0.250000, 0.245000, 0.245000, 0.235000, 0.230000, 0.235000, 0.240000
	0.275000, 0.280000, 0.275000, 0.275000, 0.275000, 0.275000, 0.275000, 0.275000, 0.280000, 0.280000, 0.280000, 0.270000, 0.270000, 0.270000, 0.265000, 0.265000, 0.265000, 0.270000, 0.260000, 0.255000, 0.235000, 0.235000, 0.235000, 0.240000, 0.235000
	0.335000, 0.315000, 0.305000, 0.310000, 0.305000, 0.300000, 0.295000, 0.290000, 0.300000, 0.295000, 0.290000, 0.290000, 0.280000, 0.270000, 0.270000, 0.275000, 0.275000, 0.265000, 0.250000, 0.245000, 0.235000, 0.225000, 0.225000, 0.230000, 0.235000
	0.355000, 0.350000, 0.345000, 0.325000, 0.330000, 0.325000, 0.325000, 0.325000, 0.315000, 0.310000, 0.300000, 0.290000, 0.285000, 0.290000, 0.275000, 0.275000, 0.265000, 0.265000, 0.250000, 0.245000, 0.235000, 0.225000, 0.230000, 0.225000, 0.215000
	0.395000, 0.385000, 0.380000, 0.370000, 0.365000, 0.370000, 0.360000, 0.355000, 0.345000, 0.340000, 0.330000, 0.320000, 0.310000, 0.305000, 0.300000, 0.290000, 0.275000, 0.260000, 0.255000, 0.255000, 0.250000, 0.235000, 0.230000, 0.230000, 0.230000
	0.395000, 0.390000, 0.375000, 0.375000, 0.375000, 0.370000, 0.365000, 0.360000, 0.355000, 0.335000, 0.325000, 0.315000, 0.315000, 0.300000, 0.295000, 0.280000, 0.255000, 0.260000, 0.250000, 0.240000, 0.230000, 0.235000, 0.230000, 0.205000, 0.195000
	0.405000, 0.395000, 0.395000, 0.390000, 0.380000, 0.375000, 0.370000, 0.360000, 0.355000, 0.345000, 0.325000, 0.325000, 0.310000, 0.295000, 0.290000, 0.270000, 0.250000, 0.240000, 0.235000, 0.235000, 0.230000, 0.205000, 0.195000, 0.195000, 0.195000
	0.405000, 0.395000, 0.380000, 0.375000, 0.375000, 0.370000, 0.360000, 0.345000, 0.340000, 0.330000, 0.305000, 0.300000, 0.285000, 0.270000, 0.250000, 0.235000, 0.220000, 0.215000, 0.220000, 0.205000, 0.195000, 0.175000, 0.175000, 0.170000, 0.165000
	0.405000, 0.390000, 0.395000, 0.385000, 0.365000, 0.350000, 0.345000, 0.330000, 0.320000, 0.305000, 0.290000, 0.265000, 0.260000, 0.240000, 0.225000, 0.215000, 0.205000, 0.190000, 0.180000, 0.185000, 0.165000, 0.150000, 0.145000, 0.145000, 0.145000
	0.430000, 0.425000, 0.400000, 0.395000, 0.385000, 0.370000, 0.365000, 0.340000, 0.320000, 0.305000, 0.295000, 0.270000, 0.250000, 0.235000, 0.215000, 0.215000, 0.200000, 0.190000, 0.185000, 0.165000, 0.155000, 0.145000, 0.135000, 0.130000, 0.135000
x_count = 25
y_count = 25
mesh_x_pps = 3
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 310.0
min_y = 26.43
max_y = 281.31
=======================
Config error
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/klippy.py", line 175, in _connect
    self._read_config()
  File "/home/pi/klipper/klippy/klippy.py", line 143, in _read_config
    m.add_printer_objects(config)
  File "/home/pi/klipper/klippy/toolhead.py", line 658, in add_printer_objects
    config.get_printer().add_object('toolhead', ToolHead(config))
                                                ^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/toolhead.py", line 261, in __init__
    self.kin = mod.load_kinematics(self, config)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/kinematics/corexy.py", line 99, in load_kinematics
    return CoreXYKinematics(toolhead, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/kinematics/corexy.py", line 12, in __init__
    self.rails = [stepper.LookupMultiRail(config.getsection('stepper_' + n))
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/kinematics/corexy.py", line 12, in <listcomp>
    self.rails = [stepper.LookupMultiRail(config.getsection('stepper_' + n))
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/stepper.py", line 423, in LookupMultiRail
    rail = PrinterRail(config, need_position_minmax,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/stepper.py", line 304, in __init__
    self.add_extra_stepper(config)
  File "/home/pi/klipper/klippy/stepper.py", line 383, in add_extra_stepper
    pin_params = ppins.parse_pin(endstop_pin, True, True)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/pins.py", line 83, in parse_pin
    raise error("Unknown pin chip name '%s'" % (chip_name,))
pins.error: Unknown pin chip name 'probe'
webhooks client 140734118052752: New connection
webhooks client 140734118052752: Client info {'program': 'Moonraker', 'version': 'v0.8.0-308-g71b46cc'}
Attempting MCU 'mcu' reset
webhooks client 140734118052752: Disconnected
Restarting printer
Start printer at Mon Feb  5 14:54:34 2024 (1707144874.1 90790.0)
===== Config file =====
[virtual_sdcard]
path = /home/pi/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]
recover_velocity = 350

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set allow_park = client.park_at_cancel|default(false)|lower == 'true' %}
	{% set retract = client.cancel_retract|default(5.0)|abs %}
	
	{% set park_x = "" if (client.park_at_cancel_x|default(none) is none)
	else "X=" ~ client.park_at_cancel_x %}
	{% set park_y = "" if (client.park_at_cancel_y|default(none) is none)
	else "Y=" ~ client.park_at_cancel_y %}
	{% set custom_park = park_x|length > 0 or park_y|length > 0 %}
	
	
	{% if printer['gcode_macro RESUME'].restore_idle_timeout > 0 %}
	SET_IDLE_TIMEOUT TIMEOUT={printer['gcode_macro RESUME'].restore_idle_timeout}
	{% endif %}
	{% if (custom_park or not printer.pause_resume.is_paused) and allow_park %} _TOOLHEAD_PARK_PAUSE_CANCEL {park_x} {park_y} {% endif %}
	_CLIENT_RETRACT LENGTH={retract}
	TURN_OFF_HEATERS
	M106 S0
	{client.user_cancel_macro|default("")}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=idle_state VALUE=False
	
	SET_PAUSE_NEXT_LAYER ENABLE=0
	SET_PAUSE_AT_LAYER ENABLE=0 LAYER=0
	CANCEL_PRINT_BASE

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = PAUSE_BASE
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set idle_timeout = client.idle_timeout|default(0) %}
	{% set temp = printer[printer.toolhead.extruder].target if printer.toolhead.extruder != '' else 0 %}
	{% set restore = False if printer.toolhead.extruder == ''
	else True  if params.RESTORE|default(1)|int == 1 else False %}
	
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=last_extruder_temp VALUE="{{'restore': restore, 'temp': temp}}"
	
	{% if idle_timeout > 0 %}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=restore_idle_timeout VALUE={printer.configfile.settings.idle_timeout.timeout}
	SET_IDLE_TIMEOUT TIMEOUT={idle_timeout}
	{% endif %}
	PAUSE_BASE
	{client.user_pause_macro|default("")}
	_TOOLHEAD_PARK_PAUSE_CANCEL {rawparams}

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = RESUME_BASE
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set sp_move = client.speed_move|default(velocity) %}
	{% set runout_resume = True if client.runout_sensor|default("") == ""
	else True if not printer[client.runout_sensor].enabled
	else printer[client.runout_sensor].filament_detected %}
	{% set can_extrude = True if printer.toolhead.extruder == ''
	else printer[printer.toolhead.extruder].can_extrude %}
	{% set do_resume = False %}
	{% set prompt_txt = [] %}
	
	
	{% if printer.idle_timeout.state|upper == "IDLE" or idle_state %}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=idle_state VALUE=False
	{% if last_extruder_temp.restore %}
	
	RESPOND TYPE=echo MSG='{"Restoring \"%s\" temperature to %3.1f\u00B0C, this may take some time" % (printer.toolhead.extruder, last_extruder_temp.temp) }'
	M109 S{last_extruder_temp.temp}
	{% set do_resume = True %}
	{% elif can_extrude %}
	{% set do_resume = True %}
	{% else %}
	RESPOND TYPE=error MSG='{"Resume aborted !!! \"%s\" not hot enough, please heat up again and press RESUME" % printer.toolhead.extruder}'
	{% set _d = prompt_txt.append("\"%s\" not hot enough, please heat up again and press RESUME" % printer.toolhead.extruder) %}
	{% endif %}
	
	{% elif can_extrude %}
	{% set do_resume = True %}
	{% else %}
	RESPOND TYPE=error MSG='{"Resume aborted !!! \"%s\" not hot enough, please heat up again and press RESUME" % printer.toolhead.extruder}'
	{% set _d = prompt_txt.append("\"%s\" not hot enough, please heat up again and press RESUME" % printer.toolhead.extruder) %}
	{% endif %}
	{% if runout_resume %}
	{% if do_resume %}
	{% if restore_idle_timeout > 0 %} SET_IDLE_TIMEOUT TIMEOUT={restore_idle_timeout} {% endif %}
	{client.user_resume_macro|default("")}
	_CLIENT_EXTRUDE
	RESUME_BASE VELOCITY={params.VELOCITY|default(sp_move)}
	{% endif %}
	{% else %}
	RESPOND TYPE=error MSG='{"Resume aborted !!! \"%s\" detects no filament, please load filament and press RESUME" % (client.runout_sensor.split(" "))[1]}'
	{% set _d = prompt_txt.append("\"%s\" detects no filament, please load filament and press RESUME" % (client.runout_sensor.split(" "))[1]) %}
	{% endif %}
	
	{% if not (runout_resume and do_resume) %}
	RESPOND TYPE=command MSG="action:prompt_begin RESUME aborted !!!"
	{% for element in prompt_txt %}
	RESPOND TYPE=command MSG='{"action:prompt_text %s" % element}'
	{% endfor %}
	RESPOND TYPE=command MSG="action:prompt_footer_button Ok|RESPOND TYPE=command MSG=action:prompt_end|info"
	RESPOND TYPE=command MSG="action:prompt_show"
	{% endif %}

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[tmc5160 extruder]
cs_pin = PA10
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 0.65
sense_resistor = 0.075
stealthchop_threshold = 0

[extruder]
rotation_distance = 5.7
full_steps_per_rotation = 200
sensor_type = PT1000
min_temp = 0
max_temp = 330
filament_diameter = 1.750
dir_pin = !PB6
step_pin = PG15
enable_pin = !PG14
heater_pin = PF6
sensor_pin = PB1
microsteps = 16
nozzle_diameter = 0.600
pressure_advance = 0.015
pressure_advance_smooth_time = 0.02
max_extrude_only_distance = 101
control = pid
pid_kp = 22.354
pid_ki = 1.552
pid_kd = 80.473

[tmc5160 stepper_x]
cs_pin = PD6
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
diag1_pin = PC15
run_current = 2.00
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_x]
dir_pin = !PC13
step_pin = PC14
enable_pin = !PE6
endstop_pin = PC15
microsteps = 16
rotation_distance = 40
position_endstop = -6
position_min = -6
position_max = 330
homing_speed = 20
full_steps_per_rotation = 200
homing_retract_dist = 0
homing_positive_dir = false
step_pulse_duration = 0.000001

[tmc5160 stepper_x1]
cs_pin = PD5
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2.00
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_x1]
dir_pin = !PE4
step_pin = PE5
enable_pin = !PE3
microsteps = 16
rotation_distance = 40
full_steps_per_rotation = 200
step_pulse_duration = 0.000001

[tmc5160 stepper_y]
cs_pin = PD4
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_y]
dir_pin = !PE1
step_pin = PE2
enable_pin = !PE0
endstop_pin = PF0
microsteps = 16
rotation_distance = 40
position_endstop = 0
position_min = 0
position_max = 315
homing_speed = 20
full_steps_per_rotation = 200
homing_retract_dist = 0
homing_positive_dir = false
step_pulse_duration = 0.000001

[tmc5160 stepper_y1]
cs_pin = PD3
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_y1]
dir_pin = !PB8
step_pin = PB9
enable_pin = !PB7
microsteps = 16
rotation_distance = 40
full_steps_per_rotation = 200
step_pulse_duration = 0.000001

[tmc5160 stepper_z]
cs_pin = PD2
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 1
sense_resistor = 0.075
stealthchop_threshold = 0

[stepper_z]
dir_pin = !PG10
step_pin = PG9
enable_pin = !PG13
endstop_pin = probe:z_virtual_endstop
microsteps = 16
rotation_distance = 8
position_min = -20
position_max = 400
full_steps_per_rotation = 200
homing_retract_dist = 5.0
homing_positive_dir = false
homing_speed = 3
second_homing_speed = 1
step_pulse_duration = 0.000004

[tmc5160 stepper_z1]
cs_pin = PA15
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 1
sense_resistor = 0.075
stealthchop_threshold = 0

[stepper_z1]
dir_pin = !PD7
step_pin = PG11
enable_pin = !PG12
microsteps = 16
rotation_distance = 8

[safe_z_home]
home_xy_position = 165, 165
z_hop = 10

[z_tilt]
z_positions = 
	-80,  -20
	350, -20
points = 
	15, 150
	275, 150
speed = 50
horizontal_move_z = 10
retries = 30
retry_tolerance = 0.1

[input_shaper]
shaper_type_x = zv
shaper_freq_x = 120.6
shaper_type_y = zv
shaper_freq_y = 76.6

[printer]
kinematics = corexy
max_velocity = 3000
max_accel = 20000
max_z_velocity = 20
max_z_accel = 15
square_corner_velocity = 10

[exclude_object]

[gcode_arcs]
resolution = 0.05

[idle_timeout]
gcode = 
	{% if not printer.pause_resume.is_paused %}
	TURN_OFF_HEATERS
	M84
	{% endif %}

[save_variables]
filename = vars.cfg

[mcu]
serial = /dev/serial/by-id/usb-Klipper_stm32h723xx_4C0023001551313338343730-if00

[bed_mesh default]
version = 1
points = 
	-0.215000, -0.210000, -0.190000, -0.185000, -0.170000, -0.145000, -0.135000, -0.120000, -0.105000, -0.070000, -0.055000, -0.035000, 0.000000, 0.010000, 0.025000, 0.050000, 0.080000, 0.105000, 0.130000, 0.135000, 0.150000, 0.155000, 0.165000, 0.190000, 0.205000
	-0.160000, -0.155000, -0.160000, -0.150000, -0.130000, -0.110000, -0.105000, -0.085000, -0.055000, -0.035000, -0.025000, 0.000000, 0.025000, 0.055000, 0.075000, 0.100000, 0.110000, 0.130000, 0.160000, 0.170000, 0.190000, 0.190000, 0.205000, 0.205000, 0.220000
	-0.160000, -0.150000, -0.140000, -0.135000, -0.115000, -0.105000, -0.090000, -0.070000, -0.040000, -0.025000, -0.010000, 0.015000, 0.030000, 0.045000, 0.080000, 0.100000, 0.115000, 0.135000, 0.160000, 0.165000, 0.180000, 0.185000, 0.190000, 0.220000, 0.235000
	-0.120000, -0.115000, -0.115000, -0.100000, -0.080000, -0.070000, -0.065000, -0.040000, -0.015000, 0.010000, 0.030000, 0.050000, 0.065000, 0.090000, 0.110000, 0.130000, 0.145000, 0.175000, 0.195000, 0.195000, 0.195000, 0.205000, 0.210000, 0.235000, 0.240000
	-0.075000, -0.065000, -0.055000, -0.045000, -0.040000, -0.020000, -0.005000, 0.015000, 0.035000, 0.065000, 0.075000, 0.090000, 0.105000, 0.115000, 0.140000, 0.170000, 0.175000, 0.190000, 0.205000, 0.205000, 0.205000, 0.210000, 0.215000, 0.240000, 0.240000
	-0.045000, -0.050000, -0.055000, -0.045000, -0.015000, -0.005000, -0.005000, 0.020000, 0.060000, 0.065000, 0.075000, 0.100000, 0.115000, 0.125000, 0.135000, 0.170000, 0.175000, 0.175000, 0.205000, 0.205000, 0.205000, 0.205000, 0.210000, 0.220000, 0.225000
	-0.035000, -0.030000, -0.030000, -0.020000, 0.000000, 0.015000, 0.015000, 0.035000, 0.065000, 0.085000, 0.100000, 0.110000, 0.115000, 0.130000, 0.160000, 0.170000, 0.180000, 0.180000, 0.200000, 0.200000, 0.200000, 0.205000, 0.205000, 0.220000, 0.235000
	0.005000, 0.010000, 0.015000, 0.025000, 0.035000, 0.040000, 0.055000, 0.085000, 0.095000, 0.110000, 0.115000, 0.125000, 0.140000, 0.160000, 0.175000, 0.180000, 0.190000, 0.190000, 0.225000, 0.225000, 0.225000, 0.225000, 0.230000, 0.235000, 0.250000
	0.055000, 0.065000, 0.060000, 0.065000, 0.075000, 0.090000, 0.100000, 0.110000, 0.120000, 0.130000, 0.140000, 0.155000, 0.170000, 0.180000, 0.190000, 0.195000, 0.210000, 0.220000, 0.235000, 0.235000, 0.235000, 0.235000, 0.245000, 0.250000, 0.260000
	0.100000, 0.105000, 0.110000, 0.110000, 0.120000, 0.135000, 0.145000, 0.150000, 0.155000, 0.155000, 0.170000, 0.185000, 0.190000, 0.195000, 0.195000, 0.215000, 0.230000, 0.235000, 0.245000, 0.245000, 0.245000, 0.235000, 0.245000, 0.250000, 0.260000
	0.100000, 0.115000, 0.125000, 0.130000, 0.135000, 0.145000, 0.150000, 0.155000, 0.165000, 0.175000, 0.190000, 0.200000, 0.205000, 0.205000, 0.215000, 0.225000, 0.230000, 0.245000, 0.255000, 0.240000, 0.240000, 0.240000, 0.245000, 0.250000, 0.250000
	0.155000, 0.150000, 0.150000, 0.150000, 0.160000, 0.165000, 0.165000, 0.175000, 0.175000, 0.195000, 0.200000, 0.215000, 0.205000, 0.210000, 0.215000, 0.225000, 0.235000, 0.240000, 0.245000, 0.240000, 0.240000, 0.235000, 0.220000, 0.235000, 0.240000
	0.170000, 0.165000, 0.165000, 0.170000, 0.180000, 0.190000, 0.190000, 0.185000, 0.200000, 0.205000, 0.220000, 0.230000, 0.225000, 0.225000, 0.240000, 0.245000, 0.240000, 0.250000, 0.255000, 0.245000, 0.250000, 0.245000, 0.245000, 0.240000, 0.240000
	0.210000, 0.200000, 0.195000, 0.200000, 0.210000, 0.210000, 0.210000, 0.215000, 0.215000, 0.215000, 0.235000, 0.245000, 0.235000, 0.235000, 0.245000, 0.250000, 0.240000, 0.250000, 0.250000, 0.250000, 0.255000, 0.250000, 0.235000, 0.235000, 0.240000
	0.240000, 0.250000, 0.250000, 0.245000, 0.260000, 0.260000, 0.255000, 0.255000, 0.255000, 0.250000, 0.265000, 0.265000, 0.260000, 0.255000, 0.260000, 0.255000, 0.255000, 0.270000, 0.260000, 0.255000, 0.250000, 0.255000, 0.245000, 0.250000, 0.240000
	0.270000, 0.260000, 0.255000, 0.265000, 0.265000, 0.265000, 0.265000, 0.260000, 0.260000, 0.255000, 0.265000, 0.265000, 0.265000, 0.255000, 0.255000, 0.250000, 0.255000, 0.250000, 0.250000, 0.245000, 0.245000, 0.235000, 0.230000, 0.235000, 0.240000
	0.275000, 0.280000, 0.275000, 0.275000, 0.275000, 0.275000, 0.275000, 0.275000, 0.280000, 0.280000, 0.280000, 0.270000, 0.270000, 0.270000, 0.265000, 0.265000, 0.265000, 0.270000, 0.260000, 0.255000, 0.235000, 0.235000, 0.235000, 0.240000, 0.235000
	0.335000, 0.315000, 0.305000, 0.310000, 0.305000, 0.300000, 0.295000, 0.290000, 0.300000, 0.295000, 0.290000, 0.290000, 0.280000, 0.270000, 0.270000, 0.275000, 0.275000, 0.265000, 0.250000, 0.245000, 0.235000, 0.225000, 0.225000, 0.230000, 0.235000
	0.355000, 0.350000, 0.345000, 0.325000, 0.330000, 0.325000, 0.325000, 0.325000, 0.315000, 0.310000, 0.300000, 0.290000, 0.285000, 0.290000, 0.275000, 0.275000, 0.265000, 0.265000, 0.250000, 0.245000, 0.235000, 0.225000, 0.230000, 0.225000, 0.215000
	0.395000, 0.385000, 0.380000, 0.370000, 0.365000, 0.370000, 0.360000, 0.355000, 0.345000, 0.340000, 0.330000, 0.320000, 0.310000, 0.305000, 0.300000, 0.290000, 0.275000, 0.260000, 0.255000, 0.255000, 0.250000, 0.235000, 0.230000, 0.230000, 0.230000
	0.395000, 0.390000, 0.375000, 0.375000, 0.375000, 0.370000, 0.365000, 0.360000, 0.355000, 0.335000, 0.325000, 0.315000, 0.315000, 0.300000, 0.295000, 0.280000, 0.255000, 0.260000, 0.250000, 0.240000, 0.230000, 0.235000, 0.230000, 0.205000, 0.195000
	0.405000, 0.395000, 0.395000, 0.390000, 0.380000, 0.375000, 0.370000, 0.360000, 0.355000, 0.345000, 0.325000, 0.325000, 0.310000, 0.295000, 0.290000, 0.270000, 0.250000, 0.240000, 0.235000, 0.235000, 0.230000, 0.205000, 0.195000, 0.195000, 0.195000
	0.405000, 0.395000, 0.380000, 0.375000, 0.375000, 0.370000, 0.360000, 0.345000, 0.340000, 0.330000, 0.305000, 0.300000, 0.285000, 0.270000, 0.250000, 0.235000, 0.220000, 0.215000, 0.220000, 0.205000, 0.195000, 0.175000, 0.175000, 0.170000, 0.165000
	0.405000, 0.390000, 0.395000, 0.385000, 0.365000, 0.350000, 0.345000, 0.330000, 0.320000, 0.305000, 0.290000, 0.265000, 0.260000, 0.240000, 0.225000, 0.215000, 0.205000, 0.190000, 0.180000, 0.185000, 0.165000, 0.150000, 0.145000, 0.145000, 0.145000
	0.430000, 0.425000, 0.400000, 0.395000, 0.385000, 0.370000, 0.365000, 0.340000, 0.320000, 0.305000, 0.295000, 0.270000, 0.250000, 0.235000, 0.215000, 0.215000, 0.200000, 0.190000, 0.185000, 0.165000, 0.155000, 0.145000, 0.135000, 0.130000, 0.135000
x_count = 25
y_count = 25
mesh_x_pps = 3
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 310.0
min_y = 26.43
max_y = 281.31
=======================
Config error
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/klippy.py", line 175, in _connect
    self._read_config()
  File "/home/pi/klipper/klippy/klippy.py", line 143, in _read_config
    m.add_printer_objects(config)
  File "/home/pi/klipper/klippy/toolhead.py", line 658, in add_printer_objects
    config.get_printer().add_object('toolhead', ToolHead(config))
                                                ^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/toolhead.py", line 261, in __init__
    self.kin = mod.load_kinematics(self, config)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/kinematics/corexy.py", line 99, in load_kinematics
    return CoreXYKinematics(toolhead, config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/kinematics/corexy.py", line 12, in __init__
    self.rails = [stepper.LookupMultiRail(config.getsection('stepper_' + n))
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/kinematics/corexy.py", line 12, in <listcomp>
    self.rails = [stepper.LookupMultiRail(config.getsection('stepper_' + n))
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/stepper.py", line 423, in LookupMultiRail
    rail = PrinterRail(config, need_position_minmax,
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/stepper.py", line 304, in __init__
    self.add_extra_stepper(config)
  File "/home/pi/klipper/klippy/stepper.py", line 383, in add_extra_stepper
    pin_params = ppins.parse_pin(endstop_pin, True, True)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/pins.py", line 83, in parse_pin
    raise error("Unknown pin chip name '%s'" % (chip_name,))
pins.error: Unknown pin chip name 'probe'
webhooks client 140734128972112: New connection
webhooks client 140734128972112: Client info {'program': 'Moonraker', 'version': 'v0.8.0-308-g71b46cc'}
Attempting MCU 'mcu' reset
webhooks client 140734128972112: Disconnected
Restarting printer
Start printer at Mon Feb  5 14:55:48 2024 (1707144948.2 90864.0)
===== Config file =====
[virtual_sdcard]
path = /home/pi/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]
recover_velocity = 350

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set allow_park = client.park_at_cancel|default(false)|lower == 'true' %}
	{% set retract = client.cancel_retract|default(5.0)|abs %}
	
	{% set park_x = "" if (client.park_at_cancel_x|default(none) is none)
	else "X=" ~ client.park_at_cancel_x %}
	{% set park_y = "" if (client.park_at_cancel_y|default(none) is none)
	else "Y=" ~ client.park_at_cancel_y %}
	{% set custom_park = park_x|length > 0 or park_y|length > 0 %}
	
	
	{% if printer['gcode_macro RESUME'].restore_idle_timeout > 0 %}
	SET_IDLE_TIMEOUT TIMEOUT={printer['gcode_macro RESUME'].restore_idle_timeout}
	{% endif %}
	{% if (custom_park or not printer.pause_resume.is_paused) and allow_park %} _TOOLHEAD_PARK_PAUSE_CANCEL {park_x} {park_y} {% endif %}
	_CLIENT_RETRACT LENGTH={retract}
	TURN_OFF_HEATERS
	M106 S0
	{client.user_cancel_macro|default("")}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=idle_state VALUE=False
	
	SET_PAUSE_NEXT_LAYER ENABLE=0
	SET_PAUSE_AT_LAYER ENABLE=0 LAYER=0
	CANCEL_PRINT_BASE

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = PAUSE_BASE
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set idle_timeout = client.idle_timeout|default(0) %}
	{% set temp = printer[printer.toolhead.extruder].target if printer.toolhead.extruder != '' else 0 %}
	{% set restore = False if printer.toolhead.extruder == ''
	else True  if params.RESTORE|default(1)|int == 1 else False %}
	
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=last_extruder_temp VALUE="{{'restore': restore, 'temp': temp}}"
	
	{% if idle_timeout > 0 %}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=restore_idle_timeout VALUE={printer.configfile.settings.idle_timeout.timeout}
	SET_IDLE_TIMEOUT TIMEOUT={idle_timeout}
	{% endif %}
	PAUSE_BASE
	{client.user_pause_macro|default("")}
	_TOOLHEAD_PARK_PAUSE_CANCEL {rawparams}

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = RESUME_BASE
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set sp_move = client.speed_move|default(velocity) %}
	{% set runout_resume = True if client.runout_sensor|default("") == ""
	else True if not printer[client.runout_sensor].enabled
	else printer[client.runout_sensor].filament_detected %}
	{% set can_extrude = True if printer.toolhead.extruder == ''
	else printer[printer.toolhead.extruder].can_extrude %}
	{% set do_resume = False %}
	{% set prompt_txt = [] %}
	
	
	{% if printer.idle_timeout.state|upper == "IDLE" or idle_state %}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=idle_state VALUE=False
	{% if last_extruder_temp.restore %}
	
	RESPOND TYPE=echo MSG='{"Restoring \"%s\" temperature to %3.1f\u00B0C, this may take some time" % (printer.toolhead.extruder, last_extruder_temp.temp) }'
	M109 S{last_extruder_temp.temp}
	{% set do_resume = True %}
	{% elif can_extrude %}
	{% set do_resume = True %}
	{% else %}
	RESPOND TYPE=error MSG='{"Resume aborted !!! \"%s\" not hot enough, please heat up again and press RESUME" % printer.toolhead.extruder}'
	{% set _d = prompt_txt.append("\"%s\" not hot enough, please heat up again and press RESUME" % printer.toolhead.extruder) %}
	{% endif %}
	
	{% elif can_extrude %}
	{% set do_resume = True %}
	{% else %}
	RESPOND TYPE=error MSG='{"Resume aborted !!! \"%s\" not hot enough, please heat up again and press RESUME" % printer.toolhead.extruder}'
	{% set _d = prompt_txt.append("\"%s\" not hot enough, please heat up again and press RESUME" % printer.toolhead.extruder) %}
	{% endif %}
	{% if runout_resume %}
	{% if do_resume %}
	{% if restore_idle_timeout > 0 %} SET_IDLE_TIMEOUT TIMEOUT={restore_idle_timeout} {% endif %}
	{client.user_resume_macro|default("")}
	_CLIENT_EXTRUDE
	RESUME_BASE VELOCITY={params.VELOCITY|default(sp_move)}
	{% endif %}
	{% else %}
	RESPOND TYPE=error MSG='{"Resume aborted !!! \"%s\" detects no filament, please load filament and press RESUME" % (client.runout_sensor.split(" "))[1]}'
	{% set _d = prompt_txt.append("\"%s\" detects no filament, please load filament and press RESUME" % (client.runout_sensor.split(" "))[1]) %}
	{% endif %}
	
	{% if not (runout_resume and do_resume) %}
	RESPOND TYPE=command MSG="action:prompt_begin RESUME aborted !!!"
	{% for element in prompt_txt %}
	RESPOND TYPE=command MSG='{"action:prompt_text %s" % element}'
	{% endfor %}
	RESPOND TYPE=command MSG="action:prompt_footer_button Ok|RESPOND TYPE=command MSG=action:prompt_end|info"
	RESPOND TYPE=command MSG="action:prompt_show"
	{% endif %}

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[tmc5160 extruder]
cs_pin = PA10
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 0.65
sense_resistor = 0.075
stealthchop_threshold = 0

[extruder]
rotation_distance = 5.7
full_steps_per_rotation = 200
sensor_type = PT1000
min_temp = 0
max_temp = 330
filament_diameter = 1.750
dir_pin = !PB6
step_pin = PG15
enable_pin = !PG14
heater_pin = PF6
sensor_pin = PB1
microsteps = 16
nozzle_diameter = 0.600
pressure_advance = 0.015
pressure_advance_smooth_time = 0.02
max_extrude_only_distance = 101
control = pid
pid_kp = 22.354
pid_ki = 1.552
pid_kd = 80.473

[tmc5160 stepper_x]
cs_pin = PD6
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
diag1_pin = PC15
run_current = 2.00
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_x]
dir_pin = !PC13
step_pin = PC14
enable_pin = !PE6
endstop_pin = PC15
microsteps = 16
rotation_distance = 40
position_endstop = -6
position_min = -6
position_max = 330
homing_speed = 20
full_steps_per_rotation = 200
homing_retract_dist = 0
homing_positive_dir = false
step_pulse_duration = 0.000001

[tmc5160 stepper_x1]
cs_pin = PD5
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2.00
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_x1]
dir_pin = !PE4
step_pin = PE5
enable_pin = !PE3
microsteps = 16
rotation_distance = 40
full_steps_per_rotation = 200
step_pulse_duration = 0.000001

[tmc5160 stepper_y]
cs_pin = PD4
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_y]
dir_pin = !PE1
step_pin = PE2
enable_pin = !PE0
endstop_pin = PF0
microsteps = 16
rotation_distance = 40
position_endstop = 0
position_min = 0
position_max = 315
homing_speed = 20
full_steps_per_rotation = 200
homing_retract_dist = 0
homing_positive_dir = false
step_pulse_duration = 0.000001

[tmc5160 stepper_y1]
cs_pin = PD3
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_y1]
dir_pin = !PB8
step_pin = PB9
enable_pin = !PB7
microsteps = 16
rotation_distance = 40
full_steps_per_rotation = 200
step_pulse_duration = 0.000001

[tmc5160 stepper_z]
cs_pin = PD2
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 1
sense_resistor = 0.075
stealthchop_threshold = 0

[stepper_z]
dir_pin = !PG10
step_pin = PG9
enable_pin = !PG13
endstop_pin = probe:z_virtual_endstop
microsteps = 16
rotation_distance = 8
position_min = -20
position_max = 400
full_steps_per_rotation = 200
homing_retract_dist = 5.0
homing_positive_dir = false
homing_speed = 3
second_homing_speed = 1
step_pulse_duration = 0.000004

[tmc5160 stepper_z1]
cs_pin = PA15
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 1
sense_resistor = 0.075
stealthchop_threshold = 0

[stepper_z1]
dir_pin = !PD7
step_pin = PG11
enable_pin = !PG12
microsteps = 16
rotation_distance = 8

[safe_z_home]
home_xy_position = 165, 165
z_hop = 10

[z_tilt]
z_positions = 
	-80,  -20
	350, -20
points = 
	15, 150
	275, 150
speed = 50
horizontal_move_z = 10
retries = 30
retry_tolerance = 0.1

[input_shaper]
shaper_type_x = zv
shaper_freq_x = 120.6
shaper_type_y = zv
shaper_freq_y = 76.6

[cartographer]
serial = 
speed = 40.
lift_speed = 5.
backlash_comp = 0.5
x_offset = 0.
y_offset = 21.1
trigger_distance = 2.
trigger_dive_threshold = 1.5
trigger_hysteresis = 0.006
cal_nozzle_z = 0.1
cal_floor = 0.1
cal_ceil = 5.
cal_speed = 1.0
cal_move_speed = 10.
default_model_name = default
mesh_main_direction = x
mesh_cluster_size = 1
mesh_runs = 2

[printer]
kinematics = corexy
max_velocity = 3000
max_accel = 20000
max_z_velocity = 20
max_z_accel = 15
square_corner_velocity = 10

[exclude_object]

[gcode_arcs]
resolution = 0.05

[idle_timeout]
gcode = 
	{% if not printer.pause_resume.is_paused %}
	TURN_OFF_HEATERS
	M84
	{% endif %}

[save_variables]
filename = vars.cfg

[mcu]
serial = /dev/serial/by-id/usb-Klipper_stm32h723xx_4C0023001551313338343730-if00

[bed_mesh default]
version = 1
points = 
	-0.215000, -0.210000, -0.190000, -0.185000, -0.170000, -0.145000, -0.135000, -0.120000, -0.105000, -0.070000, -0.055000, -0.035000, 0.000000, 0.010000, 0.025000, 0.050000, 0.080000, 0.105000, 0.130000, 0.135000, 0.150000, 0.155000, 0.165000, 0.190000, 0.205000
	-0.160000, -0.155000, -0.160000, -0.150000, -0.130000, -0.110000, -0.105000, -0.085000, -0.055000, -0.035000, -0.025000, 0.000000, 0.025000, 0.055000, 0.075000, 0.100000, 0.110000, 0.130000, 0.160000, 0.170000, 0.190000, 0.190000, 0.205000, 0.205000, 0.220000
	-0.160000, -0.150000, -0.140000, -0.135000, -0.115000, -0.105000, -0.090000, -0.070000, -0.040000, -0.025000, -0.010000, 0.015000, 0.030000, 0.045000, 0.080000, 0.100000, 0.115000, 0.135000, 0.160000, 0.165000, 0.180000, 0.185000, 0.190000, 0.220000, 0.235000
	-0.120000, -0.115000, -0.115000, -0.100000, -0.080000, -0.070000, -0.065000, -0.040000, -0.015000, 0.010000, 0.030000, 0.050000, 0.065000, 0.090000, 0.110000, 0.130000, 0.145000, 0.175000, 0.195000, 0.195000, 0.195000, 0.205000, 0.210000, 0.235000, 0.240000
	-0.075000, -0.065000, -0.055000, -0.045000, -0.040000, -0.020000, -0.005000, 0.015000, 0.035000, 0.065000, 0.075000, 0.090000, 0.105000, 0.115000, 0.140000, 0.170000, 0.175000, 0.190000, 0.205000, 0.205000, 0.205000, 0.210000, 0.215000, 0.240000, 0.240000
	-0.045000, -0.050000, -0.055000, -0.045000, -0.015000, -0.005000, -0.005000, 0.020000, 0.060000, 0.065000, 0.075000, 0.100000, 0.115000, 0.125000, 0.135000, 0.170000, 0.175000, 0.175000, 0.205000, 0.205000, 0.205000, 0.205000, 0.210000, 0.220000, 0.225000
	-0.035000, -0.030000, -0.030000, -0.020000, 0.000000, 0.015000, 0.015000, 0.035000, 0.065000, 0.085000, 0.100000, 0.110000, 0.115000, 0.130000, 0.160000, 0.170000, 0.180000, 0.180000, 0.200000, 0.200000, 0.200000, 0.205000, 0.205000, 0.220000, 0.235000
	0.005000, 0.010000, 0.015000, 0.025000, 0.035000, 0.040000, 0.055000, 0.085000, 0.095000, 0.110000, 0.115000, 0.125000, 0.140000, 0.160000, 0.175000, 0.180000, 0.190000, 0.190000, 0.225000, 0.225000, 0.225000, 0.225000, 0.230000, 0.235000, 0.250000
	0.055000, 0.065000, 0.060000, 0.065000, 0.075000, 0.090000, 0.100000, 0.110000, 0.120000, 0.130000, 0.140000, 0.155000, 0.170000, 0.180000, 0.190000, 0.195000, 0.210000, 0.220000, 0.235000, 0.235000, 0.235000, 0.235000, 0.245000, 0.250000, 0.260000
	0.100000, 0.105000, 0.110000, 0.110000, 0.120000, 0.135000, 0.145000, 0.150000, 0.155000, 0.155000, 0.170000, 0.185000, 0.190000, 0.195000, 0.195000, 0.215000, 0.230000, 0.235000, 0.245000, 0.245000, 0.245000, 0.235000, 0.245000, 0.250000, 0.260000
	0.100000, 0.115000, 0.125000, 0.130000, 0.135000, 0.145000, 0.150000, 0.155000, 0.165000, 0.175000, 0.190000, 0.200000, 0.205000, 0.205000, 0.215000, 0.225000, 0.230000, 0.245000, 0.255000, 0.240000, 0.240000, 0.240000, 0.245000, 0.250000, 0.250000
	0.155000, 0.150000, 0.150000, 0.150000, 0.160000, 0.165000, 0.165000, 0.175000, 0.175000, 0.195000, 0.200000, 0.215000, 0.205000, 0.210000, 0.215000, 0.225000, 0.235000, 0.240000, 0.245000, 0.240000, 0.240000, 0.235000, 0.220000, 0.235000, 0.240000
	0.170000, 0.165000, 0.165000, 0.170000, 0.180000, 0.190000, 0.190000, 0.185000, 0.200000, 0.205000, 0.220000, 0.230000, 0.225000, 0.225000, 0.240000, 0.245000, 0.240000, 0.250000, 0.255000, 0.245000, 0.250000, 0.245000, 0.245000, 0.240000, 0.240000
	0.210000, 0.200000, 0.195000, 0.200000, 0.210000, 0.210000, 0.210000, 0.215000, 0.215000, 0.215000, 0.235000, 0.245000, 0.235000, 0.235000, 0.245000, 0.250000, 0.240000, 0.250000, 0.250000, 0.250000, 0.255000, 0.250000, 0.235000, 0.235000, 0.240000
	0.240000, 0.250000, 0.250000, 0.245000, 0.260000, 0.260000, 0.255000, 0.255000, 0.255000, 0.250000, 0.265000, 0.265000, 0.260000, 0.255000, 0.260000, 0.255000, 0.255000, 0.270000, 0.260000, 0.255000, 0.250000, 0.255000, 0.245000, 0.250000, 0.240000
	0.270000, 0.260000, 0.255000, 0.265000, 0.265000, 0.265000, 0.265000, 0.260000, 0.260000, 0.255000, 0.265000, 0.265000, 0.265000, 0.255000, 0.255000, 0.250000, 0.255000, 0.250000, 0.250000, 0.245000, 0.245000, 0.235000, 0.230000, 0.235000, 0.240000
	0.275000, 0.280000, 0.275000, 0.275000, 0.275000, 0.275000, 0.275000, 0.275000, 0.280000, 0.280000, 0.280000, 0.270000, 0.270000, 0.270000, 0.265000, 0.265000, 0.265000, 0.270000, 0.260000, 0.255000, 0.235000, 0.235000, 0.235000, 0.240000, 0.235000
	0.335000, 0.315000, 0.305000, 0.310000, 0.305000, 0.300000, 0.295000, 0.290000, 0.300000, 0.295000, 0.290000, 0.290000, 0.280000, 0.270000, 0.270000, 0.275000, 0.275000, 0.265000, 0.250000, 0.245000, 0.235000, 0.225000, 0.225000, 0.230000, 0.235000
	0.355000, 0.350000, 0.345000, 0.325000, 0.330000, 0.325000, 0.325000, 0.325000, 0.315000, 0.310000, 0.300000, 0.290000, 0.285000, 0.290000, 0.275000, 0.275000, 0.265000, 0.265000, 0.250000, 0.245000, 0.235000, 0.225000, 0.230000, 0.225000, 0.215000
	0.395000, 0.385000, 0.380000, 0.370000, 0.365000, 0.370000, 0.360000, 0.355000, 0.345000, 0.340000, 0.330000, 0.320000, 0.310000, 0.305000, 0.300000, 0.290000, 0.275000, 0.260000, 0.255000, 0.255000, 0.250000, 0.235000, 0.230000, 0.230000, 0.230000
	0.395000, 0.390000, 0.375000, 0.375000, 0.375000, 0.370000, 0.365000, 0.360000, 0.355000, 0.335000, 0.325000, 0.315000, 0.315000, 0.300000, 0.295000, 0.280000, 0.255000, 0.260000, 0.250000, 0.240000, 0.230000, 0.235000, 0.230000, 0.205000, 0.195000
	0.405000, 0.395000, 0.395000, 0.390000, 0.380000, 0.375000, 0.370000, 0.360000, 0.355000, 0.345000, 0.325000, 0.325000, 0.310000, 0.295000, 0.290000, 0.270000, 0.250000, 0.240000, 0.235000, 0.235000, 0.230000, 0.205000, 0.195000, 0.195000, 0.195000
	0.405000, 0.395000, 0.380000, 0.375000, 0.375000, 0.370000, 0.360000, 0.345000, 0.340000, 0.330000, 0.305000, 0.300000, 0.285000, 0.270000, 0.250000, 0.235000, 0.220000, 0.215000, 0.220000, 0.205000, 0.195000, 0.175000, 0.175000, 0.170000, 0.165000
	0.405000, 0.390000, 0.395000, 0.385000, 0.365000, 0.350000, 0.345000, 0.330000, 0.320000, 0.305000, 0.290000, 0.265000, 0.260000, 0.240000, 0.225000, 0.215000, 0.205000, 0.190000, 0.180000, 0.185000, 0.165000, 0.150000, 0.145000, 0.145000, 0.145000
	0.430000, 0.425000, 0.400000, 0.395000, 0.385000, 0.370000, 0.365000, 0.340000, 0.320000, 0.305000, 0.295000, 0.270000, 0.250000, 0.235000, 0.215000, 0.215000, 0.200000, 0.190000, 0.185000, 0.165000, 0.155000, 0.145000, 0.135000, 0.130000, 0.135000
x_count = 25
y_count = 25
mesh_x_pps = 3
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 310.0
min_y = 26.43
max_y = 281.31
=======================
Extruder max_extrude_ratio=0.598682
Config error
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/klippy.py", line 175, in _connect
    self._read_config()
  File "/home/pi/klipper/klippy/klippy.py", line 145, in _read_config
    pconfig.check_unused_options(config)
  File "/home/pi/klipper/klippy/configfile.py", line 307, in check_unused_options
    raise error("Option '%s' is not valid in section '%s'"
configparser.Error: Option 'mesh_main_direction' is not valid in section 'cartographer'
webhooks client 140734128653072: New connection
webhooks client 140734128653072: Client info {'program': 'Moonraker', 'version': 'v0.8.0-308-g71b46cc'}
Attempting MCU 'mcu' reset
Attempting MCU 'cartographer' reset
Unhandled exception during post run
Traceback (most recent call last):
  File "/home/pi/klippy-env/lib/python3.11/site-packages/serial/serialposix.py", line 265, in open
    self.fd = os.open(self.portstr, os.O_RDWR | os.O_NOCTTY | os.O_NONBLOCK)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
FileNotFoundError: [Errno 2] No such file or directory: ''

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/pi/klipper/klippy/klippy.py", line 234, in run
    self.send_event("klippy:firmware_restart")
  File "/home/pi/klipper/klippy/klippy.py", line 263, in send_event
    return [cb(*params) for cb in self.event_handlers.get(event, [])]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/klippy.py", line 263, in <listcomp>
    return [cb(*params) for cb in self.event_handlers.get(event, [])]
            ^^^^^^^^^^^
  File "/home/pi/klipper/klippy/mcu.py", line 915, in _firmware_restart
    self._restart_arduino()
  File "/home/pi/klipper/klippy/mcu.py", line 875, in _restart_arduino
    serialhdl.arduino_reset(self._serialport, self._reactor)
  File "/home/pi/klipper/klippy/serialhdl.py", line 379, in arduino_reset
    ser = serial.Serial(serialport, 2400, timeout=0, exclusive=True)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klippy-env/lib/python3.11/site-packages/serial/serialutil.py", line 240, in __init__
    self.open()
  File "/home/pi/klippy-env/lib/python3.11/site-packages/serial/serialposix.py", line 268, in open
    raise SerialException(msg.errno, "could not open port {}: {}".format(self._port, msg))
serial.serialutil.SerialException: [Errno 2] could not open port : [Errno 2] No such file or directory: ''
Restarting printer
Start printer at Mon Feb  5 14:56:15 2024 (1707144975.8 90891.6)
===== Config file =====
[virtual_sdcard]
path = /home/pi/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]
recover_velocity = 350

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set allow_park = client.park_at_cancel|default(false)|lower == 'true' %}
	{% set retract = client.cancel_retract|default(5.0)|abs %}
	
	{% set park_x = "" if (client.park_at_cancel_x|default(none) is none)
	else "X=" ~ client.park_at_cancel_x %}
	{% set park_y = "" if (client.park_at_cancel_y|default(none) is none)
	else "Y=" ~ client.park_at_cancel_y %}
	{% set custom_park = park_x|length > 0 or park_y|length > 0 %}
	
	
	{% if printer['gcode_macro RESUME'].restore_idle_timeout > 0 %}
	SET_IDLE_TIMEOUT TIMEOUT={printer['gcode_macro RESUME'].restore_idle_timeout}
	{% endif %}
	{% if (custom_park or not printer.pause_resume.is_paused) and allow_park %} _TOOLHEAD_PARK_PAUSE_CANCEL {park_x} {park_y} {% endif %}
	_CLIENT_RETRACT LENGTH={retract}
	TURN_OFF_HEATERS
	M106 S0
	{client.user_cancel_macro|default("")}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=idle_state VALUE=False
	
	SET_PAUSE_NEXT_LAYER ENABLE=0
	SET_PAUSE_AT_LAYER ENABLE=0 LAYER=0
	CANCEL_PRINT_BASE

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = PAUSE_BASE
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set idle_timeout = client.idle_timeout|default(0) %}
	{% set temp = printer[printer.toolhead.extruder].target if printer.toolhead.extruder != '' else 0 %}
	{% set restore = False if printer.toolhead.extruder == ''
	else True  if params.RESTORE|default(1)|int == 1 else False %}
	
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=last_extruder_temp VALUE="{{'restore': restore, 'temp': temp}}"
	
	{% if idle_timeout > 0 %}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=restore_idle_timeout VALUE={printer.configfile.settings.idle_timeout.timeout}
	SET_IDLE_TIMEOUT TIMEOUT={idle_timeout}
	{% endif %}
	PAUSE_BASE
	{client.user_pause_macro|default("")}
	_TOOLHEAD_PARK_PAUSE_CANCEL {rawparams}

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = RESUME_BASE
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set sp_move = client.speed_move|default(velocity) %}
	{% set runout_resume = True if client.runout_sensor|default("") == ""
	else True if not printer[client.runout_sensor].enabled
	else printer[client.runout_sensor].filament_detected %}
	{% set can_extrude = True if printer.toolhead.extruder == ''
	else printer[printer.toolhead.extruder].can_extrude %}
	{% set do_resume = False %}
	{% set prompt_txt = [] %}
	
	
	{% if printer.idle_timeout.state|upper == "IDLE" or idle_state %}
	SET_GCODE_VARIABLE MACRO=RESUME VARIABLE=idle_state VALUE=False
	{% if last_extruder_temp.restore %}
	
	RESPOND TYPE=echo MSG='{"Restoring \"%s\" temperature to %3.1f\u00B0C, this may take some time" % (printer.toolhead.extruder, last_extruder_temp.temp) }'
	M109 S{last_extruder_temp.temp}
	{% set do_resume = True %}
	{% elif can_extrude %}
	{% set do_resume = True %}
	{% else %}
	RESPOND TYPE=error MSG='{"Resume aborted !!! \"%s\" not hot enough, please heat up again and press RESUME" % printer.toolhead.extruder}'
	{% set _d = prompt_txt.append("\"%s\" not hot enough, please heat up again and press RESUME" % printer.toolhead.extruder) %}
	{% endif %}
	
	{% elif can_extrude %}
	{% set do_resume = True %}
	{% else %}
	RESPOND TYPE=error MSG='{"Resume aborted !!! \"%s\" not hot enough, please heat up again and press RESUME" % printer.toolhead.extruder}'
	{% set _d = prompt_txt.append("\"%s\" not hot enough, please heat up again and press RESUME" % printer.toolhead.extruder) %}
	{% endif %}
	{% if runout_resume %}
	{% if do_resume %}
	{% if restore_idle_timeout > 0 %} SET_IDLE_TIMEOUT TIMEOUT={restore_idle_timeout} {% endif %}
	{client.user_resume_macro|default("")}
	_CLIENT_EXTRUDE
	RESUME_BASE VELOCITY={params.VELOCITY|default(sp_move)}
	{% endif %}
	{% else %}
	RESPOND TYPE=error MSG='{"Resume aborted !!! \"%s\" detects no filament, please load filament and press RESUME" % (client.runout_sensor.split(" "))[1]}'
	{% set _d = prompt_txt.append("\"%s\" detects no filament, please load filament and press RESUME" % (client.runout_sensor.split(" "))[1]) %}
	{% endif %}
	
	{% if not (runout_resume and do_resume) %}
	RESPOND TYPE=command MSG="action:prompt_begin RESUME aborted !!!"
	{% for element in prompt_txt %}
	RESPOND TYPE=command MSG='{"action:prompt_text %s" % element}'
	{% endfor %}
	RESPOND TYPE=command MSG="action:prompt_footer_button Ok|RESPOND TYPE=command MSG=action:prompt_end|info"
	RESPOND TYPE=command MSG="action:prompt_show"
	{% endif %}

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[tmc5160 extruder]
cs_pin = PA10
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 0.65
sense_resistor = 0.075
stealthchop_threshold = 0

[extruder]
rotation_distance = 5.7
full_steps_per_rotation = 200
sensor_type = PT1000
min_temp = 0
max_temp = 330
filament_diameter = 1.750
dir_pin = !PB6
step_pin = PG15
enable_pin = !PG14
heater_pin = PF6
sensor_pin = PB1
microsteps = 16
nozzle_diameter = 0.600
pressure_advance = 0.015
pressure_advance_smooth_time = 0.02
max_extrude_only_distance = 101
control = pid
pid_kp = 22.354
pid_ki = 1.552
pid_kd = 80.473

[tmc5160 stepper_x]
cs_pin = PD6
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
diag1_pin = PC15
run_current = 2.00
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_x]
dir_pin = !PC13
step_pin = PC14
enable_pin = !PE6
endstop_pin = PC15
microsteps = 16
rotation_distance = 40
position_endstop = -6
position_min = -6
position_max = 330
homing_speed = 20
full_steps_per_rotation = 200
homing_retract_dist = 0
homing_positive_dir = false
step_pulse_duration = 0.000001

[tmc5160 stepper_x1]
cs_pin = PD5
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2.00
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_x1]
dir_pin = !PE4
step_pin = PE5
enable_pin = !PE3
microsteps = 16
rotation_distance = 40
full_steps_per_rotation = 200
step_pulse_duration = 0.000001

[tmc5160 stepper_y]
cs_pin = PD4
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_y]
dir_pin = !PE1
step_pin = PE2
enable_pin = !PE0
endstop_pin = PF0
microsteps = 16
rotation_distance = 40
position_endstop = 0
position_min = 0
position_max = 315
homing_speed = 20
full_steps_per_rotation = 200
homing_retract_dist = 0
homing_positive_dir = false
step_pulse_duration = 0.000001

[tmc5160 stepper_y1]
cs_pin = PD3
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_y1]
dir_pin = !PB8
step_pin = PB9
enable_pin = !PB7
microsteps = 16
rotation_distance = 40
full_steps_per_rotation = 200
step_pulse_duration = 0.000001

[tmc5160 stepper_z]
cs_pin = PD2
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 1
sense_resistor = 0.075
stealthchop_threshold = 0

[stepper_z]
dir_pin = !PG10
step_pin = PG9
enable_pin = !PG13
endstop_pin = probe:z_virtual_endstop
microsteps = 16
rotation_distance = 8
position_min = -20
position_max = 400
full_steps_per_rotation = 200
homing_retract_dist = 5.0
homing_positive_dir = false
homing_speed = 3
second_homing_speed = 1
step_pulse_duration = 0.000004

[tmc5160 stepper_z1]
cs_pin = PA15
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 1
sense_resistor = 0.075
stealthchop_threshold = 0

[stepper_z1]
dir_pin = !PD7
step_pin = PG11
enable_pin = !PG12
microsteps = 16
rotation_distance = 8

[safe_z_home]
home_xy_position = 165, 165
z_hop = 10

[z_tilt]
z_positions = 
	-80,  -20
	350, -20
points = 
	15, 150
	275, 150
speed = 50
horizontal_move_z = 10
retries = 30
retry_tolerance = 0.1

[input_shaper]
shaper_type_x = zv
shaper_freq_x = 120.6
shaper_type_y = zv
shaper_freq_y = 76.6

[cartographer]
serial = /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00
speed = 40.
lift_speed = 5.
backlash_comp = 0.5
x_offset = 0.
y_offset = 21.1
trigger_distance = 2.
trigger_dive_threshold = 1.5
trigger_hysteresis = 0.006
cal_nozzle_z = 0.1
cal_floor = 0.1
cal_ceil = 5.
cal_speed = 1.0
cal_move_speed = 10.
default_model_name = default
mesh_main_direction = x
mesh_cluster_size = 1
mesh_runs = 2

[printer]
kinematics = corexy
max_velocity = 3000
max_accel = 20000
max_z_velocity = 20
max_z_accel = 15
square_corner_velocity = 10

[exclude_object]

[gcode_arcs]
resolution = 0.05

[idle_timeout]
gcode = 
	{% if not printer.pause_resume.is_paused %}
	TURN_OFF_HEATERS
	M84
	{% endif %}

[save_variables]
filename = vars.cfg

[mcu]
serial = /dev/serial/by-id/usb-Klipper_stm32h723xx_4C0023001551313338343730-if00

[bed_mesh default]
version = 1
points = 
	-0.215000, -0.210000, -0.190000, -0.185000, -0.170000, -0.145000, -0.135000, -0.120000, -0.105000, -0.070000, -0.055000, -0.035000, 0.000000, 0.010000, 0.025000, 0.050000, 0.080000, 0.105000, 0.130000, 0.135000, 0.150000, 0.155000, 0.165000, 0.190000, 0.205000
	-0.160000, -0.155000, -0.160000, -0.150000, -0.130000, -0.110000, -0.105000, -0.085000, -0.055000, -0.035000, -0.025000, 0.000000, 0.025000, 0.055000, 0.075000, 0.100000, 0.110000, 0.130000, 0.160000, 0.170000, 0.190000, 0.190000, 0.205000, 0.205000, 0.220000
	-0.160000, -0.150000, -0.140000, -0.135000, -0.115000, -0.105000, -0.090000, -0.070000, -0.040000, -0.025000, -0.010000, 0.015000, 0.030000, 0.045000, 0.080000, 0.100000, 0.115000, 0.135000, 0.160000, 0.165000, 0.180000, 0.185000, 0.190000, 0.220000, 0.235000
	-0.120000, -0.115000, -0.115000, -0.100000, -0.080000, -0.070000, -0.065000, -0.040000, -0.015000, 0.010000, 0.030000, 0.050000, 0.065000, 0.090000, 0.110000, 0.130000, 0.145000, 0.175000, 0.195000, 0.195000, 0.195000, 0.205000, 0.210000, 0.235000, 0.240000
	-0.075000, -0.065000, -0.055000, -0.045000, -0.040000, -0.020000, -0.005000, 0.015000, 0.035000, 0.065000, 0.075000, 0.090000, 0.105000, 0.115000, 0.140000, 0.170000, 0.175000, 0.190000, 0.205000, 0.205000, 0.205000, 0.210000, 0.215000, 0.240000, 0.240000
	-0.045000, -0.050000, -0.055000, -0.045000, -0.015000, -0.005000, -0.005000, 0.020000, 0.060000, 0.065000, 0.075000, 0.100000, 0.115000, 0.125000, 0.135000, 0.170000, 0.175000, 0.175000, 0.205000, 0.205000, 0.205000, 0.205000, 0.210000, 0.220000, 0.225000
	-0.035000, -0.030000, -0.030000, -0.020000, 0.000000, 0.015000, 0.015000, 0.035000, 0.065000, 0.085000, 0.100000, 0.110000, 0.115000, 0.130000, 0.160000, 0.170000, 0.180000, 0.180000, 0.200000, 0.200000, 0.200000, 0.205000, 0.205000, 0.220000, 0.235000
	0.005000, 0.010000, 0.015000, 0.025000, 0.035000, 0.040000, 0.055000, 0.085000, 0.095000, 0.110000, 0.115000, 0.125000, 0.140000, 0.160000, 0.175000, 0.180000, 0.190000, 0.190000, 0.225000, 0.225000, 0.225000, 0.225000, 0.230000, 0.235000, 0.250000
	0.055000, 0.065000, 0.060000, 0.065000, 0.075000, 0.090000, 0.100000, 0.110000, 0.120000, 0.130000, 0.140000, 0.155000, 0.170000, 0.180000, 0.190000, 0.195000, 0.210000, 0.220000, 0.235000, 0.235000, 0.235000, 0.235000, 0.245000, 0.250000, 0.260000
	0.100000, 0.105000, 0.110000, 0.110000, 0.120000, 0.135000, 0.145000, 0.150000, 0.155000, 0.155000, 0.170000, 0.185000, 0.190000, 0.195000, 0.195000, 0.215000, 0.230000, 0.235000, 0.245000, 0.245000, 0.245000, 0.235000, 0.245000, 0.250000, 0.260000
	0.100000, 0.115000, 0.125000, 0.130000, 0.135000, 0.145000, 0.150000, 0.155000, 0.165000, 0.175000, 0.190000, 0.200000, 0.205000, 0.205000, 0.215000, 0.225000, 0.230000, 0.245000, 0.255000, 0.240000, 0.240000, 0.240000, 0.245000, 0.250000, 0.250000
	0.155000, 0.150000, 0.150000, 0.150000, 0.160000, 0.165000, 0.165000, 0.175000, 0.175000, 0.195000, 0.200000, 0.215000, 0.205000, 0.210000, 0.215000, 0.225000, 0.235000, 0.240000, 0.245000, 0.240000, 0.240000, 0.235000, 0.220000, 0.235000, 0.240000
	0.170000, 0.165000, 0.165000, 0.170000, 0.180000, 0.190000, 0.190000, 0.185000, 0.200000, 0.205000, 0.220000, 0.230000, 0.225000, 0.225000, 0.240000, 0.245000, 0.240000, 0.250000, 0.255000, 0.245000, 0.250000, 0.245000, 0.245000, 0.240000, 0.240000
	0.210000, 0.200000, 0.195000, 0.200000, 0.210000, 0.210000, 0.210000, 0.215000, 0.215000, 0.215000, 0.235000, 0.245000, 0.235000, 0.235000, 0.245000, 0.250000, 0.240000, 0.250000, 0.250000, 0.250000, 0.255000, 0.250000, 0.235000, 0.235000, 0.240000
	0.240000, 0.250000, 0.250000, 0.245000, 0.260000, 0.260000, 0.255000, 0.255000, 0.255000, 0.250000, 0.265000, 0.265000, 0.260000, 0.255000, 0.260000, 0.255000, 0.255000, 0.270000, 0.260000, 0.255000, 0.250000, 0.255000, 0.245000, 0.250000, 0.240000
	0.270000, 0.260000, 0.255000, 0.265000, 0.265000, 0.265000, 0.265000, 0.260000, 0.260000, 0.255000, 0.265000, 0.265000, 0.265000, 0.255000, 0.255000, 0.250000, 0.255000, 0.250000, 0.250000, 0.245000, 0.245000, 0.235000, 0.230000, 0.235000, 0.240000
	0.275000, 0.280000, 0.275000, 0.275000, 0.275000, 0.275000, 0.275000, 0.275000, 0.280000, 0.280000, 0.280000, 0.270000, 0.270000, 0.270000, 0.265000, 0.265000, 0.265000, 0.270000, 0.260000, 0.255000, 0.235000, 0.235000, 0.235000, 0.240000, 0.235000
	0.335000, 0.315000, 0.305000, 0.310000, 0.305000, 0.300000, 0.295000, 0.290000, 0.300000, 0.295000, 0.290000, 0.290000, 0.280000, 0.270000, 0.270000, 0.275000, 0.275000, 0.265000, 0.250000, 0.245000, 0.235000, 0.225000, 0.225000, 0.230000, 0.235000
	0.355000, 0.350000, 0.345000, 0.325000, 0.330000, 0.325000, 0.325000, 0.325000, 0.315000, 0.310000, 0.300000, 0.290000, 0.285000, 0.290000, 0.275000, 0.275000, 0.265000, 0.265000, 0.250000, 0.245000, 0.235000, 0.225000, 0.230000, 0.225000, 0.215000
	0.395000, 0.385000, 0.380000, 0.370000, 0.365000, 0.370000, 0.360000, 0.355000, 0.345000, 0.340000, 0.330000, 0.320000, 0.310000, 0.305000, 0.300000, 0.290000, 0.275000, 0.260000, 0.255000, 0.255000, 0.250000, 0.235000, 0.230000, 0.230000, 0.230000
	0.395000, 0.390000, 0.375000, 0.375000, 0.375000, 0.370000, 0.365000, 0.360000, 0.355000, 0.335000, 0.325000, 0.315000, 0.315000, 0.300000, 0.295000, 0.280000, 0.255000, 0.260000, 0.250000, 0.240000, 0.230000, 0.235000, 0.230000, 0.205000, 0.195000
	0.405000, 0.395000, 0.395000, 0.390000, 0.380000, 0.375000, 0.370000, 0.360000, 0.355000, 0.345000, 0.325000, 0.325000, 0.310000, 0.295000, 0.290000, 0.270000, 0.250000, 0.240000, 0.235000, 0.235000, 0.230000, 0.205000, 0.195000, 0.195000, 0.195000
	0.405000, 0.395000, 0.380000, 0.375000, 0.375000, 0.370000, 0.360000, 0.345000, 0.340000, 0.330000, 0.305000, 0.300000, 0.285000, 0.270000, 0.250000, 0.235000, 0.220000, 0.215000, 0.220000, 0.205000, 0.195000, 0.175000, 0.175000, 0.170000, 0.165000
	0.405000, 0.390000, 0.395000, 0.385000, 0.365000, 0.350000, 0.345000, 0.330000, 0.320000, 0.305000, 0.290000, 0.265000, 0.260000, 0.240000, 0.225000, 0.215000, 0.205000, 0.190000, 0.180000, 0.185000, 0.165000, 0.150000, 0.145000, 0.145000, 0.145000
	0.430000, 0.425000, 0.400000, 0.395000, 0.385000, 0.370000, 0.365000, 0.340000, 0.320000, 0.305000, 0.295000, 0.270000, 0.250000, 0.235000, 0.215000, 0.215000, 0.200000, 0.190000, 0.185000, 0.165000, 0.155000, 0.145000, 0.135000, 0.130000, 0.135000
x_count = 25
y_count = 25
mesh_x_pps = 3
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 310.0
min_y = 26.43
max_y = 281.31
=======================
Extruder max_extrude_ratio=0.598682
Config error
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/klippy.py", line 175, in _connect
    self._read_config()
  File "/home/pi/klipper/klippy/klippy.py", line 145, in _read_config
    pconfig.check_unused_options(config)
  File "/home/pi/klipper/klippy/configfile.py", line 307, in check_unused_options
    raise error("Option '%s' is not valid in section '%s'"
configparser.Error: Option 'mesh_main_direction' is not valid in section 'cartographer'
webhooks client 140733882104848: New connection
webhooks client 140733882104848: Client info {'program': 'Moonraker', 'version': 'v0.8.0-308-g71b46cc'}
Attempting MCU 'mcu' reset
Attempting MCU 'cartographer' reset
Unhandled exception during post run
Traceback (most recent call last):
  File "/home/pi/klippy-env/lib/python3.11/site-packages/serial/serialposix.py", line 265, in open
    self.fd = os.open(self.portstr, os.O_RDWR | os.O_NOCTTY | os.O_NONBLOCK)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
FileNotFoundError: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/pi/klipper/klippy/klippy.py", line 234, in run
    self.send_event("klippy:firmware_restart")
  File "/home/pi/klipper/klippy/klippy.py", line 263, in send_event
    return [cb(*params) for cb in self.event_handlers.get(event, [])]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/klippy.py", line 263, in <listcomp>
    return [cb(*params) for cb in self.event_handlers.get(event, [])]
            ^^^^^^^^^^^
  File "/home/pi/klipper/klippy/mcu.py", line 915, in _firmware_restart
    self._restart_arduino()
  File "/home/pi/klipper/klippy/mcu.py", line 875, in _restart_arduino
    serialhdl.arduino_reset(self._serialport, self._reactor)
  File "/home/pi/klipper/klippy/serialhdl.py", line 379, in arduino_reset
    ser = serial.Serial(serialport, 2400, timeout=0, exclusive=True)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klippy-env/lib/python3.11/site-packages/serial/serialutil.py", line 240, in __init__
    self.open()
  File "/home/pi/klippy-env/lib/python3.11/site-packages/serial/serialposix.py", line 268, in open
    raise SerialException(msg.errno, "could not open port {}: {}".format(self._port, msg))
serial.serialutil.SerialException: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
Restarting printer
Start printer at Mon Feb  5 14:57:44 2024 (1707145064.7 90980.6)
===== Config file =====
[virtual_sdcard]
path = /home/pi/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]
recover_velocity = 350

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	TURN_OFF_HEATERS
	G91
	G1 Z10 E-2 F3600
	G1 E-3 F3600
	G90
	G1 X30 Y250 F7000; home X axis
	M106 S80
	G4 P10000
	M106 S0
	M221 S100
	CANCEL_PRINT_BASE
	CLEAR_PAUSE
	
	SET_GCODE_OFFSET Z=0.0
	RESETSPEEDS
	M84
	
	BED_MESH_CLEAR

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	
	{% set x_park = printer.toolhead.axis_maximum.x|float - 5.0 %}
	{% set y_park = printer.toolhead.axis_maximum.y|float - 5.0 %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < (max_z - 2.0) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	
	SAVE_GCODE_STATE NAME=PAUSE_state
	BASE_PAUSE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	G91
	G1 E-{1} F2100
	G1 Z{10} F900
	G90
	G1 X{50} Y{0} F6000
variable_extrude = 1.0

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	G91
	G1 E{1} F2100
	RESTORE_GCODE_STATE NAME=PAUSE_state
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[tmc5160 extruder]
cs_pin = PA10
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 0.65
sense_resistor = 0.075
stealthchop_threshold = 0

[extruder]
rotation_distance = 5.7
full_steps_per_rotation = 200
sensor_type = PT1000
min_temp = 0
max_temp = 330
filament_diameter = 1.750
dir_pin = !PB6
step_pin = PG15
enable_pin = !PG14
heater_pin = PF6
sensor_pin = PB1
microsteps = 16
max_extrude_only_distance = 101
max_extrude_cross_section = 100
nozzle_diameter = 0.600
pressure_advance = 0.015
pressure_advance_smooth_time = 0.02
control = pid
pid_kp = 22.354
pid_ki = 1.552
pid_kd = 80.473

[tmc5160 stepper_x]
cs_pin = PD6
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
diag1_pin = PC15
run_current = 2.00
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_x]
dir_pin = !PC13
step_pin = PC14
enable_pin = !PE6
endstop_pin = PC15
microsteps = 16
rotation_distance = 40
position_endstop = -6
position_min = -6
position_max = 330
homing_speed = 20
full_steps_per_rotation = 200
homing_retract_dist = 0
homing_positive_dir = false
step_pulse_duration = 0.000001

[tmc5160 stepper_x1]
cs_pin = PD5
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2.00
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_x1]
dir_pin = !PE4
step_pin = PE5
enable_pin = !PE3
microsteps = 16
rotation_distance = 40
full_steps_per_rotation = 200
step_pulse_duration = 0.000001

[tmc5160 stepper_y]
cs_pin = PD4
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_y]
dir_pin = !PE1
step_pin = PE2
enable_pin = !PE0
endstop_pin = PF0
microsteps = 16
rotation_distance = 40
position_endstop = 0
position_min = 0
position_max = 315
homing_speed = 20
full_steps_per_rotation = 200
homing_retract_dist = 0
homing_positive_dir = false
step_pulse_duration = 0.000001

[tmc5160 stepper_y1]
cs_pin = PD3
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_y1]
dir_pin = !PB8
step_pin = PB9
enable_pin = !PB7
microsteps = 16
rotation_distance = 40
full_steps_per_rotation = 200
step_pulse_duration = 0.000001

[tmc5160 stepper_z]
cs_pin = PD2
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 1
sense_resistor = 0.075
stealthchop_threshold = 0

[stepper_z]
dir_pin = !PG10
step_pin = PG9
enable_pin = !PG13
endstop_pin = probe:z_virtual_endstop
microsteps = 16
rotation_distance = 8
position_min = -20
position_max = 400
full_steps_per_rotation = 200
homing_retract_dist = 5.0
homing_positive_dir = false
homing_speed = 3
second_homing_speed = 1
step_pulse_duration = 0.000004

[tmc5160 stepper_z1]
cs_pin = PA15
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 1
sense_resistor = 0.075
stealthchop_threshold = 0

[stepper_z1]
dir_pin = !PD7
step_pin = PG11
enable_pin = !PG12
microsteps = 16
rotation_distance = 8

[temperature_sensor Kraken]
sensor_type = temperature_mcu
min_temp = 10
max_temp = 100

[heater_fan hotend_fan]
pin = PA0
max_power = 1.0
kick_start_time = 0.5
heater = extruder
heater_temp = 50.0

[fan]
pin = PF12
enable_pin = PF7
hardware_pwm = false
max_power = 1
cycle_time = 0.00002
off_below = 0.012
kick_start_time = 0.01

[heater_bed]
heater_pin = PF5
sensor_pin = PC5
sensor_type = NTC 100K MGB18-104F39050L32
control = pid
pid_kp = 34.679
pid_ki = 1.492
pid_kd = 201.572
min_temp = 0
max_temp = 120
max_power = 1
pwm_cycle_time = 0.0166

[bed_screws]
screw1 = 10,0
screw2 = 10,260
screw3 = 320,260
screw4 = 320,0

[screws_tilt_adjust]
screw1 = 10, 0
screw1_name = front left screw
screw2 = 10, 260
screw2_name = rear left screw
screw3 = 300, 260
screw3_name = rear right screw
screw4 = 320, 0
screw4_name = front right screw
horizontal_move_z = 10.
speed = 250
screw_thread = CW-M3

[force_move]
enable_force_move = true

[bed_mesh]
speed = 200
horizontal_move_z = 1
mesh_min = 10, 22
mesh_max = 310, 260
mesh_pps = 3,3
probe_count = 25,25
algorithm = bicubic
relative_reference_index = 12
bicubic_tension = 0.2
fade_start = 1
fade_end = 10
split_delta_z = .025
move_check_distance = 5

[neopixel my_neopixel]
pin = PF11
chain_count = 13
color_order = GRB
initial_red = 1.0
initial_green = 1
initial_blue = 1

[gcode_macro BED_MESH]
gcode = 
	BED_MESH_CALIBRATE

[gcode_macro PA_TUNING]
gcode = 
	SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=1 ACCEL=500
	TUNING_TOWER COMMAND=SET_PRESSURE_ADVANCE PARAMETER=ADVANCE START=0 FACTOR=.005

[gcode_macro HOTEND_PID]
gcode = 
	{% set tool_temp = params.TEMPERATURE|default(220)|int %}
	{% set tool_name = printer.toolhead.extruder %}
	PID_CALIBRATE HEATER={tool_name} TARGET={tool_temp}

[gcode_macro BED_PID]
gcode = 
	{% set bed_temp = params.TEMPERATURE|default(60)|int %}
	PID_CALIBRATE HEATER=heater_bed TARGET={bed_temp}

[gcode_macro SCREWS_TILT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro DUMP_WARNINGS]
description = Debug: Print all warning messages from klipper
gcode = 
	{% set parameters = ["printer.configfile.warnings:"] %}
	{% for warning in printer.configfile.warnings %}
	{% set parameters = parameters.append("%s -> %s -> %s\n%s" % (warning.type, warning.section, warning.option, warning.message)) %}
	{% endfor %}
	{action_respond_info(parameters|join("\n"))}

[gcode_macro enable_stepper]
gcode = 
	SET_STEPPER_ENABLE STEPPER=stepper_x ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_x1 ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y1 ENABLE=1

[gcode_macro disable-steppers]
gcode = 
	m84

[gcode_macro M600]
gcode = 
	G4 P1500
	{% set X = params.X|default(50)|float %}
	{% set Y = params.Y|default(0)|float %}
	{% set Z = params.Z|default(10)|float %}
	
	SAVE_GCODE_STATE NAME=M600_state
	PAUSE
	
	G91
	G1 E-{1} F2100
	G1 Z{Z}
	G90
	G1 X{X} Y{Y} F4000
	G91
	M83
	G1 E5 F800
	G1 E-180 F2000
	M82
	RESTORE_GCODE_STATE NAME=M600_state

[gcode_macro PURGE]
gcode = 
	M83
	G1 E120 F250

[gcode_macro _UNLOAD_FILAMENT]
gcode = 
	{% set e_temp = params.TEMPERATURE|default(235)|int %}
	M118 Filament unloading!
	M117 Filament unloading!
	M82
	G92 E0
	{% if printer.extruder.can_extrude|lower != 'true' %}
	
	M118 Hotend heating!
	M109 S{e_temp} T0
	{% endif %}
	G1 E10 F{5*60}
	G0 E-5 F{60*60}
	G0 E-70 F{5*60}
	M400
	M118 Filament unload complete!
	M117 Filament unload complete!

[gcode_macro _LOAD_FILAMENT]
gcode = 
	{% set e_temp = params.TEMPERATURE|default(230)|int %}
	M109 S{e_temp}
	M83
	G1 E50 F300
	G1 E-1 F100
	M82
	M104 S0

[gcode_macro UNLOAD_PLA]
gcode = 
	_UNLOAD_FILAMENT TEMPERATURE=200

[gcode_macro LOAD_PLA]
gcode = 
	_LOAD_FILAMENT TEMPERATURE=200

[gcode_macro UNLOAD_ABS]
gcode = 
	_UNLOAD_FILAMENT TEMPERATURE=250

[gcode_macro LOAD_ABS]
gcode = 
	_LOAD_FILAMENT TEMPERATURE=250

[gcode_macro UNLOAD_PETG]
gcode = 
	_UNLOAD_FILAMENT TEMPERATURE=235

[gcode_macro LOAD_PETG]
gcode = 
	_LOAD_FILAMENT TEMPERATURE=235

[gcode_macro LOAD_FILAMENT]
gcode = 
	{% set speed = params.SPEED|default(300) %}
	{% set max_velocity = printer.configfile.settings['extruder'].max_extrude_only_velocity %}
	SAVE_GCODE_STATE NAME=load_state
	M300
	G91
	G92 E0
	G1 E350 F{max_velocity}
	G1 E25 F{speed}
	M300
	M300
	RESTORE_GCODE_STATE NAME=load_state

[gcode_macro UNLOAD_FILAMENT]
gcode = 
	{% set speed = params.SPEED|default(300) %}
	{% set max_velocity = printer.configfile.settings['extruder'].max_extrude_only_velocity %}
	SAVE_GCODE_STATE NAME=unload_state
	G91
	M300
	G92 E0
	G1 E25 F{speed}
	G1 E-420 F{max_velocity}
	M300
	M300
	RESTORE_GCODE_STATE NAME=unload_state

[gcode_macro START_PRINT]
gcode = 
	
	{% set DWELL = params.DWELL|default(00)|int %}
	{% set bedTemp = params.BED|default(70)|int %}
	{% set hotendTemp = params.HOTEND|default(210)|int %}
	SET_FAN_SPEED FAN=LED_Bar SPEED=0.5
	CLEAR_PAUSE
	RESETSPEEDS
	G21
	G90
	M83
	M140 S{bedTemp}; start heating the bed
	M104 S100
	SET_DISPLAY_TEXT MSG="Waiting for temperatures..."
	HEATSOAK DWELL={DWELL}
	G28 X Y
	ATTACH_PROBE_LOCK
	G28 Z
	SET_DISPLAY_TEXT MSG="Adjusting Z Tilt"
	Z_TILT_ADJUST
	G28 Z
	
	SET_DISPLAY_TEXT MSG="Calibrating Bed Mesh"
	BED_MESH_CLEAR
	BED_MESH_CALIBRATE
	BED_MESH_PROFILE LOAD=default
	SET_DISPLAY_TEXT MSG="Heating Extruder to temp"
	G1 X1 Y1 Z0.5 F9000
	M109 S{hotendTemp}; wait for extruder to heat up
	TR_UNLOAD_TOOLHEAD
	TR_HOME
	FIXED_PURGE_LINE
	M83
	SET_DISPLAY_TEXT MSG="Printing..."
	TR_SYNC_TO_EXTRUDER

[gcode_macro HEATSOAK]
gcode = 
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion..."
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 5% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 10% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 15% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 20% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 25% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 30% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 35% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 40% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 45% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 50% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 55% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 60% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 65% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 70% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 75% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 80% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 85% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 90% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 95% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Thermal expansion done"

[gcode_macro _CG28]
gcode = 
	{% if "xyz" not in printer.toolhead.homed_axes %}
	G28
	{% endif %}

[gcode_macro FIXED_PURGE_LINE]
gcode = 
	M83
	G92 E0
	G1 Z1 F3000
	G1 X1 Y80 Z0.3 E10  F1200
	G1 X1 Y120 E11  F1200
	G1 E-0.8 F1000
	G92 E0
	G1 Z1 F2000

[gcode_macro END_PRINT]
gcode = 
	TR_UNLOAD_TOOLHEAD
	
	TURN_OFF_HEATERS
	G91
	G1 Z10 E-2 F3600
	
	G90
	G1 X30 Y250 F7000; home X axis
	M106 S80
	G4 P10000
	M106 S0
	M221 S100
	CLEAR_PAUSE
	
	SET_GCODE_OFFSET Z=0.0
	RESETSPEEDS
	
	M84
	BED_MESH_CLEAR
	SET_FAN_SPEED FAN=LED_Bar SPEED=0
	TR_UNSYNC_TO_EXTRUDER
	UPDATE_GIT

[gcode_macro PARK]
description = Park the toolhead at the front and retract some filament if the nozzle is hot
gcode = 
	{% set E = params.E|default(1.7)|float %}
	
	{% set Px, Py = printer["gcode_macro _USER_VARIABLES"].park_position_xy|map('float') %}
	{% set park_lift_z = printer["gcode_macro _USER_VARIABLES"].park_lift_z %}
	
	{% set St = printer["gcode_macro _USER_VARIABLES"].travel_speed * 60 %}
	{% set Sz = printer["gcode_macro _USER_VARIABLES"].z_drop_speed * 60 %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	
	{% set z_safe = act_z + park_lift_z %}
	{% if z_safe > max_z %}
	{% set z_safe = max_z %}
	{% endif %}
	
	
	{% if printer.extruder.temperature > 185 %}
	G10
	{% endif %}
	G90
	G1 Z{z_safe} F{Sz}
	
	G0 X{Px} Y{Py} F{St}

[gcode_macro RESETSPEEDS]
gcode = 
	SET_VELOCITY_LIMIT VELOCITY={printer.configfile.settings.printer.max_velocity}
	SET_VELOCITY_LIMIT ACCEL={printer.configfile.settings.printer.max_accel}
	SET_VELOCITY_LIMIT ACCEL_TO_DECEL={printer.configfile.settings.printer.max_accel_to_decel}
	SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={printer.configfile.settings.printer.square_corner_velocity}

[gcode_macro DISABLEXYE]
gcode = 
	SET_STEPPER_ENABLE STEPPER=extruder ENABLE=0
	SET_STEPPER_ENABLE STEPPER=stepper_x ENABLE=0
	
	SET_STEPPER_ENABLE STEPPER=stepper_y ENABLE=0
	
	SET_STEPPER_ENABLE STEPPER=stepper_z ENABLE=1

[gcode_macro TEST_SPEED]
gcode = 
	
	{% set speed  = params.SPEED|default(printer.configfile.settings.printer.max_velocity)|int %}
	
	{% set iterations = params.ITERATIONS|default(5)|int %}
	
	{% set accel  = params.ACCEL|default(printer.configfile.settings.printer.max_accel)|int %}
	
	{% set bound = params.BOUND|default(20)|int %}
	
	{% set smallpatternsize = SMALLPATTERNSIZE|default(20)|int %}
	
	
	
	{% set x_min = 10 + bound %}
	{% set x_max = 300 - bound %}
	{% set y_min = 10 + bound %}
	{% set y_max = 300 - bound %}
	
	
	
	{% set x_center = (printer.toolhead.axis_minimum.x|float + printer.toolhead.axis_maximum.x|float ) / 2 %}
	{% set y_center = (printer.toolhead.axis_minimum.y|float + printer.toolhead.axis_maximum.y|float ) / 2 %}
	
	
	{% set x_center_min = x_center - (smallpatternsize/2) %}
	{% set x_center_max = x_center + (smallpatternsize/2) %}
	{% set y_center_min = y_center - (smallpatternsize/2) %}
	{% set y_center_max = y_center + (smallpatternsize/2) %}
	
	
	SAVE_GCODE_STATE NAME=TEST_SPEED
	
	
	{ action_respond_info("TEST_SPEED: starting %d iterations at speed %d, accel %d" % (iterations, speed, accel)) }
	
	
	M400
	G28
	
	{% if printer.configfile.settings.quad_gantry_level %}
	{% if printer.quad_gantry_level.applied == False %}
	QUAD_GANTRY_LEVEL
	G28 Z
	{% endif %}
	{% endif %}
	
	G90
	G1 X{printer.toolhead.axis_maximum.x-50} Y{printer.toolhead.axis_maximum.y-50} F{30*60}
	M400
	G28 X Y
	G0 X{300} Y{300} F{30*60}
	G4 P1000
	GET_POSITION
	
	
	G0 X{x_min} Y{y_min} Z{bound + 10} F{speed*60}
	
	
	SET_VELOCITY_LIMIT VELOCITY={speed} ACCEL={accel} ACCEL_TO_DECEL={accel / 2}
	
	{% for i in range(iterations) %}
	
	G0 X{x_min} Y{y_min} F{speed*60}
	G0 X{x_max} Y{y_max} F{speed*60}
	G0 X{x_min} Y{y_min} F{speed*60}
	G0 X{x_max} Y{y_min} F{speed*60}
	G0 X{x_min} Y{y_max} F{speed*60}
	G0 X{x_max} Y{y_min} F{speed*60}
	
	
	G0 X{x_min} Y{y_min} F{speed*60}
	G0 X{x_min} Y{y_max} F{speed*60}
	G0 X{x_max} Y{y_max} F{speed*60}
	G0 X{x_max} Y{y_min} F{speed*60}
	
	
	G0 X{x_center_min} Y{y_center_min} F{speed*60}
	G0 X{x_center_max} Y{y_center_max} F{speed*60}
	G0 X{x_center_min} Y{y_center_min} F{speed*60}
	G0 X{x_center_max} Y{y_center_min} F{speed*60}
	G0 X{x_center_min} Y{y_center_max} F{speed*60}
	G0 X{x_center_max} Y{y_center_min} F{speed*60}
	
	
	G0 X{x_center_min} Y{y_center_min} F{speed*60}
	G0 X{x_center_min} Y{y_center_max} F{speed*60}
	G0 X{x_center_max} Y{y_center_max} F{speed*60}
	G0 X{x_center_max} Y{y_center_min} F{speed*60}
	{% endfor %}
	
	
	SET_VELOCITY_LIMIT VELOCITY={printer.configfile.settings.printer.max_velocity} ACCEL={printer.configfile.settings.printer.max_accel} ACCEL_TO_DECEL={printer.configfile.settings.printer.max_accel_to_decel}
	
	
	M400
	G28
	
	G90
	G0 X{300} Y{300} F{30*60}
	G4 P1000
	GET_POSITION
	
	
	RESTORE_GCODE_STATE NAME=TEST_SPEED

[gcode_macro update_git]
gcode = 
	RUN_SHELL_COMMAND CMD=update_git_script

[gcode_shell_command update_git_script]
command = bash /home/pi/klipper-backup/script.sh
timeout = 90.0
verbose = True

[mcu tr]
serial = /dev/serial/by-id/usb-Klipper_stm32g0b1xx_290023000950415833323720-if00

[belay my_belay]
extruder_type = trad_rack
sensor_pin = ^tr:PB9
multiplier_high = 1.05
multiplier_low = 0.8
debug_level = 1

[trad_rack]
sync_to_extruder = true
selector_max_velocity = 400
selector_max_accel = 10000
lane_count = 4
lane_spacing = 17.26
servo_down_angle = 0
servo_up_angle = 130
toolhead_unload_speed = 20
extruder_load_speed = 2
toolhead_sense_speed = 20
selector_unload_length = 20
bowden_length = 865
extruder_load_length = 60
hotend_load_length = 20
toolhead_unload_length = 80
buffer_pull_speed = 100.0
pre_unload_gcode = 
	SAVE_GCODE_STATE NAME=PRE_UNLOAD_state
	{% if printer.virtual_sdcard.is_active %}
	{% set z_max = printer.toolhead.axis_maximum.z - printer.gcode_move.homing_origin.z %}
	{% set z_lift = printer["gcode_macro TR_Variables"].z_lift|float %}
	{% set x_park = printer["gcode_macro TR_Variables"].x_park|float %}
	{% set y_park = printer["gcode_macro TR_Variables"].y_park|float %}
	{% set do_x_park = printer["gcode_macro TR_Variables"].do_x_park %}
	{% set do_y_park = printer["gcode_macro TR_Variables"].do_y_park %}
	{% set st = printer["gcode_macro TR_Variables"].travel_speed * 60 %}
	{% set shape_tip = printer["gcode_macro TR_Variables"].shape_tip %}
	{% set use_wiper = printer["gcode_macro TR_Variables"].use_wiper %}
	{% set x = printer.gcode_move.gcode_position.x %}
	{% set y = printer.gcode_move.gcode_position.y %}
	{% set z = printer.gcode_move.gcode_position.z %}
	{% set z_park = [z + z_lift, z_max]|min %}
	
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=x VALUE={x}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=y VALUE={y}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=z VALUE={z}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=saved_pos VALUE={True}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=z_park VALUE={z_park}
	
	
	G90
	G1 Z{z_park}
	
	
	{% if use_wiper %}
	Go_To_Purge_Location
	
	
	{% else %}
	G90
	{% if do_x_park %}
	{% set x = x_park %}
	{% endif %}
	{% if do_y_park %}
	{% set y = y_park %}
	{% endif %}
	G1 X{x} Y{y} F{st}
	{% endif %}
	
	
	{% if shape_tip %}
	Shape_Tip
	{% endif %}
	{% else %}
	
	{% if use_wiper %}
	Go_To_Purge_Location
	{% endif %}
	
	
	Shape_Tip
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRE_UNLOAD_state
post_load_gcode = 
	SAVE_GCODE_STATE NAME=POST_LOAD_state
	{% set use_wiper = printer["gcode_macro TR_Variables"].use_wiper %}
	{% if printer.virtual_sdcard.is_active %}
	{% set st = printer["gcode_macro TR_Variables"].travel_speed * 60 %}
	{% set take_frame = printer["gcode_macro TR_Variables"].take_frame %}
	{% set x = printer["gcode_macro TR_Variables"].x %}
	{% set y = printer["gcode_macro TR_Variables"].y %}
	{% set z = printer["gcode_macro TR_Variables"].z %}
	{% set saved_pos = printer["gcode_macro TR_Variables"].saved_pos %}
	{% set z_park = printer["gcode_macro TR_Variables"].z_park %}
	
	
	{% if take_frame %}
	TIMELAPSE_TAKE_FRAME
	{% endif %}
	
	
	{% if use_wiper %}
	Home_and_Wipe_Nozzle
	{% endif %}
	
	
	{% if saved_pos %}
	G90
	G1 Z{z_park}
	G1 X{x} Y{y} F{st}
	G1 Z{z}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=saved_pos VALUE={False}
	{% endif %}
	
	Restore_Pressure_Advance
	{% elif use_wiper %}
	Home_and_Wipe_Nozzle
	{% endif %}
	RESTORE_GCODE_STATE NAME=POST_LOAD_state

[stepper_tr_selector]
step_pin = tr:PB15
dir_pin = !tr:PB14
enable_pin = !tr:PA8
rotation_distance = 40
microsteps = 16
full_steps_per_rotation = 400
endstop_pin = ^tr:PA3
position_min = 0.0
position_endstop = 0
position_max = 158
homing_speed = 30

[stepper_tr_fil_driver]
step_pin = tr:PD2
dir_pin = tr:PB13
enable_pin = !tr:PD1
rotation_distance = 22.67895
gear_ratio = 50:17
microsteps = 16
full_steps_per_rotation = 400
endstop_pin = ^tr:PA4
position_min = -5000
position_endstop = 0
position_max = 5000
homing_positive_dir = False

[tmc2209 stepper_tr_selector]
uart_pin = tr:PA10
interpolate = True
run_current = 1.3
sense_resistor = 0.110

[tmc2209 stepper_tr_fil_driver]
uart_pin = tr:PC7
interpolate = False
run_current = 1.3
sense_resistor = 0.110

[servo tr_servo]
pin = tr:PA0
maximum_servo_angle = 131
minimum_pulse_width = 0.000700
maximum_pulse_width = 0.002200

[gcode_macro ACTIVATE_EXTRUDER]
rename_existing = ACTIVATE_EXTRUDER.1
gcode = 
	{% set EXTRUDER = params.EXTRUDER|default('extruder')|lower|replace('extruder', '') %}
	{% if EXTRUDER == '' %}
	{% set EXTRUDER = '0' %}
	{% endif %}
	TR_LOAD_TOOLHEAD LANE={EXTRUDER}

[gcode_macro TR_Variables]
description = Variables for use with Trad Rack pre unload and post load gcode
variable_z_lift = 0.1
variable_x_park = 0.0
variable_y_park = 175.0
variable_do_x_park = False
variable_do_y_park = False
variable_travel_speed = 300
variable_shape_tip = False
variable_take_frame = False
variable_use_wiper = False
variable_x = 0
variable_y = 0
variable_z = 0
variable_saved_pos = False
variable_z_park = 0
gcode = 

[gcode_macro Shape_Tip]
description = Perform tip-shaping, retraction, and cooling moves
gcode = 
	SAVE_GCODE_STATE NAME=Shape_Tip_state
	Save_Pressure_Advance
	
	Slicer_Unload
	
	
	Restore_Pressure_Advance
	RESTORE_GCODE_STATE NAME=Shape_Tip_state

[gcode_macro Set_Slicer_Unload_Preset]
description = Apply a preset of values to use for the Slicer_Unload macro
variable_asa_ss = {
	"filament_ramming_parameters": "120 110 5.32258 5.45161 5.67742 6 6.48387 7.12903 7.90323 8.70968 9.3871 9.83871 10.0968 10.2258| 0.05 5.30967 0.45 5.50967 0.95 6.1871 1.45 7.39677 1.95 9.05484 2.45 10 2.95 10.3098 3.45 13.0839 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": True}
variable_pla_ss = {
	"filament_ramming_parameters": "130 120 2.70968 2.93548 3.32258 3.83871 4.58065 5.54839 6.51613 7.35484 7.93548 8.16129| 0.05 2.66451 0.45 3.05805 0.95 4.05807 1.45 5.97742 1.95 7.69999 2.45 8.1936 2.95 11.342 3.45 11.4065 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": True}
variable_asa_ps = {
	"filament_ramming_parameters": "120 110 5.32258 5.45161 5.67742 6 6.48387 7.12903 7.90323 8.70968 9.3871 9.83871 10.0968 10.2258| 0.05 5.30967 0.45 5.50967 0.95 6.1871 1.45 7.39677 1.95 9.05484 2.45 10 2.95 10.3098 3.45 13.0839 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": False}
variable_pla_ps = {
	"filament_ramming_parameters": "130 120 2.70968 2.93548 3.32258 3.83871 4.58065 5.54839 6.51613 7.35484 7.93548 8.16129| 0.05 2.66451 0.45 3.05805 0.95 4.05807 1.45 5.97742 1.95 7.69999 2.45 8.1936 2.95 11.342 3.45 11.4065 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": False}
gcode = 
	{% set preset_name = params.PRESET|lower %}
	{% if preset_name in printer['gcode_macro Set_Slicer_Unload_Preset'] %}
	{% set preset = printer['gcode_macro Set_Slicer_Unload_Preset'].preset_name %}
	{% for key in preset %}
	SET_GCODE_VARIABLE MACRO=Slicer_Unload VARIABLE={key} VALUE={preset[key]}
	{% endfor %}
	{% else %}
	{ action_raise_error("Preset \"%s\" does not exist" % preset_name) }
	{% endif %}

[gcode_macro Slicer_Unload]
description = Mimic ramming and unload behavior of PrusaSlicer or SuperSlicer
variable_cooling_tube_length = 14
variable_cooling_tube_retraction = 30
variable_filament_cooling_final_speed = 30
variable_filament_cooling_initial_speed = 20
variable_filament_cooling_moves = 4
variable_filament_diameter = 1.75
variable_filament_unloading_speed = 90
variable_filament_unloading_speed_start = 100
variable_filament_toolchange_delay = 0
variable_filament_ramming_parameters = "120 110 5.32258 5.45161 5.67742 6 6.48387 7.12903 7.90323 8.70968 9.3871 9.83871 10.0968 10.2258| 0.05 5.30967 0.45 5.50967 0.95 6.1871 1.45 7.39677 1.95 9.05484 2.45 10 2.95 10.3098 3.45 13.0839 3.95 7.6 4.45 7.6 4.95 7.6"
variable_filament_enable_toolchange_temp = False
variable_filament_toolchange_temp = 200
variable_filament_use_fast_skinnydip = False
variable_filament_enable_toolchange_part_fan = False
variable_filament_toolchange_part_fan_speed = 50
variable_filament_use_skinnydip = True
variable_filament_skinnydip_distance = 24
variable_filament_melt_zone_pause = 0
variable_filament_cooling_zone_pause = 0
variable_filament_dip_insertion_speed = 33
variable_filament_dip_extraction_speed = 70
variable_superslicer = False
variable_do_ramming = False
variable_do_unload = True
gcode = 
	{% set NEW_TEMPERATURE = params.NEW_TEMPERATURE|default(0)|float %}
	{% set prev_temp_target = printer.extruder.target %}
	
	SAVE_GCODE_STATE NAME=Slicer_Unload_state
	Save_Pressure_Advance
	
	M83
	M220 S100
	SET_PRESSURE_ADVANCE ADVANCE=0
	
	
	{% if do_ramming %}
	
	{% set ramming_speed = (filament_ramming_parameters.split('|')[0]).split(' ') %}
	
	
	{% set filament_area = 3.1415 * (filament_diameter / 2) ** 2 %}
	
	
	{% for i in range(2, ramming_speed|length) %}
	
	{% set f = ramming_speed[i]|float / filament_area %}
	
	
	{% set e = f * 0.25 %}
	
	
	G1 E{e} F{f * 60}
	{% endfor %}
	{% endif %}
	
	
	{% if do_unload %}
	
	{% if superslicer and filament_enable_toolchange_temp and not filament_use_fast_skinnydip %}
	_Wait_for_Toolchange_Temp
	{% endif %}
	
	
	{% set total_retraction_distance = cooling_tube_retraction + cooling_tube_length / 2 - 15 %}
	G1 E-15 F{filament_unloading_speed_start * 60}
	G1 E-{0.70 * total_retraction_distance} F{1.0 * filament_unloading_speed * 60}
	G1 E-{0.20 * total_retraction_distance} F{0.5 * filament_unloading_speed * 60}
	G1 E-{0.10 * total_retraction_distance} F{0.3 * filament_unloading_speed * 60}
	
	
	{% if not superslicer or not filament_enable_toolchange_temp %}
	{% if NEW_TEMPERATURE != 0 and (NEW_TEMPERATURE != prev_temp_target) %}
	M104 S{NEW_TEMPERATURE}
	{% endif %}
	
	
	{% elif superslicer and filament_enable_toolchange_temp and not filament_use_fast_skinnydip %}
	{% if NEW_TEMPERATURE != 0 %}
	M104 S{NEW_TEMPERATURE}
	{% else %}
	M104 S{prev_temp_target}
	{% endif %}
	{% endif %}
	
	
	{% set speed_inc = (filament_cooling_final_speed - filament_cooling_initial_speed) / (2 * filament_cooling_moves - 1) %}
	{% for i in range(filament_cooling_moves) %}
	{% set speed = filament_cooling_initial_speed + speed_inc * 2 * i %}
	G1 E{cooling_tube_length} F{speed * 60}
	{% set speed = speed + speed_inc %}
	G1 E-{cooling_tube_length} F{speed * 60}
	{% endfor %}
	
	
	{% if superslicer %}
	
	{% if filament_enable_toolchange_temp and filament_use_fast_skinnydip %}
	_Wait_for_Toolchange_Temp
	{% endif %}
	
	
	{% if filament_use_skinnydip %}
	G1 E{filament_skinnydip_distance} F{filament_dip_insertion_speed * 60}
	G4 P{filament_melt_zone_pause}
	G1 E-{filament_skinnydip_distance} F{filament_dip_extraction_speed * 60}
	G4 P{filament_cooling_zone_pause}
	{% endif %}
	
	
	{% if filament_enable_toolchange_temp and filament_use_fast_skinnydip %}
	{% if NEW_TEMPERATURE != 0 %}
	M109 S{NEW_TEMPERATURE}
	{% else %}
	M109 S{prev_temp_target}
	{% endif %}
	{% elif filament_enable_toolchange_temp and filament_use_fast_skinnydip %}
	{% if NEW_TEMPERATURE != 0 and (NEW_TEMPERATURE != prev_temp_target) %}
	M109 S{NEW_TEMPERATURE}
	{% endif %}
	{% endif %}
	{% endif %}
	
	
	G4 P{filament_toolchange_delay}
	
	
	
	{% endif %}
	
	Restore_Pressure_Advance
	RESTORE_GCODE_STATE NAME=Slicer_Unload_state

[gcode_macro _Wait_for_Toolchange_Temp]
description = Helper function for Slicer_Unload
gcode = 
	{% set tc_temp = printer["gcode_macro Slicer_Unload"].filament_toolchange_temp %}
	{% set fan_on = printer["gcode_macro Slicer_Unload"].filament_enable_toolchange_part_fan %}
	{% set fan_speed = printer["gcode_macro Slicer_Unload"].filament_toolchange_part_fan_speed %}
	
	{% set prev_fan_speed = printer.fan.speed %}
	{% if fan_on %}
	M106 S{(fan_speed / 100.0 * 255)|int}
	{% endif %}
	M109 S{filament_toolchange_temp}
	{% if fan_on %}
	M106 S{(prev_fan_speed * 255)|int}
	{% endif %}

[gcode_macro Home_and_Wipe_Nozzle]
description = Home x and y if needed, then wipe the nozzle
gcode = 
	
	{% if not 'xy' in printer.toolhead.homed_axes %}
	G28 X Y
	{% endif %}
	
	
	Wipe_Nozzle

[gcode_macro Save_Pressure_Advance]
description = Save the current pressure advance value
variable_pa = -1
gcode = 
	
	{% set pa = printer.extruder.pressure_advance %}
	{% if pa > 0 %}
	SET_GCODE_VARIABLE MACRO=Save_Pressure_Advance VARIABLE=pa VALUE={pa}
	{% endif %}

[gcode_macro Restore_Pressure_Advance]
description = Restore saved pressure advance value
gcode = 
	
	{% if not (printer["gcode_macro Save_Pressure_Advance"].pa == -1) %}
	SET_PRESSURE_ADVANCE ADVANCE={printer["gcode_macro Save_Pressure_Advance"].pa}
	{% endif %}

[safe_z_home]
home_xy_position = 165, 165
z_hop = 10

[z_tilt]
z_positions = 
	-80,  -20
	350, -20
points = 
	15, 150
	275, 150
speed = 50
horizontal_move_z = 10
retries = 30
retry_tolerance = 0.1

[input_shaper]
shaper_type_x = zv
shaper_freq_x = 120.6
shaper_type_y = zv
shaper_freq_y = 76.6

[cartographer]
serial = /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00
speed = 40.
lift_speed = 5.
backlash_comp = 0.5
x_offset = 0.
y_offset = 21.1
trigger_distance = 2.
trigger_dive_threshold = 1.5
trigger_hysteresis = 0.006
cal_nozzle_z = 0.1
cal_floor = 0.1
cal_ceil = 5.
cal_speed = 1.0
cal_move_speed = 10.
default_model_name = default
mesh_main_direction = X
mesh_cluster_size = 1
mesh_runs = 2

[printer]
kinematics = corexy
max_velocity = 3000
max_accel = 20000
max_z_velocity = 20
max_z_accel = 15
square_corner_velocity = 10

[exclude_object]

[gcode_arcs]
resolution = 0.05

[idle_timeout]
gcode = 
	{% if not printer.pause_resume.is_paused %}
	TURN_OFF_HEATERS
	M84
	{% endif %}

[save_variables]
filename = vars.cfg

[mcu]
serial = /dev/serial/by-id/usb-Klipper_stm32h723xx_4C0023001551313338343730-if00

[bed_mesh default]
version = 1
points = 
	-0.215000, -0.210000, -0.190000, -0.185000, -0.170000, -0.145000, -0.135000, -0.120000, -0.105000, -0.070000, -0.055000, -0.035000, 0.000000, 0.010000, 0.025000, 0.050000, 0.080000, 0.105000, 0.130000, 0.135000, 0.150000, 0.155000, 0.165000, 0.190000, 0.205000
	-0.160000, -0.155000, -0.160000, -0.150000, -0.130000, -0.110000, -0.105000, -0.085000, -0.055000, -0.035000, -0.025000, 0.000000, 0.025000, 0.055000, 0.075000, 0.100000, 0.110000, 0.130000, 0.160000, 0.170000, 0.190000, 0.190000, 0.205000, 0.205000, 0.220000
	-0.160000, -0.150000, -0.140000, -0.135000, -0.115000, -0.105000, -0.090000, -0.070000, -0.040000, -0.025000, -0.010000, 0.015000, 0.030000, 0.045000, 0.080000, 0.100000, 0.115000, 0.135000, 0.160000, 0.165000, 0.180000, 0.185000, 0.190000, 0.220000, 0.235000
	-0.120000, -0.115000, -0.115000, -0.100000, -0.080000, -0.070000, -0.065000, -0.040000, -0.015000, 0.010000, 0.030000, 0.050000, 0.065000, 0.090000, 0.110000, 0.130000, 0.145000, 0.175000, 0.195000, 0.195000, 0.195000, 0.205000, 0.210000, 0.235000, 0.240000
	-0.075000, -0.065000, -0.055000, -0.045000, -0.040000, -0.020000, -0.005000, 0.015000, 0.035000, 0.065000, 0.075000, 0.090000, 0.105000, 0.115000, 0.140000, 0.170000, 0.175000, 0.190000, 0.205000, 0.205000, 0.205000, 0.210000, 0.215000, 0.240000, 0.240000
	-0.045000, -0.050000, -0.055000, -0.045000, -0.015000, -0.005000, -0.005000, 0.020000, 0.060000, 0.065000, 0.075000, 0.100000, 0.115000, 0.125000, 0.135000, 0.170000, 0.175000, 0.175000, 0.205000, 0.205000, 0.205000, 0.205000, 0.210000, 0.220000, 0.225000
	-0.035000, -0.030000, -0.030000, -0.020000, 0.000000, 0.015000, 0.015000, 0.035000, 0.065000, 0.085000, 0.100000, 0.110000, 0.115000, 0.130000, 0.160000, 0.170000, 0.180000, 0.180000, 0.200000, 0.200000, 0.200000, 0.205000, 0.205000, 0.220000, 0.235000
	0.005000, 0.010000, 0.015000, 0.025000, 0.035000, 0.040000, 0.055000, 0.085000, 0.095000, 0.110000, 0.115000, 0.125000, 0.140000, 0.160000, 0.175000, 0.180000, 0.190000, 0.190000, 0.225000, 0.225000, 0.225000, 0.225000, 0.230000, 0.235000, 0.250000
	0.055000, 0.065000, 0.060000, 0.065000, 0.075000, 0.090000, 0.100000, 0.110000, 0.120000, 0.130000, 0.140000, 0.155000, 0.170000, 0.180000, 0.190000, 0.195000, 0.210000, 0.220000, 0.235000, 0.235000, 0.235000, 0.235000, 0.245000, 0.250000, 0.260000
	0.100000, 0.105000, 0.110000, 0.110000, 0.120000, 0.135000, 0.145000, 0.150000, 0.155000, 0.155000, 0.170000, 0.185000, 0.190000, 0.195000, 0.195000, 0.215000, 0.230000, 0.235000, 0.245000, 0.245000, 0.245000, 0.235000, 0.245000, 0.250000, 0.260000
	0.100000, 0.115000, 0.125000, 0.130000, 0.135000, 0.145000, 0.150000, 0.155000, 0.165000, 0.175000, 0.190000, 0.200000, 0.205000, 0.205000, 0.215000, 0.225000, 0.230000, 0.245000, 0.255000, 0.240000, 0.240000, 0.240000, 0.245000, 0.250000, 0.250000
	0.155000, 0.150000, 0.150000, 0.150000, 0.160000, 0.165000, 0.165000, 0.175000, 0.175000, 0.195000, 0.200000, 0.215000, 0.205000, 0.210000, 0.215000, 0.225000, 0.235000, 0.240000, 0.245000, 0.240000, 0.240000, 0.235000, 0.220000, 0.235000, 0.240000
	0.170000, 0.165000, 0.165000, 0.170000, 0.180000, 0.190000, 0.190000, 0.185000, 0.200000, 0.205000, 0.220000, 0.230000, 0.225000, 0.225000, 0.240000, 0.245000, 0.240000, 0.250000, 0.255000, 0.245000, 0.250000, 0.245000, 0.245000, 0.240000, 0.240000
	0.210000, 0.200000, 0.195000, 0.200000, 0.210000, 0.210000, 0.210000, 0.215000, 0.215000, 0.215000, 0.235000, 0.245000, 0.235000, 0.235000, 0.245000, 0.250000, 0.240000, 0.250000, 0.250000, 0.250000, 0.255000, 0.250000, 0.235000, 0.235000, 0.240000
	0.240000, 0.250000, 0.250000, 0.245000, 0.260000, 0.260000, 0.255000, 0.255000, 0.255000, 0.250000, 0.265000, 0.265000, 0.260000, 0.255000, 0.260000, 0.255000, 0.255000, 0.270000, 0.260000, 0.255000, 0.250000, 0.255000, 0.245000, 0.250000, 0.240000
	0.270000, 0.260000, 0.255000, 0.265000, 0.265000, 0.265000, 0.265000, 0.260000, 0.260000, 0.255000, 0.265000, 0.265000, 0.265000, 0.255000, 0.255000, 0.250000, 0.255000, 0.250000, 0.250000, 0.245000, 0.245000, 0.235000, 0.230000, 0.235000, 0.240000
	0.275000, 0.280000, 0.275000, 0.275000, 0.275000, 0.275000, 0.275000, 0.275000, 0.280000, 0.280000, 0.280000, 0.270000, 0.270000, 0.270000, 0.265000, 0.265000, 0.265000, 0.270000, 0.260000, 0.255000, 0.235000, 0.235000, 0.235000, 0.240000, 0.235000
	0.335000, 0.315000, 0.305000, 0.310000, 0.305000, 0.300000, 0.295000, 0.290000, 0.300000, 0.295000, 0.290000, 0.290000, 0.280000, 0.270000, 0.270000, 0.275000, 0.275000, 0.265000, 0.250000, 0.245000, 0.235000, 0.225000, 0.225000, 0.230000, 0.235000
	0.355000, 0.350000, 0.345000, 0.325000, 0.330000, 0.325000, 0.325000, 0.325000, 0.315000, 0.310000, 0.300000, 0.290000, 0.285000, 0.290000, 0.275000, 0.275000, 0.265000, 0.265000, 0.250000, 0.245000, 0.235000, 0.225000, 0.230000, 0.225000, 0.215000
	0.395000, 0.385000, 0.380000, 0.370000, 0.365000, 0.370000, 0.360000, 0.355000, 0.345000, 0.340000, 0.330000, 0.320000, 0.310000, 0.305000, 0.300000, 0.290000, 0.275000, 0.260000, 0.255000, 0.255000, 0.250000, 0.235000, 0.230000, 0.230000, 0.230000
	0.395000, 0.390000, 0.375000, 0.375000, 0.375000, 0.370000, 0.365000, 0.360000, 0.355000, 0.335000, 0.325000, 0.315000, 0.315000, 0.300000, 0.295000, 0.280000, 0.255000, 0.260000, 0.250000, 0.240000, 0.230000, 0.235000, 0.230000, 0.205000, 0.195000
	0.405000, 0.395000, 0.395000, 0.390000, 0.380000, 0.375000, 0.370000, 0.360000, 0.355000, 0.345000, 0.325000, 0.325000, 0.310000, 0.295000, 0.290000, 0.270000, 0.250000, 0.240000, 0.235000, 0.235000, 0.230000, 0.205000, 0.195000, 0.195000, 0.195000
	0.405000, 0.395000, 0.380000, 0.375000, 0.375000, 0.370000, 0.360000, 0.345000, 0.340000, 0.330000, 0.305000, 0.300000, 0.285000, 0.270000, 0.250000, 0.235000, 0.220000, 0.215000, 0.220000, 0.205000, 0.195000, 0.175000, 0.175000, 0.170000, 0.165000
	0.405000, 0.390000, 0.395000, 0.385000, 0.365000, 0.350000, 0.345000, 0.330000, 0.320000, 0.305000, 0.290000, 0.265000, 0.260000, 0.240000, 0.225000, 0.215000, 0.205000, 0.190000, 0.180000, 0.185000, 0.165000, 0.150000, 0.145000, 0.145000, 0.145000
	0.430000, 0.425000, 0.400000, 0.395000, 0.385000, 0.370000, 0.365000, 0.340000, 0.320000, 0.305000, 0.295000, 0.270000, 0.250000, 0.235000, 0.215000, 0.215000, 0.200000, 0.190000, 0.185000, 0.165000, 0.155000, 0.145000, 0.135000, 0.130000, 0.135000
x_count = 25
y_count = 25
mesh_x_pps = 3
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 310.0
min_y = 26.43
max_y = 281.31
=======================
Extruder max_extrude_ratio=41.575169
mcu 'mcu': Starting serial connect
webhooks client 140734118906000: New connection
webhooks client 140734118906000: Client info {'program': 'Moonraker', 'version': 'v0.8.0-308-g71b46cc'}
Loaded MCU 'mcu' 117 commands (v0.12.0-61-gb50d6669 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1_PB6_PB7=PB6,PB7 BUS_PINS_i2c1_PB8_PB9=PB8,PB9 BUS_PINS_i2c2_PB10_PB11=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi2a=PC2,PC3,PB10 BUS_PINS_spi3a=PC11,PC12,PC10 BUS_PINS_spi4=PE13,PE14,PE12 BUS_PINS_spi5=PF8,PF9,PF7 BUS_PINS_spi5a=PH7,PF11,PH6 BUS_PINS_spi6=PG12,PG14,PG13 CLOCK_FREQ=400000000 MCU=stm32h723xx PWM_MAX=255 RESERVE_PINS_USB=PA11,PA12 RESERVE_PINS_crystal=PH0,PH1 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
mcu 'tr': Starting serial connect
Loaded MCU 'tr' 106 commands (v0.12.0-102-g9f41f53c / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'tr' config: ADC_MAX=4095 BUS_PINS_i2c1_PA9_PA10=PA9,PA10 BUS_PINS_i2c1_PB6_PB7=PB6,PB7 BUS_PINS_i2c1_PB8_PB9=PB8,PB9 BUS_PINS_i2c2_PB10_PB11=PB10,PB11 BUS_PINS_i2c2_PB13_PB14=PB13,PB14 BUS_PINS_i2c3_PB3_PB4=PB3,PB4 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi2a=PC2,PC3,PB10 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=64000000 MCU=stm32g0b1xx PWM_MAX=255 RESERVE_PINS_USB=PA11,PA12 RESERVE_PINS_crystal=PF0,PF1 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
mcu_temperature 'mcu' nominal base=-274.819277 slope=1644.578313
mcu 'cartographer': Starting serial connect
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
MCU error during connect
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/mcu.py", line 768, in _mcu_identify
    self._serial.connect_uart(self._serialport, self._baud, rts)
  File "/home/pi/klipper/klippy/serialhdl.py", line 182, in connect_uart
    self._error("Unable to connect")
  File "/home/pi/klipper/klippy/serialhdl.py", line 61, in _error
    raise error(self.warn_prefix + (msg % params))
serialhdl.error: mcu 'cartographer': Unable to connect

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/pi/klipper/klippy/klippy.py", line 176, in _connect
    self.send_event("klippy:mcu_identify")
  File "/home/pi/klipper/klippy/klippy.py", line 263, in send_event
    return [cb(*params) for cb in self.event_handlers.get(event, [])]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/klippy.py", line 263, in <listcomp>
    return [cb(*params) for cb in self.event_handlers.get(event, [])]
            ^^^^^^^^^^^
  File "/home/pi/klipper/klippy/mcu.py", line 773, in _mcu_identify
    raise error(str(e))
mcu.error: mcu 'cartographer': Unable to connect
Build file /home/pi/klipper/klippy/../.config(3424): Sun Feb  4 11:55:53 2024
========= Last MCU build config =========
CONFIG_LOW_LEVEL_OPTIONS=y
# CONFIG_MACH_AVR is not set
# CONFIG_MACH_ATSAM is not set
# CONFIG_MACH_ATSAMD is not set
# CONFIG_MACH_LPC176X is not set
CONFIG_MACH_STM32=y
# CONFIG_MACH_HC32F460 is not set
# CONFIG_MACH_RP2040 is not set
# CONFIG_MACH_PRU is not set
# CONFIG_MACH_AR100 is not set
# CONFIG_MACH_LINUX is not set
# CONFIG_MACH_SIMU is not set
CONFIG_BOARD_DIRECTORY="stm32"
CONFIG_MCU="stm32h723xx"
CONFIG_CLOCK_FREQ=400000000
CONFIG_USBSERIAL=y
CONFIG_FLASH_SIZE=0x40000
CONFIG_FLASH_BOOT_ADDRESS=0x8000000
CONFIG_RAM_START=0x20000000
CONFIG_RAM_SIZE=0x20000
CONFIG_STACK_SIZE=512
CONFIG_FLASH_APPLICATION_ADDRESS=0x8020000
CONFIG_STM32_SELECT=y
# CONFIG_MACH_STM32F103 is not set
# CONFIG_MACH_STM32F207 is not set
# CONFIG_MACH_STM32F401 is not set
# CONFIG_MACH_STM32F405 is not set
# CONFIG_MACH_STM32F407 is not set
# CONFIG_MACH_STM32F429 is not set
# CONFIG_MACH_STM32F446 is not set
# CONFIG_MACH_STM32F765 is not set
# CONFIG_MACH_STM32F031 is not set
# CONFIG_MACH_STM32F042 is not set
# CONFIG_MACH_STM32F070 is not set
# CONFIG_MACH_STM32F072 is not set
# CONFIG_MACH_STM32G070 is not set
# CONFIG_MACH_STM32G071 is not set
# CONFIG_MACH_STM32G0B0 is not set
# CONFIG_MACH_STM32G0B1 is not set
# CONFIG_MACH_STM32G431 is not set
CONFIG_MACH_STM32H723=y
# CONFIG_MACH_STM32H743 is not set
# CONFIG_MACH_STM32H750 is not set
# CONFIG_MACH_STM32L412 is not set
# CONFIG_MACH_N32G452 is not set
# CONFIG_MACH_N32G455 is not set
CONFIG_MACH_STM32H7=y
CONFIG_HAVE_STM32_USBOTG=y
CONFIG_HAVE_STM32_FDCANBUS=y
CONFIG_HAVE_STM32_USBCANBUS=y
CONFIG_STM32_DFU_ROM_ADDRESS=0x1ff09800
CONFIG_STM32_FLASH_START_20000=y
# CONFIG_STM32_FLASH_START_0000 is not set
# CONFIG_STM32_CLOCK_REF_8M is not set
# CONFIG_STM32_CLOCK_REF_12M is not set
# CONFIG_STM32_CLOCK_REF_16M is not set
# CONFIG_STM32_CLOCK_REF_20M is not set
# CONFIG_STM32_CLOCK_REF_24M is not set
CONFIG_STM32_CLOCK_REF_25M=y
# CONFIG_STM32_CLOCK_REF_INTERNAL is not set
CONFIG_CLOCK_REF_FREQ=25000000
CONFIG_STM32F0_TRIM=16
CONFIG_STM32_USB_PA11_PA12=y
# CONFIG_STM32_SERIAL_USART1 is not set
# CONFIG_STM32_SERIAL_USART1_ALT_PB7_PB6 is not set
# CONFIG_STM32_SERIAL_USART2 is not set
# CONFIG_STM32_SERIAL_USART2_ALT_PD6_PD5 is not set
# CONFIG_STM32_SERIAL_USART3 is not set
# CONFIG_STM32_SERIAL_USART3_ALT_PD9_PD8 is not set
# CONFIG_STM32_SERIAL_UART4 is not set
# CONFIG_STM32_CANBUS_PA11_PA12 is not set
# CONFIG_STM32_CANBUS_PA11_PB9 is not set
# CONFIG_STM32_MMENU_CANBUS_PB8_PB9 is not set
# CONFIG_STM32_MMENU_CANBUS_PB12_PB13 is not set
# CONFIG_STM32_MMENU_CANBUS_PD0_PD1 is not set
# CONFIG_STM32_MMENU_CANBUS_PB0_PB1 is not set
# CONFIG_STM32_MMENU_CANBUS_PD12_PD13 is not set
# CONFIG_STM32_MMENU_CANBUS_PC2_PC3 is not set
# CONFIG_STM32_USBCANBUS_PA11_PA12 is not set
CONFIG_USB=y
CONFIG_USB_VENDOR_ID=0x1d50
CONFIG_USB_DEVICE_ID=0x614e
CONFIG_USB_SERIAL_NUMBER_CHIPID=y
CONFIG_USB_SERIAL_NUMBER="12345"

#
# USB ids
#
# end of USB ids

CONFIG_WANT_GPIO_BITBANGING=y
CONFIG_WANT_DISPLAYS=y
CONFIG_WANT_SENSORS=y
CONFIG_WANT_LIS2DW=y
CONFIG_WANT_SOFTWARE_I2C=y
CONFIG_WANT_SOFTWARE_SPI=y
CONFIG_NEED_SENSOR_BULK=y
CONFIG_CANBUS_FREQUENCY=1000000
CONFIG_INITIAL_PINS=""
CONFIG_HAVE_GPIO=y
CONFIG_HAVE_GPIO_ADC=y
CONFIG_HAVE_GPIO_SPI=y
CONFIG_HAVE_GPIO_I2C=y
CONFIG_HAVE_GPIO_HARD_PWM=y
CONFIG_HAVE_STRICT_TIMING=y
CONFIG_HAVE_CHIPID=y
CONFIG_HAVE_STEPPER_BOTH_EDGE=y
CONFIG_HAVE_BOOTLOADER_REQUEST=y
CONFIG_INLINE_STEPPER_HACK=y
=======================
Build file /home/pi/klipper/klippy/../out/klipper.dict(7712): Sun Feb  4 11:56:28 2024
Last MCU build version: v0.12.0-102-g9f41f53c
Last MCU build tools: gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40
Last MCU build config: ADC_MAX=4095 BUS_PINS_i2c1_PB6_PB7=PB6,PB7 BUS_PINS_i2c1_PB8_PB9=PB8,PB9 BUS_PINS_i2c2_PB10_PB11=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi2a=PC2,PC3,PB10 BUS_PINS_spi3a=PC11,PC12,PC10 BUS_PINS_spi4=PE13,PE14,PE12 BUS_PINS_spi5=PF8,PF9,PF7 BUS_PINS_spi5a=PH7,PF11,PH6 BUS_PINS_spi6=PG12,PG14,PG13 CLOCK_FREQ=400000000 MCU=stm32h723xx PWM_MAX=255 RESERVE_PINS_USB=PA11,PA12 RESERVE_PINS_crystal=PH0,PH1 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Build file /home/pi/klipper/klippy/../out/klipper.elf(1520408): Sun Feb  4 11:56:32 2024
Attempting MCU 'mcu' reset command
b'Got EOF when reading from device'
Attempting MCU 'tr' reset command
b'Got EOF when reading from device'
Attempting MCU 'cartographer' reset
Unhandled exception during post run
Traceback (most recent call last):
  File "/home/pi/klippy-env/lib/python3.11/site-packages/serial/serialposix.py", line 265, in open
    self.fd = os.open(self.portstr, os.O_RDWR | os.O_NOCTTY | os.O_NONBLOCK)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
FileNotFoundError: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/pi/klipper/klippy/klippy.py", line 234, in run
    self.send_event("klippy:firmware_restart")
  File "/home/pi/klipper/klippy/klippy.py", line 263, in send_event
    return [cb(*params) for cb in self.event_handlers.get(event, [])]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/klippy.py", line 263, in <listcomp>
    return [cb(*params) for cb in self.event_handlers.get(event, [])]
            ^^^^^^^^^^^
  File "/home/pi/klipper/klippy/mcu.py", line 915, in _firmware_restart
    self._restart_arduino()
  File "/home/pi/klipper/klippy/mcu.py", line 875, in _restart_arduino
    serialhdl.arduino_reset(self._serialport, self._reactor)
  File "/home/pi/klipper/klippy/serialhdl.py", line 379, in arduino_reset
    ser = serial.Serial(serialport, 2400, timeout=0, exclusive=True)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klippy-env/lib/python3.11/site-packages/serial/serialutil.py", line 240, in __init__
    self.open()
  File "/home/pi/klippy-env/lib/python3.11/site-packages/serial/serialposix.py", line 268, in open
    raise SerialException(msg.errno, "could not open port {}: {}".format(self._port, msg))
serial.serialutil.SerialException: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
Restarting printer
Start printer at Mon Feb  5 15:30:21 2024 (1707147021.4 92937.2)
===== Config file =====
[virtual_sdcard]
path = /home/pi/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]
recover_velocity = 350

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	TURN_OFF_HEATERS
	G91
	G1 Z10 E-2 F3600
	G1 E-3 F3600
	G90
	G1 X30 Y250 F7000; home X axis
	M106 S80
	G4 P10000
	M106 S0
	M221 S100
	CANCEL_PRINT_BASE
	CLEAR_PAUSE
	
	SET_GCODE_OFFSET Z=0.0
	RESETSPEEDS
	M84
	
	BED_MESH_CLEAR

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	
	{% set x_park = printer.toolhead.axis_maximum.x|float - 5.0 %}
	{% set y_park = printer.toolhead.axis_maximum.y|float - 5.0 %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < (max_z - 2.0) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	
	SAVE_GCODE_STATE NAME=PAUSE_state
	BASE_PAUSE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	G91
	G1 E-{1} F2100
	G1 Z{10} F900
	G90
	G1 X{50} Y{0} F6000
variable_extrude = 1.0

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	G91
	G1 E{1} F2100
	RESTORE_GCODE_STATE NAME=PAUSE_state
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[tmc5160 extruder]
cs_pin = PA10
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 0.65
sense_resistor = 0.075
stealthchop_threshold = 0

[extruder]
rotation_distance = 5.7
full_steps_per_rotation = 200
sensor_type = PT1000
min_temp = 0
max_temp = 330
filament_diameter = 1.750
dir_pin = !PB6
step_pin = PG15
enable_pin = !PG14
heater_pin = PF6
sensor_pin = PB1
microsteps = 16
max_extrude_only_distance = 101
max_extrude_cross_section = 100
nozzle_diameter = 0.600
pressure_advance = 0.015
pressure_advance_smooth_time = 0.02
control = pid
pid_kp = 22.354
pid_ki = 1.552
pid_kd = 80.473

[tmc5160 stepper_x]
cs_pin = PD6
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
diag1_pin = PC15
run_current = 2.00
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_x]
dir_pin = !PC13
step_pin = PC14
enable_pin = !PE6
endstop_pin = PC15
microsteps = 16
rotation_distance = 40
position_endstop = -6
position_min = -6
position_max = 330
homing_speed = 20
full_steps_per_rotation = 200
homing_retract_dist = 0
homing_positive_dir = false
step_pulse_duration = 0.000001

[tmc5160 stepper_x1]
cs_pin = PD5
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2.00
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_x1]
dir_pin = !PE4
step_pin = PE5
enable_pin = !PE3
microsteps = 16
rotation_distance = 40
full_steps_per_rotation = 200
step_pulse_duration = 0.000001

[tmc5160 stepper_y]
cs_pin = PD4
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_y]
dir_pin = !PE1
step_pin = PE2
enable_pin = !PE0
endstop_pin = PF0
microsteps = 16
rotation_distance = 40
position_endstop = 0
position_min = 0
position_max = 315
homing_speed = 20
full_steps_per_rotation = 200
homing_retract_dist = 0
homing_positive_dir = false
step_pulse_duration = 0.000001

[tmc5160 stepper_y1]
cs_pin = PD3
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_y1]
dir_pin = !PB8
step_pin = PB9
enable_pin = !PB7
microsteps = 16
rotation_distance = 40
full_steps_per_rotation = 200
step_pulse_duration = 0.000001

[tmc5160 stepper_z]
cs_pin = PD2
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 1
sense_resistor = 0.075
stealthchop_threshold = 0

[stepper_z]
dir_pin = !PG10
step_pin = PG9
enable_pin = !PG13
endstop_pin = probe:z_virtual_endstop
microsteps = 16
rotation_distance = 8
position_min = -20
position_max = 400
full_steps_per_rotation = 200
homing_retract_dist = 5.0
homing_positive_dir = false
homing_speed = 3
second_homing_speed = 1
step_pulse_duration = 0.000004

[tmc5160 stepper_z1]
cs_pin = PA15
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 1
sense_resistor = 0.075
stealthchop_threshold = 0

[stepper_z1]
dir_pin = !PD7
step_pin = PG11
enable_pin = !PG12
microsteps = 16
rotation_distance = 8

[temperature_sensor Kraken]
sensor_type = temperature_mcu
min_temp = 10
max_temp = 100

[heater_fan hotend_fan]
pin = PA0
max_power = 1.0
kick_start_time = 0.5
heater = extruder
heater_temp = 50.0

[fan]
pin = PF12
enable_pin = PF7
hardware_pwm = false
max_power = 1
cycle_time = 0.00002
off_below = 0.012
kick_start_time = 0.01

[heater_bed]
heater_pin = PF5
sensor_pin = PC5
sensor_type = NTC 100K MGB18-104F39050L32
control = pid
pid_kp = 34.679
pid_ki = 1.492
pid_kd = 201.572
min_temp = 0
max_temp = 120
max_power = 1
pwm_cycle_time = 0.0166

[bed_screws]
screw1 = 10,0
screw2 = 10,260
screw3 = 320,260
screw4 = 320,0

[screws_tilt_adjust]
screw1 = 10, 0
screw1_name = front left screw
screw2 = 10, 260
screw2_name = rear left screw
screw3 = 300, 260
screw3_name = rear right screw
screw4 = 320, 0
screw4_name = front right screw
horizontal_move_z = 10.
speed = 250
screw_thread = CW-M3

[force_move]
enable_force_move = true

[bed_mesh]
speed = 200
horizontal_move_z = 1
mesh_min = 10, 22
mesh_max = 310, 260
mesh_pps = 3,3
probe_count = 25,25
algorithm = bicubic
relative_reference_index = 12
bicubic_tension = 0.2
fade_start = 1
fade_end = 10
split_delta_z = .025
move_check_distance = 5

[neopixel my_neopixel]
pin = PF11
chain_count = 13
color_order = GRB
initial_red = 1.0
initial_green = 1
initial_blue = 1

[gcode_macro BED_MESH]
gcode = 
	BED_MESH_CALIBRATE

[gcode_macro PA_TUNING]
gcode = 
	SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=1 ACCEL=500
	TUNING_TOWER COMMAND=SET_PRESSURE_ADVANCE PARAMETER=ADVANCE START=0 FACTOR=.005

[gcode_macro HOTEND_PID]
gcode = 
	{% set tool_temp = params.TEMPERATURE|default(220)|int %}
	{% set tool_name = printer.toolhead.extruder %}
	PID_CALIBRATE HEATER={tool_name} TARGET={tool_temp}

[gcode_macro BED_PID]
gcode = 
	{% set bed_temp = params.TEMPERATURE|default(60)|int %}
	PID_CALIBRATE HEATER=heater_bed TARGET={bed_temp}

[gcode_macro SCREWS_TILT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro DUMP_WARNINGS]
description = Debug: Print all warning messages from klipper
gcode = 
	{% set parameters = ["printer.configfile.warnings:"] %}
	{% for warning in printer.configfile.warnings %}
	{% set parameters = parameters.append("%s -> %s -> %s\n%s" % (warning.type, warning.section, warning.option, warning.message)) %}
	{% endfor %}
	{action_respond_info(parameters|join("\n"))}

[gcode_macro enable_stepper]
gcode = 
	SET_STEPPER_ENABLE STEPPER=stepper_x ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_x1 ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y1 ENABLE=1

[gcode_macro disable-steppers]
gcode = 
	m84

[gcode_macro M600]
gcode = 
	G4 P1500
	{% set X = params.X|default(50)|float %}
	{% set Y = params.Y|default(0)|float %}
	{% set Z = params.Z|default(10)|float %}
	
	SAVE_GCODE_STATE NAME=M600_state
	PAUSE
	
	G91
	G1 E-{1} F2100
	G1 Z{Z}
	G90
	G1 X{X} Y{Y} F4000
	G91
	M83
	G1 E5 F800
	G1 E-180 F2000
	M82
	RESTORE_GCODE_STATE NAME=M600_state

[gcode_macro PURGE]
gcode = 
	M83
	G1 E120 F250

[gcode_macro _UNLOAD_FILAMENT]
gcode = 
	{% set e_temp = params.TEMPERATURE|default(235)|int %}
	M118 Filament unloading!
	M117 Filament unloading!
	M82
	G92 E0
	{% if printer.extruder.can_extrude|lower != 'true' %}
	
	M118 Hotend heating!
	M109 S{e_temp} T0
	{% endif %}
	G1 E10 F{5*60}
	G0 E-5 F{60*60}
	G0 E-70 F{5*60}
	M400
	M118 Filament unload complete!
	M117 Filament unload complete!

[gcode_macro _LOAD_FILAMENT]
gcode = 
	{% set e_temp = params.TEMPERATURE|default(230)|int %}
	M109 S{e_temp}
	M83
	G1 E50 F300
	G1 E-1 F100
	M82
	M104 S0

[gcode_macro UNLOAD_PLA]
gcode = 
	_UNLOAD_FILAMENT TEMPERATURE=200

[gcode_macro LOAD_PLA]
gcode = 
	_LOAD_FILAMENT TEMPERATURE=200

[gcode_macro UNLOAD_ABS]
gcode = 
	_UNLOAD_FILAMENT TEMPERATURE=250

[gcode_macro LOAD_ABS]
gcode = 
	_LOAD_FILAMENT TEMPERATURE=250

[gcode_macro UNLOAD_PETG]
gcode = 
	_UNLOAD_FILAMENT TEMPERATURE=235

[gcode_macro LOAD_PETG]
gcode = 
	_LOAD_FILAMENT TEMPERATURE=235

[gcode_macro LOAD_FILAMENT]
gcode = 
	{% set speed = params.SPEED|default(300) %}
	{% set max_velocity = printer.configfile.settings['extruder'].max_extrude_only_velocity %}
	SAVE_GCODE_STATE NAME=load_state
	M300
	G91
	G92 E0
	G1 E350 F{max_velocity}
	G1 E25 F{speed}
	M300
	M300
	RESTORE_GCODE_STATE NAME=load_state

[gcode_macro UNLOAD_FILAMENT]
gcode = 
	{% set speed = params.SPEED|default(300) %}
	{% set max_velocity = printer.configfile.settings['extruder'].max_extrude_only_velocity %}
	SAVE_GCODE_STATE NAME=unload_state
	G91
	M300
	G92 E0
	G1 E25 F{speed}
	G1 E-420 F{max_velocity}
	M300
	M300
	RESTORE_GCODE_STATE NAME=unload_state

[gcode_macro START_PRINT]
gcode = 
	
	{% set DWELL = params.DWELL|default(00)|int %}
	{% set bedTemp = params.BED|default(70)|int %}
	{% set hotendTemp = params.HOTEND|default(210)|int %}
	SET_FAN_SPEED FAN=LED_Bar SPEED=0.5
	CLEAR_PAUSE
	RESETSPEEDS
	G21
	G90
	M83
	M140 S{bedTemp}; start heating the bed
	M104 S100
	SET_DISPLAY_TEXT MSG="Waiting for temperatures..."
	HEATSOAK DWELL={DWELL}
	G28 X Y
	ATTACH_PROBE_LOCK
	G28 Z
	SET_DISPLAY_TEXT MSG="Adjusting Z Tilt"
	Z_TILT_ADJUST
	G28 Z
	
	SET_DISPLAY_TEXT MSG="Calibrating Bed Mesh"
	BED_MESH_CLEAR
	BED_MESH_CALIBRATE
	BED_MESH_PROFILE LOAD=default
	SET_DISPLAY_TEXT MSG="Heating Extruder to temp"
	G1 X1 Y1 Z0.5 F9000
	M109 S{hotendTemp}; wait for extruder to heat up
	TR_UNLOAD_TOOLHEAD
	TR_HOME
	FIXED_PURGE_LINE
	M83
	SET_DISPLAY_TEXT MSG="Printing..."
	TR_SYNC_TO_EXTRUDER

[gcode_macro HEATSOAK]
gcode = 
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion..."
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 5% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 10% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 15% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 20% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 25% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 30% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 35% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 40% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 45% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 50% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 55% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 60% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 65% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 70% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 75% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 80% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 85% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 90% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 95% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Thermal expansion done"

[gcode_macro _CG28]
gcode = 
	{% if "xyz" not in printer.toolhead.homed_axes %}
	G28
	{% endif %}

[gcode_macro FIXED_PURGE_LINE]
gcode = 
	M83
	G92 E0
	G1 Z1 F3000
	G1 X1 Y80 Z0.3 E10  F1200
	G1 X1 Y120 E11  F1200
	G1 E-0.8 F1000
	G92 E0
	G1 Z1 F2000

[gcode_macro END_PRINT]
gcode = 
	TR_UNLOAD_TOOLHEAD
	
	TURN_OFF_HEATERS
	G91
	G1 Z10 E-2 F3600
	
	G90
	G1 X30 Y250 F7000; home X axis
	M106 S80
	G4 P10000
	M106 S0
	M221 S100
	CLEAR_PAUSE
	
	SET_GCODE_OFFSET Z=0.0
	RESETSPEEDS
	
	M84
	BED_MESH_CLEAR
	SET_FAN_SPEED FAN=LED_Bar SPEED=0
	TR_UNSYNC_TO_EXTRUDER
	UPDATE_GIT

[gcode_macro PARK]
description = Park the toolhead at the front and retract some filament if the nozzle is hot
gcode = 
	{% set E = params.E|default(1.7)|float %}
	
	{% set Px, Py = printer["gcode_macro _USER_VARIABLES"].park_position_xy|map('float') %}
	{% set park_lift_z = printer["gcode_macro _USER_VARIABLES"].park_lift_z %}
	
	{% set St = printer["gcode_macro _USER_VARIABLES"].travel_speed * 60 %}
	{% set Sz = printer["gcode_macro _USER_VARIABLES"].z_drop_speed * 60 %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	
	{% set z_safe = act_z + park_lift_z %}
	{% if z_safe > max_z %}
	{% set z_safe = max_z %}
	{% endif %}
	
	
	{% if printer.extruder.temperature > 185 %}
	G10
	{% endif %}
	G90
	G1 Z{z_safe} F{Sz}
	
	G0 X{Px} Y{Py} F{St}

[gcode_macro RESETSPEEDS]
gcode = 
	SET_VELOCITY_LIMIT VELOCITY={printer.configfile.settings.printer.max_velocity}
	SET_VELOCITY_LIMIT ACCEL={printer.configfile.settings.printer.max_accel}
	SET_VELOCITY_LIMIT ACCEL_TO_DECEL={printer.configfile.settings.printer.max_accel_to_decel}
	SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={printer.configfile.settings.printer.square_corner_velocity}

[gcode_macro DISABLEXYE]
gcode = 
	SET_STEPPER_ENABLE STEPPER=extruder ENABLE=0
	SET_STEPPER_ENABLE STEPPER=stepper_x ENABLE=0
	
	SET_STEPPER_ENABLE STEPPER=stepper_y ENABLE=0
	
	SET_STEPPER_ENABLE STEPPER=stepper_z ENABLE=1

[gcode_macro TEST_SPEED]
gcode = 
	
	{% set speed  = params.SPEED|default(printer.configfile.settings.printer.max_velocity)|int %}
	
	{% set iterations = params.ITERATIONS|default(5)|int %}
	
	{% set accel  = params.ACCEL|default(printer.configfile.settings.printer.max_accel)|int %}
	
	{% set bound = params.BOUND|default(20)|int %}
	
	{% set smallpatternsize = SMALLPATTERNSIZE|default(20)|int %}
	
	
	
	{% set x_min = 10 + bound %}
	{% set x_max = 300 - bound %}
	{% set y_min = 10 + bound %}
	{% set y_max = 300 - bound %}
	
	
	
	{% set x_center = (printer.toolhead.axis_minimum.x|float + printer.toolhead.axis_maximum.x|float ) / 2 %}
	{% set y_center = (printer.toolhead.axis_minimum.y|float + printer.toolhead.axis_maximum.y|float ) / 2 %}
	
	
	{% set x_center_min = x_center - (smallpatternsize/2) %}
	{% set x_center_max = x_center + (smallpatternsize/2) %}
	{% set y_center_min = y_center - (smallpatternsize/2) %}
	{% set y_center_max = y_center + (smallpatternsize/2) %}
	
	
	SAVE_GCODE_STATE NAME=TEST_SPEED
	
	
	{ action_respond_info("TEST_SPEED: starting %d iterations at speed %d, accel %d" % (iterations, speed, accel)) }
	
	
	M400
	G28
	
	{% if printer.configfile.settings.quad_gantry_level %}
	{% if printer.quad_gantry_level.applied == False %}
	QUAD_GANTRY_LEVEL
	G28 Z
	{% endif %}
	{% endif %}
	
	G90
	G1 X{printer.toolhead.axis_maximum.x-50} Y{printer.toolhead.axis_maximum.y-50} F{30*60}
	M400
	G28 X Y
	G0 X{300} Y{300} F{30*60}
	G4 P1000
	GET_POSITION
	
	
	G0 X{x_min} Y{y_min} Z{bound + 10} F{speed*60}
	
	
	SET_VELOCITY_LIMIT VELOCITY={speed} ACCEL={accel} ACCEL_TO_DECEL={accel / 2}
	
	{% for i in range(iterations) %}
	
	G0 X{x_min} Y{y_min} F{speed*60}
	G0 X{x_max} Y{y_max} F{speed*60}
	G0 X{x_min} Y{y_min} F{speed*60}
	G0 X{x_max} Y{y_min} F{speed*60}
	G0 X{x_min} Y{y_max} F{speed*60}
	G0 X{x_max} Y{y_min} F{speed*60}
	
	
	G0 X{x_min} Y{y_min} F{speed*60}
	G0 X{x_min} Y{y_max} F{speed*60}
	G0 X{x_max} Y{y_max} F{speed*60}
	G0 X{x_max} Y{y_min} F{speed*60}
	
	
	G0 X{x_center_min} Y{y_center_min} F{speed*60}
	G0 X{x_center_max} Y{y_center_max} F{speed*60}
	G0 X{x_center_min} Y{y_center_min} F{speed*60}
	G0 X{x_center_max} Y{y_center_min} F{speed*60}
	G0 X{x_center_min} Y{y_center_max} F{speed*60}
	G0 X{x_center_max} Y{y_center_min} F{speed*60}
	
	
	G0 X{x_center_min} Y{y_center_min} F{speed*60}
	G0 X{x_center_min} Y{y_center_max} F{speed*60}
	G0 X{x_center_max} Y{y_center_max} F{speed*60}
	G0 X{x_center_max} Y{y_center_min} F{speed*60}
	{% endfor %}
	
	
	SET_VELOCITY_LIMIT VELOCITY={printer.configfile.settings.printer.max_velocity} ACCEL={printer.configfile.settings.printer.max_accel} ACCEL_TO_DECEL={printer.configfile.settings.printer.max_accel_to_decel}
	
	
	M400
	G28
	
	G90
	G0 X{300} Y{300} F{30*60}
	G4 P1000
	GET_POSITION
	
	
	RESTORE_GCODE_STATE NAME=TEST_SPEED

[gcode_macro update_git]
gcode = 
	RUN_SHELL_COMMAND CMD=update_git_script

[gcode_shell_command update_git_script]
command = bash /home/pi/klipper-backup/script.sh
timeout = 90.0
verbose = True

[mcu tr]
serial = /dev/serial/by-id/usb-Klipper_stm32g0b1xx_290023000950415833323720-if00

[belay my_belay]
extruder_type = trad_rack
sensor_pin = ^tr:PB9
multiplier_high = 1.05
multiplier_low = 0.8
debug_level = 1

[trad_rack]
sync_to_extruder = true
selector_max_velocity = 400
selector_max_accel = 10000
lane_count = 4
lane_spacing = 17.26
servo_down_angle = 0
servo_up_angle = 130
toolhead_unload_speed = 20
extruder_load_speed = 2
toolhead_sense_speed = 20
selector_unload_length = 20
bowden_length = 865
extruder_load_length = 60
hotend_load_length = 20
toolhead_unload_length = 80
buffer_pull_speed = 100.0
pre_unload_gcode = 
	SAVE_GCODE_STATE NAME=PRE_UNLOAD_state
	{% if printer.virtual_sdcard.is_active %}
	{% set z_max = printer.toolhead.axis_maximum.z - printer.gcode_move.homing_origin.z %}
	{% set z_lift = printer["gcode_macro TR_Variables"].z_lift|float %}
	{% set x_park = printer["gcode_macro TR_Variables"].x_park|float %}
	{% set y_park = printer["gcode_macro TR_Variables"].y_park|float %}
	{% set do_x_park = printer["gcode_macro TR_Variables"].do_x_park %}
	{% set do_y_park = printer["gcode_macro TR_Variables"].do_y_park %}
	{% set st = printer["gcode_macro TR_Variables"].travel_speed * 60 %}
	{% set shape_tip = printer["gcode_macro TR_Variables"].shape_tip %}
	{% set use_wiper = printer["gcode_macro TR_Variables"].use_wiper %}
	{% set x = printer.gcode_move.gcode_position.x %}
	{% set y = printer.gcode_move.gcode_position.y %}
	{% set z = printer.gcode_move.gcode_position.z %}
	{% set z_park = [z + z_lift, z_max]|min %}
	
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=x VALUE={x}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=y VALUE={y}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=z VALUE={z}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=saved_pos VALUE={True}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=z_park VALUE={z_park}
	
	
	G90
	G1 Z{z_park}
	
	
	{% if use_wiper %}
	Go_To_Purge_Location
	
	
	{% else %}
	G90
	{% if do_x_park %}
	{% set x = x_park %}
	{% endif %}
	{% if do_y_park %}
	{% set y = y_park %}
	{% endif %}
	G1 X{x} Y{y} F{st}
	{% endif %}
	
	
	{% if shape_tip %}
	Shape_Tip
	{% endif %}
	{% else %}
	
	{% if use_wiper %}
	Go_To_Purge_Location
	{% endif %}
	
	
	Shape_Tip
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRE_UNLOAD_state
post_load_gcode = 
	SAVE_GCODE_STATE NAME=POST_LOAD_state
	{% set use_wiper = printer["gcode_macro TR_Variables"].use_wiper %}
	{% if printer.virtual_sdcard.is_active %}
	{% set st = printer["gcode_macro TR_Variables"].travel_speed * 60 %}
	{% set take_frame = printer["gcode_macro TR_Variables"].take_frame %}
	{% set x = printer["gcode_macro TR_Variables"].x %}
	{% set y = printer["gcode_macro TR_Variables"].y %}
	{% set z = printer["gcode_macro TR_Variables"].z %}
	{% set saved_pos = printer["gcode_macro TR_Variables"].saved_pos %}
	{% set z_park = printer["gcode_macro TR_Variables"].z_park %}
	
	
	{% if take_frame %}
	TIMELAPSE_TAKE_FRAME
	{% endif %}
	
	
	{% if use_wiper %}
	Home_and_Wipe_Nozzle
	{% endif %}
	
	
	{% if saved_pos %}
	G90
	G1 Z{z_park}
	G1 X{x} Y{y} F{st}
	G1 Z{z}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=saved_pos VALUE={False}
	{% endif %}
	
	Restore_Pressure_Advance
	{% elif use_wiper %}
	Home_and_Wipe_Nozzle
	{% endif %}
	RESTORE_GCODE_STATE NAME=POST_LOAD_state

[stepper_tr_selector]
step_pin = tr:PB15
dir_pin = !tr:PB14
enable_pin = !tr:PA8
rotation_distance = 40
microsteps = 16
full_steps_per_rotation = 400
endstop_pin = ^tr:PA3
position_min = 0.0
position_endstop = 0
position_max = 158
homing_speed = 30

[stepper_tr_fil_driver]
step_pin = tr:PD2
dir_pin = tr:PB13
enable_pin = !tr:PD1
rotation_distance = 22.67895
gear_ratio = 50:17
microsteps = 16
full_steps_per_rotation = 400
endstop_pin = ^tr:PA4
position_min = -5000
position_endstop = 0
position_max = 5000
homing_positive_dir = False

[tmc2209 stepper_tr_selector]
uart_pin = tr:PA10
interpolate = True
run_current = 1.3
sense_resistor = 0.110

[tmc2209 stepper_tr_fil_driver]
uart_pin = tr:PC7
interpolate = False
run_current = 1.3
sense_resistor = 0.110

[servo tr_servo]
pin = tr:PA0
maximum_servo_angle = 131
minimum_pulse_width = 0.000700
maximum_pulse_width = 0.002200

[gcode_macro ACTIVATE_EXTRUDER]
rename_existing = ACTIVATE_EXTRUDER.1
gcode = 
	{% set EXTRUDER = params.EXTRUDER|default('extruder')|lower|replace('extruder', '') %}
	{% if EXTRUDER == '' %}
	{% set EXTRUDER = '0' %}
	{% endif %}
	TR_LOAD_TOOLHEAD LANE={EXTRUDER}

[gcode_macro TR_Variables]
description = Variables for use with Trad Rack pre unload and post load gcode
variable_z_lift = 0.1
variable_x_park = 0.0
variable_y_park = 175.0
variable_do_x_park = False
variable_do_y_park = False
variable_travel_speed = 300
variable_shape_tip = False
variable_take_frame = False
variable_use_wiper = False
variable_x = 0
variable_y = 0
variable_z = 0
variable_saved_pos = False
variable_z_park = 0
gcode = 

[gcode_macro Shape_Tip]
description = Perform tip-shaping, retraction, and cooling moves
gcode = 
	SAVE_GCODE_STATE NAME=Shape_Tip_state
	Save_Pressure_Advance
	
	Slicer_Unload
	
	
	Restore_Pressure_Advance
	RESTORE_GCODE_STATE NAME=Shape_Tip_state

[gcode_macro Set_Slicer_Unload_Preset]
description = Apply a preset of values to use for the Slicer_Unload macro
variable_asa_ss = {
	"filament_ramming_parameters": "120 110 5.32258 5.45161 5.67742 6 6.48387 7.12903 7.90323 8.70968 9.3871 9.83871 10.0968 10.2258| 0.05 5.30967 0.45 5.50967 0.95 6.1871 1.45 7.39677 1.95 9.05484 2.45 10 2.95 10.3098 3.45 13.0839 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": True}
variable_pla_ss = {
	"filament_ramming_parameters": "130 120 2.70968 2.93548 3.32258 3.83871 4.58065 5.54839 6.51613 7.35484 7.93548 8.16129| 0.05 2.66451 0.45 3.05805 0.95 4.05807 1.45 5.97742 1.95 7.69999 2.45 8.1936 2.95 11.342 3.45 11.4065 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": True}
variable_asa_ps = {
	"filament_ramming_parameters": "120 110 5.32258 5.45161 5.67742 6 6.48387 7.12903 7.90323 8.70968 9.3871 9.83871 10.0968 10.2258| 0.05 5.30967 0.45 5.50967 0.95 6.1871 1.45 7.39677 1.95 9.05484 2.45 10 2.95 10.3098 3.45 13.0839 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": False}
variable_pla_ps = {
	"filament_ramming_parameters": "130 120 2.70968 2.93548 3.32258 3.83871 4.58065 5.54839 6.51613 7.35484 7.93548 8.16129| 0.05 2.66451 0.45 3.05805 0.95 4.05807 1.45 5.97742 1.95 7.69999 2.45 8.1936 2.95 11.342 3.45 11.4065 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": False}
gcode = 
	{% set preset_name = params.PRESET|lower %}
	{% if preset_name in printer['gcode_macro Set_Slicer_Unload_Preset'] %}
	{% set preset = printer['gcode_macro Set_Slicer_Unload_Preset'].preset_name %}
	{% for key in preset %}
	SET_GCODE_VARIABLE MACRO=Slicer_Unload VARIABLE={key} VALUE={preset[key]}
	{% endfor %}
	{% else %}
	{ action_raise_error("Preset \"%s\" does not exist" % preset_name) }
	{% endif %}

[gcode_macro Slicer_Unload]
description = Mimic ramming and unload behavior of PrusaSlicer or SuperSlicer
variable_cooling_tube_length = 14
variable_cooling_tube_retraction = 30
variable_filament_cooling_final_speed = 30
variable_filament_cooling_initial_speed = 20
variable_filament_cooling_moves = 4
variable_filament_diameter = 1.75
variable_filament_unloading_speed = 90
variable_filament_unloading_speed_start = 100
variable_filament_toolchange_delay = 0
variable_filament_ramming_parameters = "120 110 5.32258 5.45161 5.67742 6 6.48387 7.12903 7.90323 8.70968 9.3871 9.83871 10.0968 10.2258| 0.05 5.30967 0.45 5.50967 0.95 6.1871 1.45 7.39677 1.95 9.05484 2.45 10 2.95 10.3098 3.45 13.0839 3.95 7.6 4.45 7.6 4.95 7.6"
variable_filament_enable_toolchange_temp = False
variable_filament_toolchange_temp = 200
variable_filament_use_fast_skinnydip = False
variable_filament_enable_toolchange_part_fan = False
variable_filament_toolchange_part_fan_speed = 50
variable_filament_use_skinnydip = True
variable_filament_skinnydip_distance = 24
variable_filament_melt_zone_pause = 0
variable_filament_cooling_zone_pause = 0
variable_filament_dip_insertion_speed = 33
variable_filament_dip_extraction_speed = 70
variable_superslicer = False
variable_do_ramming = False
variable_do_unload = True
gcode = 
	{% set NEW_TEMPERATURE = params.NEW_TEMPERATURE|default(0)|float %}
	{% set prev_temp_target = printer.extruder.target %}
	
	SAVE_GCODE_STATE NAME=Slicer_Unload_state
	Save_Pressure_Advance
	
	M83
	M220 S100
	SET_PRESSURE_ADVANCE ADVANCE=0
	
	
	{% if do_ramming %}
	
	{% set ramming_speed = (filament_ramming_parameters.split('|')[0]).split(' ') %}
	
	
	{% set filament_area = 3.1415 * (filament_diameter / 2) ** 2 %}
	
	
	{% for i in range(2, ramming_speed|length) %}
	
	{% set f = ramming_speed[i]|float / filament_area %}
	
	
	{% set e = f * 0.25 %}
	
	
	G1 E{e} F{f * 60}
	{% endfor %}
	{% endif %}
	
	
	{% if do_unload %}
	
	{% if superslicer and filament_enable_toolchange_temp and not filament_use_fast_skinnydip %}
	_Wait_for_Toolchange_Temp
	{% endif %}
	
	
	{% set total_retraction_distance = cooling_tube_retraction + cooling_tube_length / 2 - 15 %}
	G1 E-15 F{filament_unloading_speed_start * 60}
	G1 E-{0.70 * total_retraction_distance} F{1.0 * filament_unloading_speed * 60}
	G1 E-{0.20 * total_retraction_distance} F{0.5 * filament_unloading_speed * 60}
	G1 E-{0.10 * total_retraction_distance} F{0.3 * filament_unloading_speed * 60}
	
	
	{% if not superslicer or not filament_enable_toolchange_temp %}
	{% if NEW_TEMPERATURE != 0 and (NEW_TEMPERATURE != prev_temp_target) %}
	M104 S{NEW_TEMPERATURE}
	{% endif %}
	
	
	{% elif superslicer and filament_enable_toolchange_temp and not filament_use_fast_skinnydip %}
	{% if NEW_TEMPERATURE != 0 %}
	M104 S{NEW_TEMPERATURE}
	{% else %}
	M104 S{prev_temp_target}
	{% endif %}
	{% endif %}
	
	
	{% set speed_inc = (filament_cooling_final_speed - filament_cooling_initial_speed) / (2 * filament_cooling_moves - 1) %}
	{% for i in range(filament_cooling_moves) %}
	{% set speed = filament_cooling_initial_speed + speed_inc * 2 * i %}
	G1 E{cooling_tube_length} F{speed * 60}
	{% set speed = speed + speed_inc %}
	G1 E-{cooling_tube_length} F{speed * 60}
	{% endfor %}
	
	
	{% if superslicer %}
	
	{% if filament_enable_toolchange_temp and filament_use_fast_skinnydip %}
	_Wait_for_Toolchange_Temp
	{% endif %}
	
	
	{% if filament_use_skinnydip %}
	G1 E{filament_skinnydip_distance} F{filament_dip_insertion_speed * 60}
	G4 P{filament_melt_zone_pause}
	G1 E-{filament_skinnydip_distance} F{filament_dip_extraction_speed * 60}
	G4 P{filament_cooling_zone_pause}
	{% endif %}
	
	
	{% if filament_enable_toolchange_temp and filament_use_fast_skinnydip %}
	{% if NEW_TEMPERATURE != 0 %}
	M109 S{NEW_TEMPERATURE}
	{% else %}
	M109 S{prev_temp_target}
	{% endif %}
	{% elif filament_enable_toolchange_temp and filament_use_fast_skinnydip %}
	{% if NEW_TEMPERATURE != 0 and (NEW_TEMPERATURE != prev_temp_target) %}
	M109 S{NEW_TEMPERATURE}
	{% endif %}
	{% endif %}
	{% endif %}
	
	
	G4 P{filament_toolchange_delay}
	
	
	
	{% endif %}
	
	Restore_Pressure_Advance
	RESTORE_GCODE_STATE NAME=Slicer_Unload_state

[gcode_macro _Wait_for_Toolchange_Temp]
description = Helper function for Slicer_Unload
gcode = 
	{% set tc_temp = printer["gcode_macro Slicer_Unload"].filament_toolchange_temp %}
	{% set fan_on = printer["gcode_macro Slicer_Unload"].filament_enable_toolchange_part_fan %}
	{% set fan_speed = printer["gcode_macro Slicer_Unload"].filament_toolchange_part_fan_speed %}
	
	{% set prev_fan_speed = printer.fan.speed %}
	{% if fan_on %}
	M106 S{(fan_speed / 100.0 * 255)|int}
	{% endif %}
	M109 S{filament_toolchange_temp}
	{% if fan_on %}
	M106 S{(prev_fan_speed * 255)|int}
	{% endif %}

[gcode_macro Home_and_Wipe_Nozzle]
description = Home x and y if needed, then wipe the nozzle
gcode = 
	
	{% if not 'xy' in printer.toolhead.homed_axes %}
	G28 X Y
	{% endif %}
	
	
	Wipe_Nozzle

[gcode_macro Save_Pressure_Advance]
description = Save the current pressure advance value
variable_pa = -1
gcode = 
	
	{% set pa = printer.extruder.pressure_advance %}
	{% if pa > 0 %}
	SET_GCODE_VARIABLE MACRO=Save_Pressure_Advance VARIABLE=pa VALUE={pa}
	{% endif %}

[gcode_macro Restore_Pressure_Advance]
description = Restore saved pressure advance value
gcode = 
	
	{% if not (printer["gcode_macro Save_Pressure_Advance"].pa == -1) %}
	SET_PRESSURE_ADVANCE ADVANCE={printer["gcode_macro Save_Pressure_Advance"].pa}
	{% endif %}

[safe_z_home]
home_xy_position = 165, 165
z_hop = 10

[z_tilt]
z_positions = 
	-80,  -20
	350, -20
points = 
	15, 150
	275, 150
speed = 50
horizontal_move_z = 10
retries = 30
retry_tolerance = 0.1

[input_shaper]
shaper_type_x = zv
shaper_freq_x = 120.6
shaper_type_y = zv
shaper_freq_y = 76.6

[cartographer]
serial = /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00
speed = 40.
lift_speed = 5.
backlash_comp = 0.5
x_offset = 0.
y_offset = 21.1
trigger_distance = 2.
trigger_dive_threshold = 1.5
trigger_hysteresis = 0.006
cal_nozzle_z = 0.1
cal_floor = 0.1
cal_ceil = 5.
cal_speed = 1.0
cal_move_speed = 10.
default_model_name = default
mesh_main_direction = X
mesh_cluster_size = 1
mesh_runs = 2

[printer]
kinematics = corexy
max_velocity = 3000
max_accel = 20000
max_z_velocity = 20
max_z_accel = 15
square_corner_velocity = 10

[exclude_object]

[gcode_arcs]
resolution = 0.05

[idle_timeout]
gcode = 
	{% if not printer.pause_resume.is_paused %}
	TURN_OFF_HEATERS
	M84
	{% endif %}

[save_variables]
filename = vars.cfg

[mcu]
serial = /dev/serial/by-id/usb-Klipper_stm32h723xx_4C0023001551313338343730-if00

[bed_mesh default]
version = 1
points = 
	-0.215000, -0.210000, -0.190000, -0.185000, -0.170000, -0.145000, -0.135000, -0.120000, -0.105000, -0.070000, -0.055000, -0.035000, 0.000000, 0.010000, 0.025000, 0.050000, 0.080000, 0.105000, 0.130000, 0.135000, 0.150000, 0.155000, 0.165000, 0.190000, 0.205000
	-0.160000, -0.155000, -0.160000, -0.150000, -0.130000, -0.110000, -0.105000, -0.085000, -0.055000, -0.035000, -0.025000, 0.000000, 0.025000, 0.055000, 0.075000, 0.100000, 0.110000, 0.130000, 0.160000, 0.170000, 0.190000, 0.190000, 0.205000, 0.205000, 0.220000
	-0.160000, -0.150000, -0.140000, -0.135000, -0.115000, -0.105000, -0.090000, -0.070000, -0.040000, -0.025000, -0.010000, 0.015000, 0.030000, 0.045000, 0.080000, 0.100000, 0.115000, 0.135000, 0.160000, 0.165000, 0.180000, 0.185000, 0.190000, 0.220000, 0.235000
	-0.120000, -0.115000, -0.115000, -0.100000, -0.080000, -0.070000, -0.065000, -0.040000, -0.015000, 0.010000, 0.030000, 0.050000, 0.065000, 0.090000, 0.110000, 0.130000, 0.145000, 0.175000, 0.195000, 0.195000, 0.195000, 0.205000, 0.210000, 0.235000, 0.240000
	-0.075000, -0.065000, -0.055000, -0.045000, -0.040000, -0.020000, -0.005000, 0.015000, 0.035000, 0.065000, 0.075000, 0.090000, 0.105000, 0.115000, 0.140000, 0.170000, 0.175000, 0.190000, 0.205000, 0.205000, 0.205000, 0.210000, 0.215000, 0.240000, 0.240000
	-0.045000, -0.050000, -0.055000, -0.045000, -0.015000, -0.005000, -0.005000, 0.020000, 0.060000, 0.065000, 0.075000, 0.100000, 0.115000, 0.125000, 0.135000, 0.170000, 0.175000, 0.175000, 0.205000, 0.205000, 0.205000, 0.205000, 0.210000, 0.220000, 0.225000
	-0.035000, -0.030000, -0.030000, -0.020000, 0.000000, 0.015000, 0.015000, 0.035000, 0.065000, 0.085000, 0.100000, 0.110000, 0.115000, 0.130000, 0.160000, 0.170000, 0.180000, 0.180000, 0.200000, 0.200000, 0.200000, 0.205000, 0.205000, 0.220000, 0.235000
	0.005000, 0.010000, 0.015000, 0.025000, 0.035000, 0.040000, 0.055000, 0.085000, 0.095000, 0.110000, 0.115000, 0.125000, 0.140000, 0.160000, 0.175000, 0.180000, 0.190000, 0.190000, 0.225000, 0.225000, 0.225000, 0.225000, 0.230000, 0.235000, 0.250000
	0.055000, 0.065000, 0.060000, 0.065000, 0.075000, 0.090000, 0.100000, 0.110000, 0.120000, 0.130000, 0.140000, 0.155000, 0.170000, 0.180000, 0.190000, 0.195000, 0.210000, 0.220000, 0.235000, 0.235000, 0.235000, 0.235000, 0.245000, 0.250000, 0.260000
	0.100000, 0.105000, 0.110000, 0.110000, 0.120000, 0.135000, 0.145000, 0.150000, 0.155000, 0.155000, 0.170000, 0.185000, 0.190000, 0.195000, 0.195000, 0.215000, 0.230000, 0.235000, 0.245000, 0.245000, 0.245000, 0.235000, 0.245000, 0.250000, 0.260000
	0.100000, 0.115000, 0.125000, 0.130000, 0.135000, 0.145000, 0.150000, 0.155000, 0.165000, 0.175000, 0.190000, 0.200000, 0.205000, 0.205000, 0.215000, 0.225000, 0.230000, 0.245000, 0.255000, 0.240000, 0.240000, 0.240000, 0.245000, 0.250000, 0.250000
	0.155000, 0.150000, 0.150000, 0.150000, 0.160000, 0.165000, 0.165000, 0.175000, 0.175000, 0.195000, 0.200000, 0.215000, 0.205000, 0.210000, 0.215000, 0.225000, 0.235000, 0.240000, 0.245000, 0.240000, 0.240000, 0.235000, 0.220000, 0.235000, 0.240000
	0.170000, 0.165000, 0.165000, 0.170000, 0.180000, 0.190000, 0.190000, 0.185000, 0.200000, 0.205000, 0.220000, 0.230000, 0.225000, 0.225000, 0.240000, 0.245000, 0.240000, 0.250000, 0.255000, 0.245000, 0.250000, 0.245000, 0.245000, 0.240000, 0.240000
	0.210000, 0.200000, 0.195000, 0.200000, 0.210000, 0.210000, 0.210000, 0.215000, 0.215000, 0.215000, 0.235000, 0.245000, 0.235000, 0.235000, 0.245000, 0.250000, 0.240000, 0.250000, 0.250000, 0.250000, 0.255000, 0.250000, 0.235000, 0.235000, 0.240000
	0.240000, 0.250000, 0.250000, 0.245000, 0.260000, 0.260000, 0.255000, 0.255000, 0.255000, 0.250000, 0.265000, 0.265000, 0.260000, 0.255000, 0.260000, 0.255000, 0.255000, 0.270000, 0.260000, 0.255000, 0.250000, 0.255000, 0.245000, 0.250000, 0.240000
	0.270000, 0.260000, 0.255000, 0.265000, 0.265000, 0.265000, 0.265000, 0.260000, 0.260000, 0.255000, 0.265000, 0.265000, 0.265000, 0.255000, 0.255000, 0.250000, 0.255000, 0.250000, 0.250000, 0.245000, 0.245000, 0.235000, 0.230000, 0.235000, 0.240000
	0.275000, 0.280000, 0.275000, 0.275000, 0.275000, 0.275000, 0.275000, 0.275000, 0.280000, 0.280000, 0.280000, 0.270000, 0.270000, 0.270000, 0.265000, 0.265000, 0.265000, 0.270000, 0.260000, 0.255000, 0.235000, 0.235000, 0.235000, 0.240000, 0.235000
	0.335000, 0.315000, 0.305000, 0.310000, 0.305000, 0.300000, 0.295000, 0.290000, 0.300000, 0.295000, 0.290000, 0.290000, 0.280000, 0.270000, 0.270000, 0.275000, 0.275000, 0.265000, 0.250000, 0.245000, 0.235000, 0.225000, 0.225000, 0.230000, 0.235000
	0.355000, 0.350000, 0.345000, 0.325000, 0.330000, 0.325000, 0.325000, 0.325000, 0.315000, 0.310000, 0.300000, 0.290000, 0.285000, 0.290000, 0.275000, 0.275000, 0.265000, 0.265000, 0.250000, 0.245000, 0.235000, 0.225000, 0.230000, 0.225000, 0.215000
	0.395000, 0.385000, 0.380000, 0.370000, 0.365000, 0.370000, 0.360000, 0.355000, 0.345000, 0.340000, 0.330000, 0.320000, 0.310000, 0.305000, 0.300000, 0.290000, 0.275000, 0.260000, 0.255000, 0.255000, 0.250000, 0.235000, 0.230000, 0.230000, 0.230000
	0.395000, 0.390000, 0.375000, 0.375000, 0.375000, 0.370000, 0.365000, 0.360000, 0.355000, 0.335000, 0.325000, 0.315000, 0.315000, 0.300000, 0.295000, 0.280000, 0.255000, 0.260000, 0.250000, 0.240000, 0.230000, 0.235000, 0.230000, 0.205000, 0.195000
	0.405000, 0.395000, 0.395000, 0.390000, 0.380000, 0.375000, 0.370000, 0.360000, 0.355000, 0.345000, 0.325000, 0.325000, 0.310000, 0.295000, 0.290000, 0.270000, 0.250000, 0.240000, 0.235000, 0.235000, 0.230000, 0.205000, 0.195000, 0.195000, 0.195000
	0.405000, 0.395000, 0.380000, 0.375000, 0.375000, 0.370000, 0.360000, 0.345000, 0.340000, 0.330000, 0.305000, 0.300000, 0.285000, 0.270000, 0.250000, 0.235000, 0.220000, 0.215000, 0.220000, 0.205000, 0.195000, 0.175000, 0.175000, 0.170000, 0.165000
	0.405000, 0.390000, 0.395000, 0.385000, 0.365000, 0.350000, 0.345000, 0.330000, 0.320000, 0.305000, 0.290000, 0.265000, 0.260000, 0.240000, 0.225000, 0.215000, 0.205000, 0.190000, 0.180000, 0.185000, 0.165000, 0.150000, 0.145000, 0.145000, 0.145000
	0.430000, 0.425000, 0.400000, 0.395000, 0.385000, 0.370000, 0.365000, 0.340000, 0.320000, 0.305000, 0.295000, 0.270000, 0.250000, 0.235000, 0.215000, 0.215000, 0.200000, 0.190000, 0.185000, 0.165000, 0.155000, 0.145000, 0.135000, 0.130000, 0.135000
x_count = 25
y_count = 25
mesh_x_pps = 3
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 310.0
min_y = 26.43
max_y = 281.31
=======================
Extruder max_extrude_ratio=41.575169
mcu 'mcu': Starting serial connect
webhooks client 140734119266576: New connection
webhooks client 140734119266576: Client info {'program': 'Moonraker', 'version': 'v0.8.0-308-g71b46cc'}
Loaded MCU 'mcu' 117 commands (v0.12.0-61-gb50d6669 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1_PB6_PB7=PB6,PB7 BUS_PINS_i2c1_PB8_PB9=PB8,PB9 BUS_PINS_i2c2_PB10_PB11=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi2a=PC2,PC3,PB10 BUS_PINS_spi3a=PC11,PC12,PC10 BUS_PINS_spi4=PE13,PE14,PE12 BUS_PINS_spi5=PF8,PF9,PF7 BUS_PINS_spi5a=PH7,PF11,PH6 BUS_PINS_spi6=PG12,PG14,PG13 CLOCK_FREQ=400000000 MCU=stm32h723xx PWM_MAX=255 RESERVE_PINS_USB=PA11,PA12 RESERVE_PINS_crystal=PH0,PH1 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
mcu 'tr': Starting serial connect
Loaded MCU 'tr' 106 commands (v0.12.0-102-g9f41f53c / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'tr' config: ADC_MAX=4095 BUS_PINS_i2c1_PA9_PA10=PA9,PA10 BUS_PINS_i2c1_PB6_PB7=PB6,PB7 BUS_PINS_i2c1_PB8_PB9=PB8,PB9 BUS_PINS_i2c2_PB10_PB11=PB10,PB11 BUS_PINS_i2c2_PB13_PB14=PB13,PB14 BUS_PINS_i2c3_PB3_PB4=PB3,PB4 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi2a=PC2,PC3,PB10 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=64000000 MCU=stm32g0b1xx PWM_MAX=255 RESERVE_PINS_USB=PA11,PA12 RESERVE_PINS_crystal=PF0,PF1 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
mcu_temperature 'mcu' nominal base=-274.819277 slope=1644.578313
mcu 'cartographer': Starting serial connect
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
MCU error during connect
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/mcu.py", line 768, in _mcu_identify
    self._serial.connect_uart(self._serialport, self._baud, rts)
  File "/home/pi/klipper/klippy/serialhdl.py", line 182, in connect_uart
    self._error("Unable to connect")
  File "/home/pi/klipper/klippy/serialhdl.py", line 61, in _error
    raise error(self.warn_prefix + (msg % params))
serialhdl.error: mcu 'cartographer': Unable to connect

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/pi/klipper/klippy/klippy.py", line 176, in _connect
    self.send_event("klippy:mcu_identify")
  File "/home/pi/klipper/klippy/klippy.py", line 263, in send_event
    return [cb(*params) for cb in self.event_handlers.get(event, [])]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/klippy.py", line 263, in <listcomp>
    return [cb(*params) for cb in self.event_handlers.get(event, [])]
            ^^^^^^^^^^^
  File "/home/pi/klipper/klippy/mcu.py", line 773, in _mcu_identify
    raise error(str(e))
mcu.error: mcu 'cartographer': Unable to connect
Build file /home/pi/klipper/klippy/../.config(3424): Sun Feb  4 11:55:53 2024
========= Last MCU build config =========
CONFIG_LOW_LEVEL_OPTIONS=y
# CONFIG_MACH_AVR is not set
# CONFIG_MACH_ATSAM is not set
# CONFIG_MACH_ATSAMD is not set
# CONFIG_MACH_LPC176X is not set
CONFIG_MACH_STM32=y
# CONFIG_MACH_HC32F460 is not set
# CONFIG_MACH_RP2040 is not set
# CONFIG_MACH_PRU is not set
# CONFIG_MACH_AR100 is not set
# CONFIG_MACH_LINUX is not set
# CONFIG_MACH_SIMU is not set
CONFIG_BOARD_DIRECTORY="stm32"
CONFIG_MCU="stm32h723xx"
CONFIG_CLOCK_FREQ=400000000
CONFIG_USBSERIAL=y
CONFIG_FLASH_SIZE=0x40000
CONFIG_FLASH_BOOT_ADDRESS=0x8000000
CONFIG_RAM_START=0x20000000
CONFIG_RAM_SIZE=0x20000
CONFIG_STACK_SIZE=512
CONFIG_FLASH_APPLICATION_ADDRESS=0x8020000
CONFIG_STM32_SELECT=y
# CONFIG_MACH_STM32F103 is not set
# CONFIG_MACH_STM32F207 is not set
# CONFIG_MACH_STM32F401 is not set
# CONFIG_MACH_STM32F405 is not set
# CONFIG_MACH_STM32F407 is not set
# CONFIG_MACH_STM32F429 is not set
# CONFIG_MACH_STM32F446 is not set
# CONFIG_MACH_STM32F765 is not set
# CONFIG_MACH_STM32F031 is not set
# CONFIG_MACH_STM32F042 is not set
# CONFIG_MACH_STM32F070 is not set
# CONFIG_MACH_STM32F072 is not set
# CONFIG_MACH_STM32G070 is not set
# CONFIG_MACH_STM32G071 is not set
# CONFIG_MACH_STM32G0B0 is not set
# CONFIG_MACH_STM32G0B1 is not set
# CONFIG_MACH_STM32G431 is not set
CONFIG_MACH_STM32H723=y
# CONFIG_MACH_STM32H743 is not set
# CONFIG_MACH_STM32H750 is not set
# CONFIG_MACH_STM32L412 is not set
# CONFIG_MACH_N32G452 is not set
# CONFIG_MACH_N32G455 is not set
CONFIG_MACH_STM32H7=y
CONFIG_HAVE_STM32_USBOTG=y
CONFIG_HAVE_STM32_FDCANBUS=y
CONFIG_HAVE_STM32_USBCANBUS=y
CONFIG_STM32_DFU_ROM_ADDRESS=0x1ff09800
CONFIG_STM32_FLASH_START_20000=y
# CONFIG_STM32_FLASH_START_0000 is not set
# CONFIG_STM32_CLOCK_REF_8M is not set
# CONFIG_STM32_CLOCK_REF_12M is not set
# CONFIG_STM32_CLOCK_REF_16M is not set
# CONFIG_STM32_CLOCK_REF_20M is not set
# CONFIG_STM32_CLOCK_REF_24M is not set
CONFIG_STM32_CLOCK_REF_25M=y
# CONFIG_STM32_CLOCK_REF_INTERNAL is not set
CONFIG_CLOCK_REF_FREQ=25000000
CONFIG_STM32F0_TRIM=16
CONFIG_STM32_USB_PA11_PA12=y
# CONFIG_STM32_SERIAL_USART1 is not set
# CONFIG_STM32_SERIAL_USART1_ALT_PB7_PB6 is not set
# CONFIG_STM32_SERIAL_USART2 is not set
# CONFIG_STM32_SERIAL_USART2_ALT_PD6_PD5 is not set
# CONFIG_STM32_SERIAL_USART3 is not set
# CONFIG_STM32_SERIAL_USART3_ALT_PD9_PD8 is not set
# CONFIG_STM32_SERIAL_UART4 is not set
# CONFIG_STM32_CANBUS_PA11_PA12 is not set
# CONFIG_STM32_CANBUS_PA11_PB9 is not set
# CONFIG_STM32_MMENU_CANBUS_PB8_PB9 is not set
# CONFIG_STM32_MMENU_CANBUS_PB12_PB13 is not set
# CONFIG_STM32_MMENU_CANBUS_PD0_PD1 is not set
# CONFIG_STM32_MMENU_CANBUS_PB0_PB1 is not set
# CONFIG_STM32_MMENU_CANBUS_PD12_PD13 is not set
# CONFIG_STM32_MMENU_CANBUS_PC2_PC3 is not set
# CONFIG_STM32_USBCANBUS_PA11_PA12 is not set
CONFIG_USB=y
CONFIG_USB_VENDOR_ID=0x1d50
CONFIG_USB_DEVICE_ID=0x614e
CONFIG_USB_SERIAL_NUMBER_CHIPID=y
CONFIG_USB_SERIAL_NUMBER="12345"

#
# USB ids
#
# end of USB ids

CONFIG_WANT_GPIO_BITBANGING=y
CONFIG_WANT_DISPLAYS=y
CONFIG_WANT_SENSORS=y
CONFIG_WANT_LIS2DW=y
CONFIG_WANT_SOFTWARE_I2C=y
CONFIG_WANT_SOFTWARE_SPI=y
CONFIG_NEED_SENSOR_BULK=y
CONFIG_CANBUS_FREQUENCY=1000000
CONFIG_INITIAL_PINS=""
CONFIG_HAVE_GPIO=y
CONFIG_HAVE_GPIO_ADC=y
CONFIG_HAVE_GPIO_SPI=y
CONFIG_HAVE_GPIO_I2C=y
CONFIG_HAVE_GPIO_HARD_PWM=y
CONFIG_HAVE_STRICT_TIMING=y
CONFIG_HAVE_CHIPID=y
CONFIG_HAVE_STEPPER_BOTH_EDGE=y
CONFIG_HAVE_BOOTLOADER_REQUEST=y
CONFIG_INLINE_STEPPER_HACK=y
=======================
Build file /home/pi/klipper/klippy/../out/klipper.dict(7712): Sun Feb  4 11:56:28 2024
Last MCU build version: v0.12.0-102-g9f41f53c
Last MCU build tools: gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40
Last MCU build config: ADC_MAX=4095 BUS_PINS_i2c1_PB6_PB7=PB6,PB7 BUS_PINS_i2c1_PB8_PB9=PB8,PB9 BUS_PINS_i2c2_PB10_PB11=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi2a=PC2,PC3,PB10 BUS_PINS_spi3a=PC11,PC12,PC10 BUS_PINS_spi4=PE13,PE14,PE12 BUS_PINS_spi5=PF8,PF9,PF7 BUS_PINS_spi5a=PH7,PF11,PH6 BUS_PINS_spi6=PG12,PG14,PG13 CLOCK_FREQ=400000000 MCU=stm32h723xx PWM_MAX=255 RESERVE_PINS_USB=PA11,PA12 RESERVE_PINS_crystal=PH0,PH1 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Build file /home/pi/klipper/klippy/../out/klipper.elf(1520408): Sun Feb  4 11:56:32 2024
Attempting MCU 'mcu' reset command
b'Got EOF when reading from device'
Attempting MCU 'tr' reset command
b'Got EOF when reading from device'
Attempting MCU 'cartographer' reset
Unhandled exception during post run
Traceback (most recent call last):
  File "/home/pi/klippy-env/lib/python3.11/site-packages/serial/serialposix.py", line 265, in open
    self.fd = os.open(self.portstr, os.O_RDWR | os.O_NOCTTY | os.O_NONBLOCK)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
FileNotFoundError: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/pi/klipper/klippy/klippy.py", line 234, in run
    self.send_event("klippy:firmware_restart")
  File "/home/pi/klipper/klippy/klippy.py", line 263, in send_event
    return [cb(*params) for cb in self.event_handlers.get(event, [])]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/klippy.py", line 263, in <listcomp>
    return [cb(*params) for cb in self.event_handlers.get(event, [])]
            ^^^^^^^^^^^
  File "/home/pi/klipper/klippy/mcu.py", line 915, in _firmware_restart
    self._restart_arduino()
  File "/home/pi/klipper/klippy/mcu.py", line 875, in _restart_arduino
    serialhdl.arduino_reset(self._serialport, self._reactor)
  File "/home/pi/klipper/klippy/serialhdl.py", line 379, in arduino_reset
    ser = serial.Serial(serialport, 2400, timeout=0, exclusive=True)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klippy-env/lib/python3.11/site-packages/serial/serialutil.py", line 240, in __init__
    self.open()
  File "/home/pi/klippy-env/lib/python3.11/site-packages/serial/serialposix.py", line 268, in open
    raise SerialException(msg.errno, "could not open port {}: {}".format(self._port, msg))
serial.serialutil.SerialException: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
Restarting printer
Start printer at Mon Feb  5 15:42:35 2024 (1707147755.9 93671.7)
===== Config file =====
[virtual_sdcard]
path = /home/pi/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]
recover_velocity = 350

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	TURN_OFF_HEATERS
	G91
	G1 Z10 E-2 F3600
	G1 E-3 F3600
	G90
	G1 X30 Y250 F7000; home X axis
	M106 S80
	G4 P10000
	M106 S0
	M221 S100
	CANCEL_PRINT_BASE
	CLEAR_PAUSE
	
	SET_GCODE_OFFSET Z=0.0
	RESETSPEEDS
	M84
	
	BED_MESH_CLEAR

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	
	{% set x_park = printer.toolhead.axis_maximum.x|float - 5.0 %}
	{% set y_park = printer.toolhead.axis_maximum.y|float - 5.0 %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < (max_z - 2.0) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	
	SAVE_GCODE_STATE NAME=PAUSE_state
	BASE_PAUSE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	G91
	G1 E-{1} F2100
	G1 Z{10} F900
	G90
	G1 X{50} Y{0} F6000
variable_extrude = 1.0

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	G91
	G1 E{1} F2100
	RESTORE_GCODE_STATE NAME=PAUSE_state
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[tmc5160 extruder]
cs_pin = PA10
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 0.65
sense_resistor = 0.075
stealthchop_threshold = 0

[extruder]
rotation_distance = 5.7
full_steps_per_rotation = 200
sensor_type = PT1000
min_temp = 0
max_temp = 330
filament_diameter = 1.750
dir_pin = !PB6
step_pin = PG15
enable_pin = !PG14
heater_pin = PF6
sensor_pin = PB1
microsteps = 16
max_extrude_only_distance = 101
max_extrude_cross_section = 100
nozzle_diameter = 0.600
pressure_advance = 0.015
pressure_advance_smooth_time = 0.02
control = pid
pid_kp = 22.354
pid_ki = 1.552
pid_kd = 80.473

[tmc5160 stepper_x]
cs_pin = PD6
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
diag1_pin = PC15
run_current = 2.00
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_x]
dir_pin = !PC13
step_pin = PC14
enable_pin = !PE6
endstop_pin = PC15
microsteps = 16
rotation_distance = 40
position_endstop = -6
position_min = -6
position_max = 330
homing_speed = 20
full_steps_per_rotation = 200
homing_retract_dist = 0
homing_positive_dir = false
step_pulse_duration = 0.000001

[tmc5160 stepper_x1]
cs_pin = PD5
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2.00
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_x1]
dir_pin = !PE4
step_pin = PE5
enable_pin = !PE3
microsteps = 16
rotation_distance = 40
full_steps_per_rotation = 200
step_pulse_duration = 0.000001

[tmc5160 stepper_y]
cs_pin = PD4
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_y]
dir_pin = !PE1
step_pin = PE2
enable_pin = !PE0
endstop_pin = PF0
microsteps = 16
rotation_distance = 40
position_endstop = 0
position_min = 0
position_max = 315
homing_speed = 20
full_steps_per_rotation = 200
homing_retract_dist = 0
homing_positive_dir = false
step_pulse_duration = 0.000001

[tmc5160 stepper_y1]
cs_pin = PD3
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_y1]
dir_pin = !PB8
step_pin = PB9
enable_pin = !PB7
microsteps = 16
rotation_distance = 40
full_steps_per_rotation = 200
step_pulse_duration = 0.000001

[tmc5160 stepper_z]
cs_pin = PD2
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 1
sense_resistor = 0.075
stealthchop_threshold = 0

[stepper_z]
dir_pin = !PG10
step_pin = PG9
enable_pin = !PG13
endstop_pin = probe:z_virtual_endstop
microsteps = 16
rotation_distance = 8
position_min = -20
position_max = 400
full_steps_per_rotation = 200
homing_retract_dist = 5.0
homing_positive_dir = false
homing_speed = 3
second_homing_speed = 1
step_pulse_duration = 0.000004

[tmc5160 stepper_z1]
cs_pin = PA15
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 1
sense_resistor = 0.075
stealthchop_threshold = 0

[stepper_z1]
dir_pin = !PD7
step_pin = PG11
enable_pin = !PG12
microsteps = 16
rotation_distance = 8

[temperature_sensor Kraken]
sensor_type = temperature_mcu
min_temp = 10
max_temp = 100

[heater_fan hotend_fan]
pin = PA0
max_power = 1.0
kick_start_time = 0.5
heater = extruder
heater_temp = 50.0

[fan]
pin = PF12
enable_pin = PF7
hardware_pwm = false
max_power = 1
cycle_time = 0.00002
off_below = 0.012
kick_start_time = 0.01

[heater_bed]
heater_pin = PF5
sensor_pin = PC5
sensor_type = NTC 100K MGB18-104F39050L32
control = pid
pid_kp = 34.679
pid_ki = 1.492
pid_kd = 201.572
min_temp = 0
max_temp = 120
max_power = 1
pwm_cycle_time = 0.0166

[bed_screws]
screw1 = 10,0
screw2 = 10,260
screw3 = 320,260
screw4 = 320,0

[screws_tilt_adjust]
screw1 = 10, 0
screw1_name = front left screw
screw2 = 10, 260
screw2_name = rear left screw
screw3 = 300, 260
screw3_name = rear right screw
screw4 = 320, 0
screw4_name = front right screw
horizontal_move_z = 10.
speed = 250
screw_thread = CW-M3

[force_move]
enable_force_move = true

[bed_mesh]
speed = 200
horizontal_move_z = 1
mesh_min = 10, 22
mesh_max = 310, 260
mesh_pps = 3,3
probe_count = 25,25
algorithm = bicubic
relative_reference_index = 12
bicubic_tension = 0.2
fade_start = 1
fade_end = 10
split_delta_z = .025
move_check_distance = 5

[neopixel my_neopixel]
pin = PF11
chain_count = 13
color_order = GRB
initial_red = 1.0
initial_green = 1
initial_blue = 1

[gcode_macro BED_MESH]
gcode = 
	BED_MESH_CALIBRATE

[gcode_macro PA_TUNING]
gcode = 
	SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=1 ACCEL=500
	TUNING_TOWER COMMAND=SET_PRESSURE_ADVANCE PARAMETER=ADVANCE START=0 FACTOR=.005

[gcode_macro HOTEND_PID]
gcode = 
	{% set tool_temp = params.TEMPERATURE|default(220)|int %}
	{% set tool_name = printer.toolhead.extruder %}
	PID_CALIBRATE HEATER={tool_name} TARGET={tool_temp}

[gcode_macro BED_PID]
gcode = 
	{% set bed_temp = params.TEMPERATURE|default(60)|int %}
	PID_CALIBRATE HEATER=heater_bed TARGET={bed_temp}

[gcode_macro SCREWS_TILT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro DUMP_WARNINGS]
description = Debug: Print all warning messages from klipper
gcode = 
	{% set parameters = ["printer.configfile.warnings:"] %}
	{% for warning in printer.configfile.warnings %}
	{% set parameters = parameters.append("%s -> %s -> %s\n%s" % (warning.type, warning.section, warning.option, warning.message)) %}
	{% endfor %}
	{action_respond_info(parameters|join("\n"))}

[gcode_macro enable_stepper]
gcode = 
	SET_STEPPER_ENABLE STEPPER=stepper_x ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_x1 ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y1 ENABLE=1

[gcode_macro disable-steppers]
gcode = 
	m84

[gcode_macro M600]
gcode = 
	G4 P1500
	{% set X = params.X|default(50)|float %}
	{% set Y = params.Y|default(0)|float %}
	{% set Z = params.Z|default(10)|float %}
	
	SAVE_GCODE_STATE NAME=M600_state
	PAUSE
	
	G91
	G1 E-{1} F2100
	G1 Z{Z}
	G90
	G1 X{X} Y{Y} F4000
	G91
	M83
	G1 E5 F800
	G1 E-180 F2000
	M82
	RESTORE_GCODE_STATE NAME=M600_state

[gcode_macro PURGE]
gcode = 
	M83
	G1 E120 F250

[gcode_macro _UNLOAD_FILAMENT]
gcode = 
	{% set e_temp = params.TEMPERATURE|default(235)|int %}
	M118 Filament unloading!
	M117 Filament unloading!
	M82
	G92 E0
	{% if printer.extruder.can_extrude|lower != 'true' %}
	
	M118 Hotend heating!
	M109 S{e_temp} T0
	{% endif %}
	G1 E10 F{5*60}
	G0 E-5 F{60*60}
	G0 E-70 F{5*60}
	M400
	M118 Filament unload complete!
	M117 Filament unload complete!

[gcode_macro _LOAD_FILAMENT]
gcode = 
	{% set e_temp = params.TEMPERATURE|default(230)|int %}
	M109 S{e_temp}
	M83
	G1 E50 F300
	G1 E-1 F100
	M82
	M104 S0

[gcode_macro UNLOAD_PLA]
gcode = 
	_UNLOAD_FILAMENT TEMPERATURE=200

[gcode_macro LOAD_PLA]
gcode = 
	_LOAD_FILAMENT TEMPERATURE=200

[gcode_macro UNLOAD_ABS]
gcode = 
	_UNLOAD_FILAMENT TEMPERATURE=250

[gcode_macro LOAD_ABS]
gcode = 
	_LOAD_FILAMENT TEMPERATURE=250

[gcode_macro UNLOAD_PETG]
gcode = 
	_UNLOAD_FILAMENT TEMPERATURE=235

[gcode_macro LOAD_PETG]
gcode = 
	_LOAD_FILAMENT TEMPERATURE=235

[gcode_macro LOAD_FILAMENT]
gcode = 
	{% set speed = params.SPEED|default(300) %}
	{% set max_velocity = printer.configfile.settings['extruder'].max_extrude_only_velocity %}
	SAVE_GCODE_STATE NAME=load_state
	M300
	G91
	G92 E0
	G1 E350 F{max_velocity}
	G1 E25 F{speed}
	M300
	M300
	RESTORE_GCODE_STATE NAME=load_state

[gcode_macro UNLOAD_FILAMENT]
gcode = 
	{% set speed = params.SPEED|default(300) %}
	{% set max_velocity = printer.configfile.settings['extruder'].max_extrude_only_velocity %}
	SAVE_GCODE_STATE NAME=unload_state
	G91
	M300
	G92 E0
	G1 E25 F{speed}
	G1 E-420 F{max_velocity}
	M300
	M300
	RESTORE_GCODE_STATE NAME=unload_state

[gcode_macro START_PRINT]
gcode = 
	
	{% set DWELL = params.DWELL|default(00)|int %}
	{% set bedTemp = params.BED|default(70)|int %}
	{% set hotendTemp = params.HOTEND|default(210)|int %}
	SET_FAN_SPEED FAN=LED_Bar SPEED=0.5
	CLEAR_PAUSE
	RESETSPEEDS
	G21
	G90
	M83
	M140 S{bedTemp}; start heating the bed
	M104 S100
	SET_DISPLAY_TEXT MSG="Waiting for temperatures..."
	HEATSOAK DWELL={DWELL}
	G28 X Y
	ATTACH_PROBE_LOCK
	G28 Z
	SET_DISPLAY_TEXT MSG="Adjusting Z Tilt"
	Z_TILT_ADJUST
	G28 Z
	
	SET_DISPLAY_TEXT MSG="Calibrating Bed Mesh"
	BED_MESH_CLEAR
	BED_MESH_CALIBRATE
	BED_MESH_PROFILE LOAD=default
	SET_DISPLAY_TEXT MSG="Heating Extruder to temp"
	G1 X1 Y1 Z0.5 F9000
	M109 S{hotendTemp}; wait for extruder to heat up
	TR_UNLOAD_TOOLHEAD
	TR_HOME
	FIXED_PURGE_LINE
	M83
	SET_DISPLAY_TEXT MSG="Printing..."
	TR_SYNC_TO_EXTRUDER

[gcode_macro HEATSOAK]
gcode = 
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion..."
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 5% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 10% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 15% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 20% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 25% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 30% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 35% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 40% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 45% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 50% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 55% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 60% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 65% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 70% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 75% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 80% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 85% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 90% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 95% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Thermal expansion done"

[gcode_macro _CG28]
gcode = 
	{% if "xyz" not in printer.toolhead.homed_axes %}
	G28
	{% endif %}

[gcode_macro FIXED_PURGE_LINE]
gcode = 
	M83
	G92 E0
	G1 Z1 F3000
	G1 X1 Y80 Z0.3 E10  F1200
	G1 X1 Y120 E11  F1200
	G1 E-0.8 F1000
	G92 E0
	G1 Z1 F2000

[gcode_macro END_PRINT]
gcode = 
	TR_UNLOAD_TOOLHEAD
	
	TURN_OFF_HEATERS
	G91
	G1 Z10 E-2 F3600
	
	G90
	G1 X30 Y250 F7000; home X axis
	M106 S80
	G4 P10000
	M106 S0
	M221 S100
	CLEAR_PAUSE
	
	SET_GCODE_OFFSET Z=0.0
	RESETSPEEDS
	
	M84
	BED_MESH_CLEAR
	SET_FAN_SPEED FAN=LED_Bar SPEED=0
	TR_UNSYNC_TO_EXTRUDER
	UPDATE_GIT

[gcode_macro PARK]
description = Park the toolhead at the front and retract some filament if the nozzle is hot
gcode = 
	{% set E = params.E|default(1.7)|float %}
	
	{% set Px, Py = printer["gcode_macro _USER_VARIABLES"].park_position_xy|map('float') %}
	{% set park_lift_z = printer["gcode_macro _USER_VARIABLES"].park_lift_z %}
	
	{% set St = printer["gcode_macro _USER_VARIABLES"].travel_speed * 60 %}
	{% set Sz = printer["gcode_macro _USER_VARIABLES"].z_drop_speed * 60 %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	
	{% set z_safe = act_z + park_lift_z %}
	{% if z_safe > max_z %}
	{% set z_safe = max_z %}
	{% endif %}
	
	
	{% if printer.extruder.temperature > 185 %}
	G10
	{% endif %}
	G90
	G1 Z{z_safe} F{Sz}
	
	G0 X{Px} Y{Py} F{St}

[gcode_macro RESETSPEEDS]
gcode = 
	SET_VELOCITY_LIMIT VELOCITY={printer.configfile.settings.printer.max_velocity}
	SET_VELOCITY_LIMIT ACCEL={printer.configfile.settings.printer.max_accel}
	SET_VELOCITY_LIMIT ACCEL_TO_DECEL={printer.configfile.settings.printer.max_accel_to_decel}
	SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={printer.configfile.settings.printer.square_corner_velocity}

[gcode_macro DISABLEXYE]
gcode = 
	SET_STEPPER_ENABLE STEPPER=extruder ENABLE=0
	SET_STEPPER_ENABLE STEPPER=stepper_x ENABLE=0
	
	SET_STEPPER_ENABLE STEPPER=stepper_y ENABLE=0
	
	SET_STEPPER_ENABLE STEPPER=stepper_z ENABLE=1

[gcode_macro TEST_SPEED]
gcode = 
	
	{% set speed  = params.SPEED|default(printer.configfile.settings.printer.max_velocity)|int %}
	
	{% set iterations = params.ITERATIONS|default(5)|int %}
	
	{% set accel  = params.ACCEL|default(printer.configfile.settings.printer.max_accel)|int %}
	
	{% set bound = params.BOUND|default(20)|int %}
	
	{% set smallpatternsize = SMALLPATTERNSIZE|default(20)|int %}
	
	
	
	{% set x_min = 10 + bound %}
	{% set x_max = 300 - bound %}
	{% set y_min = 10 + bound %}
	{% set y_max = 300 - bound %}
	
	
	
	{% set x_center = (printer.toolhead.axis_minimum.x|float + printer.toolhead.axis_maximum.x|float ) / 2 %}
	{% set y_center = (printer.toolhead.axis_minimum.y|float + printer.toolhead.axis_maximum.y|float ) / 2 %}
	
	
	{% set x_center_min = x_center - (smallpatternsize/2) %}
	{% set x_center_max = x_center + (smallpatternsize/2) %}
	{% set y_center_min = y_center - (smallpatternsize/2) %}
	{% set y_center_max = y_center + (smallpatternsize/2) %}
	
	
	SAVE_GCODE_STATE NAME=TEST_SPEED
	
	
	{ action_respond_info("TEST_SPEED: starting %d iterations at speed %d, accel %d" % (iterations, speed, accel)) }
	
	
	M400
	G28
	
	{% if printer.configfile.settings.quad_gantry_level %}
	{% if printer.quad_gantry_level.applied == False %}
	QUAD_GANTRY_LEVEL
	G28 Z
	{% endif %}
	{% endif %}
	
	G90
	G1 X{printer.toolhead.axis_maximum.x-50} Y{printer.toolhead.axis_maximum.y-50} F{30*60}
	M400
	G28 X Y
	G0 X{300} Y{300} F{30*60}
	G4 P1000
	GET_POSITION
	
	
	G0 X{x_min} Y{y_min} Z{bound + 10} F{speed*60}
	
	
	SET_VELOCITY_LIMIT VELOCITY={speed} ACCEL={accel} ACCEL_TO_DECEL={accel / 2}
	
	{% for i in range(iterations) %}
	
	G0 X{x_min} Y{y_min} F{speed*60}
	G0 X{x_max} Y{y_max} F{speed*60}
	G0 X{x_min} Y{y_min} F{speed*60}
	G0 X{x_max} Y{y_min} F{speed*60}
	G0 X{x_min} Y{y_max} F{speed*60}
	G0 X{x_max} Y{y_min} F{speed*60}
	
	
	G0 X{x_min} Y{y_min} F{speed*60}
	G0 X{x_min} Y{y_max} F{speed*60}
	G0 X{x_max} Y{y_max} F{speed*60}
	G0 X{x_max} Y{y_min} F{speed*60}
	
	
	G0 X{x_center_min} Y{y_center_min} F{speed*60}
	G0 X{x_center_max} Y{y_center_max} F{speed*60}
	G0 X{x_center_min} Y{y_center_min} F{speed*60}
	G0 X{x_center_max} Y{y_center_min} F{speed*60}
	G0 X{x_center_min} Y{y_center_max} F{speed*60}
	G0 X{x_center_max} Y{y_center_min} F{speed*60}
	
	
	G0 X{x_center_min} Y{y_center_min} F{speed*60}
	G0 X{x_center_min} Y{y_center_max} F{speed*60}
	G0 X{x_center_max} Y{y_center_max} F{speed*60}
	G0 X{x_center_max} Y{y_center_min} F{speed*60}
	{% endfor %}
	
	
	SET_VELOCITY_LIMIT VELOCITY={printer.configfile.settings.printer.max_velocity} ACCEL={printer.configfile.settings.printer.max_accel} ACCEL_TO_DECEL={printer.configfile.settings.printer.max_accel_to_decel}
	
	
	M400
	G28
	
	G90
	G0 X{300} Y{300} F{30*60}
	G4 P1000
	GET_POSITION
	
	
	RESTORE_GCODE_STATE NAME=TEST_SPEED

[gcode_macro update_git]
gcode = 
	RUN_SHELL_COMMAND CMD=update_git_script

[gcode_shell_command update_git_script]
command = bash /home/pi/klipper-backup/script.sh
timeout = 90.0
verbose = True

[mcu tr]
serial = /dev/serial/by-id/usb-Klipper_stm32g0b1xx_290023000950415833323720-if00

[belay my_belay]
extruder_type = trad_rack
sensor_pin = ^tr:PB9
multiplier_high = 1.05
multiplier_low = 0.8
debug_level = 1

[trad_rack]
sync_to_extruder = true
selector_max_velocity = 400
selector_max_accel = 10000
lane_count = 4
lane_spacing = 17.26
servo_down_angle = 0
servo_up_angle = 130
toolhead_unload_speed = 20
extruder_load_speed = 2
toolhead_sense_speed = 20
selector_unload_length = 20
bowden_length = 865
extruder_load_length = 60
hotend_load_length = 20
toolhead_unload_length = 80
buffer_pull_speed = 100.0
pre_unload_gcode = 
	SAVE_GCODE_STATE NAME=PRE_UNLOAD_state
	{% if printer.virtual_sdcard.is_active %}
	{% set z_max = printer.toolhead.axis_maximum.z - printer.gcode_move.homing_origin.z %}
	{% set z_lift = printer["gcode_macro TR_Variables"].z_lift|float %}
	{% set x_park = printer["gcode_macro TR_Variables"].x_park|float %}
	{% set y_park = printer["gcode_macro TR_Variables"].y_park|float %}
	{% set do_x_park = printer["gcode_macro TR_Variables"].do_x_park %}
	{% set do_y_park = printer["gcode_macro TR_Variables"].do_y_park %}
	{% set st = printer["gcode_macro TR_Variables"].travel_speed * 60 %}
	{% set shape_tip = printer["gcode_macro TR_Variables"].shape_tip %}
	{% set use_wiper = printer["gcode_macro TR_Variables"].use_wiper %}
	{% set x = printer.gcode_move.gcode_position.x %}
	{% set y = printer.gcode_move.gcode_position.y %}
	{% set z = printer.gcode_move.gcode_position.z %}
	{% set z_park = [z + z_lift, z_max]|min %}
	
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=x VALUE={x}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=y VALUE={y}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=z VALUE={z}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=saved_pos VALUE={True}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=z_park VALUE={z_park}
	
	
	G90
	G1 Z{z_park}
	
	
	{% if use_wiper %}
	Go_To_Purge_Location
	
	
	{% else %}
	G90
	{% if do_x_park %}
	{% set x = x_park %}
	{% endif %}
	{% if do_y_park %}
	{% set y = y_park %}
	{% endif %}
	G1 X{x} Y{y} F{st}
	{% endif %}
	
	
	{% if shape_tip %}
	Shape_Tip
	{% endif %}
	{% else %}
	
	{% if use_wiper %}
	Go_To_Purge_Location
	{% endif %}
	
	
	Shape_Tip
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRE_UNLOAD_state
post_load_gcode = 
	SAVE_GCODE_STATE NAME=POST_LOAD_state
	{% set use_wiper = printer["gcode_macro TR_Variables"].use_wiper %}
	{% if printer.virtual_sdcard.is_active %}
	{% set st = printer["gcode_macro TR_Variables"].travel_speed * 60 %}
	{% set take_frame = printer["gcode_macro TR_Variables"].take_frame %}
	{% set x = printer["gcode_macro TR_Variables"].x %}
	{% set y = printer["gcode_macro TR_Variables"].y %}
	{% set z = printer["gcode_macro TR_Variables"].z %}
	{% set saved_pos = printer["gcode_macro TR_Variables"].saved_pos %}
	{% set z_park = printer["gcode_macro TR_Variables"].z_park %}
	
	
	{% if take_frame %}
	TIMELAPSE_TAKE_FRAME
	{% endif %}
	
	
	{% if use_wiper %}
	Home_and_Wipe_Nozzle
	{% endif %}
	
	
	{% if saved_pos %}
	G90
	G1 Z{z_park}
	G1 X{x} Y{y} F{st}
	G1 Z{z}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=saved_pos VALUE={False}
	{% endif %}
	
	Restore_Pressure_Advance
	{% elif use_wiper %}
	Home_and_Wipe_Nozzle
	{% endif %}
	RESTORE_GCODE_STATE NAME=POST_LOAD_state

[stepper_tr_selector]
step_pin = tr:PB15
dir_pin = !tr:PB14
enable_pin = !tr:PA8
rotation_distance = 40
microsteps = 16
full_steps_per_rotation = 400
endstop_pin = ^tr:PA3
position_min = 0.0
position_endstop = 0
position_max = 158
homing_speed = 30

[stepper_tr_fil_driver]
step_pin = tr:PD2
dir_pin = tr:PB13
enable_pin = !tr:PD1
rotation_distance = 22.67895
gear_ratio = 50:17
microsteps = 16
full_steps_per_rotation = 400
endstop_pin = ^tr:PA4
position_min = -5000
position_endstop = 0
position_max = 5000
homing_positive_dir = False

[tmc2209 stepper_tr_selector]
uart_pin = tr:PA10
interpolate = True
run_current = 1.3
sense_resistor = 0.110

[tmc2209 stepper_tr_fil_driver]
uart_pin = tr:PC7
interpolate = False
run_current = 1.3
sense_resistor = 0.110

[servo tr_servo]
pin = tr:PA0
maximum_servo_angle = 131
minimum_pulse_width = 0.000700
maximum_pulse_width = 0.002200

[gcode_macro ACTIVATE_EXTRUDER]
rename_existing = ACTIVATE_EXTRUDER.1
gcode = 
	{% set EXTRUDER = params.EXTRUDER|default('extruder')|lower|replace('extruder', '') %}
	{% if EXTRUDER == '' %}
	{% set EXTRUDER = '0' %}
	{% endif %}
	TR_LOAD_TOOLHEAD LANE={EXTRUDER}

[gcode_macro TR_Variables]
description = Variables for use with Trad Rack pre unload and post load gcode
variable_z_lift = 0.1
variable_x_park = 0.0
variable_y_park = 175.0
variable_do_x_park = False
variable_do_y_park = False
variable_travel_speed = 300
variable_shape_tip = False
variable_take_frame = False
variable_use_wiper = False
variable_x = 0
variable_y = 0
variable_z = 0
variable_saved_pos = False
variable_z_park = 0
gcode = 

[gcode_macro Shape_Tip]
description = Perform tip-shaping, retraction, and cooling moves
gcode = 
	SAVE_GCODE_STATE NAME=Shape_Tip_state
	Save_Pressure_Advance
	
	Slicer_Unload
	
	
	Restore_Pressure_Advance
	RESTORE_GCODE_STATE NAME=Shape_Tip_state

[gcode_macro Set_Slicer_Unload_Preset]
description = Apply a preset of values to use for the Slicer_Unload macro
variable_asa_ss = {
	"filament_ramming_parameters": "120 110 5.32258 5.45161 5.67742 6 6.48387 7.12903 7.90323 8.70968 9.3871 9.83871 10.0968 10.2258| 0.05 5.30967 0.45 5.50967 0.95 6.1871 1.45 7.39677 1.95 9.05484 2.45 10 2.95 10.3098 3.45 13.0839 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": True}
variable_pla_ss = {
	"filament_ramming_parameters": "130 120 2.70968 2.93548 3.32258 3.83871 4.58065 5.54839 6.51613 7.35484 7.93548 8.16129| 0.05 2.66451 0.45 3.05805 0.95 4.05807 1.45 5.97742 1.95 7.69999 2.45 8.1936 2.95 11.342 3.45 11.4065 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": True}
variable_asa_ps = {
	"filament_ramming_parameters": "120 110 5.32258 5.45161 5.67742 6 6.48387 7.12903 7.90323 8.70968 9.3871 9.83871 10.0968 10.2258| 0.05 5.30967 0.45 5.50967 0.95 6.1871 1.45 7.39677 1.95 9.05484 2.45 10 2.95 10.3098 3.45 13.0839 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": False}
variable_pla_ps = {
	"filament_ramming_parameters": "130 120 2.70968 2.93548 3.32258 3.83871 4.58065 5.54839 6.51613 7.35484 7.93548 8.16129| 0.05 2.66451 0.45 3.05805 0.95 4.05807 1.45 5.97742 1.95 7.69999 2.45 8.1936 2.95 11.342 3.45 11.4065 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": False}
gcode = 
	{% set preset_name = params.PRESET|lower %}
	{% if preset_name in printer['gcode_macro Set_Slicer_Unload_Preset'] %}
	{% set preset = printer['gcode_macro Set_Slicer_Unload_Preset'].preset_name %}
	{% for key in preset %}
	SET_GCODE_VARIABLE MACRO=Slicer_Unload VARIABLE={key} VALUE={preset[key]}
	{% endfor %}
	{% else %}
	{ action_raise_error("Preset \"%s\" does not exist" % preset_name) }
	{% endif %}

[gcode_macro Slicer_Unload]
description = Mimic ramming and unload behavior of PrusaSlicer or SuperSlicer
variable_cooling_tube_length = 14
variable_cooling_tube_retraction = 30
variable_filament_cooling_final_speed = 30
variable_filament_cooling_initial_speed = 20
variable_filament_cooling_moves = 4
variable_filament_diameter = 1.75
variable_filament_unloading_speed = 90
variable_filament_unloading_speed_start = 100
variable_filament_toolchange_delay = 0
variable_filament_ramming_parameters = "120 110 5.32258 5.45161 5.67742 6 6.48387 7.12903 7.90323 8.70968 9.3871 9.83871 10.0968 10.2258| 0.05 5.30967 0.45 5.50967 0.95 6.1871 1.45 7.39677 1.95 9.05484 2.45 10 2.95 10.3098 3.45 13.0839 3.95 7.6 4.45 7.6 4.95 7.6"
variable_filament_enable_toolchange_temp = False
variable_filament_toolchange_temp = 200
variable_filament_use_fast_skinnydip = False
variable_filament_enable_toolchange_part_fan = False
variable_filament_toolchange_part_fan_speed = 50
variable_filament_use_skinnydip = True
variable_filament_skinnydip_distance = 24
variable_filament_melt_zone_pause = 0
variable_filament_cooling_zone_pause = 0
variable_filament_dip_insertion_speed = 33
variable_filament_dip_extraction_speed = 70
variable_superslicer = False
variable_do_ramming = False
variable_do_unload = True
gcode = 
	{% set NEW_TEMPERATURE = params.NEW_TEMPERATURE|default(0)|float %}
	{% set prev_temp_target = printer.extruder.target %}
	
	SAVE_GCODE_STATE NAME=Slicer_Unload_state
	Save_Pressure_Advance
	
	M83
	M220 S100
	SET_PRESSURE_ADVANCE ADVANCE=0
	
	
	{% if do_ramming %}
	
	{% set ramming_speed = (filament_ramming_parameters.split('|')[0]).split(' ') %}
	
	
	{% set filament_area = 3.1415 * (filament_diameter / 2) ** 2 %}
	
	
	{% for i in range(2, ramming_speed|length) %}
	
	{% set f = ramming_speed[i]|float / filament_area %}
	
	
	{% set e = f * 0.25 %}
	
	
	G1 E{e} F{f * 60}
	{% endfor %}
	{% endif %}
	
	
	{% if do_unload %}
	
	{% if superslicer and filament_enable_toolchange_temp and not filament_use_fast_skinnydip %}
	_Wait_for_Toolchange_Temp
	{% endif %}
	
	
	{% set total_retraction_distance = cooling_tube_retraction + cooling_tube_length / 2 - 15 %}
	G1 E-15 F{filament_unloading_speed_start * 60}
	G1 E-{0.70 * total_retraction_distance} F{1.0 * filament_unloading_speed * 60}
	G1 E-{0.20 * total_retraction_distance} F{0.5 * filament_unloading_speed * 60}
	G1 E-{0.10 * total_retraction_distance} F{0.3 * filament_unloading_speed * 60}
	
	
	{% if not superslicer or not filament_enable_toolchange_temp %}
	{% if NEW_TEMPERATURE != 0 and (NEW_TEMPERATURE != prev_temp_target) %}
	M104 S{NEW_TEMPERATURE}
	{% endif %}
	
	
	{% elif superslicer and filament_enable_toolchange_temp and not filament_use_fast_skinnydip %}
	{% if NEW_TEMPERATURE != 0 %}
	M104 S{NEW_TEMPERATURE}
	{% else %}
	M104 S{prev_temp_target}
	{% endif %}
	{% endif %}
	
	
	{% set speed_inc = (filament_cooling_final_speed - filament_cooling_initial_speed) / (2 * filament_cooling_moves - 1) %}
	{% for i in range(filament_cooling_moves) %}
	{% set speed = filament_cooling_initial_speed + speed_inc * 2 * i %}
	G1 E{cooling_tube_length} F{speed * 60}
	{% set speed = speed + speed_inc %}
	G1 E-{cooling_tube_length} F{speed * 60}
	{% endfor %}
	
	
	{% if superslicer %}
	
	{% if filament_enable_toolchange_temp and filament_use_fast_skinnydip %}
	_Wait_for_Toolchange_Temp
	{% endif %}
	
	
	{% if filament_use_skinnydip %}
	G1 E{filament_skinnydip_distance} F{filament_dip_insertion_speed * 60}
	G4 P{filament_melt_zone_pause}
	G1 E-{filament_skinnydip_distance} F{filament_dip_extraction_speed * 60}
	G4 P{filament_cooling_zone_pause}
	{% endif %}
	
	
	{% if filament_enable_toolchange_temp and filament_use_fast_skinnydip %}
	{% if NEW_TEMPERATURE != 0 %}
	M109 S{NEW_TEMPERATURE}
	{% else %}
	M109 S{prev_temp_target}
	{% endif %}
	{% elif filament_enable_toolchange_temp and filament_use_fast_skinnydip %}
	{% if NEW_TEMPERATURE != 0 and (NEW_TEMPERATURE != prev_temp_target) %}
	M109 S{NEW_TEMPERATURE}
	{% endif %}
	{% endif %}
	{% endif %}
	
	
	G4 P{filament_toolchange_delay}
	
	
	
	{% endif %}
	
	Restore_Pressure_Advance
	RESTORE_GCODE_STATE NAME=Slicer_Unload_state

[gcode_macro _Wait_for_Toolchange_Temp]
description = Helper function for Slicer_Unload
gcode = 
	{% set tc_temp = printer["gcode_macro Slicer_Unload"].filament_toolchange_temp %}
	{% set fan_on = printer["gcode_macro Slicer_Unload"].filament_enable_toolchange_part_fan %}
	{% set fan_speed = printer["gcode_macro Slicer_Unload"].filament_toolchange_part_fan_speed %}
	
	{% set prev_fan_speed = printer.fan.speed %}
	{% if fan_on %}
	M106 S{(fan_speed / 100.0 * 255)|int}
	{% endif %}
	M109 S{filament_toolchange_temp}
	{% if fan_on %}
	M106 S{(prev_fan_speed * 255)|int}
	{% endif %}

[gcode_macro Home_and_Wipe_Nozzle]
description = Home x and y if needed, then wipe the nozzle
gcode = 
	
	{% if not 'xy' in printer.toolhead.homed_axes %}
	G28 X Y
	{% endif %}
	
	
	Wipe_Nozzle

[gcode_macro Save_Pressure_Advance]
description = Save the current pressure advance value
variable_pa = -1
gcode = 
	
	{% set pa = printer.extruder.pressure_advance %}
	{% if pa > 0 %}
	SET_GCODE_VARIABLE MACRO=Save_Pressure_Advance VARIABLE=pa VALUE={pa}
	{% endif %}

[gcode_macro Restore_Pressure_Advance]
description = Restore saved pressure advance value
gcode = 
	
	{% if not (printer["gcode_macro Save_Pressure_Advance"].pa == -1) %}
	SET_PRESSURE_ADVANCE ADVANCE={printer["gcode_macro Save_Pressure_Advance"].pa}
	{% endif %}

[safe_z_home]
home_xy_position = 165, 165
z_hop = 10

[z_tilt]
z_positions = 
	-80,  -20
	350, -20
points = 
	15, 150
	275, 150
speed = 50
horizontal_move_z = 10
retries = 30
retry_tolerance = 0.1

[input_shaper]
shaper_type_x = zv
shaper_freq_x = 120.6
shaper_type_y = zv
shaper_freq_y = 76.6

[cartographer]
serial = /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00
speed = 40.
lift_speed = 5.
backlash_comp = 0.5
x_offset = 0.
y_offset = 21.1
trigger_distance = 2.
trigger_dive_threshold = 1.5
trigger_hysteresis = 0.006
cal_nozzle_z = 0.1
cal_floor = 0.1
cal_ceil = 5.
cal_speed = 1.0
cal_move_speed = 10.
default_model_name = default
mesh_main_direction = X
mesh_cluster_size = 1
mesh_runs = 2

[printer]
kinematics = corexy
max_velocity = 3000
max_accel = 20000
max_z_velocity = 20
max_z_accel = 15
square_corner_velocity = 10

[exclude_object]

[gcode_arcs]
resolution = 0.05

[idle_timeout]
gcode = 
	{% if not printer.pause_resume.is_paused %}
	TURN_OFF_HEATERS
	M84
	{% endif %}

[save_variables]
filename = vars.cfg

[mcu]
serial = /dev/serial/by-id/usb-Klipper_stm32h723xx_4C0023001551313338343730-if00

[bed_mesh default]
version = 1
points = 
	-0.215000, -0.210000, -0.190000, -0.185000, -0.170000, -0.145000, -0.135000, -0.120000, -0.105000, -0.070000, -0.055000, -0.035000, 0.000000, 0.010000, 0.025000, 0.050000, 0.080000, 0.105000, 0.130000, 0.135000, 0.150000, 0.155000, 0.165000, 0.190000, 0.205000
	-0.160000, -0.155000, -0.160000, -0.150000, -0.130000, -0.110000, -0.105000, -0.085000, -0.055000, -0.035000, -0.025000, 0.000000, 0.025000, 0.055000, 0.075000, 0.100000, 0.110000, 0.130000, 0.160000, 0.170000, 0.190000, 0.190000, 0.205000, 0.205000, 0.220000
	-0.160000, -0.150000, -0.140000, -0.135000, -0.115000, -0.105000, -0.090000, -0.070000, -0.040000, -0.025000, -0.010000, 0.015000, 0.030000, 0.045000, 0.080000, 0.100000, 0.115000, 0.135000, 0.160000, 0.165000, 0.180000, 0.185000, 0.190000, 0.220000, 0.235000
	-0.120000, -0.115000, -0.115000, -0.100000, -0.080000, -0.070000, -0.065000, -0.040000, -0.015000, 0.010000, 0.030000, 0.050000, 0.065000, 0.090000, 0.110000, 0.130000, 0.145000, 0.175000, 0.195000, 0.195000, 0.195000, 0.205000, 0.210000, 0.235000, 0.240000
	-0.075000, -0.065000, -0.055000, -0.045000, -0.040000, -0.020000, -0.005000, 0.015000, 0.035000, 0.065000, 0.075000, 0.090000, 0.105000, 0.115000, 0.140000, 0.170000, 0.175000, 0.190000, 0.205000, 0.205000, 0.205000, 0.210000, 0.215000, 0.240000, 0.240000
	-0.045000, -0.050000, -0.055000, -0.045000, -0.015000, -0.005000, -0.005000, 0.020000, 0.060000, 0.065000, 0.075000, 0.100000, 0.115000, 0.125000, 0.135000, 0.170000, 0.175000, 0.175000, 0.205000, 0.205000, 0.205000, 0.205000, 0.210000, 0.220000, 0.225000
	-0.035000, -0.030000, -0.030000, -0.020000, 0.000000, 0.015000, 0.015000, 0.035000, 0.065000, 0.085000, 0.100000, 0.110000, 0.115000, 0.130000, 0.160000, 0.170000, 0.180000, 0.180000, 0.200000, 0.200000, 0.200000, 0.205000, 0.205000, 0.220000, 0.235000
	0.005000, 0.010000, 0.015000, 0.025000, 0.035000, 0.040000, 0.055000, 0.085000, 0.095000, 0.110000, 0.115000, 0.125000, 0.140000, 0.160000, 0.175000, 0.180000, 0.190000, 0.190000, 0.225000, 0.225000, 0.225000, 0.225000, 0.230000, 0.235000, 0.250000
	0.055000, 0.065000, 0.060000, 0.065000, 0.075000, 0.090000, 0.100000, 0.110000, 0.120000, 0.130000, 0.140000, 0.155000, 0.170000, 0.180000, 0.190000, 0.195000, 0.210000, 0.220000, 0.235000, 0.235000, 0.235000, 0.235000, 0.245000, 0.250000, 0.260000
	0.100000, 0.105000, 0.110000, 0.110000, 0.120000, 0.135000, 0.145000, 0.150000, 0.155000, 0.155000, 0.170000, 0.185000, 0.190000, 0.195000, 0.195000, 0.215000, 0.230000, 0.235000, 0.245000, 0.245000, 0.245000, 0.235000, 0.245000, 0.250000, 0.260000
	0.100000, 0.115000, 0.125000, 0.130000, 0.135000, 0.145000, 0.150000, 0.155000, 0.165000, 0.175000, 0.190000, 0.200000, 0.205000, 0.205000, 0.215000, 0.225000, 0.230000, 0.245000, 0.255000, 0.240000, 0.240000, 0.240000, 0.245000, 0.250000, 0.250000
	0.155000, 0.150000, 0.150000, 0.150000, 0.160000, 0.165000, 0.165000, 0.175000, 0.175000, 0.195000, 0.200000, 0.215000, 0.205000, 0.210000, 0.215000, 0.225000, 0.235000, 0.240000, 0.245000, 0.240000, 0.240000, 0.235000, 0.220000, 0.235000, 0.240000
	0.170000, 0.165000, 0.165000, 0.170000, 0.180000, 0.190000, 0.190000, 0.185000, 0.200000, 0.205000, 0.220000, 0.230000, 0.225000, 0.225000, 0.240000, 0.245000, 0.240000, 0.250000, 0.255000, 0.245000, 0.250000, 0.245000, 0.245000, 0.240000, 0.240000
	0.210000, 0.200000, 0.195000, 0.200000, 0.210000, 0.210000, 0.210000, 0.215000, 0.215000, 0.215000, 0.235000, 0.245000, 0.235000, 0.235000, 0.245000, 0.250000, 0.240000, 0.250000, 0.250000, 0.250000, 0.255000, 0.250000, 0.235000, 0.235000, 0.240000
	0.240000, 0.250000, 0.250000, 0.245000, 0.260000, 0.260000, 0.255000, 0.255000, 0.255000, 0.250000, 0.265000, 0.265000, 0.260000, 0.255000, 0.260000, 0.255000, 0.255000, 0.270000, 0.260000, 0.255000, 0.250000, 0.255000, 0.245000, 0.250000, 0.240000
	0.270000, 0.260000, 0.255000, 0.265000, 0.265000, 0.265000, 0.265000, 0.260000, 0.260000, 0.255000, 0.265000, 0.265000, 0.265000, 0.255000, 0.255000, 0.250000, 0.255000, 0.250000, 0.250000, 0.245000, 0.245000, 0.235000, 0.230000, 0.235000, 0.240000
	0.275000, 0.280000, 0.275000, 0.275000, 0.275000, 0.275000, 0.275000, 0.275000, 0.280000, 0.280000, 0.280000, 0.270000, 0.270000, 0.270000, 0.265000, 0.265000, 0.265000, 0.270000, 0.260000, 0.255000, 0.235000, 0.235000, 0.235000, 0.240000, 0.235000
	0.335000, 0.315000, 0.305000, 0.310000, 0.305000, 0.300000, 0.295000, 0.290000, 0.300000, 0.295000, 0.290000, 0.290000, 0.280000, 0.270000, 0.270000, 0.275000, 0.275000, 0.265000, 0.250000, 0.245000, 0.235000, 0.225000, 0.225000, 0.230000, 0.235000
	0.355000, 0.350000, 0.345000, 0.325000, 0.330000, 0.325000, 0.325000, 0.325000, 0.315000, 0.310000, 0.300000, 0.290000, 0.285000, 0.290000, 0.275000, 0.275000, 0.265000, 0.265000, 0.250000, 0.245000, 0.235000, 0.225000, 0.230000, 0.225000, 0.215000
	0.395000, 0.385000, 0.380000, 0.370000, 0.365000, 0.370000, 0.360000, 0.355000, 0.345000, 0.340000, 0.330000, 0.320000, 0.310000, 0.305000, 0.300000, 0.290000, 0.275000, 0.260000, 0.255000, 0.255000, 0.250000, 0.235000, 0.230000, 0.230000, 0.230000
	0.395000, 0.390000, 0.375000, 0.375000, 0.375000, 0.370000, 0.365000, 0.360000, 0.355000, 0.335000, 0.325000, 0.315000, 0.315000, 0.300000, 0.295000, 0.280000, 0.255000, 0.260000, 0.250000, 0.240000, 0.230000, 0.235000, 0.230000, 0.205000, 0.195000
	0.405000, 0.395000, 0.395000, 0.390000, 0.380000, 0.375000, 0.370000, 0.360000, 0.355000, 0.345000, 0.325000, 0.325000, 0.310000, 0.295000, 0.290000, 0.270000, 0.250000, 0.240000, 0.235000, 0.235000, 0.230000, 0.205000, 0.195000, 0.195000, 0.195000
	0.405000, 0.395000, 0.380000, 0.375000, 0.375000, 0.370000, 0.360000, 0.345000, 0.340000, 0.330000, 0.305000, 0.300000, 0.285000, 0.270000, 0.250000, 0.235000, 0.220000, 0.215000, 0.220000, 0.205000, 0.195000, 0.175000, 0.175000, 0.170000, 0.165000
	0.405000, 0.390000, 0.395000, 0.385000, 0.365000, 0.350000, 0.345000, 0.330000, 0.320000, 0.305000, 0.290000, 0.265000, 0.260000, 0.240000, 0.225000, 0.215000, 0.205000, 0.190000, 0.180000, 0.185000, 0.165000, 0.150000, 0.145000, 0.145000, 0.145000
	0.430000, 0.425000, 0.400000, 0.395000, 0.385000, 0.370000, 0.365000, 0.340000, 0.320000, 0.305000, 0.295000, 0.270000, 0.250000, 0.235000, 0.215000, 0.215000, 0.200000, 0.190000, 0.185000, 0.165000, 0.155000, 0.145000, 0.135000, 0.130000, 0.135000
x_count = 25
y_count = 25
mesh_x_pps = 3
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 310.0
min_y = 26.43
max_y = 281.31
=======================
Extruder max_extrude_ratio=41.575169
mcu 'mcu': Starting serial connect
webhooks client 140734117620752: New connection
webhooks client 140734117620752: Client info {'program': 'Moonraker', 'version': 'v0.8.0-308-g71b46cc'}
Loaded MCU 'mcu' 117 commands (v0.12.0-61-gb50d6669 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1_PB6_PB7=PB6,PB7 BUS_PINS_i2c1_PB8_PB9=PB8,PB9 BUS_PINS_i2c2_PB10_PB11=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi2a=PC2,PC3,PB10 BUS_PINS_spi3a=PC11,PC12,PC10 BUS_PINS_spi4=PE13,PE14,PE12 BUS_PINS_spi5=PF8,PF9,PF7 BUS_PINS_spi5a=PH7,PF11,PH6 BUS_PINS_spi6=PG12,PG14,PG13 CLOCK_FREQ=400000000 MCU=stm32h723xx PWM_MAX=255 RESERVE_PINS_USB=PA11,PA12 RESERVE_PINS_crystal=PH0,PH1 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
mcu 'tr': Starting serial connect
Loaded MCU 'tr' 106 commands (v0.12.0-102-g9f41f53c / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'tr' config: ADC_MAX=4095 BUS_PINS_i2c1_PA9_PA10=PA9,PA10 BUS_PINS_i2c1_PB6_PB7=PB6,PB7 BUS_PINS_i2c1_PB8_PB9=PB8,PB9 BUS_PINS_i2c2_PB10_PB11=PB10,PB11 BUS_PINS_i2c2_PB13_PB14=PB13,PB14 BUS_PINS_i2c3_PB3_PB4=PB3,PB4 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi2a=PC2,PC3,PB10 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=64000000 MCU=stm32g0b1xx PWM_MAX=255 RESERVE_PINS_USB=PA11,PA12 RESERVE_PINS_crystal=PF0,PF1 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
mcu_temperature 'mcu' nominal base=-274.819277 slope=1644.578313
mcu 'cartographer': Starting serial connect
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
mcu 'cartographer': Unable to open serial port: [Errno 2] could not open port /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00: [Errno 2] No such file or directory: '/dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00'
MCU error during connect
Traceback (most recent call last):
  File "/home/pi/klipper/klippy/mcu.py", line 768, in _mcu_identify
    self._serial.connect_uart(self._serialport, self._baud, rts)
  File "/home/pi/klipper/klippy/serialhdl.py", line 182, in connect_uart
    self._error("Unable to connect")
  File "/home/pi/klipper/klippy/serialhdl.py", line 61, in _error
    raise error(self.warn_prefix + (msg % params))
serialhdl.error: mcu 'cartographer': Unable to connect

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/pi/klipper/klippy/klippy.py", line 176, in _connect
    self.send_event("klippy:mcu_identify")
  File "/home/pi/klipper/klippy/klippy.py", line 263, in send_event
    return [cb(*params) for cb in self.event_handlers.get(event, [])]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/klipper/klippy/klippy.py", line 263, in <listcomp>
    return [cb(*params) for cb in self.event_handlers.get(event, [])]
            ^^^^^^^^^^^
  File "/home/pi/klipper/klippy/mcu.py", line 773, in _mcu_identify
    raise error(str(e))
mcu.error: mcu 'cartographer': Unable to connect
Build file /home/pi/klipper/klippy/../.config(3424): Sun Feb  4 11:55:53 2024
========= Last MCU build config =========
CONFIG_LOW_LEVEL_OPTIONS=y
# CONFIG_MACH_AVR is not set
# CONFIG_MACH_ATSAM is not set
# CONFIG_MACH_ATSAMD is not set
# CONFIG_MACH_LPC176X is not set
CONFIG_MACH_STM32=y
# CONFIG_MACH_HC32F460 is not set
# CONFIG_MACH_RP2040 is not set
# CONFIG_MACH_PRU is not set
# CONFIG_MACH_AR100 is not set
# CONFIG_MACH_LINUX is not set
# CONFIG_MACH_SIMU is not set
CONFIG_BOARD_DIRECTORY="stm32"
CONFIG_MCU="stm32h723xx"
CONFIG_CLOCK_FREQ=400000000
CONFIG_USBSERIAL=y
CONFIG_FLASH_SIZE=0x40000
CONFIG_FLASH_BOOT_ADDRESS=0x8000000
CONFIG_RAM_START=0x20000000
CONFIG_RAM_SIZE=0x20000
CONFIG_STACK_SIZE=512
CONFIG_FLASH_APPLICATION_ADDRESS=0x8020000
CONFIG_STM32_SELECT=y
# CONFIG_MACH_STM32F103 is not set
# CONFIG_MACH_STM32F207 is not set
# CONFIG_MACH_STM32F401 is not set
# CONFIG_MACH_STM32F405 is not set
# CONFIG_MACH_STM32F407 is not set
# CONFIG_MACH_STM32F429 is not set
# CONFIG_MACH_STM32F446 is not set
# CONFIG_MACH_STM32F765 is not set
# CONFIG_MACH_STM32F031 is not set
# CONFIG_MACH_STM32F042 is not set
# CONFIG_MACH_STM32F070 is not set
# CONFIG_MACH_STM32F072 is not set
# CONFIG_MACH_STM32G070 is not set
# CONFIG_MACH_STM32G071 is not set
# CONFIG_MACH_STM32G0B0 is not set
# CONFIG_MACH_STM32G0B1 is not set
# CONFIG_MACH_STM32G431 is not set
CONFIG_MACH_STM32H723=y
# CONFIG_MACH_STM32H743 is not set
# CONFIG_MACH_STM32H750 is not set
# CONFIG_MACH_STM32L412 is not set
# CONFIG_MACH_N32G452 is not set
# CONFIG_MACH_N32G455 is not set
CONFIG_MACH_STM32H7=y
CONFIG_HAVE_STM32_USBOTG=y
CONFIG_HAVE_STM32_FDCANBUS=y
CONFIG_HAVE_STM32_USBCANBUS=y
CONFIG_STM32_DFU_ROM_ADDRESS=0x1ff09800
CONFIG_STM32_FLASH_START_20000=y
# CONFIG_STM32_FLASH_START_0000 is not set
# CONFIG_STM32_CLOCK_REF_8M is not set
# CONFIG_STM32_CLOCK_REF_12M is not set
# CONFIG_STM32_CLOCK_REF_16M is not set
# CONFIG_STM32_CLOCK_REF_20M is not set
# CONFIG_STM32_CLOCK_REF_24M is not set
CONFIG_STM32_CLOCK_REF_25M=y
# CONFIG_STM32_CLOCK_REF_INTERNAL is not set
CONFIG_CLOCK_REF_FREQ=25000000
CONFIG_STM32F0_TRIM=16
CONFIG_STM32_USB_PA11_PA12=y
# CONFIG_STM32_SERIAL_USART1 is not set
# CONFIG_STM32_SERIAL_USART1_ALT_PB7_PB6 is not set
# CONFIG_STM32_SERIAL_USART2 is not set
# CONFIG_STM32_SERIAL_USART2_ALT_PD6_PD5 is not set
# CONFIG_STM32_SERIAL_USART3 is not set
# CONFIG_STM32_SERIAL_USART3_ALT_PD9_PD8 is not set
# CONFIG_STM32_SERIAL_UART4 is not set
# CONFIG_STM32_CANBUS_PA11_PA12 is not set
# CONFIG_STM32_CANBUS_PA11_PB9 is not set
# CONFIG_STM32_MMENU_CANBUS_PB8_PB9 is not set
# CONFIG_STM32_MMENU_CANBUS_PB12_PB13 is not set
# CONFIG_STM32_MMENU_CANBUS_PD0_PD1 is not set
# CONFIG_STM32_MMENU_CANBUS_PB0_PB1 is not set
# CONFIG_STM32_MMENU_CANBUS_PD12_PD13 is not set
# CONFIG_STM32_MMENU_CANBUS_PC2_PC3 is not set
# CONFIG_STM32_USBCANBUS_PA11_PA12 is not set
CONFIG_USB=y
CONFIG_USB_VENDOR_ID=0x1d50
CONFIG_USB_DEVICE_ID=0x614e
CONFIG_USB_SERIAL_NUMBER_CHIPID=y
CONFIG_USB_SERIAL_NUMBER="12345"

#
# USB ids
#
# end of USB ids

CONFIG_WANT_GPIO_BITBANGING=y
CONFIG_WANT_DISPLAYS=y
CONFIG_WANT_SENSORS=y
CONFIG_WANT_LIS2DW=y
CONFIG_WANT_SOFTWARE_I2C=y
CONFIG_WANT_SOFTWARE_SPI=y
CONFIG_NEED_SENSOR_BULK=y
CONFIG_CANBUS_FREQUENCY=1000000
CONFIG_INITIAL_PINS=""
CONFIG_HAVE_GPIO=y
CONFIG_HAVE_GPIO_ADC=y
CONFIG_HAVE_GPIO_SPI=y
CONFIG_HAVE_GPIO_I2C=y
CONFIG_HAVE_GPIO_HARD_PWM=y
CONFIG_HAVE_STRICT_TIMING=y
CONFIG_HAVE_CHIPID=y
CONFIG_HAVE_STEPPER_BOTH_EDGE=y
CONFIG_HAVE_BOOTLOADER_REQUEST=y
CONFIG_INLINE_STEPPER_HACK=y
=======================
Build file /home/pi/klipper/klippy/../out/klipper.dict(7712): Sun Feb  4 11:56:28 2024
Last MCU build version: v0.12.0-102-g9f41f53c
Last MCU build tools: gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40
Last MCU build config: ADC_MAX=4095 BUS_PINS_i2c1_PB6_PB7=PB6,PB7 BUS_PINS_i2c1_PB8_PB9=PB8,PB9 BUS_PINS_i2c2_PB10_PB11=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi2a=PC2,PC3,PB10 BUS_PINS_spi3a=PC11,PC12,PC10 BUS_PINS_spi4=PE13,PE14,PE12 BUS_PINS_spi5=PF8,PF9,PF7 BUS_PINS_spi5a=PH7,PF11,PH6 BUS_PINS_spi6=PG12,PG14,PG13 CLOCK_FREQ=400000000 MCU=stm32h723xx PWM_MAX=255 RESERVE_PINS_USB=PA11,PA12 RESERVE_PINS_crystal=PH0,PH1 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Build file /home/pi/klipper/klippy/../out/klipper.elf(1520408): Sun Feb  4 11:56:32 2024
Attempting MCU 'mcu' reset command
b'Got EOF when reading from device'
Attempting MCU 'tr' reset command
b'Got EOF when reading from device'
Attempting MCU 'cartographer' reset
webhooks client 140734117620752: Disconnected
Restarting printer
Start printer at Mon Feb  5 16:29:53 2024 (1707150593.5 96509.3)
===== Config file =====
[virtual_sdcard]
path = /home/pi/printer_data/gcodes
on_error_gcode = CANCEL_PRINT

[pause_resume]
recover_velocity = 350

[display_status]

[respond]

[gcode_macro CANCEL_PRINT]
description = Cancel the actual running print
rename_existing = CANCEL_PRINT_BASE
gcode = 
	TURN_OFF_HEATERS
	G91
	G1 Z10 E-2 F3600
	G1 E-3 F3600
	G90
	G1 X30 Y250 F7000; home X axis
	M106 S80
	G4 P10000
	M106 S0
	M221 S100
	CANCEL_PRINT_BASE
	CLEAR_PAUSE
	
	SET_GCODE_OFFSET Z=0.0
	RESETSPEEDS
	M84
	
	BED_MESH_CLEAR

[gcode_macro PAUSE]
description = Pause the actual running print
rename_existing = BASE_PAUSE
gcode = 
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	
	{% set x_park = printer.toolhead.axis_maximum.x|float - 5.0 %}
	{% set y_park = printer.toolhead.axis_maximum.y|float - 5.0 %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	{% if act_z < (max_z - 2.0) %}
	{% set z_safe = 2.0 %}
	{% else %}
	{% set z_safe = max_z - act_z %}
	{% endif %}
	
	SAVE_GCODE_STATE NAME=PAUSE_state
	BASE_PAUSE
	SET_IDLE_TIMEOUT TIMEOUT=7200
	G91
	G1 E-{1} F2100
	G1 Z{10} F900
	G90
	G1 X{50} Y{0} F6000
variable_extrude = 1.0

[gcode_macro RESUME]
description = Resume the actual running print
rename_existing = BASE_RESUME
variable_last_extruder_temp = {'restore': False, 'temp': 0}
variable_restore_idle_timeout = 0
variable_idle_state = False
gcode = 
	
	{% set E = printer["gcode_macro PAUSE"].extrude|float %}
	
	G91
	G1 E{1} F2100
	RESTORE_GCODE_STATE NAME=PAUSE_state
	BASE_RESUME

[gcode_macro SET_PAUSE_NEXT_LAYER]
description = Enable a pause if the next layer is reached
gcode = 
	{% set pause_next_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_next_layer %}
	{% set ENABLE = params.ENABLE|default(1)|int != 0 %}
	{% set MACRO = params.MACRO|default(pause_next_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_next_layer VALUE="{{ 'enable': ENABLE, 'call': MACRO }}"

[gcode_macro SET_PAUSE_AT_LAYER]
description = Enable/disable a pause if a given layer number is reached
gcode = 
	{% set pause_at_layer = printer['gcode_macro SET_PRINT_STATS_INFO'].pause_at_layer %}
	{% set ENABLE = params.ENABLE|int != 0 if params.ENABLE is defined
	else params.LAYER is defined %}
	{% set LAYER = params.LAYER|default(pause_at_layer.layer)|int %}
	{% set MACRO = params.MACRO|default(pause_at_layer.call, True) %}
	SET_GCODE_VARIABLE MACRO=SET_PRINT_STATS_INFO VARIABLE=pause_at_layer VALUE="{{ 'enable': ENABLE, 'layer': LAYER, 'call': MACRO }}"

[gcode_macro SET_PRINT_STATS_INFO]
rename_existing = SET_PRINT_STATS_INFO_BASE
description = Overwrite, to get pause_next_layer and pause_at_layer feature
variable_pause_next_layer = { 'enable': False, 'call': "PAUSE" }
variable_pause_at_layer = { 'enable': False, 'layer': 0, 'call': "PAUSE" }
gcode = 
	{% if pause_next_layer.enable %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_next_layer" % pause_next_layer.call}'
	{pause_next_layer.call}
	SET_PAUSE_NEXT_LAYER ENABLE=0
	{% elif pause_at_layer.enable and params.CURRENT_LAYER is defined and params.CURRENT_LAYER|int == pause_at_layer.layer %}
	RESPOND TYPE=echo MSG='{"%s, forced by pause_at_layer [%d]" % (pause_at_layer.call, pause_at_layer.layer)}'
	{pause_at_layer.call}
	SET_PAUSE_AT_LAYER ENABLE=0
	{% endif %}
	SET_PRINT_STATS_INFO_BASE {rawparams}

[gcode_macro _TOOLHEAD_PARK_PAUSE_CANCEL]
description = Helper: park toolhead used in PAUSE and CANCEL_PRINT
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set velocity = printer.configfile.settings.pause_resume.recover_velocity %}
	{% set use_custom     = client.use_custom_pos|default(false)|lower == 'true' %}
	{% set custom_park_x  = client.custom_park_x|default(0.0) %}
	{% set custom_park_y  = client.custom_park_y|default(0.0) %}
	{% set park_dz        = client.custom_park_dz|default(2.0)|abs %}
	{% set sp_hop         = client.speed_hop|default(15) * 60 %}
	{% set sp_move        = client.speed_move|default(velocity) * 60 %}
	
	{% set origin    = printer.gcode_move.homing_origin %}
	{% set act       = printer.gcode_move.gcode_position %}
	{% set max       = printer.toolhead.axis_maximum %}
	{% set cone      = printer.toolhead.cone_start_z|default(max.z) %}
	{% set round_bed = True if printer.configfile.settings.printer.kinematics is in ['delta','polar','rotary_delta','winch']
	else False %}
	
	{% set z_min = params.Z_MIN|default(0)|float %}
	{% set z_park = [[(act.z + park_dz), z_min]|max, (max.z - origin.z)]|min %}
	{% set x_park = params.X       if params.X is defined
	else custom_park_x  if use_custom
	else 0.0            if round_bed
	else (max.x - 5.0) %}
	{% set y_park = params.Y       if params.Y is defined
	else custom_park_y  if use_custom
	else (max.y - 5.0)  if round_bed and z_park < cone
	else 0.0            if round_bed
	else (max.y - 5.0) %}
	
	_CLIENT_RETRACT
	{% if "xyz" in printer.toolhead.homed_axes %}
	G90
	G1 Z{z_park} F{sp_hop}
	G1 X{x_park} Y{y_park} F{sp_move}
	{% if not printer.gcode_move.absolute_coordinates %} G91 {% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='Printer not homed'
	{% endif %}

[gcode_macro _CLIENT_EXTRUDE]
description = Extrudes, if the extruder is hot enough
gcode = 
	
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set use_fw_retract = (client.use_fw_retract|default(false)|lower == 'true') and (printer.firmware_retraction is defined) %}
	{% set length = params.LENGTH|default(client.unretract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_unretract)|default(35) %}
	{% set absolute_extrude = printer.gcode_move.absolute_extrude %}
	
	{% if printer.toolhead.extruder != '' %}
	{% if printer[printer.toolhead.extruder].can_extrude %}
	{% if use_fw_retract %}
	{% if length < 0 %}
	G10
	{% else %}
	G11
	{% endif %}
	{% else %}
	M83
	G1 E{length} F{(speed|float|abs) * 60}
	{% if absolute_extrude %}
	M82
	{% endif %}
	{% endif %}
	{% else %}
	RESPOND TYPE=echo MSG='{"\"%s\" not hot enough" % printer.toolhead.extruder}'
	{% endif %}
	{% endif %}

[gcode_macro _CLIENT_RETRACT]
description = Retracts, if the extruder is hot enough
gcode = 
	{% set client = printer['gcode_macro _CLIENT_VARIABLE']|default({}) %}
	{% set length = params.LENGTH|default(client.retract)|default(1.0)|float %}
	{% set speed = params.SPEED|default(client.speed_retract)|default(35) %}
	
	_CLIENT_EXTRUDE LENGTH=-{length|float|abs} SPEED={speed|float|abs}

[tmc5160 extruder]
cs_pin = PA10
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 0.65
sense_resistor = 0.075
stealthchop_threshold = 0

[extruder]
rotation_distance = 5.7
full_steps_per_rotation = 200
sensor_type = PT1000
min_temp = 0
max_temp = 330
filament_diameter = 1.750
dir_pin = !PB6
step_pin = PG15
enable_pin = !PG14
heater_pin = PF6
sensor_pin = PB1
microsteps = 16
max_extrude_only_distance = 101
max_extrude_cross_section = 100
nozzle_diameter = 0.600
pressure_advance = 0.015
pressure_advance_smooth_time = 0.02
control = pid
pid_kp = 22.354
pid_ki = 1.552
pid_kd = 80.473

[tmc5160 stepper_x]
cs_pin = PD6
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
diag1_pin = PC15
run_current = 2.00
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_x]
dir_pin = !PC13
step_pin = PC14
enable_pin = !PE6
endstop_pin = PC15
microsteps = 16
rotation_distance = 40
position_endstop = -6
position_min = -6
position_max = 330
homing_speed = 20
full_steps_per_rotation = 200
homing_retract_dist = 0
homing_positive_dir = false
step_pulse_duration = 0.000001

[tmc5160 stepper_x1]
cs_pin = PD5
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2.00
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_x1]
dir_pin = !PE4
step_pin = PE5
enable_pin = !PE3
microsteps = 16
rotation_distance = 40
full_steps_per_rotation = 200
step_pulse_duration = 0.000001

[tmc5160 stepper_y]
cs_pin = PD4
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_y]
dir_pin = !PE1
step_pin = PE2
enable_pin = !PE0
endstop_pin = PF0
microsteps = 16
rotation_distance = 40
position_endstop = 0
position_min = 0
position_max = 315
homing_speed = 20
full_steps_per_rotation = 200
homing_retract_dist = 0
homing_positive_dir = false
step_pulse_duration = 0.000001

[tmc5160 stepper_y1]
cs_pin = PD3
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 2
sense_resistor = 0.022
stealthchop_threshold = 0

[stepper_y1]
dir_pin = !PB8
step_pin = PB9
enable_pin = !PB7
microsteps = 16
rotation_distance = 40
full_steps_per_rotation = 200
step_pulse_duration = 0.000001

[tmc5160 stepper_z]
cs_pin = PD2
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 1
sense_resistor = 0.075
stealthchop_threshold = 0

[stepper_z]
dir_pin = !PG10
step_pin = PG9
enable_pin = !PG13
endstop_pin = probe:z_virtual_endstop
microsteps = 16
rotation_distance = 8
position_min = -20
position_max = 400
full_steps_per_rotation = 200
homing_retract_dist = 5.0
homing_positive_dir = false
homing_speed = 3
second_homing_speed = 1
step_pulse_duration = 0.000004

[tmc5160 stepper_z1]
cs_pin = PA15
spi_software_sclk_pin = PC6
spi_software_mosi_pin = PC8
spi_software_miso_pin = PC7
run_current = 1
sense_resistor = 0.075
stealthchop_threshold = 0

[stepper_z1]
dir_pin = !PD7
step_pin = PG11
enable_pin = !PG12
microsteps = 16
rotation_distance = 8

[temperature_sensor Kraken]
sensor_type = temperature_mcu
min_temp = 10
max_temp = 100

[heater_fan hotend_fan]
pin = PA0
max_power = 1.0
kick_start_time = 0.5
heater = extruder
heater_temp = 50.0

[fan]
pin = PF12
enable_pin = PF7
hardware_pwm = false
max_power = 1
cycle_time = 0.00002
off_below = 0.012
kick_start_time = 0.01

[heater_bed]
heater_pin = PF5
sensor_pin = PC5
sensor_type = NTC 100K MGB18-104F39050L32
control = pid
pid_kp = 34.679
pid_ki = 1.492
pid_kd = 201.572
min_temp = 0
max_temp = 120
max_power = 1
pwm_cycle_time = 0.0166

[bed_screws]
screw1 = 10,0
screw2 = 10,260
screw3 = 320,260
screw4 = 320,0

[screws_tilt_adjust]
screw1 = 10, 0
screw1_name = front left screw
screw2 = 10, 260
screw2_name = rear left screw
screw3 = 300, 260
screw3_name = rear right screw
screw4 = 320, 0
screw4_name = front right screw
horizontal_move_z = 10.
speed = 250
screw_thread = CW-M3

[force_move]
enable_force_move = true

[bed_mesh]
speed = 200
horizontal_move_z = 1
mesh_min = 10, 22
mesh_max = 310, 260
mesh_pps = 3,3
probe_count = 25,25
algorithm = bicubic
relative_reference_index = 12
bicubic_tension = 0.2
fade_start = 1
fade_end = 10
split_delta_z = .025
move_check_distance = 5

[neopixel my_neopixel]
pin = PF11
chain_count = 13
color_order = GRB
initial_red = 1.0
initial_green = 1
initial_blue = 1

[gcode_macro BED_MESH]
gcode = 
	BED_MESH_CALIBRATE

[gcode_macro PA_TUNING]
gcode = 
	SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=1 ACCEL=500
	TUNING_TOWER COMMAND=SET_PRESSURE_ADVANCE PARAMETER=ADVANCE START=0 FACTOR=.005

[gcode_macro HOTEND_PID]
gcode = 
	{% set tool_temp = params.TEMPERATURE|default(220)|int %}
	{% set tool_name = printer.toolhead.extruder %}
	PID_CALIBRATE HEATER={tool_name} TARGET={tool_temp}

[gcode_macro BED_PID]
gcode = 
	{% set bed_temp = params.TEMPERATURE|default(60)|int %}
	PID_CALIBRATE HEATER=heater_bed TARGET={bed_temp}

[gcode_macro SCREWS_TILT]
gcode = 
	SCREWS_TILT_CALCULATE

[gcode_macro DUMP_WARNINGS]
description = Debug: Print all warning messages from klipper
gcode = 
	{% set parameters = ["printer.configfile.warnings:"] %}
	{% for warning in printer.configfile.warnings %}
	{% set parameters = parameters.append("%s -> %s -> %s\n%s" % (warning.type, warning.section, warning.option, warning.message)) %}
	{% endfor %}
	{action_respond_info(parameters|join("\n"))}

[gcode_macro enable_stepper]
gcode = 
	SET_STEPPER_ENABLE STEPPER=stepper_x ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_x1 ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y ENABLE=1
	SET_STEPPER_ENABLE STEPPER=stepper_y1 ENABLE=1

[gcode_macro disable-steppers]
gcode = 
	m84

[gcode_macro M600]
gcode = 
	G4 P1500
	{% set X = params.X|default(50)|float %}
	{% set Y = params.Y|default(0)|float %}
	{% set Z = params.Z|default(10)|float %}
	
	SAVE_GCODE_STATE NAME=M600_state
	PAUSE
	
	G91
	G1 E-{1} F2100
	G1 Z{Z}
	G90
	G1 X{X} Y{Y} F4000
	G91
	M83
	G1 E5 F800
	G1 E-180 F2000
	M82
	RESTORE_GCODE_STATE NAME=M600_state

[gcode_macro PURGE]
gcode = 
	M83
	G1 E120 F250

[gcode_macro _UNLOAD_FILAMENT]
gcode = 
	{% set e_temp = params.TEMPERATURE|default(235)|int %}
	M118 Filament unloading!
	M117 Filament unloading!
	M82
	G92 E0
	{% if printer.extruder.can_extrude|lower != 'true' %}
	
	M118 Hotend heating!
	M109 S{e_temp} T0
	{% endif %}
	G1 E10 F{5*60}
	G0 E-5 F{60*60}
	G0 E-70 F{5*60}
	M400
	M118 Filament unload complete!
	M117 Filament unload complete!

[gcode_macro _LOAD_FILAMENT]
gcode = 
	{% set e_temp = params.TEMPERATURE|default(230)|int %}
	M109 S{e_temp}
	M83
	G1 E50 F300
	G1 E-1 F100
	M82
	M104 S0

[gcode_macro UNLOAD_PLA]
gcode = 
	_UNLOAD_FILAMENT TEMPERATURE=200

[gcode_macro LOAD_PLA]
gcode = 
	_LOAD_FILAMENT TEMPERATURE=200

[gcode_macro UNLOAD_ABS]
gcode = 
	_UNLOAD_FILAMENT TEMPERATURE=250

[gcode_macro LOAD_ABS]
gcode = 
	_LOAD_FILAMENT TEMPERATURE=250

[gcode_macro UNLOAD_PETG]
gcode = 
	_UNLOAD_FILAMENT TEMPERATURE=235

[gcode_macro LOAD_PETG]
gcode = 
	_LOAD_FILAMENT TEMPERATURE=235

[gcode_macro LOAD_FILAMENT]
gcode = 
	{% set speed = params.SPEED|default(300) %}
	{% set max_velocity = printer.configfile.settings['extruder'].max_extrude_only_velocity %}
	SAVE_GCODE_STATE NAME=load_state
	M300
	G91
	G92 E0
	G1 E350 F{max_velocity}
	G1 E25 F{speed}
	M300
	M300
	RESTORE_GCODE_STATE NAME=load_state

[gcode_macro UNLOAD_FILAMENT]
gcode = 
	{% set speed = params.SPEED|default(300) %}
	{% set max_velocity = printer.configfile.settings['extruder'].max_extrude_only_velocity %}
	SAVE_GCODE_STATE NAME=unload_state
	G91
	M300
	G92 E0
	G1 E25 F{speed}
	G1 E-420 F{max_velocity}
	M300
	M300
	RESTORE_GCODE_STATE NAME=unload_state

[gcode_macro START_PRINT]
gcode = 
	
	{% set DWELL = params.DWELL|default(00)|int %}
	{% set bedTemp = params.BED|default(70)|int %}
	{% set hotendTemp = params.HOTEND|default(210)|int %}
	SET_FAN_SPEED FAN=LED_Bar SPEED=0.5
	CLEAR_PAUSE
	RESETSPEEDS
	G21
	G90
	M83
	M140 S{bedTemp}; start heating the bed
	M104 S100
	SET_DISPLAY_TEXT MSG="Waiting for temperatures..."
	HEATSOAK DWELL={DWELL}
	G28 X Y
	ATTACH_PROBE_LOCK
	G28 Z
	SET_DISPLAY_TEXT MSG="Adjusting Z Tilt"
	Z_TILT_ADJUST
	G28 Z
	
	SET_DISPLAY_TEXT MSG="Calibrating Bed Mesh"
	BED_MESH_CLEAR
	BED_MESH_CALIBRATE
	BED_MESH_PROFILE LOAD=default
	SET_DISPLAY_TEXT MSG="Heating Extruder to temp"
	G1 X1 Y1 Z0.5 F9000
	M109 S{hotendTemp}; wait for extruder to heat up
	TR_UNLOAD_TOOLHEAD
	TR_HOME
	FIXED_PURGE_LINE
	M83
	SET_DISPLAY_TEXT MSG="Printing..."
	TR_SYNC_TO_EXTRUDER

[gcode_macro HEATSOAK]
gcode = 
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion..."
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 5% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 10% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 15% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 20% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 25% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 30% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 35% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 40% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 45% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 50% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 55% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 60% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 65% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 70% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 75% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 80% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 85% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 90% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Waiting for thermal expansion 95% done"
	G4 P{params.DWELL|int*1000/20}
	SET_DISPLAY_TEXT MSG="Thermal expansion done"

[gcode_macro _CG28]
gcode = 
	{% if "xyz" not in printer.toolhead.homed_axes %}
	G28
	{% endif %}

[gcode_macro FIXED_PURGE_LINE]
gcode = 
	M83
	G92 E0
	G1 Z1 F3000
	G1 X1 Y80 Z0.3 E10  F1200
	G1 X1 Y120 E11  F1200
	G1 E-0.8 F1000
	G92 E0
	G1 Z1 F2000

[gcode_macro END_PRINT]
gcode = 
	TR_UNLOAD_TOOLHEAD
	
	TURN_OFF_HEATERS
	G91
	G1 Z10 E-2 F3600
	
	G90
	G1 X30 Y250 F7000; home X axis
	M106 S80
	G4 P10000
	M106 S0
	M221 S100
	CLEAR_PAUSE
	
	SET_GCODE_OFFSET Z=0.0
	RESETSPEEDS
	
	M84
	BED_MESH_CLEAR
	SET_FAN_SPEED FAN=LED_Bar SPEED=0
	TR_UNSYNC_TO_EXTRUDER
	UPDATE_GIT

[gcode_macro PARK]
description = Park the toolhead at the front and retract some filament if the nozzle is hot
gcode = 
	{% set E = params.E|default(1.7)|float %}
	
	{% set Px, Py = printer["gcode_macro _USER_VARIABLES"].park_position_xy|map('float') %}
	{% set park_lift_z = printer["gcode_macro _USER_VARIABLES"].park_lift_z %}
	
	{% set St = printer["gcode_macro _USER_VARIABLES"].travel_speed * 60 %}
	{% set Sz = printer["gcode_macro _USER_VARIABLES"].z_drop_speed * 60 %}
	
	{% set max_z = printer.toolhead.axis_maximum.z|float %}
	{% set act_z = printer.toolhead.position.z|float %}
	
	{% set z_safe = act_z + park_lift_z %}
	{% if z_safe > max_z %}
	{% set z_safe = max_z %}
	{% endif %}
	
	
	{% if printer.extruder.temperature > 185 %}
	G10
	{% endif %}
	G90
	G1 Z{z_safe} F{Sz}
	
	G0 X{Px} Y{Py} F{St}

[gcode_macro RESETSPEEDS]
gcode = 
	SET_VELOCITY_LIMIT VELOCITY={printer.configfile.settings.printer.max_velocity}
	SET_VELOCITY_LIMIT ACCEL={printer.configfile.settings.printer.max_accel}
	SET_VELOCITY_LIMIT ACCEL_TO_DECEL={printer.configfile.settings.printer.max_accel_to_decel}
	SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={printer.configfile.settings.printer.square_corner_velocity}

[gcode_macro DISABLEXYE]
gcode = 
	SET_STEPPER_ENABLE STEPPER=extruder ENABLE=0
	SET_STEPPER_ENABLE STEPPER=stepper_x ENABLE=0
	
	SET_STEPPER_ENABLE STEPPER=stepper_y ENABLE=0
	
	SET_STEPPER_ENABLE STEPPER=stepper_z ENABLE=1

[gcode_macro TEST_SPEED]
gcode = 
	
	{% set speed  = params.SPEED|default(printer.configfile.settings.printer.max_velocity)|int %}
	
	{% set iterations = params.ITERATIONS|default(5)|int %}
	
	{% set accel  = params.ACCEL|default(printer.configfile.settings.printer.max_accel)|int %}
	
	{% set bound = params.BOUND|default(20)|int %}
	
	{% set smallpatternsize = SMALLPATTERNSIZE|default(20)|int %}
	
	
	
	{% set x_min = 10 + bound %}
	{% set x_max = 300 - bound %}
	{% set y_min = 10 + bound %}
	{% set y_max = 300 - bound %}
	
	
	
	{% set x_center = (printer.toolhead.axis_minimum.x|float + printer.toolhead.axis_maximum.x|float ) / 2 %}
	{% set y_center = (printer.toolhead.axis_minimum.y|float + printer.toolhead.axis_maximum.y|float ) / 2 %}
	
	
	{% set x_center_min = x_center - (smallpatternsize/2) %}
	{% set x_center_max = x_center + (smallpatternsize/2) %}
	{% set y_center_min = y_center - (smallpatternsize/2) %}
	{% set y_center_max = y_center + (smallpatternsize/2) %}
	
	
	SAVE_GCODE_STATE NAME=TEST_SPEED
	
	
	{ action_respond_info("TEST_SPEED: starting %d iterations at speed %d, accel %d" % (iterations, speed, accel)) }
	
	
	M400
	G28
	
	{% if printer.configfile.settings.quad_gantry_level %}
	{% if printer.quad_gantry_level.applied == False %}
	QUAD_GANTRY_LEVEL
	G28 Z
	{% endif %}
	{% endif %}
	
	G90
	G1 X{printer.toolhead.axis_maximum.x-50} Y{printer.toolhead.axis_maximum.y-50} F{30*60}
	M400
	G28 X Y
	G0 X{300} Y{300} F{30*60}
	G4 P1000
	GET_POSITION
	
	
	G0 X{x_min} Y{y_min} Z{bound + 10} F{speed*60}
	
	
	SET_VELOCITY_LIMIT VELOCITY={speed} ACCEL={accel} ACCEL_TO_DECEL={accel / 2}
	
	{% for i in range(iterations) %}
	
	G0 X{x_min} Y{y_min} F{speed*60}
	G0 X{x_max} Y{y_max} F{speed*60}
	G0 X{x_min} Y{y_min} F{speed*60}
	G0 X{x_max} Y{y_min} F{speed*60}
	G0 X{x_min} Y{y_max} F{speed*60}
	G0 X{x_max} Y{y_min} F{speed*60}
	
	
	G0 X{x_min} Y{y_min} F{speed*60}
	G0 X{x_min} Y{y_max} F{speed*60}
	G0 X{x_max} Y{y_max} F{speed*60}
	G0 X{x_max} Y{y_min} F{speed*60}
	
	
	G0 X{x_center_min} Y{y_center_min} F{speed*60}
	G0 X{x_center_max} Y{y_center_max} F{speed*60}
	G0 X{x_center_min} Y{y_center_min} F{speed*60}
	G0 X{x_center_max} Y{y_center_min} F{speed*60}
	G0 X{x_center_min} Y{y_center_max} F{speed*60}
	G0 X{x_center_max} Y{y_center_min} F{speed*60}
	
	
	G0 X{x_center_min} Y{y_center_min} F{speed*60}
	G0 X{x_center_min} Y{y_center_max} F{speed*60}
	G0 X{x_center_max} Y{y_center_max} F{speed*60}
	G0 X{x_center_max} Y{y_center_min} F{speed*60}
	{% endfor %}
	
	
	SET_VELOCITY_LIMIT VELOCITY={printer.configfile.settings.printer.max_velocity} ACCEL={printer.configfile.settings.printer.max_accel} ACCEL_TO_DECEL={printer.configfile.settings.printer.max_accel_to_decel}
	
	
	M400
	G28
	
	G90
	G0 X{300} Y{300} F{30*60}
	G4 P1000
	GET_POSITION
	
	
	RESTORE_GCODE_STATE NAME=TEST_SPEED

[gcode_macro update_git]
gcode = 
	RUN_SHELL_COMMAND CMD=update_git_script

[gcode_shell_command update_git_script]
command = bash /home/pi/klipper-backup/script.sh
timeout = 90.0
verbose = True

[mcu tr]
serial = /dev/serial/by-id/usb-Klipper_stm32g0b1xx_290023000950415833323720-if00

[belay my_belay]
extruder_type = trad_rack
sensor_pin = ^tr:PB9
multiplier_high = 1.05
multiplier_low = 0.8
debug_level = 1

[trad_rack]
sync_to_extruder = true
selector_max_velocity = 400
selector_max_accel = 10000
lane_count = 4
lane_spacing = 17.26
servo_down_angle = 0
servo_up_angle = 130
toolhead_unload_speed = 20
extruder_load_speed = 2
toolhead_sense_speed = 20
selector_unload_length = 20
bowden_length = 865
extruder_load_length = 60
hotend_load_length = 20
toolhead_unload_length = 80
buffer_pull_speed = 100.0
pre_unload_gcode = 
	SAVE_GCODE_STATE NAME=PRE_UNLOAD_state
	{% if printer.virtual_sdcard.is_active %}
	{% set z_max = printer.toolhead.axis_maximum.z - printer.gcode_move.homing_origin.z %}
	{% set z_lift = printer["gcode_macro TR_Variables"].z_lift|float %}
	{% set x_park = printer["gcode_macro TR_Variables"].x_park|float %}
	{% set y_park = printer["gcode_macro TR_Variables"].y_park|float %}
	{% set do_x_park = printer["gcode_macro TR_Variables"].do_x_park %}
	{% set do_y_park = printer["gcode_macro TR_Variables"].do_y_park %}
	{% set st = printer["gcode_macro TR_Variables"].travel_speed * 60 %}
	{% set shape_tip = printer["gcode_macro TR_Variables"].shape_tip %}
	{% set use_wiper = printer["gcode_macro TR_Variables"].use_wiper %}
	{% set x = printer.gcode_move.gcode_position.x %}
	{% set y = printer.gcode_move.gcode_position.y %}
	{% set z = printer.gcode_move.gcode_position.z %}
	{% set z_park = [z + z_lift, z_max]|min %}
	
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=x VALUE={x}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=y VALUE={y}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=z VALUE={z}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=saved_pos VALUE={True}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=z_park VALUE={z_park}
	
	
	G90
	G1 Z{z_park}
	
	
	{% if use_wiper %}
	Go_To_Purge_Location
	
	
	{% else %}
	G90
	{% if do_x_park %}
	{% set x = x_park %}
	{% endif %}
	{% if do_y_park %}
	{% set y = y_park %}
	{% endif %}
	G1 X{x} Y{y} F{st}
	{% endif %}
	
	
	{% if shape_tip %}
	Shape_Tip
	{% endif %}
	{% else %}
	
	{% if use_wiper %}
	Go_To_Purge_Location
	{% endif %}
	
	
	Shape_Tip
	{% endif %}
	RESTORE_GCODE_STATE NAME=PRE_UNLOAD_state
post_load_gcode = 
	SAVE_GCODE_STATE NAME=POST_LOAD_state
	{% set use_wiper = printer["gcode_macro TR_Variables"].use_wiper %}
	{% if printer.virtual_sdcard.is_active %}
	{% set st = printer["gcode_macro TR_Variables"].travel_speed * 60 %}
	{% set take_frame = printer["gcode_macro TR_Variables"].take_frame %}
	{% set x = printer["gcode_macro TR_Variables"].x %}
	{% set y = printer["gcode_macro TR_Variables"].y %}
	{% set z = printer["gcode_macro TR_Variables"].z %}
	{% set saved_pos = printer["gcode_macro TR_Variables"].saved_pos %}
	{% set z_park = printer["gcode_macro TR_Variables"].z_park %}
	
	
	{% if take_frame %}
	TIMELAPSE_TAKE_FRAME
	{% endif %}
	
	
	{% if use_wiper %}
	Home_and_Wipe_Nozzle
	{% endif %}
	
	
	{% if saved_pos %}
	G90
	G1 Z{z_park}
	G1 X{x} Y{y} F{st}
	G1 Z{z}
	SET_GCODE_VARIABLE MACRO=TR_Variables VARIABLE=saved_pos VALUE={False}
	{% endif %}
	
	Restore_Pressure_Advance
	{% elif use_wiper %}
	Home_and_Wipe_Nozzle
	{% endif %}
	RESTORE_GCODE_STATE NAME=POST_LOAD_state

[stepper_tr_selector]
step_pin = tr:PB15
dir_pin = !tr:PB14
enable_pin = !tr:PA8
rotation_distance = 40
microsteps = 16
full_steps_per_rotation = 400
endstop_pin = ^tr:PA3
position_min = 0.0
position_endstop = 0
position_max = 158
homing_speed = 30

[stepper_tr_fil_driver]
step_pin = tr:PD2
dir_pin = tr:PB13
enable_pin = !tr:PD1
rotation_distance = 22.67895
gear_ratio = 50:17
microsteps = 16
full_steps_per_rotation = 400
endstop_pin = ^tr:PA4
position_min = -5000
position_endstop = 0
position_max = 5000
homing_positive_dir = False

[tmc2209 stepper_tr_selector]
uart_pin = tr:PA10
interpolate = True
run_current = 1.3
sense_resistor = 0.110

[tmc2209 stepper_tr_fil_driver]
uart_pin = tr:PC7
interpolate = False
run_current = 1.3
sense_resistor = 0.110

[servo tr_servo]
pin = tr:PA0
maximum_servo_angle = 131
minimum_pulse_width = 0.000700
maximum_pulse_width = 0.002200

[gcode_macro ACTIVATE_EXTRUDER]
rename_existing = ACTIVATE_EXTRUDER.1
gcode = 
	{% set EXTRUDER = params.EXTRUDER|default('extruder')|lower|replace('extruder', '') %}
	{% if EXTRUDER == '' %}
	{% set EXTRUDER = '0' %}
	{% endif %}
	TR_LOAD_TOOLHEAD LANE={EXTRUDER}

[gcode_macro TR_Variables]
description = Variables for use with Trad Rack pre unload and post load gcode
variable_z_lift = 0.1
variable_x_park = 0.0
variable_y_park = 175.0
variable_do_x_park = False
variable_do_y_park = False
variable_travel_speed = 300
variable_shape_tip = False
variable_take_frame = False
variable_use_wiper = False
variable_x = 0
variable_y = 0
variable_z = 0
variable_saved_pos = False
variable_z_park = 0
gcode = 

[gcode_macro Shape_Tip]
description = Perform tip-shaping, retraction, and cooling moves
gcode = 
	SAVE_GCODE_STATE NAME=Shape_Tip_state
	Save_Pressure_Advance
	
	Slicer_Unload
	
	
	Restore_Pressure_Advance
	RESTORE_GCODE_STATE NAME=Shape_Tip_state

[gcode_macro Set_Slicer_Unload_Preset]
description = Apply a preset of values to use for the Slicer_Unload macro
variable_asa_ss = {
	"filament_ramming_parameters": "120 110 5.32258 5.45161 5.67742 6 6.48387 7.12903 7.90323 8.70968 9.3871 9.83871 10.0968 10.2258| 0.05 5.30967 0.45 5.50967 0.95 6.1871 1.45 7.39677 1.95 9.05484 2.45 10 2.95 10.3098 3.45 13.0839 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": True}
variable_pla_ss = {
	"filament_ramming_parameters": "130 120 2.70968 2.93548 3.32258 3.83871 4.58065 5.54839 6.51613 7.35484 7.93548 8.16129| 0.05 2.66451 0.45 3.05805 0.95 4.05807 1.45 5.97742 1.95 7.69999 2.45 8.1936 2.95 11.342 3.45 11.4065 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": True}
variable_asa_ps = {
	"filament_ramming_parameters": "120 110 5.32258 5.45161 5.67742 6 6.48387 7.12903 7.90323 8.70968 9.3871 9.83871 10.0968 10.2258| 0.05 5.30967 0.45 5.50967 0.95 6.1871 1.45 7.39677 1.95 9.05484 2.45 10 2.95 10.3098 3.45 13.0839 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": False}
variable_pla_ps = {
	"filament_ramming_parameters": "130 120 2.70968 2.93548 3.32258 3.83871 4.58065 5.54839 6.51613 7.35484 7.93548 8.16129| 0.05 2.66451 0.45 3.05805 0.95 4.05807 1.45 5.97742 1.95 7.69999 2.45 8.1936 2.95 11.342 3.45 11.4065 3.95 7.6 4.45 7.6 4.95 7.6",
	"superslicer": False}
gcode = 
	{% set preset_name = params.PRESET|lower %}
	{% if preset_name in printer['gcode_macro Set_Slicer_Unload_Preset'] %}
	{% set preset = printer['gcode_macro Set_Slicer_Unload_Preset'].preset_name %}
	{% for key in preset %}
	SET_GCODE_VARIABLE MACRO=Slicer_Unload VARIABLE={key} VALUE={preset[key]}
	{% endfor %}
	{% else %}
	{ action_raise_error("Preset \"%s\" does not exist" % preset_name) }
	{% endif %}

[gcode_macro Slicer_Unload]
description = Mimic ramming and unload behavior of PrusaSlicer or SuperSlicer
variable_cooling_tube_length = 14
variable_cooling_tube_retraction = 30
variable_filament_cooling_final_speed = 30
variable_filament_cooling_initial_speed = 20
variable_filament_cooling_moves = 4
variable_filament_diameter = 1.75
variable_filament_unloading_speed = 90
variable_filament_unloading_speed_start = 100
variable_filament_toolchange_delay = 0
variable_filament_ramming_parameters = "120 110 5.32258 5.45161 5.67742 6 6.48387 7.12903 7.90323 8.70968 9.3871 9.83871 10.0968 10.2258| 0.05 5.30967 0.45 5.50967 0.95 6.1871 1.45 7.39677 1.95 9.05484 2.45 10 2.95 10.3098 3.45 13.0839 3.95 7.6 4.45 7.6 4.95 7.6"
variable_filament_enable_toolchange_temp = False
variable_filament_toolchange_temp = 200
variable_filament_use_fast_skinnydip = False
variable_filament_enable_toolchange_part_fan = False
variable_filament_toolchange_part_fan_speed = 50
variable_filament_use_skinnydip = True
variable_filament_skinnydip_distance = 24
variable_filament_melt_zone_pause = 0
variable_filament_cooling_zone_pause = 0
variable_filament_dip_insertion_speed = 33
variable_filament_dip_extraction_speed = 70
variable_superslicer = False
variable_do_ramming = False
variable_do_unload = True
gcode = 
	{% set NEW_TEMPERATURE = params.NEW_TEMPERATURE|default(0)|float %}
	{% set prev_temp_target = printer.extruder.target %}
	
	SAVE_GCODE_STATE NAME=Slicer_Unload_state
	Save_Pressure_Advance
	
	M83
	M220 S100
	SET_PRESSURE_ADVANCE ADVANCE=0
	
	
	{% if do_ramming %}
	
	{% set ramming_speed = (filament_ramming_parameters.split('|')[0]).split(' ') %}
	
	
	{% set filament_area = 3.1415 * (filament_diameter / 2) ** 2 %}
	
	
	{% for i in range(2, ramming_speed|length) %}
	
	{% set f = ramming_speed[i]|float / filament_area %}
	
	
	{% set e = f * 0.25 %}
	
	
	G1 E{e} F{f * 60}
	{% endfor %}
	{% endif %}
	
	
	{% if do_unload %}
	
	{% if superslicer and filament_enable_toolchange_temp and not filament_use_fast_skinnydip %}
	_Wait_for_Toolchange_Temp
	{% endif %}
	
	
	{% set total_retraction_distance = cooling_tube_retraction + cooling_tube_length / 2 - 15 %}
	G1 E-15 F{filament_unloading_speed_start * 60}
	G1 E-{0.70 * total_retraction_distance} F{1.0 * filament_unloading_speed * 60}
	G1 E-{0.20 * total_retraction_distance} F{0.5 * filament_unloading_speed * 60}
	G1 E-{0.10 * total_retraction_distance} F{0.3 * filament_unloading_speed * 60}
	
	
	{% if not superslicer or not filament_enable_toolchange_temp %}
	{% if NEW_TEMPERATURE != 0 and (NEW_TEMPERATURE != prev_temp_target) %}
	M104 S{NEW_TEMPERATURE}
	{% endif %}
	
	
	{% elif superslicer and filament_enable_toolchange_temp and not filament_use_fast_skinnydip %}
	{% if NEW_TEMPERATURE != 0 %}
	M104 S{NEW_TEMPERATURE}
	{% else %}
	M104 S{prev_temp_target}
	{% endif %}
	{% endif %}
	
	
	{% set speed_inc = (filament_cooling_final_speed - filament_cooling_initial_speed) / (2 * filament_cooling_moves - 1) %}
	{% for i in range(filament_cooling_moves) %}
	{% set speed = filament_cooling_initial_speed + speed_inc * 2 * i %}
	G1 E{cooling_tube_length} F{speed * 60}
	{% set speed = speed + speed_inc %}
	G1 E-{cooling_tube_length} F{speed * 60}
	{% endfor %}
	
	
	{% if superslicer %}
	
	{% if filament_enable_toolchange_temp and filament_use_fast_skinnydip %}
	_Wait_for_Toolchange_Temp
	{% endif %}
	
	
	{% if filament_use_skinnydip %}
	G1 E{filament_skinnydip_distance} F{filament_dip_insertion_speed * 60}
	G4 P{filament_melt_zone_pause}
	G1 E-{filament_skinnydip_distance} F{filament_dip_extraction_speed * 60}
	G4 P{filament_cooling_zone_pause}
	{% endif %}
	
	
	{% if filament_enable_toolchange_temp and filament_use_fast_skinnydip %}
	{% if NEW_TEMPERATURE != 0 %}
	M109 S{NEW_TEMPERATURE}
	{% else %}
	M109 S{prev_temp_target}
	{% endif %}
	{% elif filament_enable_toolchange_temp and filament_use_fast_skinnydip %}
	{% if NEW_TEMPERATURE != 0 and (NEW_TEMPERATURE != prev_temp_target) %}
	M109 S{NEW_TEMPERATURE}
	{% endif %}
	{% endif %}
	{% endif %}
	
	
	G4 P{filament_toolchange_delay}
	
	
	
	{% endif %}
	
	Restore_Pressure_Advance
	RESTORE_GCODE_STATE NAME=Slicer_Unload_state

[gcode_macro _Wait_for_Toolchange_Temp]
description = Helper function for Slicer_Unload
gcode = 
	{% set tc_temp = printer["gcode_macro Slicer_Unload"].filament_toolchange_temp %}
	{% set fan_on = printer["gcode_macro Slicer_Unload"].filament_enable_toolchange_part_fan %}
	{% set fan_speed = printer["gcode_macro Slicer_Unload"].filament_toolchange_part_fan_speed %}
	
	{% set prev_fan_speed = printer.fan.speed %}
	{% if fan_on %}
	M106 S{(fan_speed / 100.0 * 255)|int}
	{% endif %}
	M109 S{filament_toolchange_temp}
	{% if fan_on %}
	M106 S{(prev_fan_speed * 255)|int}
	{% endif %}

[gcode_macro Home_and_Wipe_Nozzle]
description = Home x and y if needed, then wipe the nozzle
gcode = 
	
	{% if not 'xy' in printer.toolhead.homed_axes %}
	G28 X Y
	{% endif %}
	
	
	Wipe_Nozzle

[gcode_macro Save_Pressure_Advance]
description = Save the current pressure advance value
variable_pa = -1
gcode = 
	
	{% set pa = printer.extruder.pressure_advance %}
	{% if pa > 0 %}
	SET_GCODE_VARIABLE MACRO=Save_Pressure_Advance VARIABLE=pa VALUE={pa}
	{% endif %}

[gcode_macro Restore_Pressure_Advance]
description = Restore saved pressure advance value
gcode = 
	
	{% if not (printer["gcode_macro Save_Pressure_Advance"].pa == -1) %}
	SET_PRESSURE_ADVANCE ADVANCE={printer["gcode_macro Save_Pressure_Advance"].pa}
	{% endif %}

[safe_z_home]
home_xy_position = 165, 165
z_hop = 10

[z_tilt]
z_positions = 
	-80,  -20
	350, -20
points = 
	15, 150
	275, 150
speed = 50
horizontal_move_z = 10
retries = 30
retry_tolerance = 0.1

[input_shaper]
shaper_type_x = zv
shaper_freq_x = 120.6
shaper_type_y = zv
shaper_freq_y = 76.6

[cartographer]
serial = /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00
speed = 40.
lift_speed = 5.
backlash_comp = 0.5
x_offset = 0.
y_offset = 21.1
trigger_distance = 2.
trigger_dive_threshold = 1.5
trigger_hysteresis = 0.006
cal_nozzle_z = 0.1
cal_floor = 0.1
cal_ceil = 5.
cal_speed = 1.0
cal_move_speed = 10.
default_model_name = default
mesh_main_direction = X
mesh_cluster_size = 1
mesh_runs = 2

[printer]
kinematics = corexy
max_velocity = 3000
max_accel = 20000
max_z_velocity = 20
max_z_accel = 15
square_corner_velocity = 10

[exclude_object]

[gcode_arcs]
resolution = 0.05

[idle_timeout]
gcode = 
	{% if not printer.pause_resume.is_paused %}
	TURN_OFF_HEATERS
	M84
	{% endif %}

[save_variables]
filename = vars.cfg

[mcu]
serial = /dev/serial/by-id/usb-Klipper_stm32h723xx_4C0023001551313338343730-if00

[bed_mesh default]
version = 1
points = 
	-0.215000, -0.210000, -0.190000, -0.185000, -0.170000, -0.145000, -0.135000, -0.120000, -0.105000, -0.070000, -0.055000, -0.035000, 0.000000, 0.010000, 0.025000, 0.050000, 0.080000, 0.105000, 0.130000, 0.135000, 0.150000, 0.155000, 0.165000, 0.190000, 0.205000
	-0.160000, -0.155000, -0.160000, -0.150000, -0.130000, -0.110000, -0.105000, -0.085000, -0.055000, -0.035000, -0.025000, 0.000000, 0.025000, 0.055000, 0.075000, 0.100000, 0.110000, 0.130000, 0.160000, 0.170000, 0.190000, 0.190000, 0.205000, 0.205000, 0.220000
	-0.160000, -0.150000, -0.140000, -0.135000, -0.115000, -0.105000, -0.090000, -0.070000, -0.040000, -0.025000, -0.010000, 0.015000, 0.030000, 0.045000, 0.080000, 0.100000, 0.115000, 0.135000, 0.160000, 0.165000, 0.180000, 0.185000, 0.190000, 0.220000, 0.235000
	-0.120000, -0.115000, -0.115000, -0.100000, -0.080000, -0.070000, -0.065000, -0.040000, -0.015000, 0.010000, 0.030000, 0.050000, 0.065000, 0.090000, 0.110000, 0.130000, 0.145000, 0.175000, 0.195000, 0.195000, 0.195000, 0.205000, 0.210000, 0.235000, 0.240000
	-0.075000, -0.065000, -0.055000, -0.045000, -0.040000, -0.020000, -0.005000, 0.015000, 0.035000, 0.065000, 0.075000, 0.090000, 0.105000, 0.115000, 0.140000, 0.170000, 0.175000, 0.190000, 0.205000, 0.205000, 0.205000, 0.210000, 0.215000, 0.240000, 0.240000
	-0.045000, -0.050000, -0.055000, -0.045000, -0.015000, -0.005000, -0.005000, 0.020000, 0.060000, 0.065000, 0.075000, 0.100000, 0.115000, 0.125000, 0.135000, 0.170000, 0.175000, 0.175000, 0.205000, 0.205000, 0.205000, 0.205000, 0.210000, 0.220000, 0.225000
	-0.035000, -0.030000, -0.030000, -0.020000, 0.000000, 0.015000, 0.015000, 0.035000, 0.065000, 0.085000, 0.100000, 0.110000, 0.115000, 0.130000, 0.160000, 0.170000, 0.180000, 0.180000, 0.200000, 0.200000, 0.200000, 0.205000, 0.205000, 0.220000, 0.235000
	0.005000, 0.010000, 0.015000, 0.025000, 0.035000, 0.040000, 0.055000, 0.085000, 0.095000, 0.110000, 0.115000, 0.125000, 0.140000, 0.160000, 0.175000, 0.180000, 0.190000, 0.190000, 0.225000, 0.225000, 0.225000, 0.225000, 0.230000, 0.235000, 0.250000
	0.055000, 0.065000, 0.060000, 0.065000, 0.075000, 0.090000, 0.100000, 0.110000, 0.120000, 0.130000, 0.140000, 0.155000, 0.170000, 0.180000, 0.190000, 0.195000, 0.210000, 0.220000, 0.235000, 0.235000, 0.235000, 0.235000, 0.245000, 0.250000, 0.260000
	0.100000, 0.105000, 0.110000, 0.110000, 0.120000, 0.135000, 0.145000, 0.150000, 0.155000, 0.155000, 0.170000, 0.185000, 0.190000, 0.195000, 0.195000, 0.215000, 0.230000, 0.235000, 0.245000, 0.245000, 0.245000, 0.235000, 0.245000, 0.250000, 0.260000
	0.100000, 0.115000, 0.125000, 0.130000, 0.135000, 0.145000, 0.150000, 0.155000, 0.165000, 0.175000, 0.190000, 0.200000, 0.205000, 0.205000, 0.215000, 0.225000, 0.230000, 0.245000, 0.255000, 0.240000, 0.240000, 0.240000, 0.245000, 0.250000, 0.250000
	0.155000, 0.150000, 0.150000, 0.150000, 0.160000, 0.165000, 0.165000, 0.175000, 0.175000, 0.195000, 0.200000, 0.215000, 0.205000, 0.210000, 0.215000, 0.225000, 0.235000, 0.240000, 0.245000, 0.240000, 0.240000, 0.235000, 0.220000, 0.235000, 0.240000
	0.170000, 0.165000, 0.165000, 0.170000, 0.180000, 0.190000, 0.190000, 0.185000, 0.200000, 0.205000, 0.220000, 0.230000, 0.225000, 0.225000, 0.240000, 0.245000, 0.240000, 0.250000, 0.255000, 0.245000, 0.250000, 0.245000, 0.245000, 0.240000, 0.240000
	0.210000, 0.200000, 0.195000, 0.200000, 0.210000, 0.210000, 0.210000, 0.215000, 0.215000, 0.215000, 0.235000, 0.245000, 0.235000, 0.235000, 0.245000, 0.250000, 0.240000, 0.250000, 0.250000, 0.250000, 0.255000, 0.250000, 0.235000, 0.235000, 0.240000
	0.240000, 0.250000, 0.250000, 0.245000, 0.260000, 0.260000, 0.255000, 0.255000, 0.255000, 0.250000, 0.265000, 0.265000, 0.260000, 0.255000, 0.260000, 0.255000, 0.255000, 0.270000, 0.260000, 0.255000, 0.250000, 0.255000, 0.245000, 0.250000, 0.240000
	0.270000, 0.260000, 0.255000, 0.265000, 0.265000, 0.265000, 0.265000, 0.260000, 0.260000, 0.255000, 0.265000, 0.265000, 0.265000, 0.255000, 0.255000, 0.250000, 0.255000, 0.250000, 0.250000, 0.245000, 0.245000, 0.235000, 0.230000, 0.235000, 0.240000
	0.275000, 0.280000, 0.275000, 0.275000, 0.275000, 0.275000, 0.275000, 0.275000, 0.280000, 0.280000, 0.280000, 0.270000, 0.270000, 0.270000, 0.265000, 0.265000, 0.265000, 0.270000, 0.260000, 0.255000, 0.235000, 0.235000, 0.235000, 0.240000, 0.235000
	0.335000, 0.315000, 0.305000, 0.310000, 0.305000, 0.300000, 0.295000, 0.290000, 0.300000, 0.295000, 0.290000, 0.290000, 0.280000, 0.270000, 0.270000, 0.275000, 0.275000, 0.265000, 0.250000, 0.245000, 0.235000, 0.225000, 0.225000, 0.230000, 0.235000
	0.355000, 0.350000, 0.345000, 0.325000, 0.330000, 0.325000, 0.325000, 0.325000, 0.315000, 0.310000, 0.300000, 0.290000, 0.285000, 0.290000, 0.275000, 0.275000, 0.265000, 0.265000, 0.250000, 0.245000, 0.235000, 0.225000, 0.230000, 0.225000, 0.215000
	0.395000, 0.385000, 0.380000, 0.370000, 0.365000, 0.370000, 0.360000, 0.355000, 0.345000, 0.340000, 0.330000, 0.320000, 0.310000, 0.305000, 0.300000, 0.290000, 0.275000, 0.260000, 0.255000, 0.255000, 0.250000, 0.235000, 0.230000, 0.230000, 0.230000
	0.395000, 0.390000, 0.375000, 0.375000, 0.375000, 0.370000, 0.365000, 0.360000, 0.355000, 0.335000, 0.325000, 0.315000, 0.315000, 0.300000, 0.295000, 0.280000, 0.255000, 0.260000, 0.250000, 0.240000, 0.230000, 0.235000, 0.230000, 0.205000, 0.195000
	0.405000, 0.395000, 0.395000, 0.390000, 0.380000, 0.375000, 0.370000, 0.360000, 0.355000, 0.345000, 0.325000, 0.325000, 0.310000, 0.295000, 0.290000, 0.270000, 0.250000, 0.240000, 0.235000, 0.235000, 0.230000, 0.205000, 0.195000, 0.195000, 0.195000
	0.405000, 0.395000, 0.380000, 0.375000, 0.375000, 0.370000, 0.360000, 0.345000, 0.340000, 0.330000, 0.305000, 0.300000, 0.285000, 0.270000, 0.250000, 0.235000, 0.220000, 0.215000, 0.220000, 0.205000, 0.195000, 0.175000, 0.175000, 0.170000, 0.165000
	0.405000, 0.390000, 0.395000, 0.385000, 0.365000, 0.350000, 0.345000, 0.330000, 0.320000, 0.305000, 0.290000, 0.265000, 0.260000, 0.240000, 0.225000, 0.215000, 0.205000, 0.190000, 0.180000, 0.185000, 0.165000, 0.150000, 0.145000, 0.145000, 0.145000
	0.430000, 0.425000, 0.400000, 0.395000, 0.385000, 0.370000, 0.365000, 0.340000, 0.320000, 0.305000, 0.295000, 0.270000, 0.250000, 0.235000, 0.215000, 0.215000, 0.200000, 0.190000, 0.185000, 0.165000, 0.155000, 0.145000, 0.135000, 0.130000, 0.135000
x_count = 25
y_count = 25
mesh_x_pps = 3
mesh_y_pps = 3
algo = bicubic
tension = 0.2
min_x = 10.0
max_x = 310.0
min_y = 26.43
max_y = 281.31
=======================
Extruder max_extrude_ratio=41.575169
mcu 'mcu': Starting serial connect
webhooks client 140734127188944: New connection
webhooks client 140734127188944: Client info {'program': 'Moonraker', 'version': 'v0.8.0-308-g71b46cc'}
Loaded MCU 'mcu' 117 commands (v0.12.0-61-gb50d6669 / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'mcu' config: ADC_MAX=4095 BUS_PINS_i2c1_PB6_PB7=PB6,PB7 BUS_PINS_i2c1_PB8_PB9=PB8,PB9 BUS_PINS_i2c2_PB10_PB11=PB10,PB11 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi2a=PC2,PC3,PB10 BUS_PINS_spi3a=PC11,PC12,PC10 BUS_PINS_spi4=PE13,PE14,PE12 BUS_PINS_spi5=PF8,PF9,PF7 BUS_PINS_spi5a=PH7,PF11,PH6 BUS_PINS_spi6=PG12,PG14,PG13 CLOCK_FREQ=400000000 MCU=stm32h723xx PWM_MAX=255 RESERVE_PINS_USB=PA11,PA12 RESERVE_PINS_crystal=PH0,PH1 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
mcu 'tr': Starting serial connect
Loaded MCU 'tr' 106 commands (v0.12.0-102-g9f41f53c / gcc: (15:12.2.rel1-1) 12.2.1 20221205 binutils: (2.40-2+18+b1) 2.40)
MCU 'tr' config: ADC_MAX=4095 BUS_PINS_i2c1_PA9_PA10=PA9,PA10 BUS_PINS_i2c1_PB6_PB7=PB6,PB7 BUS_PINS_i2c1_PB8_PB9=PB8,PB9 BUS_PINS_i2c2_PB10_PB11=PB10,PB11 BUS_PINS_i2c2_PB13_PB14=PB13,PB14 BUS_PINS_i2c3_PB3_PB4=PB3,PB4 BUS_PINS_spi1=PA6,PA7,PA5 BUS_PINS_spi1a=PB4,PB5,PB3 BUS_PINS_spi2=PB14,PB15,PB13 BUS_PINS_spi2a=PC2,PC3,PB10 BUS_PINS_spi3=PB4,PB5,PB3 CLOCK_FREQ=64000000 MCU=stm32g0b1xx PWM_MAX=255 RESERVE_PINS_USB=PA11,PA12 RESERVE_PINS_crystal=PF0,PF1 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
mcu_temperature 'mcu' nominal base=-274.819277 slope=1644.578313
mcu 'cartographer': Starting serial connect
Loaded MCU 'cartographer' 55 commands (CARTOGRAPHER V3 / )
MCU 'cartographer' config: ADC_MAX=4095 BUS_PINS_i2c1=PB6,PB7 BUS_PINS_spi1=PA6,PA7,PA5 CARTOGRAPHER_ADC_SMOOTH_COUNT=16 CLOCK_FREQ=48000000 MCU=stm32f042x6 PWM_MAX=2 RESERVE_PINS_USB=PA11,PA12 RESERVE_PINS_crystal=PF0,PF1 STATS_SUMSQ_BASE=256 STEPPER_BOTH_EDGE=1
Sending MCU 'mcu' printer configuration...
Configured MCU 'mcu' (1024 moves)
Sending MCU 'tr' printer configuration...
Configured MCU 'tr' (1024 moves)
Starting heater checks for heater_bed
bed_mesh: generated points
Index |  Tool Adjusted  |   Probe
  0   | (10.0, 0.9)     | (10.0, 22.0)
  1   | (22.5, 0.9)     | (22.5, 22.0)
  2   | (35.0, 0.9)     | (35.0, 22.0)
  3   | (47.5, 0.9)     | (47.5, 22.0)
  4   | (60.0, 0.9)     | (60.0, 22.0)
  5   | (72.5, 0.9)     | (72.5, 22.0)
  6   | (85.0, 0.9)     | (85.0, 22.0)
  7   | (97.5, 0.9)     | (97.5, 22.0)
  8   | (110.0, 0.9)    | (110.0, 22.0)
  9   | (122.5, 0.9)    | (122.5, 22.0)
  10  | (135.0, 0.9)    | (135.0, 22.0)
  11  | (147.5, 0.9)    | (147.5, 22.0)
  12  | (160.0, 0.9)    | (160.0, 22.0)
  13  | (172.5, 0.9)    | (172.5, 22.0)
  14  | (185.0, 0.9)    | (185.0, 22.0)
  15  | (197.5, 0.9)    | (197.5, 22.0)
  16  | (210.0, 0.9)    | (210.0, 22.0)
  17  | (222.5, 0.9)    | (222.5, 22.0)
  18  | (235.0, 0.9)    | (235.0, 22.0)
  19  | (247.5, 0.9)    | (247.5, 22.0)
  20  | (260.0, 0.9)    | (260.0, 22.0)
  21  | (272.5, 0.9)    | (272.5, 22.0)
  22  | (285.0, 0.9)    | (285.0, 22.0)
  23  | (297.5, 0.9)    | (297.5, 22.0)
  24  | (310.0, 0.9)    | (310.0, 22.0)
  25  | (310.0, 10.8)   | (310.0, 31.9)
  26  | (297.5, 10.8)   | (297.5, 31.9)
  27  | (285.0, 10.8)   | (285.0, 31.9)
  28  | (272.5, 10.8)   | (272.5, 31.9)
  29  | (260.0, 10.8)   | (260.0, 31.9)
  30  | (247.5, 10.8)   | (247.5, 31.9)
  31  | (235.0, 10.8)   | (235.0, 31.9)
  32  | (222.5, 10.8)   | (222.5, 31.9)
  33  | (210.0, 10.8)   | (210.0, 31.9)
  34  | (197.5, 10.8)   | (197.5, 31.9)
  35  | (185.0, 10.8)   | (185.0, 31.9)
  36  | (172.5, 10.8)   | (172.5, 31.9)
  37  | (160.0, 10.8)   | (160.0, 31.9)
  38  | (147.5, 10.8)   | (147.5, 31.9)
  39  | (135.0, 10.8)   | (135.0, 31.9)
  40  | (122.5, 10.8)   | (122.5, 31.9)
  41  | (110.0, 10.8)   | (110.0, 31.9)
  42  | (97.5, 10.8)    | (97.5, 31.9)
  43  | (85.0, 10.8)    | (85.0, 31.9)
  44  | (72.5, 10.8)    | (72.5, 31.9)
  45  | (60.0, 10.8)    | (60.0, 31.9)
  46  | (47.5, 10.8)    | (47.5, 31.9)
  47  | (35.0, 10.8)    | (35.0, 31.9)
  48  | (22.5, 10.8)    | (22.5, 31.9)
  49  | (10.0, 10.8)    | (10.0, 31.9)
  50  | (10.0, 20.7)    | (10.0, 41.8)
  51  | (22.5, 20.7)    | (22.5, 41.8)
  52  | (35.0, 20.7)    | (35.0, 41.8)
  53  | (47.5, 20.7)    | (47.5, 41.8)
  54  | (60.0, 20.7)    | (60.0, 41.8)
  55  | (72.5, 20.7)    | (72.5, 41.8)
  56  | (85.0, 20.7)    | (85.0, 41.8)
  57  | (97.5, 20.7)    | (97.5, 41.8)
  58  | (110.0, 20.7)   | (110.0, 41.8)
  59  | (122.5, 20.7)   | (122.5, 41.8)
  60  | (135.0, 20.7)   | (135.0, 41.8)
  61  | (147.5, 20.7)   | (147.5, 41.8)
  62  | (160.0, 20.7)   | (160.0, 41.8)
  63  | (172.5, 20.7)   | (172.5, 41.8)
  64  | (185.0, 20.7)   | (185.0, 41.8)
  65  | (197.5, 20.7)   | (197.5, 41.8)
  66  | (210.0, 20.7)   | (210.0, 41.8)
  67  | (222.5, 20.7)   | (222.5, 41.8)
  68  | (235.0, 20.7)   | (235.0, 41.8)
  69  | (247.5, 20.7)   | (247.5, 41.8)
  70  | (260.0, 20.7)   | (260.0, 41.8)
  71  | (272.5, 20.7)   | (272.5, 41.8)
  72  | (285.0, 20.7)   | (285.0, 41.8)
  73  | (297.5, 20.7)   | (297.5, 41.8)
  74  | (310.0, 20.7)   | (310.0, 41.8)
  75  | (310.0, 30.6)   | (310.0, 51.7)
  76  | (297.5, 30.6)   | (297.5, 51.7)
  77  | (285.0, 30.6)   | (285.0, 51.7)
  78  | (272.5, 30.6)   | (272.5, 51.7)
  79  | (260.0, 30.6)   | (260.0, 51.7)
  80  | (247.5, 30.6)   | (247.5, 51.7)
  81  | (235.0, 30.6)   | (235.0, 51.7)
  82  | (222.5, 30.6)   | (222.5, 51.7)
  83  | (210.0, 30.6)   | (210.0, 51.7)
  84  | (197.5, 30.6)   | (197.5, 51.7)
  85  | (185.0, 30.6)   | (185.0, 51.7)
  86  | (172.5, 30.6)   | (172.5, 51.7)
  87  | (160.0, 30.6)   | (160.0, 51.7)
  88  | (147.5, 30.6)   | (147.5, 51.7)
  89  | (135.0, 30.6)   | (135.0, 51.7)
  90  | (122.5, 30.6)   | (122.5, 51.7)
  91  | (110.0, 30.6)   | (110.0, 51.7)
  92  | (97.5, 30.6)    | (97.5, 51.7)
  93  | (85.0, 30.6)    | (85.0, 51.7)
  94  | (72.5, 30.6)    | (72.5, 51.7)
  95  | (60.0, 30.6)    | (60.0, 51.7)
  96  | (47.5, 30.6)    | (47.5, 51.7)
  97  | (35.0, 30.6)    | (35.0, 51.7)
  98  | (22.5, 30.6)    | (22.5, 51.7)
  99  | (10.0, 30.6)    | (10.0, 51.7)
  100 | (10.0, 40.5)    | (10.0, 61.6)
  101 | (22.5, 40.5)    | (22.5, 61.6)
  102 | (35.0, 40.5)    | (35.0, 61.6)
  103 | (47.5, 40.5)    | (47.5, 61.6)
  104 | (60.0, 40.5)    | (60.0, 61.6)
  105 | (72.5, 40.5)    | (72.5, 61.6)
  106 | (85.0, 40.5)    | (85.0, 61.6)
  107 | (97.5, 40.5)    | (97.5, 61.6)
  108 | (110.0, 40.5)   | (110.0, 61.6)
  109 | (122.5, 40.5)   | (122.5, 61.6)
  110 | (135.0, 40.5)   | (135.0, 61.6)
  111 | (147.5, 40.5)   | (147.5, 61.6)
  112 | (160.0, 40.5)   | (160.0, 61.6)
  113 | (172.5, 40.5)   | (172.5, 61.6)
  114 | (185.0, 40.5)   | (185.0, 61.6)
  115 | (197.5, 40.5)   | (197.5, 61.6)
  116 | (210.0, 40.5)   | (210.0, 61.6)
  117 | (222.5, 40.5)   | (222.5, 61.6)
  118 | (235.0, 40.5)   | (235.0, 61.6)
  119 | (247.5, 40.5)   | (247.5, 61.6)
  120 | (260.0, 40.5)   | (260.0, 61.6)
  121 | (272.5, 40.5)   | (272.5, 61.6)
  122 | (285.0, 40.5)   | (285.0, 61.6)
  123 | (297.5, 40.5)   | (297.5, 61.6)
  124 | (310.0, 40.5)   | (310.0, 61.6)
  125 | (310.0, 50.4)   | (310.0, 71.5)
  126 | (297.5, 50.4)   | (297.5, 71.5)
  127 | (285.0, 50.4)   | (285.0, 71.5)
  128 | (272.5, 50.4)   | (272.5, 71.5)
  129 | (260.0, 50.4)   | (260.0, 71.5)
  130 | (247.5, 50.4)   | (247.5, 71.5)
  131 | (235.0, 50.4)   | (235.0, 71.5)
  132 | (222.5, 50.4)   | (222.5, 71.5)
  133 | (210.0, 50.4)   | (210.0, 71.5)
  134 | (197.5, 50.4)   | (197.5, 71.5)
  135 | (185.0, 50.4)   | (185.0, 71.5)
  136 | (172.5, 50.4)   | (172.5, 71.5)
  137 | (160.0, 50.4)   | (160.0, 71.5)
  138 | (147.5, 50.4)   | (147.5, 71.5)
  139 | (135.0, 50.4)   | (135.0, 71.5)
  140 | (122.5, 50.4)   | (122.5, 71.5)
  141 | (110.0, 50.4)   | (110.0, 71.5)
  142 | (97.5, 50.4)    | (97.5, 71.5)
  143 | (85.0, 50.4)    | (85.0, 71.5)
  144 | (72.5, 50.4)    | (72.5, 71.5)
  145 | (60.0, 50.4)    | (60.0, 71.5)
  146 | (47.5, 50.4)    | (47.5, 71.5)
  147 | (35.0, 50.4)    | (35.0, 71.5)
  148 | (22.5, 50.4)    | (22.5, 71.5)
  149 | (10.0, 50.4)    | (10.0, 71.5)
  150 | (10.0, 60.4)    | (10.0, 81.5)
  151 | (22.5, 60.4)    | (22.5, 81.5)
  152 | (35.0, 60.4)    | (35.0, 81.5)
  153 | (47.5, 60.4)    | (47.5, 81.5)
  154 | (60.0, 60.4)    | (60.0, 81.5)
  155 | (72.5, 60.4)    | (72.5, 81.5)
  156 | (85.0, 60.4)    | (85.0, 81.5)
  157 | (97.5, 60.4)    | (97.5, 81.5)
  158 | (110.0, 60.4)   | (110.0, 81.5)
  159 | (122.5, 60.4)   | (122.5, 81.5)
  160 | (135.0, 60.4)   | (135.0, 81.5)
  161 | (147.5, 60.4)   | (147.5, 81.5)
  162 | (160.0, 60.4)   | (160.0, 81.5)
  163 | (172.5, 60.4)   | (172.5, 81.5)
  164 | (185.0, 60.4)   | (185.0, 81.5)
  165 | (197.5, 60.4)   | (197.5, 81.5)
  166 | (210.0, 60.4)   | (210.0, 81.5)
  167 | (222.5, 60.4)   | (222.5, 81.5)
  168 | (235.0, 60.4)   | (235.0, 81.5)
  169 | (247.5, 60.4)   | (247.5, 81.5)
  170 | (260.0, 60.4)   | (260.0, 81.5)
  171 | (272.5, 60.4)   | (272.5, 81.5)
  172 | (285.0, 60.4)   | (285.0, 81.5)
  173 | (297.5, 60.4)   | (297.5, 81.5)
  174 | (310.0, 60.4)   | (310.0, 81.5)
  175 | (310.0, 70.3)   | (310.0, 91.4)
  176 | (297.5, 70.3)   | (297.5, 91.4)
  177 | (285.0, 70.3)   | (285.0, 91.4)
  178 | (272.5, 70.3)   | (272.5, 91.4)
  179 | (260.0, 70.3)   | (260.0, 91.4)
  180 | (247.5, 70.3)   | (247.5, 91.4)
  181 | (235.0, 70.3)   | (235.0, 91.4)
  182 | (222.5, 70.3)   | (222.5, 91.4)
  183 | (210.0, 70.3)   | (210.0, 91.4)
  184 | (197.5, 70.3)   | (197.5, 91.4)
  185 | (185.0, 70.3)   | (185.0, 91.4)
  186 | (172.5, 70.3)   | (172.5, 91.4)
  187 | (160.0, 70.3)   | (160.0, 91.4)
  188 | (147.5, 70.3)   | (147.5, 91.4)
  189 | (135.0, 70.3)   | (135.0, 91.4)
  190 | (122.5, 70.3)   | (122.5, 91.4)
  191 | (110.0, 70.3)   | (110.0, 91.4)
  192 | (97.5, 70.3)    | (97.5, 91.4)
  193 | (85.0, 70.3)    | (85.0, 91.4)
  194 | (72.5, 70.3)    | (72.5, 91.4)
  195 | (60.0, 70.3)    | (60.0, 91.4)
  196 | (47.5, 70.3)    | (47.5, 91.4)
  197 | (35.0, 70.3)    | (35.0, 91.4)
  198 | (22.5, 70.3)    | (22.5, 91.4)
  199 | (10.0, 70.3)    | (10.0, 91.4)
  200 | (10.0, 80.2)    | (10.0, 101.3)
  201 | (22.5, 80.2)    | (22.5, 101.3)
  202 | (35.0, 80.2)    | (35.0, 101.3)
  203 | (47.5, 80.2)    | (47.5, 101.3)
  204 | (60.0, 80.2)    | (60.0, 101.3)
  205 | (72.5, 80.2)    | (72.5, 101.3)
  206 | (85.0, 80.2)    | (85.0, 101.3)
  207 | (97.5, 80.2)    | (97.5, 101.3)
  208 | (110.0, 80.2)   | (110.0, 101.3)
  209 | (122.5, 80.2)   | (122.5, 101.3)
  210 | (135.0, 80.2)   | (135.0, 101.3)
  211 | (147.5, 80.2)   | (147.5, 101.3)
  212 | (160.0, 80.2)   | (160.0, 101.3)
  213 | (172.5, 80.2)   | (172.5, 101.3)
  214 | (185.0, 80.2)   | (185.0, 101.3)
  215 | (197.5, 80.2)   | (197.5, 101.3)
  216 | (210.0, 80.2)   | (210.0, 101.3)
  217 | (222.5, 80.2)   | (222.5, 101.3)
  218 | (235.0, 80.2)   | (235.0, 101.3)
  219 | (247.5, 80.2)   | (247.5, 101.3)
  220 | (260.0, 80.2)   | (260.0, 101.3)
  221 | (272.5, 80.2)   | (272.5, 101.3)
  222 | (285.0, 80.2)   | (285.0, 101.3)
  223 | (297.5, 80.2)   | (297.5, 101.3)
  224 | (310.0, 80.2)   | (310.0, 101.3)
  225 | (310.0, 90.1)   | (310.0, 111.2)
  226 | (297.5, 90.1)   | (297.5, 111.2)
  227 | (285.0, 90.1)   | (285.0, 111.2)
  228 | (272.5, 90.1)   | (272.5, 111.2)
  229 | (260.0, 90.1)   | (260.0, 111.2)
  230 | (247.5, 90.1)   | (247.5, 111.2)
  231 | (235.0, 90.1)   | (235.0, 111.2)
  232 | (222.5, 90.1)   | (222.5, 111.2)
  233 | (210.0, 90.1)   | (210.0, 111.2)
  234 | (197.5, 90.1)   | (197.5, 111.2)
  235 | (185.0, 90.1)   | (185.0, 111.2)
  236 | (172.5, 90.1)   | (172.5, 111.2)
  237 | (160.0, 90.1)   | (160.0, 111.2)
  238 | (147.5, 90.1)   | (147.5, 111.2)
  239 | (135.0, 90.1)   | (135.0, 111.2)
  240 | (122.5, 90.1)   | (122.5, 111.2)
  241 | (110.0, 90.1)   | (110.0, 111.2)
  242 | (97.5, 90.1)    | (97.5, 111.2)
  243 | (85.0, 90.1)    | (85.0, 111.2)
  244 | (72.5, 90.1)    | (72.5, 111.2)
  245 | (60.0, 90.1)    | (60.0, 111.2)
  246 | (47.5, 90.1)    | (47.5, 111.2)
  247 | (35.0, 90.1)    | (35.0, 111.2)
  248 | (22.5, 90.1)    | (22.5, 111.2)
  249 | (10.0, 90.1)    | (10.0, 111.2)
  250 | (10.0, 100.0)   | (10.0, 121.1)
  251 | (22.5, 100.0)   | (22.5, 121.1)
  252 | (35.0, 100.0)   | (35.0, 121.1)
  253 | (47.5, 100.0)   | (47.5, 121.1)
  254 | (60.0, 100.0)   | (60.0, 121.1)
  255 | (72.5, 100.0)   | (72.5, 121.1)
  256 | (85.0, 100.0)   | (85.0, 121.1)
  257 | (97.5, 100.0)   | (97.5, 121.1)
  258 | (110.0, 100.0)  | (110.0, 121.1)
  259 | (122.5, 100.0)  | (122.5, 121.1)
  260 | (135.0, 100.0)  | (135.0, 121.1)
  261 | (147.5, 100.0)  | (147.5, 121.1)
  262 | (160.0, 100.0)  | (160.0, 121.1)
  263 | (172.5, 100.0)  | (172.5, 121.1)
  264 | (185.0, 100.0)  | (185.0, 121.1)
  265 | (197.5, 100.0)  | (197.5, 121.1)
  266 | (210.0, 100.0)  | (210.0, 121.1)
  267 | (222.5, 100.0)  | (222.5, 121.1)
  268 | (235.0, 100.0)  | (235.0, 121.1)
  269 | (247.5, 100.0)  | (247.5, 121.1)
  270 | (260.0, 100.0)  | (260.0, 121.1)
  271 | (272.5, 100.0)  | (272.5, 121.1)
  272 | (285.0, 100.0)  | (285.0, 121.1)
  273 | (297.5, 100.0)  | (297.5, 121.1)
  274 | (310.0, 100.0)  | (310.0, 121.1)
  275 | (310.0, 109.9)  | (310.0, 131.0)
  276 | (297.5, 109.9)  | (297.5, 131.0)
  277 | (285.0, 109.9)  | (285.0, 131.0)
  278 | (272.5, 109.9)  | (272.5, 131.0)
  279 | (260.0, 109.9)  | (260.0, 131.0)
  280 | (247.5, 109.9)  | (247.5, 131.0)
  281 | (235.0, 109.9)  | (235.0, 131.0)
  282 | (222.5, 109.9)  | (222.5, 131.0)
  283 | (210.0, 109.9)  | (210.0, 131.0)
  284 | (197.5, 109.9)  | (197.5, 131.0)
  285 | (185.0, 109.9)  | (185.0, 131.0)
  286 | (172.5, 109.9)  | (172.5, 131.0)
  287 | (160.0, 109.9)  | (160.0, 131.0)
  288 | (147.5, 109.9)  | (147.5, 131.0)
  289 | (135.0, 109.9)  | (135.0, 131.0)
  290 | (122.5, 109.9)  | (122.5, 131.0)
  291 | (110.0, 109.9)  | (110.0, 131.0)
  292 | (97.5, 109.9)   | (97.5, 131.0)
  293 | (85.0, 109.9)   | (85.0, 131.0)
  294 | (72.5, 109.9)   | (72.5, 131.0)
  295 | (60.0, 109.9)   | (60.0, 131.0)
  296 | (47.5, 109.9)   | (47.5, 131.0)
  297 | (35.0, 109.9)   | (35.0, 131.0)
  298 | (22.5, 109.9)   | (22.5, 131.0)
  299 | (10.0, 109.9)   | (10.0, 131.0)
  300 | (10.0, 119.8)   | (10.0, 140.9)
  301 | (22.5, 119.8)   | (22.5, 140.9)
  302 | (35.0, 119.8)   | (35.0, 140.9)
  303 | (47.5, 119.8)   | (47.5, 140.9)
  304 | (60.0, 119.8)   | (60.0, 140.9)
  305 | (72.5, 119.8)   | (72.5, 140.9)
  306 | (85.0, 119.8)   | (85.0, 140.9)
  307 | (97.5, 119.8)   | (97.5, 140.9)
  308 | (110.0, 119.8)  | (110.0, 140.9)
  309 | (122.5, 119.8)  | (122.5, 140.9)
  310 | (135.0, 119.8)  | (135.0, 140.9)
  311 | (147.5, 119.8)  | (147.5, 140.9)
  312 | (160.0, 119.8)  | (160.0, 140.9)
  313 | (172.5, 119.8)  | (172.5, 140.9)
  314 | (185.0, 119.8)  | (185.0, 140.9)
  315 | (197.5, 119.8)  | (197.5, 140.9)
  316 | (210.0, 119.8)  | (210.0, 140.9)
  317 | (222.5, 119.8)  | (222.5, 140.9)
  318 | (235.0, 119.8)  | (235.0, 140.9)
  319 | (247.5, 119.8)  | (247.5, 140.9)
  320 | (260.0, 119.8)  | (260.0, 140.9)
  321 | (272.5, 119.8)  | (272.5, 140.9)
  322 | (285.0, 119.8)  | (285.0, 140.9)
  323 | (297.5, 119.8)  | (297.5, 140.9)
  324 | (310.0, 119.8)  | (310.0, 140.9)
  325 | (310.0, 129.7)  | (310.0, 150.8)
  326 | (297.5, 129.7)  | (297.5, 150.8)
  327 | (285.0, 129.7)  | (285.0, 150.8)
  328 | (272.5, 129.7)  | (272.5, 150.8)
  329 | (260.0, 129.7)  | (260.0, 150.8)
  330 | (247.5, 129.7)  | (247.5, 150.8)
  331 | (235.0, 129.7)  | (235.0, 150.8)
  332 | (222.5, 129.7)  | (222.5, 150.8)
  333 | (210.0, 129.7)  | (210.0, 150.8)
  334 | (197.5, 129.7)  | (197.5, 150.8)
  335 | (185.0, 129.7)  | (185.0, 150.8)
  336 | (172.5, 129.7)  | (172.5, 150.8)
  337 | (160.0, 129.7)  | (160.0, 150.8)
  338 | (147.5, 129.7)  | (147.5, 150.8)
  339 | (135.0, 129.7)  | (135.0, 150.8)
  340 | (122.5, 129.7)  | (122.5, 150.8)
  341 | (110.0, 129.7)  | (110.0, 150.8)
  342 | (97.5, 129.7)   | (97.5, 150.8)
  343 | (85.0, 129.7)   | (85.0, 150.8)
  344 | (72.5, 129.7)   | (72.5, 150.8)
  345 | (60.0, 129.7)   | (60.0, 150.8)
  346 | (47.5, 129.7)   | (47.5, 150.8)
  347 | (35.0, 129.7)   | (35.0, 150.8)
  348 | (22.5, 129.7)   | (22.5, 150.8)
  349 | (10.0, 129.7)   | (10.0, 150.8)
  350 | (10.0, 139.6)   | (10.0, 160.7)
  351 | (22.5, 139.6)   | (22.5, 160.7)
  352 | (35.0, 139.6)   | (35.0, 160.7)
  353 | (47.5, 139.6)   | (47.5, 160.7)
  354 | (60.0, 139.6)   | (60.0, 160.7)
  355 | (72.5, 139.6)   | (72.5, 160.7)
  356 | (85.0, 139.6)   | (85.0, 160.7)
  357 | (97.5, 139.6)   | (97.5, 160.7)
  358 | (110.0, 139.6)  | (110.0, 160.7)
  359 | (122.5, 139.6)  | (122.5, 160.7)
  360 | (135.0, 139.6)  | (135.0, 160.7)
  361 | (147.5, 139.6)  | (147.5, 160.7)
  362 | (160.0, 139.6)  | (160.0, 160.7)
  363 | (172.5, 139.6)  | (172.5, 160.7)
  364 | (185.0, 139.6)  | (185.0, 160.7)
  365 | (197.5, 139.6)  | (197.5, 160.7)
  366 | (210.0, 139.6)  | (210.0, 160.7)
  367 | (222.5, 139.6)  | (222.5, 160.7)
  368 | (235.0, 139.6)  | (235.0, 160.7)
  369 | (247.5, 139.6)  | (247.5, 160.7)
  370 | (260.0, 139.6)  | (260.0, 160.7)
  371 | (272.5, 139.6)  | (272.5, 160.7)
  372 | (285.0, 139.6)  | (285.0, 160.7)
  373 | (297.5, 139.6)  | (297.5, 160.7)
  374 | (310.0, 139.6)  | (310.0, 160.7)
  375 | (310.0, 149.5)  | (310.0, 170.6)
  376 | (297.5, 149.5)  | (297.5, 170.6)
  377 | (285.0, 149.5)  | (285.0, 170.6)
  378 | (272.5, 149.5)  | (272.5, 170.6)
  379 | (260.0, 149.5)  | (260.0, 170.6)
  380 | (247.5, 149.5)  | (247.5, 170.6)
  381 | (235.0, 149.5)  | (235.0, 170.6)
  382 | (222.5, 149.5)  | (222.5, 170.6)
  383 | (210.0, 149.5)  | (210.0, 170.6)
  384 | (197.5, 149.5)  | (197.5, 170.6)
  385 | (185.0, 149.5)  | (185.0, 170.6)
  386 | (172.5, 149.5)  | (172.5, 170.6)
  387 | (160.0, 149.5)  | (160.0, 170.6)
  388 | (147.5, 149.5)  | (147.5, 170.6)
  389 | (135.0, 149.5)  | (135.0, 170.6)
  390 | (122.5, 149.5)  | (122.5, 170.6)
  391 | (110.0, 149.5)  | (110.0, 170.6)
  392 | (97.5, 149.5)   | (97.5, 170.6)
  393 | (85.0, 149.5)   | (85.0, 170.6)
  394 | (72.5, 149.5)   | (72.5, 170.6)
  395 | (60.0, 149.5)   | (60.0, 170.6)
  396 | (47.5, 149.5)   | (47.5, 170.6)
  397 | (35.0, 149.5)   | (35.0, 170.6)
  398 | (22.5, 149.5)   | (22.5, 170.6)
  399 | (10.0, 149.5)   | (10.0, 170.6)
  400 | (10.0, 159.5)   | (10.0, 180.6)
  401 | (22.5, 159.5)   | (22.5, 180.6)
  402 | (35.0, 159.5)   | (35.0, 180.6)
  403 | (47.5, 159.5)   | (47.5, 180.6)
  404 | (60.0, 159.5)   | (60.0, 180.6)
  405 | (72.5, 159.5)   | (72.5, 180.6)
  406 | (85.0, 159.5)   | (85.0, 180.6)
  407 | (97.5, 159.5)   | (97.5, 180.6)
  408 | (110.0, 159.5)  | (110.0, 180.6)
  409 | (122.5, 159.5)  | (122.5, 180.6)
  410 | (135.0, 159.5)  | (135.0, 180.6)
  411 | (147.5, 159.5)  | (147.5, 180.6)
  412 | (160.0, 159.5)  | (160.0, 180.6)
  413 | (172.5, 159.5)  | (172.5, 180.6)
  414 | (185.0, 159.5)  | (185.0, 180.6)
  415 | (197.5, 159.5)  | (197.5, 180.6)
  416 | (210.0, 159.5)  | (210.0, 180.6)
  417 | (222.5, 159.5)  | (222.5, 180.6)
  418 | (235.0, 159.5)  | (235.0, 180.6)
  419 | (247.5, 159.5)  | (247.5, 180.6)
  420 | (260.0, 159.5)  | (260.0, 180.6)
  421 | (272.5, 159.5)  | (272.5, 180.6)
  422 | (285.0, 159.5)  | (285.0, 180.6)
  423 | (297.5, 159.5)  | (297.5, 180.6)
  424 | (310.0, 159.5)  | (310.0, 180.6)
  425 | (310.0, 169.4)  | (310.0, 190.5)
  426 | (297.5, 169.4)  | (297.5, 190.5)
  427 | (285.0, 169.4)  | (285.0, 190.5)
  428 | (272.5, 169.4)  | (272.5, 190.5)
  429 | (260.0, 169.4)  | (260.0, 190.5)
  430 | (247.5, 169.4)  | (247.5, 190.5)
  431 | (235.0, 169.4)  | (235.0, 190.5)
  432 | (222.5, 169.4)  | (222.5, 190.5)
  433 | (210.0, 169.4)  | (210.0, 190.5)
  434 | (197.5, 169.4)  | (197.5, 190.5)
  435 | (185.0, 169.4)  | (185.0, 190.5)
  436 | (172.5, 169.4)  | (172.5, 190.5)
  437 | (160.0, 169.4)  | (160.0, 190.5)
  438 | (147.5, 169.4)  | (147.5, 190.5)
  439 | (135.0, 169.4)  | (135.0, 190.5)
  440 | (122.5, 169.4)  | (122.5, 190.5)
  441 | (110.0, 169.4)  | (110.0, 190.5)
  442 | (97.5, 169.4)   | (97.5, 190.5)
  443 | (85.0, 169.4)   | (85.0, 190.5)
  444 | (72.5, 169.4)   | (72.5, 190.5)
  445 | (60.0, 169.4)   | (60.0, 190.5)
  446 | (47.5, 169.4)   | (47.5, 190.5)
  447 | (35.0, 169.4)   | (35.0, 190.5)
  448 | (22.5, 169.4)   | (22.5, 190.5)
  449 | (10.0, 169.4)   | (10.0, 190.5)
  450 | (10.0, 179.3)   | (10.0, 200.4)
  451 | (22.5, 179.3)   | (22.5, 200.4)
  452 | (35.0, 179.3)   | (35.0, 200.4)
  453 | (47.5, 179.3)   | (47.5, 200.4)
  454 | (60.0, 179.3)   | (60.0, 200.4)
  455 | (72.5, 179.3)   | (72.5, 200.4)
  456 | (85.0, 179.3)   | (85.0, 200.4)
  457 | (97.5, 179.3)   | (97.5, 200.4)
  458 | (110.0, 179.3)  | (110.0, 200.4)
  459 | (122.5, 179.3)  | (122.5, 200.4)
  460 | (135.0, 179.3)  | (135.0, 200.4)
  461 | (147.5, 179.3)  | (147.5, 200.4)
  462 | (160.0, 179.3)  | (160.0, 200.4)
  463 | (172.5, 179.3)  | (172.5, 200.4)
  464 | (185.0, 179.3)  | (185.0, 200.4)
  465 | (197.5, 179.3)  | (197.5, 200.4)
  466 | (210.0, 179.3)  | (210.0, 200.4)
  467 | (222.5, 179.3)  | (222.5, 200.4)
  468 | (235.0, 179.3)  | (235.0, 200.4)
  469 | (247.5, 179.3)  | (247.5, 200.4)
  470 | (260.0, 179.3)  | (260.0, 200.4)
  471 | (272.5, 179.3)  | (272.5, 200.4)
  472 | (285.0, 179.3)  | (285.0, 200.4)
  473 | (297.5, 179.3)  | (297.5, 200.4)
  474 | (310.0, 179.3)  | (310.0, 200.4)
  475 | (310.0, 189.2)  | (310.0, 210.3)
  476 | (297.5, 189.2)  | (297.5, 210.3)
  477 | (285.0, 189.2)  | (285.0, 210.3)
  478 | (272.5, 189.2)  | (272.5, 210.3)
  479 | (260.0, 189.2)  | (260.0, 210.3)
  480 | (247.5, 189.2)  | (247.5, 210.3)
  481 | (235.0, 189.2)  | (235.0, 210.3)
  482 | (222.5, 189.2)  | (222.5, 210.3)
  483 | (210.0, 189.2)  | (210.0, 210.3)
  484 | (197.5, 189.2)  | (197.5, 210.3)
  485 | (185.0, 189.2)  | (185.0, 210.3)
  486 | (172.5, 189.2)  | (172.5, 210.3)
  487 | (160.0, 189.2)  | (160.0, 210.3)
  488 | (147.5, 189.2)  | (147.5, 210.3)
  489 | (135.0, 189.2)  | (135.0, 210.3)
  490 | (122.5, 189.2)  | (122.5, 210.3)
  491 | (110.0, 189.2)  | (110.0, 210.3)
  492 | (97.5, 189.2)   | (97.5, 210.3)
  493 | (85.0, 189.2)   | (85.0, 210.3)
  494 | (72.5, 189.2)   | (72.5, 210.3)
  495 | (60.0, 189.2)   | (60.0, 210.3)
  496 | (47.5, 189.2)   | (47.5, 210.3)
  497 | (35.0, 189.2)   | (35.0, 210.3)
  498 | (22.5, 189.2)   | (22.5, 210.3)
  499 | (10.0, 189.2)   | (10.0, 210.3)
  500 | (10.0, 199.1)   | (10.0, 220.2)
  501 | (22.5, 199.1)   | (22.5, 220.2)
  502 | (35.0, 199.1)   | (35.0, 220.2)
  503 | (47.5, 199.1)   | (47.5, 220.2)
  504 | (60.0, 199.1)   | (60.0, 220.2)
  505 | (72.5, 199.1)   | (72.5, 220.2)
  506 | (85.0, 199.1)   | (85.0, 220.2)
  507 | (97.5, 199.1)   | (97.5, 220.2)
  508 | (110.0, 199.1)  | (110.0, 220.2)
  509 | (122.5, 199.1)  | (122.5, 220.2)
  510 | (135.0, 199.1)  | (135.0, 220.2)
  511 | (147.5, 199.1)  | (147.5, 220.2)
  512 | (160.0, 199.1)  | (160.0, 220.2)
  513 | (172.5, 199.1)  | (172.5, 220.2)
  514 | (185.0, 199.1)  | (185.0, 220.2)
  515 | (197.5, 199.1)  | (197.5, 220.2)
  516 | (210.0, 199.1)  | (210.0, 220.2)
  517 | (222.5, 199.1)  | (222.5, 220.2)
  518 | (235.0, 199.1)  | (235.0, 220.2)
  519 | (247.5, 199.1)  | (247.5, 220.2)
  520 | (260.0, 199.1)  | (260.0, 220.2)
  521 | (272.5, 199.1)  | (272.5, 220.2)
  522 | (285.0, 199.1)  | (285.0, 220.2)
  523 | (297.5, 199.1)  | (297.5, 220.2)
  524 | (310.0, 199.1)  | (310.0, 220.2)
  525 | (310.0, 209.0)  | (310.0, 230.1)
  526 | (297.5, 209.0)  | (297.5, 230.1)
  527 | (285.0, 209.0)  | (285.0, 230.1)
  528 | (272.5, 209.0)  | (272.5, 230.1)
  529 | (260.0, 209.0)  | (260.0, 230.1)
  530 | (247.5, 209.0)  | (247.5, 230.1)
  531 | (235.0, 209.0)  | (235.0, 230.1)
  532 | (222.5, 209.0)  | (222.5, 230.1)
  533 | (210.0, 209.0)  | (210.0, 230.1)
  534 | (197.5, 209.0)  | (197.5, 230.1)
  535 | (185.0, 209.0)  | (185.0, 230.1)
  536 | (172.5, 209.0)  | (172.5, 230.1)
  537 | (160.0, 209.0)  | (160.0, 230.1)
  538 | (147.5, 209.0)  | (147.5, 230.1)
  539 | (135.0, 209.0)  | (135.0, 230.1)
  540 | (122.5, 209.0)  | (122.5, 230.1)
  541 | (110.0, 209.0)  | (110.0, 230.1)
  542 | (97.5, 209.0)   | (97.5, 230.1)
  543 | (85.0, 209.0)   | (85.0, 230.1)
  544 | (72.5, 209.0)   | (72.5, 230.1)
  545 | (60.0, 209.0)   | (60.0, 230.1)
  546 | (47.5, 209.0)   | (47.5, 230.1)
  547 | (35.0, 209.0)   | (35.0, 230.1)
  548 | (22.5, 209.0)   | (22.5, 230.1)
  549 | (10.0, 209.0)   | (10.0, 230.1)
  550 | (10.0, 218.9)   | (10.0, 240.0)
  551 | (22.5, 218.9)   | (22.5, 240.0)
  552 | (35.0, 218.9)   | (35.0, 240.0)
  553 | (47.5, 218.9)   | (47.5, 240.0)
  554 | (60.0, 218.9)   | (60.0, 240.0)
  555 | (72.5, 218.9)   | (72.5, 240.0)
  556 | (85.0, 218.9)   | (85.0, 240.0)
  557 | (97.5, 218.9)   | (97.5, 240.0)
  558 | (110.0, 218.9)  | (110.0, 240.0)
  559 | (122.5, 218.9)  | (122.5, 240.0)
  560 | (135.0, 218.9)  | (135.0, 240.0)
  561 | (147.5, 218.9)  | (147.5, 240.0)
  562 | (160.0, 218.9)  | (160.0, 240.0)
  563 | (172.5, 218.9)  | (172.5, 240.0)
  564 | (185.0, 218.9)  | (185.0, 240.0)
  565 | (197.5, 218.9)  | (197.5, 240.0)
  566 | (210.0, 218.9)  | (210.0, 240.0)
  567 | (222.5, 218.9)  | (222.5, 240.0)
  568 | (235.0, 218.9)  | (235.0, 240.0)
  569 | (247.5, 218.9)  | (247.5, 240.0)
  570 | (260.0, 218.9)  | (260.0, 240.0)
  571 | (272.5, 218.9)  | (272.5, 240.0)
  572 | (285.0, 218.9)  | (285.0, 240.0)
  573 | (297.5, 218.9)  | (297.5, 240.0)
  574 | (310.0, 218.9)  | (310.0, 240.0)
  575 | (310.0, 228.8)  | (310.0, 249.9)
  576 | (297.5, 228.8)  | (297.5, 249.9)
  577 | (285.0, 228.8)  | (285.0, 249.9)
  578 | (272.5, 228.8)  | (272.5, 249.9)
  579 | (260.0, 228.8)  | (260.0, 249.9)
  580 | (247.5, 228.8)  | (247.5, 249.9)
  581 | (235.0, 228.8)  | (235.0, 249.9)
  582 | (222.5, 228.8)  | (222.5, 249.9)
  583 | (210.0, 228.8)  | (210.0, 249.9)
  584 | (197.5, 228.8)  | (197.5, 249.9)
  585 | (185.0, 228.8)  | (185.0, 249.9)
  586 | (172.5, 228.8)  | (172.5, 249.9)
  587 | (160.0, 228.8)  | (160.0, 249.9)
  588 | (147.5, 228.8)  | (147.5, 249.9)
  589 | (135.0, 228.8)  | (135.0, 249.9)
  590 | (122.5, 228.8)  | (122.5, 249.9)
  591 | (110.0, 228.8)  | (110.0, 249.9)
  592 | (97.5, 228.8)   | (97.5, 249.9)
  593 | (85.0, 228.8)   | (85.0, 249.9)
  594 | (72.5, 228.8)   | (72.5, 249.9)
  595 | (60.0, 228.8)   | (60.0, 249.9)
  596 | (47.5, 228.8)   | (47.5, 249.9)
  597 | (35.0, 228.8)   | (35.0, 249.9)
  598 | (22.5, 228.8)   | (22.5, 249.9)
  599 | (10.0, 228.8)   | (10.0, 249.9)
  600 | (10.0, 238.7)   | (10.0, 259.8)
  601 | (22.5, 238.7)   | (22.5, 259.8)
  602 | (35.0, 238.7)   | (35.0, 259.8)
  603 | (47.5, 238.7)   | (47.5, 259.8)
  604 | (60.0, 238.7)   | (60.0, 259.8)
  605 | (72.5, 238.7)   | (72.5, 259.8)
  606 | (85.0, 238.7)   | (85.0, 259.8)
  607 | (97.5, 238.7)   | (97.5, 259.8)
  608 | (110.0, 238.7)  | (110.0, 259.8)
  609 | (122.5, 238.7)  | (122.5, 259.8)
  610 | (135.0, 238.7)  | (135.0, 259.8)
  611 | (147.5, 238.7)  | (147.5, 259.8)
  612 | (160.0, 238.7)  | (160.0, 259.8)
  613 | (172.5, 238.7)  | (172.5, 259.8)
  614 | (185.0, 238.7)  | (185.0, 259.8)
  615 | (197.5, 238.7)  | (197.5, 259.8)
  616 | (210.0, 238.7)  | (210.0, 259.8)
  617 | (222.5, 238.7)  | (222.5, 259.8)
  618 | (235.0, 238.7)  | (235.0, 259.8)
  619 | (247.5, 238.7)  | (247.5, 259.8)
  620 | (260.0, 238.7)  | (260.0, 259.8)
  621 | (272.5, 238.7)  | (272.5, 259.8)
  622 | (285.0, 238.7)  | (285.0, 259.8)
  623 | (297.5, 238.7)  | (297.5, 259.8)
  624 | (310.0, 238.7)  | (310.0, 259.8)
bed_mesh: relative_reference_index 12 is (160.00, 22.00)
Sending MCU 'cartographer' printer configuration...
Configured MCU 'cartographer' (1024 moves)
cartographer: loaded fmin=2943053.84 from base
cartographer: loaded fmin_temp=20.33 from base
cartographer: built tempco model {'a_a': None, 'a_b': None, 'b_a': None, 'b_b': None, 'fmin': 2943053.8415908813, 'fmin_temp': 20.334694110249814}
Starting heater checks for extruder
Stats 96511.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=4388 bytes_read=7031 bytes_retransmit=9 bytes_invalid=0 send_seq=288 receive_seq=288 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400307106 tr: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=1502 bytes_read=4764 bytes_retransmit=9 bytes_invalid=0 send_seq=154 receive_seq=154 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64023200 adj=63895516  Kraken: temp=0.0 heater_bed: target=0 temp=0.0 pwm=0.000 cartographer: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=513 bytes_read=2573 bytes_retransmit=9 bytes_invalid=0 send_seq=77 receive_seq=77 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=48072447 adj=48055952 cartographer: coil_temp=21.0 refs=0 sysload=0.05 cputime=51.541 memavail=3846576 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=0.0 pwm=0.000
webhooks: registering remote method 'shutdown_machine' for connection id: 140734127188944
webhooks: registering remote method 'reboot_machine' for connection id: 140734127188944
webhooks: registering remote method 'pause_job_queue' for connection id: 140734127188944
webhooks: registering remote method 'start_job_queue' for connection id: 140734127188944
Stats 96512.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=4394 bytes_read=7133 bytes_retransmit=9 bytes_invalid=0 send_seq=289 receive_seq=289 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400142024 tr: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=1508 bytes_read=4780 bytes_retransmit=9 bytes_invalid=0 send_seq=155 receive_seq=155 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64007604 adj=64018591  Kraken: temp=30.4 heater_bed: target=0 temp=19.2 pwm=0.000 cartographer: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=519 bytes_read=2625 bytes_retransmit=9 bytes_invalid=0 send_seq=78 receive_seq=78 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=48027862 adj=48031761 cartographer: coil_temp=20.9 refs=0 sysload=0.04 cputime=51.560 memavail=3846848 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 96513.9: gcodein=0  mcu: mcu_awake=0.011 mcu_task_avg=0.000016 mcu_task_stddev=0.000096 bytes_write=4400 bytes_read=7320 bytes_retransmit=9 bytes_invalid=0 send_seq=290 receive_seq=290 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400082150 tr: mcu_awake=0.010 mcu_task_avg=0.000016 mcu_task_stddev=0.000026 bytes_write=1514 bytes_read=4811 bytes_retransmit=9 bytes_invalid=0 send_seq=156 receive_seq=156 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=63998787 adj=64029552  Kraken: temp=30.2 heater_bed: target=0 temp=19.1 pwm=0.000 cartographer: mcu_awake=0.000 mcu_task_avg=0.000000 mcu_task_stddev=0.000000 bytes_write=525 bytes_read=2695 bytes_retransmit=9 bytes_invalid=0 send_seq=79 receive_seq=79 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=48011156 adj=48004275 cartographer: coil_temp=21.0 refs=0 sysload=0.04 cputime=51.572 memavail=3846624 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 96514.9: gcodein=0  mcu: mcu_awake=0.011 mcu_task_avg=0.000016 mcu_task_stddev=0.000096 bytes_write=4406 bytes_read=7479 bytes_retransmit=9 bytes_invalid=0 send_seq=291 receive_seq=291 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400058700 tr: mcu_awake=0.010 mcu_task_avg=0.000016 mcu_task_stddev=0.000026 bytes_write=1520 bytes_read=4827 bytes_retransmit=9 bytes_invalid=0 send_seq=157 receive_seq=157 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=63996757 adj=64022396  Kraken: temp=30.3 heater_bed: target=0 temp=19.2 pwm=0.000 cartographer: mcu_awake=0.019 mcu_task_avg=0.000063 mcu_task_stddev=0.000204 bytes_write=531 bytes_read=2762 bytes_retransmit=9 bytes_invalid=0 send_seq=80 receive_seq=80 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=48007368 adj=47992487 cartographer: coil_temp=21.0 refs=0 sysload=0.04 cputime=51.578 memavail=3846624 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.6 pwm=0.000
Stats 96515.9: gcodein=0  mcu: mcu_awake=0.011 mcu_task_avg=0.000016 mcu_task_stddev=0.000096 bytes_write=4412 bytes_read=7624 bytes_retransmit=9 bytes_invalid=0 send_seq=292 receive_seq=292 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400044261 tr: mcu_awake=0.010 mcu_task_avg=0.000016 mcu_task_stddev=0.000026 bytes_write=1526 bytes_read=4843 bytes_retransmit=9 bytes_invalid=0 send_seq=158 receive_seq=158 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=63999175 adj=64017470  Kraken: temp=30.2 heater_bed: target=0 temp=19.1 pwm=0.000 cartographer: mcu_awake=0.019 mcu_task_avg=0.000063 mcu_task_stddev=0.000204 bytes_write=537 bytes_read=2832 bytes_retransmit=9 bytes_invalid=0 send_seq=81 receive_seq=81 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=48005045 adj=47993793 cartographer: coil_temp=21.0 refs=0 sysload=0.04 cputime=51.583 memavail=3846624 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.6 pwm=0.000
Stats 96516.9: gcodein=0  mcu: mcu_awake=0.011 mcu_task_avg=0.000016 mcu_task_stddev=0.000096 bytes_write=4418 bytes_read=7798 bytes_retransmit=9 bytes_invalid=0 send_seq=293 receive_seq=293 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400043366 tr: mcu_awake=0.010 mcu_task_avg=0.000016 mcu_task_stddev=0.000026 bytes_write=1532 bytes_read=4859 bytes_retransmit=9 bytes_invalid=0 send_seq=159 receive_seq=159 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64000296 adj=64021278  Kraken: temp=30.2 heater_bed: target=0 temp=19.2 pwm=0.000 cartographer: mcu_awake=0.019 mcu_task_avg=0.000063 mcu_task_stddev=0.000204 bytes_write=543 bytes_read=2884 bytes_retransmit=9 bytes_invalid=0 send_seq=82 receive_seq=82 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=48005384 adj=47994745 cartographer: coil_temp=20.9 refs=0 sysload=0.04 cputime=51.588 memavail=3846624 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 96517.9: gcodein=0  mcu: mcu_awake=0.011 mcu_task_avg=0.000016 mcu_task_stddev=0.000096 bytes_write=4424 bytes_read=7957 bytes_retransmit=9 bytes_invalid=0 send_seq=294 receive_seq=294 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400023014 tr: mcu_awake=0.010 mcu_task_avg=0.000016 mcu_task_stddev=0.000026 bytes_write=1538 bytes_read=4875 bytes_retransmit=9 bytes_invalid=0 send_seq=160 receive_seq=160 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64001757 adj=64017212  Kraken: temp=30.3 heater_bed: target=0 temp=19.1 pwm=0.000 cartographer: mcu_awake=0.019 mcu_task_avg=0.000063 mcu_task_stddev=0.000204 bytes_write=549 bytes_read=2936 bytes_retransmit=9 bytes_invalid=0 send_seq=83 receive_seq=83 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=48004609 adj=47997097 cartographer: coil_temp=21.0 refs=0 sysload=0.04 cputime=51.592 memavail=3846624 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 96518.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4430 bytes_read=8112 bytes_retransmit=9 bytes_invalid=0 send_seq=295 receive_seq=295 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400020387 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1544 bytes_read=4904 bytes_retransmit=9 bytes_invalid=0 send_seq=161 receive_seq=161 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64002318 adj=64022007  Kraken: temp=30.1 heater_bed: target=0 temp=19.2 pwm=0.000 cartographer: mcu_awake=0.019 mcu_task_avg=0.000063 mcu_task_stddev=0.000204 bytes_write=555 bytes_read=3006 bytes_retransmit=9 bytes_invalid=0 send_seq=84 receive_seq=84 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=48003584 adj=48000873 cartographer: coil_temp=21.0 refs=0 sysload=0.04 cputime=51.597 memavail=3846624 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 96519.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4436 bytes_read=8282 bytes_retransmit=9 bytes_invalid=0 send_seq=296 receive_seq=296 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400014486 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1550 bytes_read=4920 bytes_retransmit=9 bytes_invalid=0 send_seq=162 receive_seq=162 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64002195 adj=64019045  Kraken: temp=30.1 heater_bed: target=0 temp=19.2 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=561 bytes_read=3073 bytes_retransmit=9 bytes_invalid=0 send_seq=85 receive_seq=85 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=48002791 adj=47999196 cartographer: coil_temp=21.0 refs=0 sysload=0.04 cputime=51.602 memavail=3846624 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.6 pwm=0.000
Stats 96520.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4442 bytes_read=8441 bytes_retransmit=9 bytes_invalid=0 send_seq=297 receive_seq=297 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400008858 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1556 bytes_read=4936 bytes_retransmit=9 bytes_invalid=0 send_seq=163 receive_seq=163 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64002349 adj=64016871  Kraken: temp=30.2 heater_bed: target=0 temp=19.2 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=567 bytes_read=3143 bytes_retransmit=9 bytes_invalid=0 send_seq=86 receive_seq=86 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=48001601 adj=47999653 cartographer: coil_temp=21.0 refs=0 sysload=0.04 cputime=51.606 memavail=3846624 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.6 pwm=0.000
Stats 96521.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4448 bytes_read=8586 bytes_retransmit=9 bytes_invalid=0 send_seq=298 receive_seq=298 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400005094 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1562 bytes_read=4952 bytes_retransmit=9 bytes_invalid=0 send_seq=164 receive_seq=164 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64002469 adj=64016429  Kraken: temp=30.3 heater_bed: target=0 temp=19.1 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=573 bytes_read=3195 bytes_retransmit=9 bytes_invalid=0 send_seq=87 receive_seq=87 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=48000565 adj=47998523 cartographer: coil_temp=21.0 refs=0 sysload=0.04 cputime=51.611 memavail=3846624 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 96522.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4454 bytes_read=8760 bytes_retransmit=9 bytes_invalid=0 send_seq=299 receive_seq=299 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400002837 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1568 bytes_read=4968 bytes_retransmit=9 bytes_invalid=0 send_seq=165 receive_seq=165 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64001683 adj=64015312  Kraken: temp=30.2 heater_bed: target=0 temp=19.2 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=579 bytes_read=3247 bytes_retransmit=9 bytes_invalid=0 send_seq=88 receive_seq=88 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=48000932 adj=47997110 cartographer: coil_temp=21.1 refs=0 sysload=0.04 cputime=51.616 memavail=3845584 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 96523.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4460 bytes_read=8933 bytes_retransmit=9 bytes_invalid=0 send_seq=300 receive_seq=300 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400004737 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1574 bytes_read=4997 bytes_retransmit=9 bytes_invalid=0 send_seq=166 receive_seq=166 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64001929 adj=64010311  Kraken: temp=30.0 heater_bed: target=0 temp=19.1 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=585 bytes_read=3317 bytes_retransmit=9 bytes_invalid=0 send_seq=89 receive_seq=89 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=48000831 adj=48000299 cartographer: coil_temp=20.9 refs=0 sysload=0.04 cputime=51.621 memavail=3845584 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 96524.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4472 bytes_read=9094 bytes_retransmit=9 bytes_invalid=0 send_seq=302 receive_seq=302 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400006700 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1580 bytes_read=5013 bytes_retransmit=9 bytes_invalid=0 send_seq=167 receive_seq=167 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64002061 adj=64007742  Kraken: temp=30.2 heater_bed: target=0 temp=19.2 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=591 bytes_read=3384 bytes_retransmit=9 bytes_invalid=0 send_seq=90 receive_seq=90 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=48000190 adj=47998997 cartographer: coil_temp=21.0 refs=0 sysload=0.04 cputime=51.625 memavail=3845584 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.6 pwm=0.000
Stats 96525.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4478 bytes_read=9268 bytes_retransmit=9 bytes_invalid=0 send_seq=303 receive_seq=303 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400007301 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1586 bytes_read=5029 bytes_retransmit=9 bytes_invalid=0 send_seq=168 receive_seq=168 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64002366 adj=64005271  Kraken: temp=30.2 heater_bed: target=0 temp=19.2 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=597 bytes_read=3454 bytes_retransmit=9 bytes_invalid=0 send_seq=91 receive_seq=91 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=47999945 adj=47995583 cartographer: coil_temp=20.9 refs=0 sysload=0.04 cputime=51.630 memavail=3845584 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.6 pwm=0.000
Stats 96526.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4484 bytes_read=9427 bytes_retransmit=9 bytes_invalid=0 send_seq=304 receive_seq=304 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400004445 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1592 bytes_read=5045 bytes_retransmit=9 bytes_invalid=0 send_seq=169 receive_seq=169 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64002078 adj=64005130  Kraken: temp=30.1 heater_bed: target=0 temp=19.2 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=603 bytes_read=3506 bytes_retransmit=9 bytes_invalid=0 send_seq=92 receive_seq=92 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=48000044 adj=47995122 cartographer: coil_temp=20.9 refs=0 sysload=0.04 cputime=51.634 memavail=3845584 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.6 pwm=0.000
Stats 96527.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4490 bytes_read=9572 bytes_retransmit=9 bytes_invalid=0 send_seq=305 receive_seq=305 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400002329 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1598 bytes_read=5061 bytes_retransmit=9 bytes_invalid=0 send_seq=170 receive_seq=170 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64002336 adj=64005006  Kraken: temp=30.2 heater_bed: target=0 temp=19.2 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=609 bytes_read=3576 bytes_retransmit=9 bytes_invalid=0 send_seq=93 receive_seq=93 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=47999978 adj=47998231 cartographer: coil_temp=21.0 refs=0 sysload=0.03 cputime=51.638 memavail=3845824 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 96528.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4496 bytes_read=9760 bytes_retransmit=9 bytes_invalid=0 send_seq=306 receive_seq=306 retransmit_seq=2 srtt=0.000 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400000688 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1604 bytes_read=5090 bytes_retransmit=9 bytes_invalid=0 send_seq=171 receive_seq=171 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64002199 adj=64007085  Kraken: temp=30.0 heater_bed: target=0 temp=19.1 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=615 bytes_read=3628 bytes_retransmit=9 bytes_invalid=0 send_seq=94 receive_seq=94 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=47999805 adj=47999521 cartographer: coil_temp=21.0 refs=0 sysload=0.03 cputime=51.642 memavail=3845824 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 96529.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4502 bytes_read=9911 bytes_retransmit=9 bytes_invalid=0 send_seq=307 receive_seq=307 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400001719 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1610 bytes_read=5106 bytes_retransmit=9 bytes_invalid=0 send_seq=172 receive_seq=172 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64002231 adj=64006484  Kraken: temp=30.3 heater_bed: target=0 temp=19.1 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=621 bytes_read=3695 bytes_retransmit=9 bytes_invalid=0 send_seq=95 receive_seq=95 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=47999849 adj=47999734 cartographer: coil_temp=21.0 refs=0 sysload=0.03 cputime=51.646 memavail=3845824 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.6 pwm=0.000
Stats 96530.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4508 bytes_read=10056 bytes_retransmit=9 bytes_invalid=0 send_seq=308 receive_seq=308 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400002411 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1616 bytes_read=5122 bytes_retransmit=9 bytes_invalid=0 send_seq=173 receive_seq=173 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64002196 adj=64004655  Kraken: temp=30.3 heater_bed: target=0 temp=19.2 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=627 bytes_read=3765 bytes_retransmit=9 bytes_invalid=0 send_seq=96 receive_seq=96 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=47999924 adj=47999287 cartographer: coil_temp=21.0 refs=0 sysload=0.03 cputime=51.651 memavail=3845824 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.6 pwm=0.000
Stats 96531.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4514 bytes_read=10230 bytes_retransmit=9 bytes_invalid=0 send_seq=309 receive_seq=309 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400002652 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1622 bytes_read=5138 bytes_retransmit=9 bytes_invalid=0 send_seq=174 receive_seq=174 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64001861 adj=64003161  Kraken: temp=30.2 heater_bed: target=0 temp=19.2 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=633 bytes_read=3817 bytes_retransmit=9 bytes_invalid=0 send_seq=97 receive_seq=97 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=47999631 adj=47999311 cartographer: coil_temp=21.0 refs=0 sysload=0.03 cputime=51.655 memavail=3845824 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 96532.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4520 bytes_read=10389 bytes_retransmit=9 bytes_invalid=0 send_seq=310 receive_seq=310 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400003395 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1628 bytes_read=5154 bytes_retransmit=9 bytes_invalid=0 send_seq=175 receive_seq=175 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64001931 adj=64000739  Kraken: temp=30.3 heater_bed: target=0 temp=19.1 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=639 bytes_read=3887 bytes_retransmit=9 bytes_invalid=0 send_seq=98 receive_seq=98 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=47999398 adj=47997580 cartographer: coil_temp=21.0 refs=0 sysload=0.03 cputime=51.659 memavail=3845824 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 96533.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4526 bytes_read=10548 bytes_retransmit=9 bytes_invalid=0 send_seq=311 receive_seq=311 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400003801 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1634 bytes_read=5183 bytes_retransmit=9 bytes_invalid=0 send_seq=176 receive_seq=176 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64001674 adj=64000612  Kraken: temp=30.2 heater_bed: target=0 temp=19.2 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=645 bytes_read=3939 bytes_retransmit=9 bytes_invalid=0 send_seq=99 receive_seq=99 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=47999394 adj=47996125 cartographer: coil_temp=21.0 refs=0 sysload=0.03 cputime=51.663 memavail=3845824 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.6 pwm=0.000
Stats 96534.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4532 bytes_read=10722 bytes_retransmit=9 bytes_invalid=0 send_seq=312 receive_seq=312 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400004711 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1640 bytes_read=5199 bytes_retransmit=9 bytes_invalid=0 send_seq=177 receive_seq=177 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64001852 adj=63998836  Kraken: temp=30.3 heater_bed: target=0 temp=19.1 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=651 bytes_read=4006 bytes_retransmit=9 bytes_invalid=0 send_seq=100 receive_seq=100 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=47999471 adj=47996517 cartographer: coil_temp=21.0 refs=0 sysload=0.03 cputime=51.667 memavail=3845824 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 96535.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4538 bytes_read=10881 bytes_retransmit=9 bytes_invalid=0 send_seq=313 receive_seq=313 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400004523 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1646 bytes_read=5215 bytes_retransmit=9 bytes_invalid=0 send_seq=178 receive_seq=178 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64001906 adj=63999581  Kraken: temp=30.3 heater_bed: target=0 temp=19.1 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=657 bytes_read=4076 bytes_retransmit=9 bytes_invalid=0 send_seq=101 receive_seq=101 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=47999289 adj=47996898 cartographer: coil_temp=20.9 refs=0 sysload=0.03 cputime=51.671 memavail=3845824 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.6 pwm=0.000
Stats 96536.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4544 bytes_read=11026 bytes_retransmit=9 bytes_invalid=0 send_seq=314 receive_seq=314 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400004531 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1652 bytes_read=5231 bytes_retransmit=9 bytes_invalid=0 send_seq=179 receive_seq=179 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64001704 adj=64000504  Kraken: temp=29.9 heater_bed: target=0 temp=19.2 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=663 bytes_read=4128 bytes_retransmit=9 bytes_invalid=0 send_seq=102 receive_seq=102 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=47999410 adj=47996487 cartographer: coil_temp=20.9 refs=0 sysload=0.03 cputime=51.676 memavail=3845824 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 96537.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4550 bytes_read=11200 bytes_retransmit=9 bytes_invalid=0 send_seq=315 receive_seq=315 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400003136 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1658 bytes_read=5247 bytes_retransmit=9 bytes_invalid=0 send_seq=180 receive_seq=180 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64001588 adj=63999325  Kraken: temp=30.2 heater_bed: target=0 temp=19.2 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=669 bytes_read=4198 bytes_retransmit=9 bytes_invalid=0 send_seq=103 receive_seq=103 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=47999276 adj=47997838 cartographer: coil_temp=21.0 refs=0 sysload=0.03 cputime=51.680 memavail=3846432 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.6 pwm=0.000
Stats 96538.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4556 bytes_read=11373 bytes_retransmit=9 bytes_invalid=0 send_seq=316 receive_seq=316 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400002178 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1664 bytes_read=5276 bytes_retransmit=9 bytes_invalid=0 send_seq=181 receive_seq=181 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64001436 adj=64000497  Kraken: temp=30.3 heater_bed: target=0 temp=19.2 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=675 bytes_read=4250 bytes_retransmit=9 bytes_invalid=0 send_seq=104 receive_seq=104 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=47999239 adj=47998354 cartographer: coil_temp=21.0 refs=0 sysload=0.03 cputime=51.685 memavail=3846560 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 96539.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4562 bytes_read=11518 bytes_retransmit=9 bytes_invalid=0 send_seq=317 receive_seq=317 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400001078 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1670 bytes_read=5292 bytes_retransmit=9 bytes_invalid=0 send_seq=182 receive_seq=182 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64001556 adj=64000672  Kraken: temp=30.3 heater_bed: target=0 temp=19.2 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=681 bytes_read=4317 bytes_retransmit=9 bytes_invalid=0 send_seq=105 receive_seq=105 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=47999120 adj=47999054 cartographer: coil_temp=20.9 refs=0 sysload=0.03 cputime=51.690 memavail=3846080 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 96540.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4568 bytes_read=11684 bytes_retransmit=9 bytes_invalid=0 send_seq=318 receive_seq=318 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400001905 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1676 bytes_read=5308 bytes_retransmit=9 bytes_invalid=0 send_seq=183 receive_seq=183 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64001427 adj=64002915  Kraken: temp=30.3 heater_bed: target=0 temp=19.2 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=687 bytes_read=4387 bytes_retransmit=9 bytes_invalid=0 send_seq=106 receive_seq=106 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=47999160 adj=47999147 cartographer: coil_temp=21.1 refs=0 sysload=0.03 cputime=51.695 memavail=3846080 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.6 pwm=0.000
Stats 96541.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4574 bytes_read=11843 bytes_retransmit=9 bytes_invalid=0 send_seq=319 receive_seq=319 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400002620 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1682 bytes_read=5324 bytes_retransmit=9 bytes_invalid=0 send_seq=184 receive_seq=184 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64001554 adj=64000595  Kraken: temp=30.2 heater_bed: target=0 temp=19.2 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=693 bytes_read=4439 bytes_retransmit=9 bytes_invalid=0 send_seq=107 receive_seq=107 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=47999191 adj=47998661 cartographer: coil_temp=21.1 refs=0 sysload=0.03 cputime=51.699 memavail=3846080 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.6 pwm=0.000
Stats 96542.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4580 bytes_read=11988 bytes_retransmit=9 bytes_invalid=0 send_seq=320 receive_seq=320 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400002618 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1688 bytes_read=5340 bytes_retransmit=9 bytes_invalid=0 send_seq=185 receive_seq=185 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64001497 adj=64000816  Kraken: temp=30.2 heater_bed: target=0 temp=19.1 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=699 bytes_read=4509 bytes_retransmit=9 bytes_invalid=0 send_seq=108 receive_seq=108 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=47999163 adj=47998304 cartographer: coil_temp=21.0 refs=0 sysload=0.02 cputime=51.703 memavail=3846080 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 96543.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4586 bytes_read=12176 bytes_retransmit=9 bytes_invalid=0 send_seq=321 receive_seq=321 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400002598 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1694 bytes_read=5369 bytes_retransmit=9 bytes_invalid=0 send_seq=186 receive_seq=186 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64001564 adj=64000461  Kraken: temp=30.2 heater_bed: target=0 temp=19.2 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=705 bytes_read=4561 bytes_retransmit=9 bytes_invalid=0 send_seq=109 receive_seq=109 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=47999083 adj=47998238 cartographer: coil_temp=21.1 refs=0 sysload=0.02 cputime=51.708 memavail=3846080 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.6 pwm=0.000
Stats 96544.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4592 bytes_read=12335 bytes_retransmit=9 bytes_invalid=0 send_seq=322 receive_seq=322 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400002632 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1700 bytes_read=5385 bytes_retransmit=9 bytes_invalid=0 send_seq=187 receive_seq=187 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64001606 adj=64001162  Kraken: temp=30.2 heater_bed: target=0 temp=19.2 pwm=0.000 cartographer: mcu_awake=0.014 mcu_task_avg=0.000128 mcu_task_stddev=0.000329 bytes_write=711 bytes_read=4628 bytes_retransmit=9 bytes_invalid=0 send_seq=110 receive_seq=110 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=47999115 adj=47997795 cartographer: coil_temp=21.0 refs=0 sysload=0.02 cputime=51.712 memavail=3846080 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.6 pwm=0.000
Stats 96545.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4598 bytes_read=12480 bytes_retransmit=9 bytes_invalid=0 send_seq=323 receive_seq=323 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400002503 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1706 bytes_read=5401 bytes_retransmit=9 bytes_invalid=0 send_seq=188 receive_seq=188 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64001677 adj=64001456  Kraken: temp=30.1 heater_bed: target=0 temp=19.2 pwm=0.000 cartographer: mcu_awake=0.014 mcu_task_avg=0.000128 mcu_task_stddev=0.000329 bytes_write=717 bytes_read=4698 bytes_retransmit=9 bytes_invalid=0 send_seq=111 receive_seq=111 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=47999163 adj=47998254 cartographer: coil_temp=20.9 refs=0 sysload=0.02 cputime=51.716 memavail=3846080 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 96546.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4604 bytes_read=12654 bytes_retransmit=9 bytes_invalid=0 send_seq=324 receive_seq=324 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400002786 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1712 bytes_read=5417 bytes_retransmit=9 bytes_invalid=0 send_seq=189 receive_seq=189 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64001728 adj=64002136  Kraken: temp=30.2 heater_bed: target=0 temp=19.2 pwm=0.000 cartographer: mcu_awake=0.014 mcu_task_avg=0.000128 mcu_task_stddev=0.000329 bytes_write=723 bytes_read=4750 bytes_retransmit=9 bytes_invalid=0 send_seq=112 receive_seq=112 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=47999201 adj=47998907 cartographer: coil_temp=21.1 refs=0 sysload=0.02 cputime=51.720 memavail=3846320 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 96547.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4610 bytes_read=12813 bytes_retransmit=9 bytes_invalid=0 send_seq=325 receive_seq=325 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400002753 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1718 bytes_read=5433 bytes_retransmit=9 bytes_invalid=0 send_seq=190 receive_seq=190 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64001617 adj=64001961  Kraken: temp=30.2 heater_bed: target=0 temp=19.2 pwm=0.000 cartographer: mcu_awake=0.014 mcu_task_avg=0.000128 mcu_task_stddev=0.000329 bytes_write=729 bytes_read=4820 bytes_retransmit=9 bytes_invalid=0 send_seq=113 receive_seq=113 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=47999212 adj=47998927 cartographer: coil_temp=21.0 refs=0 sysload=0.02 cputime=51.724 memavail=3846320 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 96548.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4616 bytes_read=12972 bytes_retransmit=9 bytes_invalid=0 send_seq=326 receive_seq=326 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400001757 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1724 bytes_read=5462 bytes_retransmit=9 bytes_invalid=0 send_seq=191 receive_seq=191 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64001581 adj=64000899  Kraken: temp=30.2 heater_bed: target=0 temp=19.1 pwm=0.000 cartographer: mcu_awake=0.014 mcu_task_avg=0.000128 mcu_task_stddev=0.000329 bytes_write=735 bytes_read=4872 bytes_retransmit=9 bytes_invalid=0 send_seq=114 receive_seq=114 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=47999159 adj=47999039 cartographer: coil_temp=21.0 refs=0 sysload=0.02 cputime=51.728 memavail=3846320 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.6 pwm=0.000
Stats 96549.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4622 bytes_read=13146 bytes_retransmit=9 bytes_invalid=0 send_seq=327 receive_seq=327 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400001833 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1730 bytes_read=5478 bytes_retransmit=9 bytes_invalid=0 send_seq=192 receive_seq=192 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64001630 adj=64001873  Kraken: temp=30.1 heater_bed: target=0 temp=19.1 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=741 bytes_read=4939 bytes_retransmit=9 bytes_invalid=0 send_seq=115 receive_seq=115 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=47999192 adj=47999454 cartographer: coil_temp=21.0 refs=0 sysload=0.02 cputime=51.732 memavail=3846320 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 96550.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4628 bytes_read=13302 bytes_retransmit=9 bytes_invalid=0 send_seq=328 receive_seq=328 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400001830 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1736 bytes_read=5494 bytes_retransmit=9 bytes_invalid=0 send_seq=193 receive_seq=193 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64001539 adj=64002056  Kraken: temp=30.2 heater_bed: target=0 temp=19.1 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=747 bytes_read=5009 bytes_retransmit=9 bytes_invalid=0 send_seq=116 receive_seq=116 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=47999109 adj=47999535 cartographer: coil_temp=21.0 refs=0 sysload=0.02 cputime=51.736 memavail=3846320 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 96551.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4634 bytes_read=13443 bytes_retransmit=9 bytes_invalid=0 send_seq=329 receive_seq=329 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400001966 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1742 bytes_read=5510 bytes_retransmit=9 bytes_invalid=0 send_seq=194 receive_seq=194 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64001649 adj=64001070  Kraken: temp=30.2 heater_bed: target=0 temp=19.2 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=759 bytes_read=5077 bytes_retransmit=9 bytes_invalid=0 send_seq=118 receive_seq=118 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=47999079 adj=47998668 cartographer: coil_temp=21.0 refs=0 sysload=0.02 cputime=51.740 memavail=3846320 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 96552.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4640 bytes_read=13617 bytes_retransmit=9 bytes_invalid=0 send_seq=330 receive_seq=330 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400001200 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1748 bytes_read=5526 bytes_retransmit=9 bytes_invalid=0 send_seq=195 receive_seq=195 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64001562 adj=64001905  Kraken: temp=30.2 heater_bed: target=0 temp=19.2 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=765 bytes_read=5147 bytes_retransmit=9 bytes_invalid=0 send_seq=119 receive_seq=119 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=47999125 adj=47998313 cartographer: coil_temp=20.9 refs=0 sysload=0.02 cputime=51.745 memavail=3846320 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.6 pwm=0.000
Stats 96553.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4646 bytes_read=13790 bytes_retransmit=9 bytes_invalid=0 send_seq=331 receive_seq=331 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400000552 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1754 bytes_read=5555 bytes_retransmit=9 bytes_invalid=0 send_seq=196 receive_seq=196 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64001571 adj=64002106  Kraken: temp=30.0 heater_bed: target=0 temp=19.2 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=771 bytes_read=5199 bytes_retransmit=9 bytes_invalid=0 send_seq=120 receive_seq=120 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=47999133 adj=47999714 cartographer: coil_temp=21.0 refs=0 sysload=0.02 cputime=51.749 memavail=3846912 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 96554.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4652 bytes_read=13935 bytes_retransmit=9 bytes_invalid=0 send_seq=332 receive_seq=332 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400000021 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1760 bytes_read=5571 bytes_retransmit=9 bytes_invalid=0 send_seq=197 receive_seq=197 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64001618 adj=64002978  Kraken: temp=30.3 heater_bed: target=0 temp=19.1 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=777 bytes_read=5266 bytes_retransmit=9 bytes_invalid=0 send_seq=121 receive_seq=121 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=47999177 adj=48000335 cartographer: coil_temp=21.0 refs=0 sysload=0.02 cputime=51.754 memavail=3847040 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.6 pwm=0.000
Stats 96555.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4658 bytes_read=14109 bytes_retransmit=9 bytes_invalid=0 send_seq=333 receive_seq=333 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400000114 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1766 bytes_read=5587 bytes_retransmit=9 bytes_invalid=0 send_seq=198 receive_seq=198 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64001643 adj=64003858  Kraken: temp=30.1 heater_bed: target=0 temp=19.1 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=783 bytes_read=5336 bytes_retransmit=9 bytes_invalid=0 send_seq=122 receive_seq=122 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=47999192 adj=48001029 cartographer: coil_temp=21.0 refs=0 sysload=0.02 cputime=51.759 memavail=3846576 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 96556.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4664 bytes_read=14268 bytes_retransmit=9 bytes_invalid=0 send_seq=334 receive_seq=334 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400000132 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1772 bytes_read=5603 bytes_retransmit=9 bytes_invalid=0 send_seq=199 receive_seq=199 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64001718 adj=64003391  Kraken: temp=30.2 heater_bed: target=0 temp=19.1 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=789 bytes_read=5388 bytes_retransmit=9 bytes_invalid=0 send_seq=123 receive_seq=123 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=47999134 adj=48000599 cartographer: coil_temp=21.0 refs=0 sysload=0.02 cputime=51.764 memavail=3846576 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.6 pwm=0.000
Stats 96557.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4670 bytes_read=14413 bytes_retransmit=9 bytes_invalid=0 send_seq=335 receive_seq=335 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400000324 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1778 bytes_read=5619 bytes_retransmit=9 bytes_invalid=0 send_seq=200 receive_seq=200 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64001754 adj=64003653  Kraken: temp=30.1 heater_bed: target=0 temp=19.2 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=795 bytes_read=5458 bytes_retransmit=9 bytes_invalid=0 send_seq=124 receive_seq=124 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=47999176 adj=47999667 cartographer: coil_temp=21.0 refs=0 sysload=0.02 cputime=51.768 memavail=3846576 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 96558.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4676 bytes_read=14601 bytes_retransmit=9 bytes_invalid=0 send_seq=336 receive_seq=336 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400000426 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1784 bytes_read=5648 bytes_retransmit=9 bytes_invalid=0 send_seq=201 receive_seq=201 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64001669 adj=64003209  Kraken: temp=30.2 heater_bed: target=0 temp=19.2 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=801 bytes_read=5510 bytes_retransmit=9 bytes_invalid=0 send_seq=125 receive_seq=125 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=47999184 adj=47999708 cartographer: coil_temp=20.9 refs=0 sysload=0.02 cputime=51.772 memavail=3846576 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 96559.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4682 bytes_read=14760 bytes_retransmit=9 bytes_invalid=0 send_seq=337 receive_seq=337 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400000741 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1790 bytes_read=5664 bytes_retransmit=9 bytes_invalid=0 send_seq=202 receive_seq=202 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64001646 adj=64001855  Kraken: temp=30.2 heater_bed: target=0 temp=19.2 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=807 bytes_read=5577 bytes_retransmit=9 bytes_invalid=0 send_seq=126 receive_seq=126 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=47999110 adj=47999520 cartographer: coil_temp=20.9 refs=0 sysload=0.02 cputime=51.777 memavail=3846576 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.6 pwm=0.000
Stats 96560.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4688 bytes_read=14905 bytes_retransmit=9 bytes_invalid=0 send_seq=338 receive_seq=338 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400000820 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1796 bytes_read=5680 bytes_retransmit=9 bytes_invalid=0 send_seq=203 receive_seq=203 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64001671 adj=64001042  Kraken: temp=30.2 heater_bed: target=0 temp=19.1 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=813 bytes_read=5647 bytes_retransmit=9 bytes_invalid=0 send_seq=127 receive_seq=127 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=47999078 adj=47998310 cartographer: coil_temp=21.1 refs=0 sysload=0.02 cputime=51.781 memavail=3846576 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 96561.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4694 bytes_read=15073 bytes_retransmit=9 bytes_invalid=0 send_seq=339 receive_seq=339 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400000822 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1802 bytes_read=5696 bytes_retransmit=9 bytes_invalid=0 send_seq=204 receive_seq=204 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64001697 adj=64001296  Kraken: temp=30.3 heater_bed: target=0 temp=19.1 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=819 bytes_read=5699 bytes_retransmit=9 bytes_invalid=0 send_seq=128 receive_seq=128 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=47999015 adj=47998065 cartographer: coil_temp=21.0 refs=0 sysload=0.02 cputime=51.785 memavail=3846576 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 96562.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4700 bytes_read=15230 bytes_retransmit=9 bytes_invalid=0 send_seq=340 receive_seq=340 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400001041 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1808 bytes_read=5712 bytes_retransmit=9 bytes_invalid=0 send_seq=205 receive_seq=205 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64001735 adj=64001623  Kraken: temp=30.2 heater_bed: target=0 temp=19.2 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=825 bytes_read=5769 bytes_retransmit=9 bytes_invalid=0 send_seq=129 receive_seq=129 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=47998958 adj=47997648 cartographer: coil_temp=21.0 refs=0 sysload=0.02 cputime=51.790 memavail=3846576 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.6 pwm=0.000
Stats 96563.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4706 bytes_read=15375 bytes_retransmit=9 bytes_invalid=0 send_seq=341 receive_seq=341 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400001167 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1814 bytes_read=5741 bytes_retransmit=9 bytes_invalid=0 send_seq=206 receive_seq=206 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64001759 adj=64001632  Kraken: temp=30.3 heater_bed: target=0 temp=19.2 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=831 bytes_read=5821 bytes_retransmit=9 bytes_invalid=0 send_seq=130 receive_seq=130 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=47998944 adj=47997099 cartographer: coil_temp=21.0 refs=0 sysload=0.02 cputime=51.794 memavail=3846576 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 96564.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4712 bytes_read=15563 bytes_retransmit=9 bytes_invalid=0 send_seq=342 receive_seq=342 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400000606 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1820 bytes_read=5757 bytes_retransmit=9 bytes_invalid=0 send_seq=207 receive_seq=207 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64001764 adj=64001661  Kraken: temp=30.2 heater_bed: target=0 temp=19.2 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=837 bytes_read=5888 bytes_retransmit=9 bytes_invalid=0 send_seq=131 receive_seq=131 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=47998907 adj=47997232 cartographer: coil_temp=21.0 refs=0 sysload=0.02 cputime=51.798 memavail=3846576 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.4 pwm=0.000
Stats 96565.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4718 bytes_read=15722 bytes_retransmit=9 bytes_invalid=0 send_seq=343 receive_seq=343 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400000759 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1826 bytes_read=5773 bytes_retransmit=9 bytes_invalid=0 send_seq=208 receive_seq=208 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64001793 adj=64002658  Kraken: temp=30.1 heater_bed: target=0 temp=19.1 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=843 bytes_read=5958 bytes_retransmit=9 bytes_invalid=0 send_seq=132 receive_seq=132 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=47998890 adj=47997955 cartographer: coil_temp=21.1 refs=0 sysload=0.02 cputime=51.802 memavail=3846576 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.6 pwm=0.000
Stats 96566.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4724 bytes_read=15867 bytes_retransmit=9 bytes_invalid=0 send_seq=344 receive_seq=344 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400000896 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1832 bytes_read=5789 bytes_retransmit=9 bytes_invalid=0 send_seq=209 receive_seq=209 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64001809 adj=64002448  Kraken: temp=30.2 heater_bed: target=0 temp=19.1 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=849 bytes_read=6010 bytes_retransmit=9 bytes_invalid=0 send_seq=133 receive_seq=133 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=47998924 adj=47997793 cartographer: coil_temp=20.9 refs=0 sysload=0.02 cputime=51.806 memavail=3846576 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
Stats 96567.9: gcodein=0  mcu: mcu_awake=0.000 mcu_task_avg=0.000001 mcu_task_stddev=0.000001 bytes_write=4730 bytes_read=16041 bytes_retransmit=9 bytes_invalid=0 send_seq=345 receive_seq=345 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=400000412 tr: mcu_awake=0.000 mcu_task_avg=0.000007 mcu_task_stddev=0.000007 bytes_write=1838 bytes_read=5805 bytes_retransmit=9 bytes_invalid=0 send_seq=210 receive_seq=210 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=64001852 adj=64002188  Kraken: temp=30.4 heater_bed: target=0 temp=19.1 pwm=0.000 cartographer: mcu_awake=0.013 mcu_task_avg=0.000131 mcu_task_stddev=0.000333 bytes_write=855 bytes_read=6077 bytes_retransmit=9 bytes_invalid=0 send_seq=134 receive_seq=134 retransmit_seq=2 srtt=0.001 rttvar=0.000 rto=0.025 ready_bytes=0 upcoming_bytes=0 freq=47998937 adj=47998229 cartographer: coil_temp=20.9 refs=0 sysload=0.02 cputime=51.810 memavail=3846576 print_time=0.000 buffer_time=0.000 print_stall=0 extruder: target=0 temp=18.5 pwm=0.000
