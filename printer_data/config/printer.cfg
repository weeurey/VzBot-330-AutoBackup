[include mmu/base/*.cfg]
[include mmu/optional/client_macros.cfg]
#[include shell_command.cfg]
[include mainsail.cfg]
[include include/steppers.cfg]
[include include/fans.cfg]
[include include/bed.cfg]
#[include include/sensorless.cfg]f
#[include include/quickdraw.cfg]
[include include/led.cfg]
[include include/macros.cfg]
#[include include/trad_rack_btt_mmb.cfg]
#[include include/trad_rack_optional.cfg]




[safe_z_home]
home_xy_position: 165, 165
z_hop: 10

[z_tilt] 
z_positions: #Nozzle to GE5C
  -80,  -20
  350, -20
points:
  15, 150
  275, 150
speed: 50
horizontal_move_z: 10
retries: 30
retry_tolerance: 0.1

[input_shaper]
shaper_type_x = zv
shaper_freq_x = 120.6
shaper_type_y = zv
shaper_freq_y = 76.6

[scanner]
serial: /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00

#   Path to the serial port for the Cartographer device. Typically has the form
#   /dev/serial/by-id/usb-cartographer_cartographer_...
#   
#   If you are using the CAN Bus version, replace serial: with canbus_uuid: and add the UUID.
#   Example: canbus_uuid: 1283as878a9sd
#
speed: 2.0
#   Z probing dive speed.
lift_speed: 5.0
#   Z probing lift speed.
backlash_comp: 0.2
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.
x_offset: 0.
#   X offset of cartographer from the nozzle.
y_offset: 21.1
#   Y offset of cartographer from the nozzle.
trigger_distance: 2.0
#   cartographer trigger distance for homing.
trigger_dive_threshold: 1.5
#   Threshold for range vs dive mode probing. Beyond `trigger_distance +
#   trigger_dive_threshold` a dive will be used.
trigger_hysteresis: 0.006
#   Hysteresis on trigger threshold for untriggering, as a percentage of the
#   trigger threshold.
cal_nozzle_z: 0.1
#   Expected nozzle offset after completing manual Z offset calibration.
cal_floor: 0.1
#   Minimum z bound on sensor response measurement.
cal_ceil:5.
#   Maximum z bound on sensor response measurement.
cal_speed: 1.0
#   Speed while measuring response curve.
cal_move_speed: 10.
#   Speed while moving to position for response curve measurement.
default_model_name: default
#   Name of default cartographer model to load.
mesh_main_direction: X
#   Primary travel direction during mesh measurement.
#mesh_overscan: -1
#   Distance to use for direction changes at mesh line ends. Omit this setting
#   and a default will be calculated from line spacing and available travel.
mesh_cluster_size: 1
#   Radius of mesh grid point clusters.
mesh_runs: 2
#   Number of passes to make during mesh scan.
detect_threshold_z: 3600 # This needs tuning
calibration_method: tap 
z_offset: 0.0 
probe_speed: 2.0
tap_location: 150,150 # set to center of bed
sensor: cartographer

[printer]
kinematics: corexy
max_velocity: 3000
max_accel: 50000
#max_accel_to_decel: 5000
max_z_velocity: 3000
max_z_accel: 10000
square_corner_velocity: 10

[exclude_object]

[gcode_arcs] # OrcaSlicer
resolution: 1.0


[idle_timeout]

# only turn off heaters and motors if the printer is not paused
gcode:
    {% if not printer.pause_resume.is_paused %}
        TURN_OFF_HEATERS
        M84
    {% endif %}

[pause_resume]
recover_velocity: 350



[virtual_sdcard]
path: /home/pi/printer_data/gcodes
on_error_gcode: CANCEL_PRINT

[mcu]
#USB
serial: /dev/serial/by-id/usb-Klipper_stm32h723xx_0F003B001751313338343730-if00
#reconnect_interval: 9999




# Driver6
[extruder]
nozzle_diameter: 0.500
pressure_advance: 0.025
pressure_advance_smooth_time: 0.03
max_extrude_only_distance: 101

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.008192, 0.018949, 0.020221, 0.015971, 0.046533, 0.041034, 0.048649, 0.058640, 0.071010, 0.085861, 0.098374, 0.110317, 0.117982, 0.122167, 0.122534, 0.124649, 0.127036, 0.127710, 0.132925, 0.133443, 0.136485, 0.145171, 0.159084, 0.174722, 0.194458
#*# 	  -0.027306, -0.011625, -0.010998, 0.001433, 0.001392, 0.014598, 0.025884, 0.037103, 0.051687, 0.065126, 0.079909, 0.095768, 0.102493, 0.110484, 0.114218, 0.114191, 0.116857, 0.118306, 0.126084, 0.124743, 0.122871, 0.132140, 0.142308, 0.152424, 0.170318
#*# 	  -0.057783, -0.042860, -0.033805, -0.029292, -0.018606, -0.015709, -0.002372, 0.007746, 0.008377, 0.059233, 0.056207, 0.069954, 0.061782, 0.113223, 0.071921, 0.097795, 0.098109, 0.119596, 0.090832, 0.117483, 0.103604, 0.107260, 0.104470, 0.142253, 0.131429
#*# 	  -0.074903, -0.048304, -0.048463, -0.041581, -0.013722, -0.008546, -0.008749, -0.001971, 0.013056, 0.029071, 0.045315, 0.060583, 0.070991, 0.074822, 0.082993, 0.084096, 0.084745, 0.086157, 0.089455, 0.087973, 0.090024, 0.095806, 0.095014, 0.103942, 0.122841
#*# 	  -0.092882, -0.076371, -0.064735, -0.053091, -0.033080, -0.024623, -0.026436, -0.007092, -0.019313, 0.011288, 0.029153, 0.026235, 0.057108, 0.061129, 0.063185, 0.047531, 0.093970, 0.051081, 0.055486, 0.087102, 0.056650, 0.075612, 0.080250, 0.078191, 0.116356
#*# 	  -0.103233, -0.081057, -0.075698, -0.059276, -0.044915, -0.036424, -0.035502, -0.027072, -0.013443, 0.003782, 0.018031, 0.034719, 0.047220, 0.050054, 0.049931, 0.052767, 0.055228, 0.053691, 0.058201, 0.054923, 0.057525, 0.061182, 0.066568, 0.070112, 0.084599
#*# 	  -0.127025, -0.102689, -0.094837, -0.100441, -0.081956, -0.070869, -0.061298, -0.049593, -0.036683, -0.019903, -0.003538, 0.030622, 0.019950, 0.049908, 0.012015, 0.049314, 0.012216, 0.049064, 0.010519, 0.030240, 0.028722, 0.030787, 0.036680, 0.044820, 0.069562
#*# 	  -0.139978, -0.117557, -0.113589, -0.117147, -0.099879, -0.094494, -0.076356, -0.073362, -0.046367, -0.040121, -0.017373, -0.002132, 0.021107, 0.022053, 0.015642, 0.009878, 0.009205, 0.007654, 0.008140, 0.003406, 0.008771, 0.006427, 0.012552, 0.022267, 0.048020
#*# 	  -0.155937, -0.143683, -0.132042, -0.141433, -0.121167, -0.123940, -0.090852, -0.092694, -0.078522, -0.042836, -0.049234, -0.007166, -0.006622, 0.025364, -0.005131, 0.004671, -0.030176, -0.001854, -0.038328, -0.019696, -0.017752, -0.014972, -0.012351, 0.000019, 0.020744
#*# 	  -0.157449, -0.144448, -0.148277, -0.137492, -0.134357, -0.121552, -0.106041, -0.089514, -0.075676, -0.062562, -0.047279, -0.027379, 0.006413, 0.015717, 0.008030, -0.013981, -0.029567, -0.033285, -0.034649, -0.036883, -0.038472, -0.035790, -0.031030, -0.023850, 0.006162
#*# 	  -0.163651, -0.149174, -0.149849, -0.148418, -0.142958, -0.134528, -0.109598, -0.098402, -0.085222, -0.074640, -0.058007, -0.028007, 0.008185, 0.030727, 0.011625, -0.009708, -0.052537, -0.038508, -0.051101, -0.055499, -0.059757, -0.074570, -0.035150, -0.052887, -0.010788
#*# 	  -0.169841, -0.154594, -0.152185, -0.160529, -0.148016, -0.140779, -0.136609, -0.109085, -0.098901, -0.086016, -0.064345, -0.028602, 0.015293, 0.043091, 0.025733, -0.021682, -0.058935, -0.071671, -0.073543, -0.076898, -0.086636, -0.080147, -0.079666, -0.062493, -0.055117
#*# 	  -0.179372, -0.168727, -0.169931, -0.167192, -0.164585, -0.157806, -0.144351, -0.125607, -0.120243, -0.095339, -0.072946, -0.027441, 0.021651, 0.046158, 0.025009, -0.029193, -0.075155, -0.096465, -0.104190, -0.107546, -0.101634, -0.125164, -0.092834, -0.110505, -0.073015
#*# 	  -0.196372, -0.190679, -0.191959, -0.189955, -0.191770, -0.184002, -0.176295, -0.159235, -0.143159, -0.118110, -0.077499, -0.021605, 0.029449, 0.047854, 0.016505, -0.040369, -0.089560, -0.120374, -0.133464, -0.137987, -0.142527, -0.140635, -0.142043, -0.123602, -0.128375
#*# 	  -0.198354, -0.193262, -0.199653, -0.198492, -0.200043, -0.192375, -0.193836, -0.173210, -0.159951, -0.142246, -0.089635, -0.028632, 0.031551, 0.035368, 0.006452, -0.061092, -0.107740, -0.150439, -0.152057, -0.167070, -0.183636, -0.157950, -0.181005, -0.142240, -0.159131
#*# 	  -0.195879, -0.199244, -0.198819, -0.205934, -0.198875, -0.200785, -0.193657, -0.189813, -0.179953, -0.156683, -0.109722, -0.050147, 0.020373, 0.030239, -0.012819, -0.078430, -0.132788, -0.164858, -0.180362, -0.188904, -0.192200, -0.194047, -0.190054, -0.181448, -0.183082
#*# 	  -0.199771, -0.199480, -0.205226, -0.209239, -0.210640, -0.211779, -0.208123, -0.206456, -0.189565, -0.166438, -0.133949, -0.057001, -0.009064, 0.014076, -0.049918, -0.102512, -0.161512, -0.188955, -0.202121, -0.209497, -0.207430, -0.225998, -0.201303, -0.220277, -0.197587
#*# 	  -0.203221, -0.207160, -0.212457, -0.214910, -0.220312, -0.220485, -0.220341, -0.217397, -0.210085, -0.189698, -0.149545, -0.091789, -0.041011, -0.027910, -0.078259, -0.136192, -0.185902, -0.212040, -0.224298, -0.233071, -0.238055, -0.241289, -0.235198, -0.229651, -0.224779
#*# 	  -0.211077, -0.214242, -0.224765, -0.229885, -0.237940, -0.240468, -0.240095, -0.234142, -0.236318, -0.207605, -0.187825, -0.132554, -0.077055, -0.102310, -0.124258, -0.179565, -0.220116, -0.251422, -0.247941, -0.273147, -0.269368, -0.268422, -0.266368, -0.264553, -0.243264
#*# 	  -0.219237, -0.231707, -0.240915, -0.251255, -0.261334, -0.267947, -0.268867, -0.265718, -0.257313, -0.245483, -0.218589, -0.184825, -0.152448, -0.147368, -0.181323, -0.222379, -0.264616, -0.280522, -0.290693, -0.299968, -0.303803, -0.300744, -0.305049, -0.294294, -0.306526
#*# 	  -0.227552, -0.239103, -0.255810, -0.270328, -0.282515, -0.290256, -0.291230, -0.286963, -0.279831, -0.270072, -0.254290, -0.232182, -0.212055, -0.209631, -0.221160, -0.280768, -0.297933, -0.311136, -0.320198, -0.330807, -0.335224, -0.336423, -0.337410, -0.325996, -0.336970
#*# 	  -0.232856, -0.249098, -0.265812, -0.280736, -0.296069, -0.304537, -0.307348, -0.305685, -0.301600, -0.294528, -0.284717, -0.274676, -0.255915, -0.271423, -0.271657, -0.311952, -0.324187, -0.334667, -0.342384, -0.352690, -0.361375, -0.362520, -0.362920, -0.358388, -0.370336
#*# 	  -0.245872, -0.253313, -0.272550, -0.289371, -0.303024, -0.313506, -0.317074, -0.322551, -0.314463, -0.316464, -0.311842, -0.307094, -0.304455, -0.305590, -0.313934, -0.318763, -0.355871, -0.346470, -0.369264, -0.368593, -0.391887, -0.380276, -0.394881, -0.388785, -0.393452
#*# 	  -0.252154, -0.264885, -0.283849, -0.301947, -0.320780, -0.331642, -0.337028, -0.341247, -0.342512, -0.341526, -0.339809, -0.338380, -0.338007, -0.340301, -0.338164, -0.374285, -0.374712, -0.383580, -0.387318, -0.399516, -0.409424, -0.413847, -0.418109, -0.417985, -0.421463
#*# 	  -0.265324, -0.276490, -0.300691, -0.322935, -0.341417, -0.355823, -0.363255, -0.367294, -0.363672, -0.369608, -0.370522, -0.371372, -0.374679, -0.377911, -0.385499, -0.397144, -0.406366, -0.423985, -0.413855, -0.448624, -0.433356, -0.454615, -0.447417, -0.455237, -0.454098
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 3
#*# mesh_y_pps = 3
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 10.0
#*# max_x = 310.0
#*# min_y = 22.0
#*# max_y = 260.0
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 28.181
#*# pid_ki = 2.646
#*# pid_kd = 75.031
#*#
#*# [scanner model default]
#*# model_coef = 1.3505960046552101,
#*# 	1.658910122764384,
#*# 	0.7516938974793562,
#*# 	0.2036346849536123,
#*# 	0.2122579970113,
#*# 	1.3316006329889167,
#*# 	0.27018147007678495,
#*# 	-1.98049913828422,
#*# 	-0.03779621816778336,
#*# 	1.2393316401956045
#*# model_domain = 3.1161929854002e-07,3.361234641791671e-07
#*# model_range = 0.100000,5.000000
#*# model_temp = 27.148663
#*# model_offset = -0.212
