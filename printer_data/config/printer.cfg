#[include mmu/base/*.cfg]
#[include mmu/optional/client_macros.cfg]
#[include shell_command.cfg]
[include mainsail.cfg]
[include include/steppers.cfg]
[include include/fans.cfg]
[include include/bed.cfg]
#[include include/sensorless.cfg]f
#[include include/quickdraw.cfg]
[include include/led.cfg]
[include include/macros.cfg]
#[include mmu/mmu_vars.cfg]
#[include include/trad_rack_optional.cfg]




[safe_z_home]
home_xy_position: 165, 165
z_hop: 10

[z_tilt] 
z_positions: #Nozzle to GE5C
  -80,  -20
  350, -20
points:
  15, 150
  275, 150
speed: 50
horizontal_move_z: 10
retries: 30
retry_tolerance: 0.1

[input_shaper]
shaper_type_x = zv
shaper_freq_x = 120.6
shaper_type_y = zv
shaper_freq_y = 76.6

[scanner]
serial: /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00

#   Path to the serial port for the Cartographer device. Typically has the form
#   /dev/serial/by-id/usb-cartographer_cartographer_...
#   
#   If you are using the CAN Bus version, replace serial: with canbus_uuid: and add the UUID.
#   Example: canbus_uuid: 1283as878a9sd
#
speed: 2.0
#   Z probing dive speed.
lift_speed: 5.0
#   Z probing lift speed.
backlash_comp: 0.2
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.
x_offset: 0.
#   X offset of cartographer from the nozzle.
y_offset: 21.1
#   Y offset of cartographer from the nozzle.
trigger_distance: 2.0
#   cartographer trigger distance for homing.
trigger_dive_threshold: 1.5
#   Threshold for range vs dive mode probing. Beyond `trigger_distance +
#   trigger_dive_threshold` a dive will be used.
trigger_hysteresis: 0.006
#   Hysteresis on trigger threshold for untriggering, as a percentage of the
#   trigger threshold.
cal_nozzle_z: 0.1
#   Expected nozzle offset after completing manual Z offset calibration.
cal_floor: 0.1
#   Minimum z bound on sensor response measurement.
cal_ceil:5.
#   Maximum z bound on sensor response measurement.
cal_speed: 1.0
#   Speed while measuring response curve.
cal_move_speed: 10.
#   Speed while moving to position for response curve measurement.
default_model_name: default
#   Name of default cartographer model to load.
mesh_main_direction: X
#   Primary travel direction during mesh measurement.
#mesh_overscan: -1
#   Distance to use for direction changes at mesh line ends. Omit this setting
#   and a default will be calculated from line spacing and available travel.
mesh_cluster_size: 1
#   Radius of mesh grid point clusters.
mesh_runs: 2
#   Number of passes to make during mesh scan.
detect_threshold_z: 3600 # This needs tuning
calibration_method: tap 
z_offset: 0.0 
probe_speed: 2.0
tap_location: 150,150 # set to center of bed
sensor: cartographer

[printer]
kinematics: corexy
max_velocity: 3000
max_accel: 50000
#max_accel_to_decel: 5000
max_z_velocity: 3000
max_z_accel: 10000
square_corner_velocity: 10

[exclude_object]

[gcode_arcs] # OrcaSlicer
resolution: 1.0


[idle_timeout]

# only turn off heaters and motors if the printer is not paused
gcode:
    {% if not printer.pause_resume.is_paused %}
        TURN_OFF_HEATERS
        M84
    {% endif %}

[pause_resume]
recover_velocity: 350



[virtual_sdcard]
path: /home/pi/printer_data/gcodes
on_error_gcode: CANCEL_PRINT

[mcu]
#USB
serial: /dev/serial/by-id/usb-Klipper_stm32h723xx_0F003B001751313338343730-if00
#reconnect_interval: 9999




# Driver6
[extruder]
nozzle_diameter: 0.500
pressure_advance: 0.025
pressure_advance_smooth_time: 0.03
max_extrude_only_distance: 101

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.235907, -0.224025, -0.225438, -0.237842, -0.220984, -0.204772, -0.205739, -0.187824, -0.183172, -0.180015, -0.145871, -0.145648, -0.151189, -0.132966, -0.134165, -0.134126, -0.115036, -0.137680, -0.135504, -0.107871, -0.115339, -0.113103, -0.093260, -0.079844, -0.065306
#*# 	  -0.250987, -0.234010, -0.241583, -0.241289, -0.232791, -0.217602, -0.218965, -0.203595, -0.184532, -0.163151, -0.158671, -0.152106, -0.128123, -0.120939, -0.138422, -0.137262, -0.127870, -0.124329, -0.121000, -0.118353, -0.115818, -0.105404, -0.092915, -0.090522, -0.067261
#*# 	  -0.257822, -0.251056, -0.252712, -0.242905, -0.247905, -0.231878, -0.222481, -0.207558, -0.190800, -0.193247, -0.150789, -0.152003, -0.157026, -0.136892, -0.133917, -0.114686, -0.148164, -0.143027, -0.105815, -0.120230, -0.116689, -0.119558, -0.098302, -0.083139, -0.090286
#*# 	  -0.270792, -0.249875, -0.251405, -0.245021, -0.228775, -0.221171, -0.218529, -0.207047, -0.192797, -0.180618, -0.159651, -0.149963, -0.138439, -0.135154, -0.132500, -0.125508, -0.134263, -0.126434, -0.116584, -0.119920, -0.119837, -0.109699, -0.103785, -0.102812, -0.079352
#*# 	  -0.277201, -0.267203, -0.258635, -0.242128, -0.232373, -0.221955, -0.220771, -0.213959, -0.195871, -0.180750, -0.154105, -0.158555, -0.146033, -0.117955, -0.127882, -0.128674, -0.112559, -0.125383, -0.123945, -0.135106, -0.113245, -0.101440, -0.115003, -0.092524, -0.086251
#*# 	  -0.282571, -0.257771, -0.254404, -0.245069, -0.225285, -0.219549, -0.216956, -0.209044, -0.193644, -0.175506, -0.158449, -0.143820, -0.127934, -0.130015, -0.121241, -0.131562, -0.125423, -0.116561, -0.132845, -0.123096, -0.120618, -0.116421, -0.110975, -0.107682, -0.087924
#*# 	  -0.288449, -0.273850, -0.267054, -0.254509, -0.249534, -0.233273, -0.225595, -0.214135, -0.197107, -0.181018, -0.164989, -0.143926, -0.122285, -0.136647, -0.130263, -0.132408, -0.132432, -0.143836, -0.120250, -0.148479, -0.146435, -0.119469, -0.135415, -0.115297, -0.095278
#*# 	  -0.289988, -0.270699, -0.264454, -0.257190, -0.251114, -0.234413, -0.223910, -0.209212, -0.194038, -0.177475, -0.162558, -0.141189, -0.122070, -0.127894, -0.124711, -0.140892, -0.136972, -0.139567, -0.142162, -0.145386, -0.141411, -0.125205, -0.140907, -0.117814, -0.096101
#*# 	  -0.288469, -0.277641, -0.272711, -0.267937, -0.256805, -0.248151, -0.230139, -0.212281, -0.199381, -0.179505, -0.166506, -0.146077, -0.126572, -0.113334, -0.134077, -0.133093, -0.136786, -0.157884, -0.139508, -0.151058, -0.151805, -0.150086, -0.132664, -0.138570, -0.106561
#*# 	  -0.273638, -0.259504, -0.257802, -0.252683, -0.245988, -0.236151, -0.213308, -0.197183, -0.185605, -0.162214, -0.159727, -0.134120, -0.108217, -0.103445, -0.105679, -0.125803, -0.138456, -0.142812, -0.141277, -0.150346, -0.154688, -0.154225, -0.152719, -0.126197, -0.115953
#*# 	  -0.266842, -0.259185, -0.253869, -0.249940, -0.242245, -0.230402, -0.213585, -0.199603, -0.180177, -0.168134, -0.152636, -0.116009, -0.094653, -0.069248, -0.078383, -0.122625, -0.131085, -0.145046, -0.156833, -0.143210, -0.171482, -0.156780, -0.140413, -0.151813, -0.106379
#*# 	  -0.254929, -0.245021, -0.240750, -0.238069, -0.232107, -0.221270, -0.199444, -0.187268, -0.173785, -0.155264, -0.145486, -0.100948, -0.060706, -0.034376, -0.056305, -0.102043, -0.132793, -0.141600, -0.147152, -0.155289, -0.162163, -0.152009, -0.167347, -0.147357, -0.134768
#*# 	  -0.252775, -0.245844, -0.243641, -0.239175, -0.233525, -0.224858, -0.210306, -0.199677, -0.174959, -0.170968, -0.131556, -0.078746, -0.042506, -0.015862, -0.041129, -0.095399, -0.144647, -0.145865, -0.172116, -0.168308, -0.166167, -0.189253, -0.159355, -0.163279, -0.150101
#*# 	  -0.237484, -0.237267, -0.235625, -0.231857, -0.228278, -0.221394, -0.209804, -0.195835, -0.179743, -0.161853, -0.118830, -0.062307, -0.009825, 0.003932, -0.035777, -0.087006, -0.134454, -0.158132, -0.177495, -0.175756, -0.192629, -0.196449, -0.175939, -0.183635, -0.169577
#*# 	  -0.227633, -0.228699, -0.230880, -0.224493, -0.224837, -0.217982, -0.210147, -0.202997, -0.182578, -0.161374, -0.114808, -0.048667, 0.007753, 0.006707, -0.018940, -0.089059, -0.148300, -0.158700, -0.183891, -0.191954, -0.199286, -0.191266, -0.203136, -0.180650, -0.179456
#*# 	  -0.200746, -0.213135, -0.211447, -0.211360, -0.208818, -0.202728, -0.196732, -0.189479, -0.177722, -0.155686, -0.105560, -0.040089, 0.016921, 0.014174, -0.019694, -0.096571, -0.141042, -0.167257, -0.175305, -0.201012, -0.193280, -0.196444, -0.206888, -0.188132, -0.191251
#*# 	  -0.192444, -0.201864, -0.202920, -0.200582, -0.197910, -0.198723, -0.193466, -0.192289, -0.174043, -0.158507, -0.108424, -0.043546, 0.011858, 0.015300, -0.036805, -0.101586, -0.146867, -0.158401, -0.197464, -0.183110, -0.213770, -0.195207, -0.203939, -0.203125, -0.193583
#*# 	  -0.173230, -0.189474, -0.190221, -0.190340, -0.191756, -0.191547, -0.187430, -0.184571, -0.173833, -0.155202, -0.114429, -0.053025, -0.001386, -0.005302, -0.047326, -0.119534, -0.150651, -0.184851, -0.179293, -0.199801, -0.205268, -0.209597, -0.209481, -0.202719, -0.216738
#*# 	  -0.175278, -0.186421, -0.191652, -0.190462, -0.196039, -0.195754, -0.195778, -0.191325, -0.178032, -0.165992, -0.127271, -0.081161, -0.032705, -0.042518, -0.082796, -0.137478, -0.174128, -0.192097, -0.214281, -0.199641, -0.228603, -0.210289, -0.228432, -0.215731, -0.220378
#*# 	  -0.168524, -0.185824, -0.193499, -0.199575, -0.207489, -0.208840, -0.204987, -0.198396, -0.186695, -0.175625, -0.151401, -0.114396, -0.082344, -0.084792, -0.115791, -0.171198, -0.191431, -0.220616, -0.221986, -0.228651, -0.232268, -0.231435, -0.245629, -0.237093, -0.251872
#*# 	  -0.173478, -0.181950, -0.198865, -0.198623, -0.210164, -0.216356, -0.211627, -0.203327, -0.191063, -0.186048, -0.166372, -0.148048, -0.128668, -0.134591, -0.153113, -0.201524, -0.227329, -0.220094, -0.250362, -0.244411, -0.248675, -0.251045, -0.265502, -0.251025, -0.254424
#*# 	  -0.160544, -0.179075, -0.190429, -0.202002, -0.210313, -0.214240, -0.212651, -0.207347, -0.200745, -0.196544, -0.187908, -0.177207, -0.170524, -0.173604, -0.188150, -0.210334, -0.228994, -0.245789, -0.239087, -0.256304, -0.268874, -0.254426, -0.280662, -0.266470, -0.278211
#*# 	  -0.169968, -0.172358, -0.187516, -0.195928, -0.205586, -0.213321, -0.211996, -0.210998, -0.209311, -0.202722, -0.201633, -0.198629, -0.198365, -0.202887, -0.217528, -0.220260, -0.245313, -0.248110, -0.257259, -0.279039, -0.274598, -0.277161, -0.280280, -0.286114, -0.280830
#*# 	  -0.156009, -0.169724, -0.182140, -0.194804, -0.209734, -0.213965, -0.217914, -0.218559, -0.215158, -0.214399, -0.213687, -0.215894, -0.216295, -0.221580, -0.233317, -0.241593, -0.256564, -0.259181, -0.269146, -0.280542, -0.294787, -0.285597, -0.301883, -0.299318, -0.300260
#*# 	  -0.163327, -0.167102, -0.185149, -0.201596, -0.215718, -0.228297, -0.229991, -0.230672, -0.226124, -0.225767, -0.228992, -0.232414, -0.239547, -0.242176, -0.252253, -0.263569, -0.269987, -0.283714, -0.289315, -0.298151, -0.318850, -0.307519, -0.332619, -0.326839, -0.318059
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 3
#*# mesh_y_pps = 3
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 10.0
#*# max_x = 310.0
#*# min_y = 22.0
#*# max_y = 260.0
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 28.181
#*# pid_ki = 2.646
#*# pid_kd = 75.031
#*#
#*# [scanner model default]
#*# model_coef = 1.3505960046552101,
#*# 	1.658910122764384,
#*# 	0.7516938974793562,
#*# 	0.2036346849536123,
#*# 	0.2122579970113,
#*# 	1.3316006329889167,
#*# 	0.27018147007678495,
#*# 	-1.98049913828422,
#*# 	-0.03779621816778336,
#*# 	1.2393316401956045
#*# model_domain = 3.1161929854002e-07,3.361234641791671e-07
#*# model_range = 0.100000,5.000000
#*# model_temp = 27.148663
#*# model_offset = -0.326
