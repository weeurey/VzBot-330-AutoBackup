#[include mmu/base/*.cfg]
#[include mmu/optional/client_macros.cfg]
#[include shell_command.cfg]
[include mainsail.cfg]
[include include/steppers.cfg]
[include include/fans.cfg]
[include include/bed.cfg]
#[include include/sensorless.cfg]f
#[include include/quickdraw.cfg]
[include include/led.cfg]
[include include/macros.cfg]
#[include mmu/mmu_vars.cfg]
#[include include/trad_rack_optional.cfg]




[safe_z_home]
home_xy_position: 165, 165
z_hop: 10

[z_tilt] 
z_positions: #Nozzle to GE5C
  -80,  -20
  350, -20
points:
  15, 150
  275, 150
speed: 50
horizontal_move_z: 10
retries: 30
retry_tolerance: 0.1

[input_shaper]
shaper_type_x = zv
shaper_freq_x = 120.6
shaper_type_y = zv
shaper_freq_y = 76.6

[scanner]
serial: /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00

#   Path to the serial port for the Cartographer device. Typically has the form
#   /dev/serial/by-id/usb-cartographer_cartographer_...
#   
#   If you are using the CAN Bus version, replace serial: with canbus_uuid: and add the UUID.
#   Example: canbus_uuid: 1283as878a9sd
#
speed: 2.0
#   Z probing dive speed.
lift_speed: 5.0
#   Z probing lift speed.
backlash_comp: 0.2
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.
x_offset: 0.
#   X offset of cartographer from the nozzle.
y_offset: 21.1
#   Y offset of cartographer from the nozzle.
trigger_distance: 2.0
#   cartographer trigger distance for homing.
trigger_dive_threshold: 1.5
#   Threshold for range vs dive mode probing. Beyond `trigger_distance +
#   trigger_dive_threshold` a dive will be used.
trigger_hysteresis: 0.006
#   Hysteresis on trigger threshold for untriggering, as a percentage of the
#   trigger threshold.
cal_nozzle_z: 0.1
#   Expected nozzle offset after completing manual Z offset calibration.
cal_floor: 0.1
#   Minimum z bound on sensor response measurement.
cal_ceil:5.
#   Maximum z bound on sensor response measurement.
cal_speed: 1.0
#   Speed while measuring response curve.
cal_move_speed: 10.
#   Speed while moving to position for response curve measurement.
default_model_name: default
#   Name of default cartographer model to load.
mesh_main_direction: X
#   Primary travel direction during mesh measurement.
#mesh_overscan: -1
#   Distance to use for direction changes at mesh line ends. Omit this setting
#   and a default will be calculated from line spacing and available travel.
mesh_cluster_size: 1
#   Radius of mesh grid point clusters.
mesh_runs: 2
#   Number of passes to make during mesh scan.
detect_threshold_z: 3600 # This needs tuning
calibration_method: tap 
z_offset: 0.0 
probe_speed: 2.0
tap_location: 150,150 # set to center of bed
sensor: cartographer

[printer]
kinematics: corexy
max_velocity: 3000
max_accel: 50000
#max_accel_to_decel: 5000
max_z_velocity: 3000
max_z_accel: 10000
square_corner_velocity: 10

[exclude_object]

[gcode_arcs] # OrcaSlicer
resolution: 1.0


[idle_timeout]

# only turn off heaters and motors if the printer is not paused
gcode:
    {% if not printer.pause_resume.is_paused %}
        TURN_OFF_HEATERS
        M84
    {% endif %}

[pause_resume]
recover_velocity: 350



[virtual_sdcard]
path: /home/pi/printer_data/gcodes
on_error_gcode: CANCEL_PRINT

[mcu]
#USB
serial: /dev/serial/by-id/usb-Klipper_stm32h723xx_0F003B001751313338343730-if00
#reconnect_interval: 9999




# Driver6
[extruder]
nozzle_diameter: 0.500
pressure_advance: 0.025
pressure_advance_smooth_time: 0.03
max_extrude_only_distance: 101

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.155106, -0.161518, -0.165321, -0.162216, -0.149442, -0.173141, -0.141299, -0.144150, -0.139715, -0.132647, -0.124497, -0.120046, -0.121240, -0.111849, -0.140571, -0.127030, -0.140044, -0.145625, -0.152649, -0.156807, -0.154778, -0.149212, -0.133018, -0.144676, -0.112058
#*# 	  -0.185590, -0.180362, -0.185430, -0.183278, -0.183256, -0.171459, -0.152733, -0.165530, -0.138572, -0.130338, -0.145027, -0.113314, -0.111842, -0.115765, -0.101018, -0.126491, -0.132414, -0.138310, -0.133721, -0.149074, -0.156000, -0.150494, -0.148271, -0.132430, -0.119421
#*# 	  -0.199927, -0.197931, -0.203041, -0.196589, -0.191457, -0.184075, -0.178167, -0.168956, -0.153576, -0.141461, -0.153849, -0.098765, -0.143713, -0.091397, -0.122361, -0.152646, -0.111516, -0.155951, -0.125520, -0.148462, -0.156435, -0.159979, -0.152299, -0.155281, -0.121462
#*# 	  -0.199399, -0.189535, -0.193574, -0.186763, -0.169229, -0.165408, -0.164277, -0.171560, -0.130151, -0.155244, -0.107707, -0.119960, -0.115154, -0.114989, -0.115192, -0.098141, -0.150111, -0.117757, -0.153547, -0.134094, -0.152577, -0.154652, -0.157002, -0.152740, -0.137547
#*# 	  -0.201282, -0.194280, -0.198284, -0.189776, -0.173902, -0.168814, -0.169978, -0.164084, -0.149300, -0.139497, -0.128215, -0.094619, -0.138947, -0.092535, -0.144659, -0.118429, -0.122039, -0.128335, -0.137406, -0.142404, -0.148614, -0.151874, -0.150844, -0.157917, -0.137381
#*# 	  -0.196161, -0.183588, -0.184293, -0.177924, -0.162337, -0.159754, -0.160052, -0.155678, -0.145262, -0.123025, -0.135346, -0.097598, -0.123034, -0.107695, -0.112813, -0.118833, -0.120991, -0.125446, -0.133088, -0.139559, -0.127160, -0.157107, -0.147093, -0.158717, -0.143966
#*# 	  -0.203325, -0.192955, -0.197770, -0.194049, -0.186589, -0.178051, -0.169818, -0.162043, -0.151685, -0.139348, -0.130419, -0.117247, -0.108575, -0.113899, -0.118861, -0.127066, -0.132752, -0.134964, -0.136516, -0.145696, -0.177633, -0.140301, -0.175513, -0.150890, -0.151509
#*# 	  -0.196840, -0.187625, -0.190316, -0.190338, -0.187021, -0.170255, -0.174914, -0.161944, -0.150964, -0.140370, -0.130547, -0.116219, -0.113174, -0.107456, -0.100642, -0.147951, -0.113209, -0.164432, -0.149129, -0.152721, -0.159909, -0.163110, -0.166765, -0.162423, -0.147383
#*# 	  -0.198409, -0.195445, -0.198727, -0.197337, -0.191381, -0.188624, -0.171222, -0.161442, -0.151388, -0.145838, -0.135708, -0.131636, -0.092121, -0.101220, -0.112462, -0.132779, -0.169045, -0.129362, -0.184440, -0.135985, -0.193321, -0.173032, -0.174448, -0.170037, -0.153664
#*# 	  -0.178196, -0.176088, -0.178791, -0.177959, -0.178288, -0.167807, -0.155979, -0.155189, -0.130993, -0.132086, -0.123552, -0.106461, -0.085904, -0.077971, -0.083810, -0.120702, -0.142212, -0.150197, -0.156494, -0.145464, -0.188392, -0.171927, -0.175036, -0.171538, -0.140002
#*# 	  -0.171937, -0.168771, -0.173113, -0.172810, -0.164403, -0.169626, -0.135643, -0.153291, -0.112457, -0.140901, -0.104097, -0.105118, -0.063690, -0.037888, -0.087203, -0.097383, -0.157882, -0.130649, -0.181589, -0.143361, -0.200454, -0.149124, -0.176094, -0.192094, -0.143396
#*# 	  -0.160673, -0.159413, -0.162592, -0.162823, -0.165707, -0.147061, -0.151129, -0.112546, -0.137704, -0.101026, -0.115449, -0.059216, -0.033889, -0.018910, -0.038442, -0.110954, -0.126734, -0.168236, -0.143985, -0.190319, -0.162429, -0.207832, -0.162434, -0.180559, -0.191601
#*# 	  -0.156936, -0.159674, -0.162800, -0.165091, -0.162738, -0.165095, -0.137992, -0.151546, -0.107863, -0.130085, -0.070861, -0.062163, -0.011703, 0.013912, -0.046670, -0.084823, -0.155933, -0.153110, -0.194760, -0.167501, -0.198451, -0.204405, -0.201218, -0.194426, -0.173454
#*# 	  -0.150619, -0.152942, -0.158859, -0.161142, -0.161923, -0.155731, -0.158729, -0.138996, -0.127370, -0.107870, -0.075460, -0.041054, 0.031980, 0.018072, -0.025060, -0.092861, -0.145123, -0.176256, -0.193572, -0.202465, -0.193539, -0.237626, -0.213637, -0.209626, -0.206299
#*# 	  -0.139079, -0.144458, -0.152174, -0.156367, -0.157667, -0.155098, -0.151013, -0.155865, -0.113704, -0.135148, -0.051952, -0.032885, 0.031693, 0.032734, -0.021668, -0.093556, -0.139210, -0.187609, -0.205605, -0.201422, -0.240295, -0.209420, -0.250222, -0.226662, -0.192181
#*# 	  -0.124678, -0.133468, -0.142360, -0.145739, -0.148367, -0.149905, -0.137843, -0.155333, -0.112923, -0.131528, -0.065127, -0.002391, 0.046542, 0.038208, -0.020057, -0.106999, -0.141767, -0.188912, -0.208835, -0.209218, -0.238907, -0.216437, -0.252943, -0.232904, -0.207670
#*# 	  -0.112953, -0.120537, -0.131616, -0.138650, -0.143082, -0.145731, -0.145088, -0.143220, -0.135622, -0.114345, -0.051090, -0.013001, 0.035521, 0.027670, -0.029611, -0.102582, -0.161537, -0.195859, -0.211237, -0.240418, -0.235245, -0.254471, -0.241916, -0.240311, -0.238484
#*# 	  -0.100115, -0.113379, -0.124250, -0.131453, -0.139715, -0.145988, -0.142662, -0.153561, -0.125578, -0.118998, -0.082604, -0.004703, -0.010523, 0.035276, -0.066893, -0.095824, -0.184806, -0.187868, -0.232024, -0.233835, -0.241973, -0.248421, -0.249248, -0.248750, -0.230731
#*# 	  -0.098154, -0.110287, -0.123781, -0.133114, -0.143338, -0.148519, -0.158311, -0.140582, -0.159420, -0.114404, -0.123524, -0.033121, -0.050052, -0.028890, -0.077640, -0.138124, -0.182459, -0.213566, -0.219721, -0.263862, -0.245623, -0.272669, -0.251151, -0.285423, -0.263363
#*# 	  -0.091132, -0.113753, -0.132656, -0.146672, -0.161755, -0.168068, -0.171844, -0.171738, -0.163965, -0.153733, -0.131215, -0.097496, -0.093603, -0.049778, -0.139436, -0.144026, -0.229794, -0.233308, -0.254775, -0.268632, -0.277487, -0.284950, -0.276006, -0.304410, -0.271509
#*# 	  -0.091303, -0.112447, -0.132916, -0.151467, -0.164713, -0.173145, -0.171663, -0.187740, -0.158858, -0.162997, -0.148493, -0.130810, -0.118870, -0.125614, -0.184163, -0.168245, -0.255580, -0.225826, -0.287613, -0.300699, -0.282157, -0.312536, -0.294904, -0.324335, -0.294055
#*# 	  -0.085450, -0.112468, -0.133754, -0.152773, -0.170900, -0.181579, -0.187836, -0.192063, -0.187915, -0.185705, -0.179262, -0.171579, -0.183967, -0.152989, -0.214032, -0.217834, -0.217636, -0.281555, -0.260914, -0.312544, -0.307221, -0.318609, -0.322346, -0.324655, -0.315926
#*# 	  -0.088010, -0.106403, -0.128926, -0.151543, -0.169448, -0.181048, -0.189305, -0.193025, -0.188329, -0.205603, -0.180725, -0.209633, -0.174171, -0.202384, -0.215990, -0.234914, -0.252794, -0.270758, -0.266174, -0.306614, -0.323214, -0.329839, -0.339866, -0.338639, -0.341935
#*# 	  -0.083490, -0.106329, -0.131321, -0.151339, -0.174731, -0.186737, -0.194957, -0.204925, -0.206200, -0.215401, -0.207741, -0.228379, -0.202980, -0.245592, -0.253450, -0.238013, -0.293895, -0.258310, -0.318873, -0.302604, -0.345122, -0.350641, -0.358441, -0.361553, -0.372185
#*# 	  -0.087092, -0.107586, -0.135194, -0.164218, -0.182011, -0.200922, -0.212005, -0.216166, -0.223315, -0.225816, -0.231708, -0.248503, -0.226322, -0.270115, -0.244749, -0.303237, -0.273446, -0.328265, -0.305072, -0.345695, -0.362589, -0.373242, -0.383208, -0.392265, -0.386755
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 3
#*# mesh_y_pps = 3
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 10.0
#*# max_x = 310.0
#*# min_y = 22.0
#*# max_y = 260.0
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 28.181
#*# pid_ki = 2.646
#*# pid_kd = 75.031
#*#
#*# [scanner model default]
#*# model_coef = 1.3505960046552101,
#*# 	1.658910122764384,
#*# 	0.7516938974793562,
#*# 	0.2036346849536123,
#*# 	0.2122579970113,
#*# 	1.3316006329889167,
#*# 	0.27018147007678495,
#*# 	-1.98049913828422,
#*# 	-0.03779621816778336,
#*# 	1.2393316401956045
#*# model_domain = 3.1161929854002e-07,3.361234641791671e-07
#*# model_range = 0.100000,5.000000
#*# model_temp = 27.148663
#*# model_offset = -0.212
