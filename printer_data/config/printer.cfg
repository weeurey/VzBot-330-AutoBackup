[include mmu/base/*.cfg]
[include mmu/optional/client_macros.cfg]
#[include shell_command.cfg]
[include mainsail.cfg]
[include include/steppers.cfg]
[include include/fans.cfg]
[include include/bed.cfg]
#[include include/sensorless.cfg]f
#[include include/quickdraw.cfg]
[include include/led.cfg]
[include include/macros.cfg]
#[include include/trad_rack_btt_mmb.cfg]
#[include include/trad_rack_optional.cfg]




[safe_z_home]
home_xy_position: 165, 165
z_hop: 10

[z_tilt] 
z_positions: #Nozzle to GE5C
  -80,  -20
  350, -20
points:
  15, 150
  275, 150
speed: 50
horizontal_move_z: 10
retries: 30
retry_tolerance: 0.1

[input_shaper]
shaper_type_x = zv
shaper_freq_x = 120.6
shaper_type_y = zv
shaper_freq_y = 76.6

[scanner]
serial: /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00

#   Path to the serial port for the Cartographer device. Typically has the form
#   /dev/serial/by-id/usb-cartographer_cartographer_...
#   
#   If you are using the CAN Bus version, replace serial: with canbus_uuid: and add the UUID.
#   Example: canbus_uuid: 1283as878a9sd
#
speed: 2.0
#   Z probing dive speed.
lift_speed: 5.0
#   Z probing lift speed.
backlash_comp: 0.2
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.
x_offset: 0.
#   X offset of cartographer from the nozzle.
y_offset: 21.1
#   Y offset of cartographer from the nozzle.
trigger_distance: 2.0
#   cartographer trigger distance for homing.
trigger_dive_threshold: 1.5
#   Threshold for range vs dive mode probing. Beyond `trigger_distance +
#   trigger_dive_threshold` a dive will be used.
trigger_hysteresis: 0.006
#   Hysteresis on trigger threshold for untriggering, as a percentage of the
#   trigger threshold.
cal_nozzle_z: 0.1
#   Expected nozzle offset after completing manual Z offset calibration.
cal_floor: 0.1
#   Minimum z bound on sensor response measurement.
cal_ceil:5.
#   Maximum z bound on sensor response measurement.
cal_speed: 1.0
#   Speed while measuring response curve.
cal_move_speed: 10.
#   Speed while moving to position for response curve measurement.
default_model_name: default
#   Name of default cartographer model to load.
mesh_main_direction: X
#   Primary travel direction during mesh measurement.
#mesh_overscan: -1
#   Distance to use for direction changes at mesh line ends. Omit this setting
#   and a default will be calculated from line spacing and available travel.
mesh_cluster_size: 1
#   Radius of mesh grid point clusters.
mesh_runs: 2
#   Number of passes to make during mesh scan.
detect_threshold_z: 3600 # This needs tuning
calibration_method: tap 
z_offset: 0.0 
probe_speed: 2.0
tap_location: 150,150 # set to center of bed
sensor: cartographer

[printer]
kinematics: corexy
max_velocity: 3000
max_accel: 50000
#max_accel_to_decel: 5000
max_z_velocity: 3000
max_z_accel: 10000
square_corner_velocity: 10

[exclude_object]

[gcode_arcs] # OrcaSlicer
resolution: 1.0


[idle_timeout]

# only turn off heaters and motors if the printer is not paused
gcode:
    {% if not printer.pause_resume.is_paused %}
        TURN_OFF_HEATERS
        M84
    {% endif %}

[pause_resume]
recover_velocity: 350



[virtual_sdcard]
path: /home/pi/printer_data/gcodes
on_error_gcode: CANCEL_PRINT

[mcu]
#USB
serial: /dev/serial/by-id/usb-Klipper_stm32h723xx_0F003B001751313338343730-if00
#reconnect_interval: 9999




# Driver6
[extruder]
nozzle_diameter: 0.500
pressure_advance: 0.025
pressure_advance_smooth_time: 0.03
max_extrude_only_distance: 101

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.190477, -0.208403, -0.208891, -0.235983, -0.174129, -0.198936, -0.193780, -0.219469, -0.140119, -0.164882, -0.189176, -0.145825, -0.146011, -0.117195, -0.175978, -0.151116, -0.156759, -0.136718, -0.178038, -0.165392, -0.153563, -0.156399, -0.129365, -0.145081, -0.092886
#*# 	  -0.251512, -0.232162, -0.236514, -0.231257, -0.225307, -0.220371, -0.209782, -0.214747, -0.182088, -0.167294, -0.153955, -0.167052, -0.135939, -0.113776, -0.164488, -0.142523, -0.146420, -0.137246, -0.157632, -0.158754, -0.159672, -0.157221, -0.143133, -0.134472, -0.116470
#*# 	  -0.263068, -0.244961, -0.251967, -0.237648, -0.233859, -0.237028, -0.210837, -0.210342, -0.195606, -0.208767, -0.129634, -0.107361, -0.176704, -0.098003, -0.137699, -0.139368, -0.174225, -0.146810, -0.120107, -0.168996, -0.142278, -0.156159, -0.161634, -0.126874, -0.124999
#*# 	  -0.263320, -0.241446, -0.239973, -0.227872, -0.218120, -0.207368, -0.193154, -0.218600, -0.168484, -0.151823, -0.178867, -0.125249, -0.112692, -0.159711, -0.100041, -0.108066, -0.158337, -0.118087, -0.140540, -0.145291, -0.140713, -0.152402, -0.148632, -0.142993, -0.125553
#*# 	  -0.261595, -0.241550, -0.241100, -0.232455, -0.215354, -0.209405, -0.213118, -0.207141, -0.165018, -0.202639, -0.127019, -0.142594, -0.166316, -0.097013, -0.129658, -0.126611, -0.131494, -0.102620, -0.171382, -0.114998, -0.144324, -0.144925, -0.151132, -0.144251, -0.130811
#*# 	  -0.258611, -0.233524, -0.231164, -0.223702, -0.211441, -0.194010, -0.210867, -0.195276, -0.184883, -0.170216, -0.155389, -0.118359, -0.152079, -0.101187, -0.102631, -0.151469, -0.097021, -0.126025, -0.133677, -0.137325, -0.139800, -0.150506, -0.140304, -0.145960, -0.130833
#*# 	  -0.258316, -0.239791, -0.240128, -0.244223, -0.222867, -0.231276, -0.200723, -0.201709, -0.188026, -0.175666, -0.138404, -0.166919, -0.125977, -0.125723, -0.159519, -0.100911, -0.166439, -0.094349, -0.135623, -0.143422, -0.146086, -0.124485, -0.167348, -0.143728, -0.137111
#*# 	  -0.255790, -0.236587, -0.236038, -0.236102, -0.236851, -0.213798, -0.221401, -0.187648, -0.199734, -0.162300, -0.173749, -0.143401, -0.126845, -0.144829, -0.106642, -0.159631, -0.137928, -0.141577, -0.141688, -0.145721, -0.129760, -0.170758, -0.138322, -0.154189, -0.133616
#*# 	  -0.255808, -0.243201, -0.242162, -0.245733, -0.241122, -0.232150, -0.220155, -0.203260, -0.188829, -0.175820, -0.143299, -0.165534, -0.128872, -0.121106, -0.126884, -0.137422, -0.144156, -0.149508, -0.184918, -0.112828, -0.184869, -0.131790, -0.180723, -0.148417, -0.137406
#*# 	  -0.237272, -0.223972, -0.226676, -0.231319, -0.224550, -0.209314, -0.212586, -0.178102, -0.190625, -0.151145, -0.168458, -0.121748, -0.132375, -0.104340, -0.094860, -0.148086, -0.118458, -0.169080, -0.125425, -0.175197, -0.125428, -0.155276, -0.153481, -0.148738, -0.141273
#*# 	  -0.227588, -0.219643, -0.220134, -0.227756, -0.221525, -0.213017, -0.200849, -0.185510, -0.172716, -0.143433, -0.167468, -0.113252, -0.117180, -0.079180, -0.088931, -0.118337, -0.138614, -0.142618, -0.146635, -0.121147, -0.157100, -0.154579, -0.153786, -0.147502, -0.136942
#*# 	  -0.217730, -0.206736, -0.209670, -0.210635, -0.209589, -0.199642, -0.195617, -0.166619, -0.165099, -0.156038, -0.142312, -0.114638, -0.076705, -0.035542, -0.076885, -0.090196, -0.137602, -0.146935, -0.128598, -0.176562, -0.141775, -0.187200, -0.135946, -0.166434, -0.143069
#*# 	  -0.210456, -0.204476, -0.208300, -0.211875, -0.206420, -0.208087, -0.189513, -0.193829, -0.172503, -0.157010, -0.133708, -0.096616, -0.054442, -0.028086, -0.050791, -0.082708, -0.158401, -0.135497, -0.185668, -0.165709, -0.173254, -0.175917, -0.170551, -0.161280, -0.159380
#*# 	  -0.197690, -0.196114, -0.204656, -0.206109, -0.207253, -0.204450, -0.197496, -0.182848, -0.184690, -0.154092, -0.122711, -0.075863, -0.046294, 0.003306, -0.051823, -0.094569, -0.127549, -0.177898, -0.160766, -0.180288, -0.184173, -0.188930, -0.165084, -0.194048, -0.150523
#*# 	  -0.179293, -0.185317, -0.191771, -0.199190, -0.199477, -0.198604, -0.188006, -0.198368, -0.167812, -0.158542, -0.117915, -0.047938, -0.010433, 0.003847, -0.033282, -0.076164, -0.160680, -0.150047, -0.183299, -0.189449, -0.223308, -0.167036, -0.194388, -0.213994, -0.148760
#*# 	  -0.155243, -0.166745, -0.179185, -0.183682, -0.184833, -0.186471, -0.183702, -0.180854, -0.172919, -0.155361, -0.114617, -0.052756, -0.012708, 0.030559, -0.043743, -0.093611, -0.145808, -0.174051, -0.197488, -0.178267, -0.181327, -0.221079, -0.176398, -0.206665, -0.182518
#*# 	  -0.137422, -0.147669, -0.161856, -0.169266, -0.173676, -0.179506, -0.175357, -0.166265, -0.175700, -0.140494, -0.114417, -0.055732, -0.014316, 0.033563, -0.033373, -0.099468, -0.151310, -0.173381, -0.187839, -0.213266, -0.177699, -0.200455, -0.200359, -0.195509, -0.163635
#*# 	  -0.122261, -0.137184, -0.147967, -0.155368, -0.163288, -0.168307, -0.170071, -0.169131, -0.168515, -0.153091, -0.117762, -0.065073, -0.025241, 0.015712, -0.063064, -0.110882, -0.159003, -0.168270, -0.204795, -0.201165, -0.190549, -0.225847, -0.204547, -0.198188, -0.197175
#*# 	  -0.113162, -0.123977, -0.139971, -0.148931, -0.156676, -0.165240, -0.167293, -0.165229, -0.172053, -0.147495, -0.128693, -0.082743, -0.038369, -0.010900, -0.085796, -0.105033, -0.188480, -0.207961, -0.185511, -0.230482, -0.198360, -0.218751, -0.218500, -0.214960, -0.182423
#*# 	  -0.106357, -0.119687, -0.138117, -0.149321, -0.162327, -0.172147, -0.176266, -0.176297, -0.175267, -0.158278, -0.149482, -0.101141, -0.075422, -0.067115, -0.101398, -0.148903, -0.186218, -0.206385, -0.218829, -0.227668, -0.233392, -0.234903, -0.219474, -0.247770, -0.204659
#*# 	  -0.100709, -0.109276, -0.128763, -0.146692, -0.162421, -0.174379, -0.179568, -0.173989, -0.178759, -0.160104, -0.162351, -0.123734, -0.129005, -0.089921, -0.132394, -0.189373, -0.179833, -0.235552, -0.211466, -0.254416, -0.226385, -0.262915, -0.249811, -0.246740, -0.234483
#*# 	  -0.082393, -0.097859, -0.117667, -0.135422, -0.152079, -0.165338, -0.169642, -0.173036, -0.170968, -0.166176, -0.161007, -0.161867, -0.142894, -0.141441, -0.156740, -0.185343, -0.204669, -0.216837, -0.245381, -0.227310, -0.263376, -0.240994, -0.254330, -0.252621, -0.254268
#*# 	  -0.077526, -0.082396, -0.103879, -0.123973, -0.141600, -0.154176, -0.162061, -0.165172, -0.168390, -0.168446, -0.167297, -0.167587, -0.178110, -0.152645, -0.177059, -0.193576, -0.190753, -0.238179, -0.214359, -0.260375, -0.253679, -0.257826, -0.262182, -0.260590, -0.240890
#*# 	  -0.061809, -0.071207, -0.093884, -0.115497, -0.134425, -0.149758, -0.157309, -0.165653, -0.165918, -0.177865, -0.168325, -0.175822, -0.189144, -0.168508, -0.208345, -0.204179, -0.216049, -0.223311, -0.234484, -0.234948, -0.276139, -0.252303, -0.260263, -0.281688, -0.258350
#*# 	  -0.055283, -0.062765, -0.091280, -0.117981, -0.139442, -0.155219, -0.167885, -0.170955, -0.178672, -0.178420, -0.184738, -0.189588, -0.194929, -0.201029, -0.210425, -0.240128, -0.214849, -0.256953, -0.250254, -0.266692, -0.276972, -0.282206, -0.289838, -0.292601, -0.277249
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 3
#*# mesh_y_pps = 3
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 10.0
#*# max_x = 310.0
#*# min_y = 22.0
#*# max_y = 260.0
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 28.181
#*# pid_ki = 2.646
#*# pid_kd = 75.031
#*#
#*# [scanner model default]
#*# model_coef = 1.3505960046552101,
#*# 	1.658910122764384,
#*# 	0.7516938974793562,
#*# 	0.2036346849536123,
#*# 	0.2122579970113,
#*# 	1.3316006329889167,
#*# 	0.27018147007678495,
#*# 	-1.98049913828422,
#*# 	-0.03779621816778336,
#*# 	1.2393316401956045
#*# model_domain = 3.1161929854002e-07,3.361234641791671e-07
#*# model_range = 0.100000,5.000000
#*# model_temp = 27.148663
#*# model_offset = -0.212
