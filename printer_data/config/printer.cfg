#[include mmu/base/*.cfg]
#[include mmu/optional/client_macros.cfg]
#[include shell_command.cfg]
[include mainsail.cfg]
[include include/steppers.cfg]
[include include/fans.cfg]
[include include/bed.cfg]
#[include include/sensorless.cfg]f
#[include include/quickdraw.cfg]
[include include/led.cfg]
[include include/macros.cfg]
#[include mmu/mmu_vars.cfg]
#[include include/trad_rack_optional.cfg]




[safe_z_home]
home_xy_position: 165, 165
z_hop: 10

[z_tilt] 
z_positions: #Nozzle to GE5C
  -80,  -20
  350, -20
points:
  15, 150
  275, 150
speed: 50
horizontal_move_z: 10
retries: 30
retry_tolerance: 0.1

[input_shaper]
shaper_type_x = zv
shaper_freq_x = 120.6
shaper_type_y = zv
shaper_freq_y = 76.6

[scanner]
serial: /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00

#   Path to the serial port for the Cartographer device. Typically has the form
#   /dev/serial/by-id/usb-cartographer_cartographer_...
#   
#   If you are using the CAN Bus version, replace serial: with canbus_uuid: and add the UUID.
#   Example: canbus_uuid: 1283as878a9sd
#
speed: 2.0
#   Z probing dive speed.
lift_speed: 5.0
#   Z probing lift speed.
backlash_comp: 0.2
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.
x_offset: 0.
#   X offset of cartographer from the nozzle.
y_offset: 21.1
#   Y offset of cartographer from the nozzle.
trigger_distance: 2.0
#   cartographer trigger distance for homing.
trigger_dive_threshold: 1.5
#   Threshold for range vs dive mode probing. Beyond `trigger_distance +
#   trigger_dive_threshold` a dive will be used.
trigger_hysteresis: 0.006
#   Hysteresis on trigger threshold for untriggering, as a percentage of the
#   trigger threshold.
cal_nozzle_z: 0.1
#   Expected nozzle offset after completing manual Z offset calibration.
cal_floor: 0.1
#   Minimum z bound on sensor response measurement.
cal_ceil:5.
#   Maximum z bound on sensor response measurement.
cal_speed: 1.0
#   Speed while measuring response curve.
cal_move_speed: 10.
#   Speed while moving to position for response curve measurement.
default_model_name: default
#   Name of default cartographer model to load.
mesh_main_direction: X
#   Primary travel direction during mesh measurement.
#mesh_overscan: -1
#   Distance to use for direction changes at mesh line ends. Omit this setting
#   and a default will be calculated from line spacing and available travel.
mesh_cluster_size: 1
#   Radius of mesh grid point clusters.
mesh_runs: 2
#   Number of passes to make during mesh scan.
detect_threshold_z: 3600 # This needs tuning
calibration_method: tap 
z_offset: 0.0 
probe_speed: 2.0
tap_location: 150,150 # set to center of bed
sensor: cartographer

[printer]
kinematics: corexy
max_velocity: 3000
max_accel: 50000
#max_accel_to_decel: 5000
max_z_velocity: 3000
max_z_accel: 10000
square_corner_velocity: 10

[exclude_object]

[gcode_arcs] # OrcaSlicer
resolution: 1.0


[idle_timeout]

# only turn off heaters and motors if the printer is not paused
gcode:
    {% if not printer.pause_resume.is_paused %}
        TURN_OFF_HEATERS
        M84
    {% endif %}

[pause_resume]
recover_velocity: 350



[virtual_sdcard]
path: /home/pi/printer_data/gcodes
on_error_gcode: CANCEL_PRINT

[mcu]
#USB
serial: /dev/serial/by-id/usb-Klipper_stm32h723xx_0F003B001751313338343730-if00
#reconnect_interval: 9999




# Driver6
[extruder]
nozzle_diameter: 0.500
pressure_advance: 0.025
pressure_advance_smooth_time: 0.03
max_extrude_only_distance: 101

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.230925, -0.246539, -0.226739, -0.243397, -0.221969, -0.214799, -0.206423, -0.211305, -0.169538, -0.186362, -0.157144, -0.145491, -0.156698, -0.134344, -0.133883, -0.132472, -0.128064, -0.109026, -0.135605, -0.104781, -0.113805, -0.105644, -0.095909, -0.086469, -0.064119
#*# 	  -0.260770, -0.243119, -0.247182, -0.243027, -0.234761, -0.222165, -0.213880, -0.200371, -0.185280, -0.172077, -0.158473, -0.143357, -0.137896, -0.132111, -0.127450, -0.134037, -0.126276, -0.123550, -0.119887, -0.118682, -0.120615, -0.109343, -0.096753, -0.091480, -0.069046
#*# 	  -0.265970, -0.253048, -0.271240, -0.252652, -0.243504, -0.245842, -0.211439, -0.225204, -0.171319, -0.176800, -0.162886, -0.150928, -0.163231, -0.112429, -0.133617, -0.130383, -0.129438, -0.125631, -0.122286, -0.102709, -0.132816, -0.107231, -0.098985, -0.092495, -0.064905
#*# 	  -0.280467, -0.261804, -0.260106, -0.247172, -0.232645, -0.223270, -0.220128, -0.209325, -0.192743, -0.177428, -0.163825, -0.148834, -0.139237, -0.135806, -0.132086, -0.131614, -0.128229, -0.124971, -0.122958, -0.121298, -0.117189, -0.105801, -0.100077, -0.098411, -0.078187
#*# 	  -0.281845, -0.273538, -0.272754, -0.243688, -0.240205, -0.222966, -0.222221, -0.213790, -0.194840, -0.164137, -0.162323, -0.148045, -0.139220, -0.153079, -0.107851, -0.150433, -0.105391, -0.145102, -0.104549, -0.138041, -0.105593, -0.108599, -0.104830, -0.098928, -0.100913
#*# 	  -0.286270, -0.262008, -0.258175, -0.248336, -0.230304, -0.222983, -0.219187, -0.208943, -0.193023, -0.174973, -0.159590, -0.144235, -0.132108, -0.130489, -0.127020, -0.123792, -0.125994, -0.119228, -0.127610, -0.116780, -0.120861, -0.112395, -0.106079, -0.102219, -0.080474
#*# 	  -0.290768, -0.273961, -0.267024, -0.259994, -0.254914, -0.228908, -0.238012, -0.204920, -0.210294, -0.168490, -0.178759, -0.145770, -0.131259, -0.130046, -0.130684, -0.149318, -0.113874, -0.148313, -0.115027, -0.153573, -0.112109, -0.127644, -0.137225, -0.099317, -0.110742
#*# 	  -0.289411, -0.268593, -0.266492, -0.261161, -0.250760, -0.239313, -0.225319, -0.213323, -0.197305, -0.179603, -0.161713, -0.139845, -0.125849, -0.126222, -0.132285, -0.134096, -0.140223, -0.136074, -0.141276, -0.142668, -0.140936, -0.136440, -0.131059, -0.121940, -0.093185
#*# 	  -0.292188, -0.278751, -0.276995, -0.261010, -0.266724, -0.242046, -0.240389, -0.215755, -0.197300, -0.179989, -0.160905, -0.125404, -0.122204, -0.121104, -0.129364, -0.140362, -0.130446, -0.164095, -0.151033, -0.151940, -0.151817, -0.146971, -0.141062, -0.116665, -0.115033
#*# 	  -0.276457, -0.260699, -0.259185, -0.251800, -0.247065, -0.233680, -0.217470, -0.201322, -0.186490, -0.165231, -0.145779, -0.121444, -0.099731, -0.094578, -0.107364, -0.127901, -0.138721, -0.143264, -0.146704, -0.145991, -0.156474, -0.149760, -0.138455, -0.139491, -0.103223
#*# 	  -0.268277, -0.259577, -0.253382, -0.249959, -0.249613, -0.233008, -0.216017, -0.197057, -0.172112, -0.167269, -0.140470, -0.109078, -0.064342, -0.081190, -0.085028, -0.103652, -0.151956, -0.129789, -0.145491, -0.149604, -0.154923, -0.154460, -0.165753, -0.124174, -0.130574
#*# 	  -0.256775, -0.246762, -0.242412, -0.238942, -0.232829, -0.219815, -0.204770, -0.190312, -0.176457, -0.157368, -0.132470, -0.091282, -0.052494, -0.039861, -0.051342, -0.108559, -0.129082, -0.142176, -0.145658, -0.153805, -0.160741, -0.160818, -0.154712, -0.145912, -0.133826
#*# 	  -0.257653, -0.246308, -0.244695, -0.239948, -0.236820, -0.231777, -0.209143, -0.198368, -0.183520, -0.162814, -0.128879, -0.077058, -0.031702, -0.013980, -0.029706, -0.109506, -0.135953, -0.152945, -0.160329, -0.166370, -0.173994, -0.173833, -0.182342, -0.146544, -0.160238
#*# 	  -0.245321, -0.239419, -0.237574, -0.234302, -0.232182, -0.222188, -0.211835, -0.199149, -0.184876, -0.161576, -0.116876, -0.061739, -0.012327, -0.004286, -0.030494, -0.093787, -0.131808, -0.161862, -0.171545, -0.177500, -0.189141, -0.181956, -0.191270, -0.166623, -0.181034
#*# 	  -0.241250, -0.232010, -0.236875, -0.227498, -0.231066, -0.217864, -0.214074, -0.204518, -0.183337, -0.170745, -0.109115, -0.056138, 0.008858, -0.004314, -0.021406, -0.107222, -0.142020, -0.170826, -0.184561, -0.180313, -0.209962, -0.188741, -0.207572, -0.177958, -0.188356
#*# 	  -0.217441, -0.218578, -0.215122, -0.215560, -0.214111, -0.207583, -0.202119, -0.194699, -0.182532, -0.161335, -0.111025, -0.045687, 0.009403, 0.012418, -0.036095, -0.101156, -0.139244, -0.171448, -0.185259, -0.194871, -0.199521, -0.202436, -0.202994, -0.189119, -0.205632
#*# 	  -0.209278, -0.206480, -0.211695, -0.199703, -0.209908, -0.197486, -0.200529, -0.193406, -0.176988, -0.166776, -0.113465, -0.049225, 0.003325, 0.005574, -0.045504, -0.120745, -0.139475, -0.192705, -0.171730, -0.194495, -0.203951, -0.195680, -0.213200, -0.202625, -0.193418
#*# 	  -0.187508, -0.193767, -0.192932, -0.195300, -0.200417, -0.195317, -0.192225, -0.189281, -0.179752, -0.160750, -0.118731, -0.060638, -0.011244, -0.013171, -0.067360, -0.117422, -0.171486, -0.184130, -0.194287, -0.203868, -0.216032, -0.206721, -0.219746, -0.206406, -0.209579
#*# 	  -0.194597, -0.194833, -0.195944, -0.196373, -0.200071, -0.199644, -0.201201, -0.196190, -0.188718, -0.168262, -0.137740, -0.088578, -0.039419, -0.054629, -0.081425, -0.136228, -0.193569, -0.186266, -0.208954, -0.215057, -0.221895, -0.213012, -0.226313, -0.238562, -0.213170
#*# 	  -0.178951, -0.192623, -0.197581, -0.204237, -0.213923, -0.213560, -0.210721, -0.203814, -0.194682, -0.183952, -0.158749, -0.123548, -0.092618, -0.089550, -0.127710, -0.172444, -0.211813, -0.214928, -0.222109, -0.247700, -0.230483, -0.244513, -0.249064, -0.244309, -0.238626
#*# 	  -0.187049, -0.190397, -0.197388, -0.208190, -0.215500, -0.218417, -0.216304, -0.211642, -0.203152, -0.191834, -0.178361, -0.156767, -0.144249, -0.142249, -0.167114, -0.204404, -0.226361, -0.239751, -0.248355, -0.251375, -0.258306, -0.259368, -0.263667, -0.268762, -0.259149
#*# 	  -0.170666, -0.186866, -0.194549, -0.208431, -0.217198, -0.220533, -0.218620, -0.216061, -0.209335, -0.205228, -0.195259, -0.186937, -0.178183, -0.180142, -0.200028, -0.220182, -0.239229, -0.249285, -0.256871, -0.266060, -0.268419, -0.271702, -0.267394, -0.273649, -0.287161
#*# 	  -0.181013, -0.180836, -0.193039, -0.203609, -0.214763, -0.219929, -0.220306, -0.220849, -0.219856, -0.213135, -0.211478, -0.207647, -0.207936, -0.212694, -0.223745, -0.239781, -0.251113, -0.260012, -0.269502, -0.277950, -0.285224, -0.285396, -0.289022, -0.294954, -0.289552
#*# 	  -0.165226, -0.181219, -0.190093, -0.206512, -0.218728, -0.225157, -0.226631, -0.227316, -0.226595, -0.227061, -0.227564, -0.226893, -0.228359, -0.232731, -0.244661, -0.253665, -0.266821, -0.271910, -0.279580, -0.300998, -0.290070, -0.306736, -0.310529, -0.305122, -0.320702
#*# 	  -0.176992, -0.178569, -0.196761, -0.212485, -0.228893, -0.238356, -0.240076, -0.241863, -0.242772, -0.242232, -0.247148, -0.247252, -0.254239, -0.253723, -0.269184, -0.274601, -0.291631, -0.300945, -0.295290, -0.321076, -0.312915, -0.338615, -0.322258, -0.336853, -0.327470
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 3
#*# mesh_y_pps = 3
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 10.0
#*# max_x = 310.0
#*# min_y = 22.0
#*# max_y = 260.0
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 28.181
#*# pid_ki = 2.646
#*# pid_kd = 75.031
#*#
#*# [scanner model default]
#*# model_coef = 1.3505960046552101,
#*# 	1.658910122764384,
#*# 	0.7516938974793562,
#*# 	0.2036346849536123,
#*# 	0.2122579970113,
#*# 	1.3316006329889167,
#*# 	0.27018147007678495,
#*# 	-1.98049913828422,
#*# 	-0.03779621816778336,
#*# 	1.2393316401956045
#*# model_domain = 3.1161929854002e-07,3.361234641791671e-07
#*# model_range = 0.100000,5.000000
#*# model_temp = 27.148663
#*# model_offset = -0.326
