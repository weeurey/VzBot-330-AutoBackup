[include mmu/base/*.cfg]
[include mmu/optional/client_macros.cfg]
#[include shell_command.cfg]
[include mainsail.cfg]
[include include/steppers.cfg]
[include include/fans.cfg]
[include include/bed.cfg]
#[include include/sensorless.cfg]f
#[include include/quickdraw.cfg]
[include include/led.cfg]
[include include/macros.cfg]
#[include include/trad_rack_btt_mmb.cfg]
#[include include/trad_rack_optional.cfg]




[safe_z_home]
home_xy_position: 165, 165
z_hop: 10

[z_tilt] 
z_positions: #Nozzle to GE5C
  -80,  -20
  350, -20
points:
  15, 150
  275, 150
speed: 50
horizontal_move_z: 10
retries: 30
retry_tolerance: 0.1

[input_shaper]
shaper_type_x = zv
shaper_freq_x = 120.6
shaper_type_y = zv
shaper_freq_y = 76.6

[scanner]
serial: /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00

#   Path to the serial port for the Cartographer device. Typically has the form
#   /dev/serial/by-id/usb-cartographer_cartographer_...
#   
#   If you are using the CAN Bus version, replace serial: with canbus_uuid: and add the UUID.
#   Example: canbus_uuid: 1283as878a9sd
#
speed: 2.0
#   Z probing dive speed.
lift_speed: 5.0
#   Z probing lift speed.
backlash_comp: 0.2
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.
x_offset: 0.
#   X offset of cartographer from the nozzle.
y_offset: 21.1
#   Y offset of cartographer from the nozzle.
trigger_distance: 2.0
#   cartographer trigger distance for homing.
trigger_dive_threshold: 1.5
#   Threshold for range vs dive mode probing. Beyond `trigger_distance +
#   trigger_dive_threshold` a dive will be used.
trigger_hysteresis: 0.006
#   Hysteresis on trigger threshold for untriggering, as a percentage of the
#   trigger threshold.
cal_nozzle_z: 0.1
#   Expected nozzle offset after completing manual Z offset calibration.
cal_floor: 0.1
#   Minimum z bound on sensor response measurement.
cal_ceil:5.
#   Maximum z bound on sensor response measurement.
cal_speed: 1.0
#   Speed while measuring response curve.
cal_move_speed: 10.
#   Speed while moving to position for response curve measurement.
default_model_name: default
#   Name of default cartographer model to load.
mesh_main_direction: X
#   Primary travel direction during mesh measurement.
#mesh_overscan: -1
#   Distance to use for direction changes at mesh line ends. Omit this setting
#   and a default will be calculated from line spacing and available travel.
mesh_cluster_size: 1
#   Radius of mesh grid point clusters.
mesh_runs: 2
#   Number of passes to make during mesh scan.
detect_threshold_z: 3600 # This needs tuning
calibration_method: tap 
z_offset: 0.0 
probe_speed: 2.0
tap_location: 150,150 # set to center of bed
sensor: cartographer

[printer]
kinematics: corexy
max_velocity: 3000
max_accel: 50000
#max_accel_to_decel: 5000
max_z_velocity: 3000
max_z_accel: 10000
square_corner_velocity: 10

[exclude_object]

[gcode_arcs] # OrcaSlicer
resolution: 1.0


[idle_timeout]

# only turn off heaters and motors if the printer is not paused
gcode:
    {% if not printer.pause_resume.is_paused %}
        TURN_OFF_HEATERS
        M84
    {% endif %}

[pause_resume]
recover_velocity: 350



[virtual_sdcard]
path: /home/pi/printer_data/gcodes
on_error_gcode: CANCEL_PRINT

[mcu]
#USB
serial: /dev/serial/by-id/usb-Klipper_stm32h723xx_0F003B001751313338343730-if00
#reconnect_interval: 9999




# Driver6
[extruder]
nozzle_diameter: 0.500
pressure_advance: 0.025
pressure_advance_smooth_time: 0.03
max_extrude_only_distance: 101

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.274087, 0.248608, 0.201198, 0.138705, 0.122560, 0.069084, 0.058719, 0.014944, 0.005637, 0.013305, 0.028562, 0.042399, 0.052287, 0.059577, 0.046686, 0.074964, 0.046947, 0.084839, 0.071247, 0.079418, 0.086471, 0.101018, 0.094283, 0.156116, 0.142494
#*# 	  0.277063, 0.269675, 0.213536, 0.146995, 0.098092, 0.066442, 0.024122, 0.005895, -0.011117, 0.008128, 0.016210, 0.033612, 0.047296, 0.055618, 0.055096, 0.061539, 0.042291, 0.065740, 0.047003, 0.052643, 0.073745, 0.079900, 0.101022, 0.117211, 0.141518
#*# 	  0.248533, 0.243625, 0.188506, 0.127648, 0.068075, 0.040197, -0.005872, -0.015075, -0.040139, -0.003425, 0.000829, 0.017522, 0.029943, 0.035295, 0.037469, 0.021859, 0.053183, 0.024622, 0.057942, 0.044615, 0.049859, 0.059740, 0.076201, 0.097261, 0.118534
#*# 	  0.193708, 0.176846, 0.133450, 0.086046, 0.050143, 0.022121, -0.009256, -0.033216, -0.034708, -0.032806, -0.004072, 0.006663, 0.021225, 0.029782, 0.031960, 0.033658, 0.034009, 0.033856, 0.034276, 0.032989, 0.032837, 0.051437, 0.057555, 0.072662, 0.097434
#*# 	  0.118951, 0.114465, 0.071816, 0.046180, 0.023307, -0.000044, -0.011395, -0.055004, -0.044648, -0.054482, -0.007437, -0.016801, 0.027105, -0.000819, 0.036299, 0.001892, 0.022153, 0.025281, 0.026673, 0.023785, 0.024788, 0.030529, 0.039984, 0.067588, 0.059725
#*# 	  0.046560, 0.041166, 0.019005, -0.001050, -0.022591, 0.011969, -0.034693, -0.037595, -0.072011, -0.042275, -0.031700, -0.012686, 0.003683, 0.005785, 0.007505, 0.007494, 0.011266, 0.008160, 0.020444, 0.009929, 0.015733, 0.011907, 0.025403, 0.031043, 0.051888
#*# 	  -0.016861, -0.010744, -0.026818, -0.041309, -0.044617, -0.033306, -0.034676, -0.060818, -0.077602, -0.071232, -0.050982, -0.025327, -0.006723, -0.001984, 0.009160, -0.008538, -0.011457, -0.008353, -0.004461, -0.003397, -0.007642, -0.009294, -0.001851, 0.010401, 0.032252
#*# 	  -0.075362, -0.064499, -0.072537, -0.068356, -0.099580, -0.068808, -0.049533, -0.095627, -0.092814, -0.084616, -0.054228, -0.047494, -0.010449, -0.012875, -0.014201, -0.023905, -0.026330, -0.029546, -0.025346, -0.022649, -0.025356, -0.023032, -0.025634, -0.013608, 0.012020
#*# 	  -0.120813, -0.107673, -0.111938, -0.119402, -0.119083, -0.108039, -0.102069, -0.098854, -0.111301, -0.098271, -0.079793, -0.057034, -0.022464, -0.011459, -0.017712, -0.046065, -0.034911, -0.051140, -0.061569, -0.030320, -0.058064, -0.035276, -0.044372, -0.032107, -0.008744
#*# 	  -0.165174, -0.134948, -0.166456, -0.136106, -0.150995, -0.155433, -0.111033, -0.121071, -0.114670, -0.102099, -0.082526, -0.061063, -0.003868, -0.005039, 0.000120, -0.032777, -0.055461, -0.057890, -0.058286, -0.057905, -0.061404, -0.063368, -0.059841, -0.052111, -0.031033
#*# 	  -0.183807, -0.172442, -0.174139, -0.175463, -0.169633, -0.160380, -0.144854, -0.124909, -0.124341, -0.099516, -0.088530, -0.045950, -0.005905, 0.020403, 0.008929, -0.033330, -0.064972, -0.081627, -0.071826, -0.075031, -0.081689, -0.082403, -0.076661, -0.066988, -0.044831
#*# 	  -0.200701, -0.189742, -0.196736, -0.177373, -0.194110, -0.162170, -0.165389, -0.129674, -0.132428, -0.101830, -0.090572, -0.034274, 0.005833, 0.038054, 0.021427, -0.033123, -0.069986, -0.090352, -0.087402, -0.091754, -0.099726, -0.102306, -0.096173, -0.088414, -0.076684
#*# 	  -0.204461, -0.198490, -0.199306, -0.198126, -0.195135, -0.186537, -0.173492, -0.154746, -0.132813, -0.124748, -0.080023, -0.037959, 0.017435, 0.042887, 0.021044, -0.039055, -0.083702, -0.119515, -0.119705, -0.113384, -0.140211, -0.120904, -0.135866, -0.106875, -0.115564
#*# 	  -0.203030, -0.204401, -0.210444, -0.209816, -0.207950, -0.209369, -0.182992, -0.184628, -0.158858, -0.126902, -0.094102, -0.026032, 0.014509, 0.051128, 0.009632, -0.051915, -0.106261, -0.137320, -0.149988, -0.152672, -0.155929, -0.157572, -0.151650, -0.143927, -0.135004
#*# 	  -0.192193, -0.201172, -0.215388, -0.214518, -0.212754, -0.209446, -0.203731, -0.192716, -0.176912, -0.147541, -0.096201, -0.030512, 0.020419, 0.038427, -0.005695, -0.073134, -0.132790, -0.164422, -0.179250, -0.182396, -0.185697, -0.184853, -0.180938, -0.182094, -0.154269
#*# 	  -0.169049, -0.210218, -0.204826, -0.229819, -0.224597, -0.205770, -0.217546, -0.195019, -0.196559, -0.163612, -0.111153, -0.042269, 0.015157, 0.024603, -0.023426, -0.095476, -0.149204, -0.185917, -0.197575, -0.202721, -0.204952, -0.205457, -0.200377, -0.192788, -0.184648
#*# 	  -0.168269, -0.195683, -0.215407, -0.220466, -0.221211, -0.222318, -0.217577, -0.213578, -0.199947, -0.171140, -0.124582, -0.056319, -0.006738, 0.006033, -0.049466, -0.123253, -0.182054, -0.209365, -0.220195, -0.224072, -0.226295, -0.226990, -0.219443, -0.222790, -0.199989
#*# 	  -0.168884, -0.196677, -0.207640, -0.241927, -0.234521, -0.235642, -0.244561, -0.223217, -0.229325, -0.190101, -0.154745, -0.087949, -0.032997, -0.031811, -0.082599, -0.152299, -0.202937, -0.230527, -0.239099, -0.246333, -0.250035, -0.247885, -0.247936, -0.233617, -0.232095
#*# 	  -0.159108, -0.192680, -0.220274, -0.237855, -0.248524, -0.253005, -0.254848, -0.248259, -0.238973, -0.214950, -0.171847, -0.114871, -0.072005, -0.076712, -0.123429, -0.191715, -0.236758, -0.261137, -0.272427, -0.273297, -0.285808, -0.270302, -0.277626, -0.269418, -0.260561
#*# 	  -0.181724, -0.194075, -0.215466, -0.264490, -0.255576, -0.287715, -0.270934, -0.287275, -0.256037, -0.248877, -0.195393, -0.157345, -0.119091, -0.123317, -0.176298, -0.236450, -0.278656, -0.294271, -0.307973, -0.310200, -0.314139, -0.311788, -0.308269, -0.301144, -0.304727
#*# 	  -0.182422, -0.199861, -0.238973, -0.255684, -0.281954, -0.291576, -0.300939, -0.296882, -0.285871, -0.262777, -0.220385, -0.176685, -0.154955, -0.165356, -0.218313, -0.270488, -0.311255, -0.322541, -0.331397, -0.338304, -0.342315, -0.342920, -0.339405, -0.334619, -0.328250
#*# 	  -0.218263, -0.212545, -0.243087, -0.259093, -0.283491, -0.303139, -0.313502, -0.314403, -0.298138, -0.282838, -0.241395, -0.198570, -0.180861, -0.205939, -0.256148, -0.302854, -0.332686, -0.348058, -0.353677, -0.361249, -0.365798, -0.367918, -0.364426, -0.362603, -0.352715
#*# 	  -0.239956, -0.242577, -0.252268, -0.259852, -0.285492, -0.312289, -0.323932, -0.327835, -0.321108, -0.297839, -0.255704, -0.210232, -0.197099, -0.234860, -0.290344, -0.334861, -0.352565, -0.364905, -0.373993, -0.381781, -0.387563, -0.389198, -0.389301, -0.387014, -0.377167
#*# 	  -0.257045, -0.257855, -0.261967, -0.264797, -0.294872, -0.319193, -0.346362, -0.340258, -0.340551, -0.320083, -0.278142, -0.238641, -0.226390, -0.269561, -0.326594, -0.363899, -0.381066, -0.388820, -0.395816, -0.405858, -0.411684, -0.405713, -0.412553, -0.412960, -0.416697
#*# 	  -0.276685, -0.277482, -0.278318, -0.293819, -0.316834, -0.350873, -0.363571, -0.370165, -0.362832, -0.344269, -0.315149, -0.282882, -0.280753, -0.318549, -0.365694, -0.400341, -0.410445, -0.423599, -0.428331, -0.437403, -0.431365, -0.432546, -0.431420, -0.441047, -0.444750
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 3
#*# mesh_y_pps = 3
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 10.0
#*# max_x = 310.0
#*# min_y = 22.0
#*# max_y = 260.0
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 28.181
#*# pid_ki = 2.646
#*# pid_kd = 75.031
#*#
#*# [scanner model default]
#*# model_coef = 1.3505960046552101,
#*# 	1.658910122764384,
#*# 	0.7516938974793562,
#*# 	0.2036346849536123,
#*# 	0.2122579970113,
#*# 	1.3316006329889167,
#*# 	0.27018147007678495,
#*# 	-1.98049913828422,
#*# 	-0.03779621816778336,
#*# 	1.2393316401956045
#*# model_domain = 3.1161929854002e-07,3.361234641791671e-07
#*# model_range = 0.100000,5.000000
#*# model_temp = 27.148663
#*# model_offset = -0.06200
