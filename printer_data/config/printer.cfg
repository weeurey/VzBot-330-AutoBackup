[include mmu/base/*.cfg]
[include mmu/optional/client_macros.cfg]
#[include shell_command.cfg]
[include mainsail.cfg]
[include include/steppers.cfg]
[include include/fans.cfg]
[include include/bed.cfg]
#[include include/sensorless.cfg]f
#[include include/quickdraw.cfg]
[include include/led.cfg]
[include include/macros.cfg]
#[include include/trad_rack_btt_mmb.cfg]
#[include include/trad_rack_optional.cfg]




[safe_z_home]
home_xy_position: 165, 165
z_hop: 10

[z_tilt] 
z_positions: #Nozzle to GE5C
  -80,  -20
  350, -20
points:
  15, 150
  275, 150
speed: 50
horizontal_move_z: 10
retries: 30
retry_tolerance: 0.1

[input_shaper]
shaper_type_x = zv
shaper_freq_x = 120.6
shaper_type_y = zv
shaper_freq_y = 76.6

[scanner]
serial: /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00

#   Path to the serial port for the Cartographer device. Typically has the form
#   /dev/serial/by-id/usb-cartographer_cartographer_...
#   
#   If you are using the CAN Bus version, replace serial: with canbus_uuid: and add the UUID.
#   Example: canbus_uuid: 1283as878a9sd
#
speed: 2.0
#   Z probing dive speed.
lift_speed: 5.0
#   Z probing lift speed.
backlash_comp: 0.2
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.
x_offset: 0.
#   X offset of cartographer from the nozzle.
y_offset: 21.1
#   Y offset of cartographer from the nozzle.
trigger_distance: 2.0
#   cartographer trigger distance for homing.
trigger_dive_threshold: 1.5
#   Threshold for range vs dive mode probing. Beyond `trigger_distance +
#   trigger_dive_threshold` a dive will be used.
trigger_hysteresis: 0.006
#   Hysteresis on trigger threshold for untriggering, as a percentage of the
#   trigger threshold.
cal_nozzle_z: 0.1
#   Expected nozzle offset after completing manual Z offset calibration.
cal_floor: 0.1
#   Minimum z bound on sensor response measurement.
cal_ceil:5.
#   Maximum z bound on sensor response measurement.
cal_speed: 1.0
#   Speed while measuring response curve.
cal_move_speed: 10.
#   Speed while moving to position for response curve measurement.
default_model_name: default
#   Name of default cartographer model to load.
mesh_main_direction: X
#   Primary travel direction during mesh measurement.
#mesh_overscan: -1
#   Distance to use for direction changes at mesh line ends. Omit this setting
#   and a default will be calculated from line spacing and available travel.
mesh_cluster_size: 1
#   Radius of mesh grid point clusters.
mesh_runs: 2
#   Number of passes to make during mesh scan.
detect_threshold_z: 3600 # This needs tuning
calibration_method: tap 
z_offset: 0.0 
probe_speed: 2.0
tap_location: 150,150 # set to center of bed
sensor: cartographer

[printer]
kinematics: corexy
max_velocity: 3000
max_accel: 50000
#max_accel_to_decel: 5000
max_z_velocity: 3000
max_z_accel: 10000
square_corner_velocity: 10

[exclude_object]

[gcode_arcs] # OrcaSlicer
resolution: 1.0


[idle_timeout]

# only turn off heaters and motors if the printer is not paused
gcode:
    {% if not printer.pause_resume.is_paused %}
        TURN_OFF_HEATERS
        M84
    {% endif %}

[pause_resume]
recover_velocity: 350



[virtual_sdcard]
path: /home/pi/printer_data/gcodes
on_error_gcode: CANCEL_PRINT

[mcu]
#USB
serial: /dev/serial/by-id/usb-Klipper_stm32h723xx_0F003B001751313338343730-if00
#reconnect_interval: 9999




# Driver6
[extruder]
nozzle_diameter: 0.500
pressure_advance: 0.025
pressure_advance_smooth_time: 0.03
max_extrude_only_distance: 101

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.309250, 0.307867, 0.261573, 0.208555, 0.168597, 0.133289, 0.109437, 0.070682, 0.069653, 0.073334, 0.091147, 0.106970, 0.119295, 0.130346, 0.136376, 0.134872, 0.142333, 0.147752, 0.151751, 0.158881, 0.167234, 0.177003, 0.189785, 0.213018, 0.232731
#*# 	  0.333345, 0.317529, 0.259860, 0.199796, 0.153030, 0.117482, 0.083202, 0.058422, 0.050775, 0.060774, 0.076395, 0.092509, 0.108533, 0.124257, 0.111292, 0.134738, 0.114293, 0.138732, 0.119014, 0.142700, 0.132273, 0.164313, 0.158328, 0.191995, 0.201042
#*# 	  0.287440, 0.288465, 0.235265, 0.177330, 0.131041, 0.094196, 0.058615, 0.033206, 0.024338, 0.035570, 0.052170, 0.068464, 0.077393, 0.097467, 0.087907, 0.108083, 0.092764, 0.114943, 0.101602, 0.118164, 0.116122, 0.134122, 0.145462, 0.157550, 0.181742
#*# 	  0.244577, 0.225860, 0.182332, 0.141008, 0.110598, 0.084039, 0.043747, 0.021586, 0.005395, 0.026481, 0.035864, 0.058865, 0.068744, 0.076450, 0.083158, 0.083618, 0.083744, 0.086932, 0.090840, 0.092710, 0.098657, 0.105926, 0.118204, 0.133098, 0.156449
#*# 	  0.181363, 0.156652, 0.131805, 0.105282, 0.089635, 0.072004, 0.040076, 0.012653, 0.002222, 0.013013, 0.033759, 0.051717, 0.059509, 0.067326, 0.076116, 0.064758, 0.082405, 0.066854, 0.089454, 0.071647, 0.083395, 0.092265, 0.101938, 0.112825, 0.136012
#*# 	  0.095533, 0.111497, 0.073817, 0.069044, 0.056806, 0.058137, 0.031758, 0.006513, -0.014057, 0.004544, 0.014306, 0.042151, 0.052392, 0.056198, 0.058714, 0.057747, 0.059542, 0.062459, 0.063364, 0.066171, 0.066185, 0.072925, 0.081935, 0.092939, 0.113921
#*# 	  0.038136, 0.047494, 0.036025, 0.025385, 0.025967, 0.030123, 0.019477, -0.007929, -0.020704, -0.012744, 0.005371, 0.027786, 0.046913, 0.048352, 0.046463, 0.045776, 0.044788, 0.047721, 0.049072, 0.052715, 0.052978, 0.058987, 0.072256, 0.085429, 0.109588
#*# 	  0.005404, -0.019079, 0.009201, -0.031386, -0.009140, -0.025056, -0.011526, -0.036459, -0.044971, -0.036596, -0.024163, 0.018303, 0.023308, 0.037562, 0.029036, 0.024876, 0.016646, 0.015591, 0.018995, 0.022503, 0.036929, 0.020252, 0.052127, 0.041985, 0.107606
#*# 	  -0.053241, -0.042677, -0.046921, -0.057702, -0.063515, -0.059341, -0.056507, -0.062421, -0.061893, -0.052688, -0.032667, -0.004602, 0.022324, 0.033668, 0.024129, 0.008085, -0.006298, -0.011022, -0.008906, -0.006046, -0.008122, -0.007348, -0.000077, 0.014603, 0.042021
#*# 	  -0.082676, -0.065909, -0.090739, -0.078895, -0.104342, -0.079708, -0.094067, -0.080882, -0.076387, -0.072560, -0.034370, -0.015420, 0.032043, 0.038343, 0.037497, 0.008609, -0.010701, -0.021849, -0.019635, -0.021501, -0.027184, -0.025688, -0.018356, -0.007072, 0.018857
#*# 	  -0.109729, -0.103052, -0.108705, -0.113461, -0.114871, -0.109165, -0.101296, -0.091554, -0.081021, -0.062200, -0.048008, -0.005902, 0.036115, 0.060718, 0.048419, 0.006389, -0.013342, -0.036962, -0.021118, -0.041580, -0.032100, -0.050074, -0.029435, -0.030027, 0.002901
#*# 	  -0.114208, -0.128518, -0.123708, -0.127566, -0.128393, -0.123304, -0.122687, -0.090684, -0.097874, -0.071016, -0.056645, 0.003392, 0.040465, 0.082007, 0.058991, 0.011105, -0.027409, -0.043710, -0.045687, -0.051200, -0.061945, -0.063274, -0.056628, -0.046214, -0.032951
#*# 	  -0.135429, -0.133558, -0.140513, -0.141404, -0.143970, -0.141182, -0.131318, -0.117860, -0.104974, -0.087165, -0.053795, -0.003590, 0.044850, 0.071869, 0.053422, -0.002820, -0.048249, -0.071211, -0.077427, -0.088966, -0.089759, -0.092183, -0.083907, -0.077627, -0.067831
#*# 	  -0.129483, -0.140899, -0.147017, -0.144313, -0.160702, -0.146143, -0.155968, -0.136757, -0.123811, -0.107858, -0.055986, 0.001708, 0.053918, 0.072621, 0.046308, -0.020959, -0.063459, -0.096343, -0.107526, -0.110829, -0.113906, -0.117345, -0.111013, -0.106512, -0.096481
#*# 	  -0.137010, -0.144692, -0.155242, -0.160082, -0.159742, -0.160896, -0.159381, -0.153618, -0.138894, -0.114092, -0.065521, -0.004120, 0.049204, 0.063179, 0.025568, -0.038402, -0.090539, -0.120711, -0.131601, -0.137119, -0.141521, -0.139820, -0.131379, -0.134518, -0.120931
#*# 	  -0.119356, -0.132880, -0.168843, -0.152614, -0.164075, -0.166932, -0.164005, -0.161153, -0.150552, -0.128420, -0.085744, -0.003637, 0.045264, 0.052749, 0.006508, -0.059501, -0.111829, -0.141488, -0.155690, -0.158664, -0.162672, -0.161798, -0.158991, -0.152200, -0.143980
#*# 	  -0.116241, -0.142654, -0.160414, -0.163744, -0.167523, -0.170230, -0.169253, -0.167055, -0.159478, -0.136978, -0.088809, -0.024504, 0.028212, 0.031132, -0.021435, -0.090752, -0.138893, -0.172721, -0.168369, -0.190458, -0.184451, -0.184055, -0.178795, -0.174228, -0.167440
#*# 	  -0.105802, -0.142481, -0.153103, -0.172600, -0.174473, -0.177870, -0.180738, -0.179232, -0.172794, -0.154254, -0.116764, -0.040172, -0.009142, 0.001122, -0.056602, -0.119604, -0.166722, -0.190810, -0.198913, -0.203327, -0.209480, -0.205076, -0.203504, -0.196306, -0.194575
#*# 	  -0.104542, -0.134179, -0.163776, -0.179381, -0.190334, -0.194836, -0.199798, -0.195655, -0.188550, -0.166224, -0.125069, -0.071477, -0.034781, -0.041815, -0.093128, -0.152232, -0.197935, -0.219752, -0.229819, -0.230763, -0.245212, -0.229954, -0.237654, -0.225543, -0.219585
#*# 	  -0.097598, -0.134124, -0.162915, -0.183926, -0.211378, -0.210247, -0.229626, -0.212924, -0.216989, -0.187100, -0.159262, -0.106191, -0.072228, -0.097382, -0.141506, -0.199504, -0.234410, -0.256720, -0.263767, -0.269581, -0.272526, -0.277014, -0.264918, -0.265840, -0.256160
#*# 	  -0.108772, -0.142137, -0.169662, -0.196555, -0.217015, -0.233014, -0.236350, -0.237039, -0.229480, -0.208523, -0.170190, -0.130597, -0.113359, -0.133985, -0.183669, -0.240411, -0.270934, -0.288656, -0.298630, -0.297685, -0.318037, -0.301262, -0.312443, -0.301450, -0.295921
#*# 	  -0.128122, -0.162440, -0.170001, -0.204890, -0.221906, -0.238160, -0.249800, -0.252351, -0.244702, -0.230760, -0.180541, -0.145802, -0.135964, -0.167735, -0.225898, -0.265673, -0.308765, -0.306510, -0.325615, -0.327822, -0.334363, -0.336027, -0.336597, -0.330823, -0.326524
#*# 	  -0.163855, -0.171022, -0.183754, -0.193247, -0.219790, -0.247878, -0.260647, -0.263010, -0.263098, -0.240481, -0.202496, -0.161636, -0.156285, -0.201300, -0.258256, -0.297770, -0.319854, -0.330479, -0.342702, -0.355722, -0.353881, -0.367824, -0.359832, -0.358723, -0.361373
#*# 	  -0.174244, -0.184567, -0.185310, -0.200439, -0.220277, -0.258178, -0.273156, -0.281202, -0.281346, -0.264433, -0.226986, -0.187408, -0.187103, -0.234180, -0.292610, -0.328127, -0.348643, -0.351734, -0.368759, -0.377587, -0.383353, -0.382861, -0.388334, -0.386975, -0.390041
#*# 	  -0.189197, -0.190913, -0.211659, -0.210133, -0.251549, -0.272372, -0.302649, -0.296320, -0.307100, -0.283342, -0.260907, -0.236061, -0.237900, -0.280293, -0.329787, -0.361827, -0.377221, -0.387387, -0.400463, -0.409680, -0.411384, -0.406020, -0.410656, -0.416385, -0.424291
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 3
#*# mesh_y_pps = 3
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 10.0
#*# max_x = 310.0
#*# min_y = 22.0
#*# max_y = 260.0
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 28.181
#*# pid_ki = 2.646
#*# pid_kd = 75.031
#*#
#*# [scanner model default]
#*# model_coef = 1.3505960046552101,
#*# 	1.658910122764384,
#*# 	0.7516938974793562,
#*# 	0.2036346849536123,
#*# 	0.2122579970113,
#*# 	1.3316006329889167,
#*# 	0.27018147007678495,
#*# 	-1.98049913828422,
#*# 	-0.03779621816778336,
#*# 	1.2393316401956045
#*# model_domain = 3.1161929854002e-07,3.361234641791671e-07
#*# model_range = 0.100000,5.000000
#*# model_temp = 27.148663
#*# model_offset = -0.212
