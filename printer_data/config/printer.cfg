#[include shell_command.cfg]
[include mainsail.cfg]
[include include/steppers.cfg]
[include include/fans.cfg]
[include include/bed.cfg]
#[include include/sensorless.cfg]f
#[include include/quickdraw.cfg]
[include include/led.cfg]
[include include/macros.cfg]
#[include include/trad_rack_btt_mmb.cfg]
#[include include/trad_rack_optional.cfg]




[safe_z_home]
home_xy_position: 165, 165
z_hop: 10

[z_tilt] 
z_positions: #Nozzle to GE5C
  -80,  -20
  350, -20
points:
  15, 150
  275, 150
speed: 50
horizontal_move_z: 10
retries: 30
retry_tolerance: 0.1

[input_shaper]
shaper_type_x = zv
shaper_freq_x = 120.6
shaper_type_y = zv
shaper_freq_y = 76.6

[scanner]
serial: /dev/serial/by-id/usb-Cartographer_614e_01002B001043303856303820-if00

#   Path to the serial port for the Cartographer device. Typically has the form
#   /dev/serial/by-id/usb-cartographer_cartographer_...
#   
#   If you are using the CAN Bus version, replace serial: with canbus_uuid: and add the UUID.
#   Example: canbus_uuid: 1283as878a9sd
#
speed: 2.0
#   Z probing dive speed.
lift_speed: 5.0
#   Z probing lift speed.
backlash_comp: 0.2
#   Backlash compensation distance for removing Z backlash before measuring
#   the sensor response.
x_offset: 0.
#   X offset of cartographer from the nozzle.
y_offset: 21.1
#   Y offset of cartographer from the nozzle.
trigger_distance: 2.0
#   cartographer trigger distance for homing.
trigger_dive_threshold: 1.5
#   Threshold for range vs dive mode probing. Beyond `trigger_distance +
#   trigger_dive_threshold` a dive will be used.
trigger_hysteresis: 0.006
#   Hysteresis on trigger threshold for untriggering, as a percentage of the
#   trigger threshold.
cal_nozzle_z: 0.1
#   Expected nozzle offset after completing manual Z offset calibration.
cal_floor: 0.1
#   Minimum z bound on sensor response measurement.
cal_ceil:5.
#   Maximum z bound on sensor response measurement.
cal_speed: 1.0
#   Speed while measuring response curve.
cal_move_speed: 10.
#   Speed while moving to position for response curve measurement.
default_model_name: default
#   Name of default cartographer model to load.
mesh_main_direction: X
#   Primary travel direction during mesh measurement.
#mesh_overscan: -1
#   Distance to use for direction changes at mesh line ends. Omit this setting
#   and a default will be calculated from line spacing and available travel.
mesh_cluster_size: 1
#   Radius of mesh grid point clusters.
mesh_runs: 2
#   Number of passes to make during mesh scan.
detect_threshold_z: 3600 # This needs tuning
calibration_method: tap 
z_offset: 0.0 
probe_speed: 2.0
tap_location: 150,150 # set to center of bed
sensor: cartographer

[printer]
kinematics: corexy
max_velocity: 3000
max_accel: 50000
#max_accel_to_decel: 5000
max_z_velocity: 3000
max_z_accel: 10000
square_corner_velocity: 10

[exclude_object]

[gcode_arcs] # OrcaSlicer
resolution: 1.0


[idle_timeout]

timeout: 600000
# only turn off heaters and motors if the printer is not paused
#gcode:
 #   {% if not printer.pause_resume.is_paused %}
   #     TURN_OFF_HEATERS
  #      M84
   # {% endif %}

[pause_resume]
recover_velocity: 350

[save_variables]
filename:vars.cfg

[virtual_sdcard]
path: /home/pi/printer_data/gcodes
on_error_gcode: CANCEL_PRINT

[mcu]
#USB
serial: /dev/serial/by-id/usb-Klipper_stm32h723xx_0F003B001751313338343730-if00
#reconnect_interval: 9999




# Driver6
[extruder]
nozzle_diameter: 0.500
pressure_advance: 0.025
pressure_advance_smooth_time: 0.03
max_extrude_only_distance: 101

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	-0.982835, -0.137159, -0.054639, -0.040486, -0.074847, 0.015903, 0.097041, 0.024053, 0.004039, -0.003330, 0.000336, 0.003727, 0.002964, -0.001654, -0.007315, -0.011697, -0.090530, -0.016090, -0.018225, -0.095390, -0.017576, 0.061843, -0.003443, 0.003184, 0.085567
#*# 	-1.239371, -0.108081, -0.077417, -0.052161, -0.012884, -0.041857, 0.053134, 0.030210, -0.071900, -0.018286, 0.050615, -0.016243, -0.014396, 0.050318, -0.018542, -0.086574, 0.036200, -0.030444, -0.098371, 0.032298, 0.036741, -0.094566, -0.009210, 0.072740, -0.075805
#*# 	-1.045316, -0.086676, -0.050640, 0.040451, 0.037296, 0.088246, 0.156862, 0.064646, -0.035770, 0.054850, -0.003242, -0.053779, 0.011664, 0.072866, -0.064124, -0.075377, 0.065745, -0.086047, -0.084103, 0.057725, -0.012112, -0.073224, 0.015788, 0.021769, -0.057173
#*# 	-1.131888, -0.048700, -0.079747, -0.036629, 0.024444, 0.135828, 0.069063, 0.034738, 0.055665, -0.088312, 0.039778, -0.015588, -0.007646, -0.006610, 0.045010, -0.074487, -0.025021, -0.027063, -0.084140, -0.030855, -0.031283, -0.020823, 0.001884, -0.058619, 0.002527
#*# 	-1.000615, -0.114620, 0.034097, -0.044191, 0.067289, 0.101654, 0.028656, 0.056957, 0.024742, 0.014853, 0.018998, 0.086480, 0.040435, 0.040683, 0.093600, -0.034129, 0.089986, 0.019505, -0.054457, 0.079396, -0.056588, 0.018254, 0.100519, -0.023374, 0.100746
#*# 	-1.038580, -0.091644, -0.062851, -0.100250, 0.008188, 0.033512, 0.025566, 0.001475, -0.014055, -0.015552, -0.006116, 0.007417, 0.086461, 0.018511, 0.011408, 0.005717, -0.001230, -0.006099, -0.011539, -0.013092, -0.014599, 0.056661, -0.002628, 0.002227, 0.007746
#*# 	-0.891706, -0.033574, -0.011006, 0.004508, 0.027069, 0.042004, 0.038297, 0.028393, 0.023238, -0.005229, 0.071094, 0.050266, 0.064420, 0.096682, 0.020476, 0.082977, 0.041852, -0.008096, 0.071849, -0.022738, 0.068425, 0.020567, -0.015596, 0.069534, 0.034707
#*# 	-0.950873, -0.003586, -0.037519, -0.024167, 0.030648, -0.000526, 0.001213, 0.002159, 0.004436, 0.011141, 0.021699, 0.032533, 0.082905, 0.043315, 0.032610, 0.028547, 0.057988, -0.020979, 0.043205, -0.030566, 0.003629, 0.042383, -0.038732, 0.008368, 0.019462
#*# 	-0.780677, 0.020473, 0.036570, 0.029812, 0.040727, 0.045078, 0.049518, 0.050449, 0.057239, 0.078003, 0.085763, 0.085951, 0.097851, 0.094121, 0.082878, 0.072945, 0.066392, 0.059067, 0.052341, 0.050460, 0.047748, 0.043345, 0.046258, 0.057764, 0.050083
#*# 	-0.786153, 0.017328, 0.036386, 0.042119, 0.043304, 0.042989, 0.041303, 0.055965, 0.061362, 0.068608, 0.075731, 0.098860, 0.103438, 0.092171, 0.104914, 0.076845, 0.057387, 0.059270, 0.065308, 0.039244, 0.035890, 0.050917, 0.039480, 0.049170, 0.055825
#*# 	-0.748776, 0.046669, 0.066612, 0.068667, 0.066197, 0.062675, 0.064883, 0.071268, 0.077528, 0.083914, 0.090422, 0.103145, 0.127033, 0.130774, 0.114902, 0.094553, 0.078513, 0.069997, 0.061144, 0.057383, 0.055443, 0.051374, 0.053240, 0.062902, 0.057649
#*# 	-0.725847, 0.048230, 0.068472, 0.035706, 0.065742, 0.097925, 0.066859, 0.033153, 0.126142, 0.085034, 0.046403, 0.107738, 0.174392, 0.089849, 0.118128, 0.144399, 0.081386, 0.024937, 0.100624, 0.089157, 0.002449, 0.073738, 0.073415, 0.026843, 0.037025
#*# 	-0.596974, 0.064654, 0.089830, 0.089610, 0.079845, 0.076011, 0.079549, 0.085587, 0.089812, 0.089013, 0.089806, 0.121872, 0.134412, 0.121547, 0.118681, 0.118621, 0.079290, 0.070759, 0.080135, 0.057526, 0.038198, 0.043139, 0.043500, 0.041666, 0.027820
#*# 	-0.634419, 0.083967, 0.060290, 0.090341, 0.125830, 0.065241, 0.072752, 0.139456, 0.075234, 0.013669, 0.143302, 0.094762, 0.050972, 0.112217, 0.157100, 0.031407, 0.087992, 0.139656, 0.065601, -0.008046, 0.073001, 0.054316, -0.034753, 0.051259, 0.054127
#*# 	-0.599504, 0.104309, 0.115157, 0.108884, 0.096768, 0.088210, 0.094568, 0.095473, 0.088939, 0.071595, 0.091389, 0.118607, 0.111713, 0.109762, 0.122672, 0.104497, 0.096571, 0.136775, 0.097595, 0.052304, 0.045193, 0.036444, 0.013890, 0.006311, 0.022177
#*# 	-0.531762, 0.180570, 0.107907, 0.098296, 0.182402, 0.043704, 0.109701, 0.166197, 0.085626, 0.082872, 0.014158, 0.087921, 0.092614, 0.021141, 0.148019, 0.154950, 0.046717, 0.119428, 0.092384, -0.005235, 0.023043, -0.001413, 0.044095, -0.008588, -0.005252
#*# 	-0.535238, 0.136612, 0.147841, 0.143960, 0.101322, 0.106279, 0.125895, 0.067214, 0.087760, 0.080617, 0.076726, 0.073254, 0.072396, 0.095515, 0.057912, 0.041382, 0.105250, 0.071368, 0.072854, 0.055517, 0.006908, -0.010023, -0.041942, -0.002253, -0.071867
#*# 	-0.500585, 0.099095, 0.181000, 0.082617, 0.163741, 0.103794, 0.038957, 0.154699, -0.012873, 0.144061, -0.044792, 0.128819, 0.123633, -0.052939, 0.091673, -0.057031, 0.090680, -0.045517, 0.069107, -0.025879, -0.047669, -0.059153, -0.070730, -0.071992, -0.062689
#*# 	-0.454562, 0.119573, 0.135831, 0.106776, 0.119184, 0.078005, 0.108201, 0.077728, 0.039559, 0.093860, 0.020674, 0.083359, 0.039976, -0.012194, 0.043659, -0.038181, 0.028694, -0.010723, -0.060551, -0.010040, -0.088632, -0.039229, -0.202008, -0.115521, -0.020899
#*# 	-0.357513, 0.141756, 0.147247, 0.156566, 0.104259, 0.111515, 0.129026, 0.071934, 0.090241, 0.081088, 0.066576, 0.050213, 0.041561, 0.085754, -0.064183, -0.072977, 0.022553, -0.038033, -0.051746, -0.065955, -0.120646, -0.037649, -0.183866, -0.030313, -0.110126
#*# 	-0.424656, 0.132344, 0.142339, 0.146064, 0.139815, 0.096723, 0.090878, 0.101419, 0.081207, 0.072145, 0.062892, 0.043660, 0.025893, -0.041957, -0.019424, 0.015967, -0.098294, -0.019028, -0.032289, -0.129047, -0.050772, -0.104724, -0.228996, -0.149486, -0.138501
#*# 	-0.271680, 0.166491, 0.128982, 0.197129, 0.182947, 0.075283, 0.112777, 0.107003, 0.107119, 0.108299, 0.106167, 0.090075, 0.075028, -0.013256, 0.092191, 0.079791, -0.068864, 0.032523, 0.008626, -0.136704, -0.080306, -0.026641, -0.219918, -0.120640, -0.138561
#*# 	-0.450697, 0.104705, 0.149169, 0.181864, 0.130457, 0.104817, 0.087407, -0.013626, 0.011758, 0.052766, -0.001270, -0.014488, 0.032368, -0.046283, -0.063449, -0.075143, -0.089998, -0.021831, -0.124727, -0.138364, -0.052579, -0.158243, -0.171143, -0.060241, -0.180792
#*# 	-0.282308, 0.175816, 0.230910, 0.267068, 0.251862, 0.184902, 0.167737, 0.073023, 0.055216, 0.107803, 0.046139, -0.022997, 0.035581, 0.018906, -0.064073, -0.009037, 0.036867, -0.117850, -0.138846, -0.018728, -0.176096, -0.208786, -0.037655, -0.159088, -0.270713
#*# 	-0.299856, 0.184575, 0.240065, 0.282076, 0.271762, 0.203225, 0.129220, 0.076950, 0.054487, 0.044933, 0.006561, 0.030747, 0.024056, 0.010047, -0.001460, 0.026736, -0.030746, -0.049248, -0.073392, -0.092901, -0.094679, -0.107391, -0.113478, -0.200285, -0.149454
#*# x_count = 25
#*# y_count = 25
#*# mesh_x_pps = 3
#*# mesh_y_pps = 3
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 10.0
#*# max_x = 310.0
#*# min_y = 22.0
#*# max_y = 260.0
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 28.181
#*# pid_ki = 2.646
#*# pid_kd = 75.031
#*#
#*# [scanner model default]
#*# model_coef = 1.3505960046552101,
#*# 	1.658910122764384,
#*# 	0.7516938974793562,
#*# 	0.2036346849536123,
#*# 	0.2122579970113,
#*# 	1.3316006329889167,
#*# 	0.27018147007678495,
#*# 	-1.98049913828422,
#*# 	-0.03779621816778336,
#*# 	1.2393316401956045
#*# model_domain = 3.1161929854002e-07,3.361234641791671e-07
#*# model_range = 0.100000,5.000000
#*# model_temp = 27.148663
#*# model_offset = 0.151
